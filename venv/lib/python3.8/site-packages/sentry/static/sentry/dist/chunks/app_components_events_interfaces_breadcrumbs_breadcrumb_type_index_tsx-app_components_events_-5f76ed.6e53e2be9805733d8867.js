"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_interfaces_breadcrumbs_breadcrumb_type_index_tsx-app_components_events_-5f76ed"],{"./app/components/events/interfaces/breadcrumbs/breadcrumb/type/icon.tsx":(e,t,n)=>{n.d(t,{Z:()=>a});var r=n("./app/icons/index.tsx"),s=n("./app/types/breadcrumbs.tsx"),i=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=function(e){let{type:t}=e;switch(t){case s.kS.USER:case s.kS.UI:return(0,i.tZ)(r.qO,{size:"xs"});case s.kS.NAVIGATION:return(0,i.tZ)(r.tM,{size:"xs"});case s.kS.DEBUG:return(0,i.tZ)(r.w6,{size:"xs"});case s.kS.INFO:return(0,i.tZ)(r.aU,{size:"xs"});case s.kS.ERROR:return(0,i.tZ)(r.zC,{size:"xs"});case s.kS.HTTP:return(0,i.tZ)(r.Mr,{size:"xs",rotated:!0});case s.kS.WARNING:return(0,i.tZ)(r.FC,{size:"xs"});case s.kS.QUERY:return(0,i.tZ)(r.bv,{size:"xs"});case s.kS.SYSTEM:return(0,i.tZ)(r.yC,{size:"xs"});case s.kS.SESSION:return(0,i.tZ)(r.tr,{size:"xs"});case s.kS.TRANSACTION:return(0,i.tZ)(r.CR,{size:"xs"});default:return(0,i.tZ)(r.Ch,{size:"xs"})}}},"./app/components/events/interfaces/breadcrumbs/breadcrumb/type/index.tsx":(e,t,n)=>{n.d(t,{Z:()=>d});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("./app/components/tooltip.tsx"),i=n("./app/components/events/interfaces/breadcrumbs/breadcrumb/type/icon.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{type:t,color:n,description:r,error:o}=e;return(0,a.tZ)(p,{error:o,children:(0,a.tZ)(s.Z,{title:r,disabled:!r,skipWrapper:!0,disableForVisualTest:!0,children:(0,a.tZ)(l,{color:n,children:(0,a.tZ)(i.Z,{type:t})})})})}o.displayName="Type";const d=o,p=(0,r.Z)("div",{target:"e14ruzvs1"})("display:flex;justify-content:center;position:relative;:before{content:'';display:block;width:1px;top:0;bottom:0;left:50%;transform:translate(-50%);position:absolute;background:",(e=>e.error?e.theme.red300:e.theme.innerBorder),";}"),l=(0,r.Z)("div",{target:"e14ruzvs0"})("display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;color:",(e=>e.theme.white),";background:",(e=>{var t;return null!==(t=e.theme[e.color])&&void 0!==t?t:e.color}),";box-shadow:",(e=>e.theme.dropShadowLightest),";position:relative;")},"./app/components/events/interfaces/breadcrumbs/utils.tsx":(e,t,n)=>{n.d(t,{LP:()=>o,vf:()=>p}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("./app/locale.tsx"),s=n("./app/types/breadcrumbs.tsx"),i=n("./app/types/event.tsx"),a=n("./app/utils.tsx");function o(e){return e.map(((e,t)=>{var n;const i=function(e){if(e.type===s.kS.EXCEPTION)return{...e,type:s.kS.ERROR};if(e.type===s.kS.DEFAULT&&(0,a.ri)(null==e?void 0:e.category)){const[t,n]=e.category.split(".");if("ui"===t)return{...e,type:s.kS.UI};if("console"===t)return{...e,type:s.kS.DEBUG};if("navigation"===t)return{...e,type:s.kS.NAVIGATION};if("sentry"===t&&("transaction"===n||"event"===n))return{...e,type:s.kS.TRANSACTION}}return Object.values(s.kS).includes(e.type)?e:{...e,type:s.kS.DEFAULT}}(e),{color:o,description:d}=function(e){switch(e){case s.kS.USER:case s.kS.UI:return{color:"purple300",description:(0,r.t)("User Action")};case s.kS.NAVIGATION:return{color:"green300",description:(0,r.t)("Navigation")};case s.kS.DEBUG:return{color:"purple300",description:(0,r.t)("Debug")};case s.kS.INFO:return{color:"blue300",description:(0,r.t)("Info")};case s.kS.ERROR:return{color:"red300",description:(0,r.t)("Error")};case s.kS.HTTP:return{color:"green300",description:(0,r.t)("HTTP request")};case s.kS.WARNING:return{color:"yellow300",description:(0,r.t)("Warning")};case s.kS.QUERY:return{color:"blue300",description:(0,r.t)("Query")};case s.kS.SYSTEM:return{color:"pink300",description:(0,r.t)("System")};case s.kS.SESSION:return{color:"pink300",description:(0,r.t)("Session")};case s.kS.TRANSACTION:return{color:"pink300",description:(0,r.t)("Transaction")};default:return{color:"gray300",description:(0,r.t)("Default")}}}(i.type);return{...i,id:t,color:o,description:d,level:null!==(n=i.level)&&void 0!==n?n:s.nU.UNDEFINED}}))}function d(e){if(!e)return;const t=e.match(/^.*\/(.*?)(:\d+)/);return t?t[1]:e.split(/./)[0]}function p(e){const t=e.entries.find((e=>e.type===i.UZ.EXCEPTION));if(!t&&!e.message)return;const n=e.dateCreated;if(t){const{type:e,value:r,module:i}=t.data.values[0];return{type:s.kS.ERROR,level:s.nU.ERROR,category:d(i)||"exception",data:{type:e,value:r},timestamp:n}}const r=(e.tags||[]).find((e=>"level"===e.key));return{type:s.kS.INFO,level:(null==r?void 0:r.value)||s.nU.UNDEFINED,category:"message",message:e.message,timestamp:n}}},"./app/components/events/interfaces/spans/index.tsx":(e,t,n)=>{n.d(t,{Z:()=>tt});var r=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-router/es/index.js"),o=n("../node_modules/mobx-react-lite/es/index.js"),d=n("./app/components/alert.tsx"),p=n("./app/components/assistant/guideAnchor.tsx"),l=n("./app/components/list/index.tsx"),c=n("./app/components/list/listItem.tsx"),h=n("./app/components/panels/index.tsx"),u=n("./app/components/searchBar.tsx"),g=n("./app/locale.tsx"),m=n("./app/styles/space.tsx"),S=n("./app/utils.tsx"),f=n("./app/utils/performance/quickTrace/quickTraceContext.tsx"),v=n("./app/utils/withOrganization.tsx"),w=n("./app/components/events/interfaces/spans/anchorLinkManager.tsx"),b=n("./app/components/checkboxFancy/checkboxFancy.tsx"),T=n("./app/components/dropdownButton.tsx"),y=n("./app/components/dropdownControl.tsx"),Z=n("./app/components/performance/waterfall/utils.tsx"),E=n("./app/icons/index.tsx"),x=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const D={type:"no_filter"};function C(e){let{operationNameCounts:t,operationNameFilter:n,toggleOperationNameFilter:r,toggleAllOperationNameFilters:s}=e;if(0===t.size)return null;const a="no_filter"===n.type?0:n.operationNames.size,o={children:(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(E.wH,{}),(0,x.tZ)(N,{children:(0,g.t)("Filter")})]}),priority:"default",hasDarkBorderBottomColor:!1};return a>0&&(o.children=(0,x.tZ)("span",{children:(0,g.tn)("%s Active Filter","%s Active Filters",a)}),o.priority="primary",o.hasDarkBorderBottomColor=!0),(0,x.tZ)(B,{"data-test-id":"op-filter-dropdown",children:(0,x.tZ)(y.ZP,{menuWidth:"240px",blendWithActor:!0,button:e=>{let{isOpen:t,getActorProps:n}=e;return(0,x.tZ)(O,{...n(),showChevron:!1,isOpen:t,hasDarkBorderBottomColor:o.hasDarkBorderBottomColor,priority:o.priority,"data-test-id":"filter-button",children:o.children})},children:(0,x.BX)(R,{onClick:e=>{e.stopPropagation()},children:[(0,x.BX)(I,{children:[(0,x.tZ)("span",{children:(0,g.t)("Operation")}),(0,x.tZ)(b.Z,{isChecked:a>0,isIndeterminate:a>0&&a!==t.size,onClick:e=>{e.stopPropagation(),s()}})]}),(0,x.tZ)(_,{children:Array.from(t,(e=>{let[t,s]=e;const i="no_filter"!==n.type&&n.operationNames.has(t);return(0,x.BX)(k,{isChecked:i,children:[(0,x.tZ)(G,{backgroundColor:(0,Z.hd)(t)}),(0,x.tZ)(L,{children:t}),(0,x.tZ)(A,{children:s}),(0,x.tZ)(b.Z,{isChecked:i,onClick:e=>{e.stopPropagation(),r(t)}})]},t)}))})]})})})}C.displayName="Filter";const N=(0,s.Z)("span",{target:"e129lwwl9"})("margin-left:",(0,m.Z)(1),";"),B=(0,s.Z)("div",{target:"e129lwwl8"})("position:relative;display:flex;margin-right:",(0,m.Z)(1),";"),O=(0,s.Z)(T.Z,{target:"e129lwwl7"})("white-space:nowrap;max-width:200px;&:hover,&:active{",(e=>!e.isOpen&&e.hasDarkBorderBottomColor&&`\n          border-bottom-color: ${e.theme.button.primary.border};\n        `),";}",(e=>!e.isOpen&&e.hasDarkBorderBottomColor&&`\n      border-bottom-color: ${e.theme.button.primary.border};\n    `),";"),R=(0,s.Z)("div",{target:"e129lwwl6"})("max-height:250px;overflow-y:auto;border-top:1px solid ",(e=>e.theme.gray200),";"),I=(0,s.Z)("div",{target:"e129lwwl5"})("display:grid;grid-template-columns:auto min-content;grid-column-gap:",(0,m.Z)(1),";align-items:center;margin:0;background-color:",(e=>e.theme.backgroundSecondary),";color:",(e=>e.theme.gray300),";font-weight:normal;font-size:",(e=>e.theme.fontSizeMedium),";padding:",(0,m.Z)(1)," ",(0,m.Z)(2),";border-bottom:1px solid ",(e=>e.theme.border),";"),_=(0,s.Z)("ul",{target:"e129lwwl4"})({name:"z06qs",styles:"list-style:none;margin:0;padding:0"}),k=(0,s.Z)("li",{target:"e129lwwl3"})("display:grid;grid-template-columns:max-content 1fr max-content max-content;grid-column-gap:",(0,m.Z)(1),";align-items:center;padding:",(0,m.Z)(1)," ",(0,m.Z)(2),";border-bottom:1px solid ",(e=>e.theme.border),";:hover{background-color:",(e=>e.theme.backgroundSecondary),";}",b.Z,"{opacity:",(e=>e.isChecked?1:.3),";}&:hover ",b.Z,"{opacity:1;}&:hover span{color:",(e=>e.theme.blue300),";text-decoration:underline;}"),G=(0,s.Z)("div",{target:"e129lwwl2"})("content:'';display:block;width:8px;min-width:8px;height:8px;margin-right:",(0,m.Z)(1),";border-radius:100%;background-color:",(e=>e.backgroundColor),";"),L=(0,s.Z)("div",{target:"e129lwwl1"})("font-size:",(e=>e.theme.fontSizeMedium),";",(e=>e.theme.overflowEllipsis),";"),A=(0,s.Z)("div",{target:"e129lwwl0"})("font-size:",(e=>e.theme.fontSizeMedium),";"),M=C;var V=n("./app/components/emptyStateWarning.tsx"),F=n("./app/utils/performanceForSentry.tsx"),P=n("./app/components/events/interfaces/spans/cursorGuideHandler.tsx"),z=n("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),W=(n("../node_modules/core-js/modules/es.error.cause.js"),n("./app/utils/userselect.tsx"));const j=.005;var H;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(H||(H={}));class $ extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isDragging:!1,currentDraggingHandle:void 0,leftHandlePosition:0,rightHandlePosition:1,isWindowSelectionDragging:!1,windowSelectionInitial:0,windowSelectionCurrent:0,windowSelectionSize:0,viewWindowStart:0,viewWindowEnd:1}),(0,r.Z)(this,"previousUserSelect",null),(0,r.Z)(this,"hasInteractiveLayer",(()=>!!this.props.interactiveLayerRef.current)),(0,r.Z)(this,"onDragStart",(e=>t=>{!this.state.isDragging&&!this.state.isWindowSelectionDragging&&"mousedown"===t.type&&this.hasInteractiveLayer()&&(F.WZ.startInteraction("SpanTreeHandleDrag"),this.previousUserSelect=(0,W.l)({userSelect:"none",MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}),window.addEventListener("mousemove",this.onDragMove),window.addEventListener("mouseup",this.onDragEnd),this.setState({isDragging:!0,isWindowSelectionDragging:!1,currentDraggingHandle:e}))})),(0,r.Z)(this,"onLeftHandleDragStart",(e=>{this.onDragStart(H.Left)(e)})),(0,r.Z)(this,"onRightHandleDragStart",(e=>{this.onDragStart(H.Right)(e)})),(0,r.Z)(this,"onDragMove",(e=>{if(!this.state.isDragging||"mousemove"!==e.type||!this.hasInteractiveLayer())return;const t=(0,Z.FV)(this.props.interactiveLayerRef.current),n=(e.pageX-t.x)/t.width;switch(this.state.currentDraggingHandle){case H.Left:{const e=0,t=this.state.rightHandlePosition-j;this.setState({leftHandlePosition:(0,Z.uZ)(n,e,t)});break}case H.Right:{const e=this.state.leftHandlePosition+j,t=1;this.setState({rightHandlePosition:(0,Z.uZ)(n,e,t)});break}default:throw Error("this.state.currentDraggingHandle is undefined")}})),(0,r.Z)(this,"onDragEnd",(e=>{if(this.state.isDragging&&"mouseup"===e.type&&this.hasInteractiveLayer())switch(F.WZ.finishInteraction(),this.cleanUpListeners(),this.previousUserSelect&&((0,W.l)(this.previousUserSelect),this.previousUserSelect=null),this.state.currentDraggingHandle){case H.Left:return void this.setState((e=>({isDragging:!1,currentDraggingHandle:void 0,viewWindowStart:e.leftHandlePosition})));case H.Right:return void this.setState((e=>({isDragging:!1,currentDraggingHandle:void 0,viewWindowEnd:e.rightHandlePosition})));default:throw Error("this.state.currentDraggingHandle is undefined")}})),(0,r.Z)(this,"onWindowSelectionDragStart",(e=>{if(this.state.isDragging||this.state.isWindowSelectionDragging||"mousedown"!==e.type||!this.hasInteractiveLayer())return;F.WZ.startInteraction("SpanTreeWindowDrag"),this.previousUserSelect=(0,W.l)({userSelect:"none",MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}),window.addEventListener("mousemove",this.onWindowSelectionDragMove),window.addEventListener("mouseup",this.onWindowSelectionDragEnd);const t=(0,Z.FV)(this.props.interactiveLayerRef.current),n=(e.pageX-t.x)/t.width;this.setState({isDragging:!1,isWindowSelectionDragging:!0,windowSelectionInitial:n,windowSelectionCurrent:n})})),(0,r.Z)(this,"onWindowSelectionDragMove",(e=>{if(!this.state.isWindowSelectionDragging||"mousemove"!==e.type||!this.hasInteractiveLayer())return;const t=(0,Z.FV)(this.props.interactiveLayerRef.current),n=(e.pageX-t.x)/t.width,r=(0,Z.uZ)(n,0,1),s=(0,Z.uZ)(Math.abs(this.state.windowSelectionInitial-r),0,1);this.setState({windowSelectionCurrent:r,windowSelectionSize:s})})),(0,r.Z)(this,"onWindowSelectionDragEnd",(e=>{this.state.isWindowSelectionDragging&&"mouseup"===e.type&&this.hasInteractiveLayer()&&(F.WZ.finishInteraction(),this.cleanUpListeners(),this.previousUserSelect&&((0,W.l)(this.previousUserSelect),this.previousUserSelect=null),this.setState((e=>{let t=Math.min(e.windowSelectionInitial,e.windowSelectionCurrent),n=Math.max(e.windowSelectionInitial,e.windowSelectionCurrent);return n-t<j&&(n=t+j,n>1&&(n=1,t=.995)),{isWindowSelectionDragging:!1,windowSelectionInitial:0,windowSelectionCurrent:0,windowSelectionSize:0,leftHandlePosition:t,rightHandlePosition:n,viewWindowStart:t,viewWindowEnd:n}})))})),(0,r.Z)(this,"cleanUpListeners",(()=>{this.state.isDragging&&(window.removeEventListener("mousemove",this.onDragMove),window.removeEventListener("mouseup",this.onDragEnd)),this.state.isWindowSelectionDragging&&(window.removeEventListener("mousemove",this.onWindowSelectionDragMove),window.removeEventListener("mouseup",this.onWindowSelectionDragEnd))}))}componentWillUnmount(){this.cleanUpListeners()}render(){const e={isDragging:this.state.isDragging,onLeftHandleDragStart:this.onLeftHandleDragStart,leftHandlePosition:this.state.leftHandlePosition,onRightHandleDragStart:this.onRightHandleDragStart,rightHandlePosition:this.state.rightHandlePosition,isWindowSelectionDragging:this.state.isWindowSelectionDragging,windowSelectionInitial:this.state.windowSelectionInitial,windowSelectionCurrent:this.state.windowSelectionCurrent,windowSelectionSize:this.state.windowSelectionSize,onWindowSelectionDragStart:this.onWindowSelectionDragStart,viewWindowStart:this.state.viewWindowStart,viewWindowEnd:this.state.viewWindowEnd};return this.props.children(e)}}$.displayName="DragManager";const U=$;var X=n("./app/components/events/interfaces/spans/header.tsx"),q=n("./app/components/events/interfaces/spans/scrollbarManager.tsx"),Q=n("../node_modules/lodash/isEqual.js"),Y=n.n(Q),K=n("./app/components/performance/waterfall/messageRow.tsx"),J=(n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/intersection-observer/intersection-observer.js"),n("./app/components/count.tsx")),ee=n("./app/components/performance/waterfall/constants.tsx"),te=n("./app/components/performance/waterfall/row.tsx"),ne=n("./app/components/performance/waterfall/rowBar.tsx"),re=n("./app/components/performance/waterfall/rowDivider.tsx"),se=n("./app/components/performance/waterfall/rowTitle.tsx"),ie=n("./app/components/performance/waterfall/treeConnector.tsx"),ae=n("./app/components/tooltip.tsx"),oe=n("./app/utils/analytics.tsx"),de=n("./app/utils/discover/urls.tsx"),pe=n("./app/utils/performance/quickTrace/utils.tsx"),le=n("./app/components/events/interfaces/spans/constants.tsx");function ce(){return(0,x.tZ)(P.$,{children:e=>{let{showCursorGuide:t,traceViewMouseLeft:n}=e;return t&&n?(0,x.tZ)(he,{style:{left:(0,Z.yI)(n)}}):null}})}ce.displayName="SpanBarCursorGuide";const he=(0,s.Z)("div",{target:"e1ev4mhs0"})("position:absolute;top:0;width:1px;background-color:",(e=>e.theme.red300),";transform:translateX(-50%);height:100%;"),ue=ce;var ge=n("./app/components/events/interfaces/spans/spanDetail.tsx");const me=(0,s.Z)("div",{target:"e1qyxl2h0"})("position:absolute;top:0;height:",ee.d,"px;user-select:none;width:1px;background:repeating-linear-gradient(\n      to bottom,\n      transparent 0 4px,\n      ",(e=>e.failedThreshold?e.theme.red300:e.theme.textColor)," 4px 8px\n    ) 80%/2px 100% no-repeat;z-index:",(e=>e.theme.zIndex.traceView.dividerLine),";color:",(e=>e.theme.textColor),";");var Se=n("./app/components/events/interfaces/spans/types.tsx"),fe=n("./app/components/events/interfaces/spans/utils.tsx");const ve=[0,.01,.02,.03,.04,.05,.06,.07,.08,.09,.1,.11,.12,.13,.14,.15,.16,.17,.18,.19,.2,.21,.22,.23,.24,.25,.26,.27,.28,.29,.3,.31,.32,.33,.34,.35,.36,.37,.38,.39,.4,.41,.42,.43,.44,.45,.46,.47,.48,.49,.5,.51,.52,.53,.54,.55,.56,.57,.58,.59,.6,.61,.62,.63,.64,.65,.66,.67,.68,.69,.7,.71,.72,.73,.74,.75,.76,.77,.78,.79,.8,.81,.82,.83,.84,.85,.86,.87,.88,.89,.9,.91,.92,.93,.94,.95,.96,.97,.98,.99,1];class we extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{showDetail:!1}),(0,r.Z)(this,"spanRowDOMRef",(0,i.createRef)()),(0,r.Z)(this,"spanTitleRef",(0,i.createRef)()),(0,r.Z)(this,"intersectionObserver",void 0),(0,r.Z)(this,"zoomLevel",1),(0,r.Z)(this,"_mounted",!1),(0,r.Z)(this,"handleWheel",(e=>{if(Math.abs(e.deltaY)>Math.abs(e.deltaX))return;if(e.preventDefault(),e.stopPropagation(),Math.abs(e.deltaY)===Math.abs(e.deltaX))return;const{onWheel:t}=this.props;t(e.deltaX)})),(0,r.Z)(this,"toggleDisplayDetail",(()=>{this.setState((e=>({showDetail:!e.showDetail})))})),(0,r.Z)(this,"scrollIntoView",(()=>{const e=this.spanRowDOMRef.current;if(!e)return;const t=e.getBoundingClientRect().top+window.scrollY-le.ZR-1;this.setState({showDetail:!0},(()=>window.scrollTo(0,t)))}))}componentDidMount(){this._mounted=!0,this.spanRowDOMRef.current&&(this.props.storeSpanBar(this),this.connectObservers()),this.spanTitleRef.current&&this.spanTitleRef.current.addEventListener("wheel",this.handleWheel,{passive:!1})}componentWillUnmount(){this._mounted=!1,this.disconnectObservers(),this.spanTitleRef.current&&this.spanTitleRef.current.removeEventListener("wheel",this.handleWheel);const{span:e}=this.props;"type"in e||this.props.markSpanOutOfView(e.span_id)}renderDetail(e){let{isVisible:t,transactions:n,errors:r}=e;const{span:s,organization:i,isRoot:a,trace:o,event:d}=this.props;return(0,x.tZ)(w.$,{children:e=>{let{registerScrollFn:p,scrollToHash:l}=e;return(0,fe.hw)(s)||p((0,fe.ct)(s.span_id),this.scrollIntoView,!1),this.state.showDetail&&t?(0,x.tZ)(ge.ZP,{span:s,organization:i,event:d,isRoot:!!a,trace:o,childTransactions:n,relatedErrors:r,scrollToHash:l}):null}})}getBounds(){const{event:e,span:t,generateBounds:n}=this.props,r=n({startTimestamp:t.start_timestamp,endTimestamp:t.timestamp}),s=(0,fe.PC)(e);switch(r.type){case"TRACE_TIMESTAMPS_EQUAL":return{warning:(0,g.t)("Trace times are equal"),left:void 0,width:void 0,isSpanVisibleInView:r.isSpanVisibleInView};case"INVALID_VIEW_WINDOW":return{warning:(0,g.t)("Invalid view window"),left:void 0,width:void 0,isSpanVisibleInView:r.isSpanVisibleInView};case"TIMESTAMPS_EQUAL":return{warning:s&&"op"in t&&t.op&&fe.o0.includes(t.op)?void 0:(0,g.t)("Equal start and end times"),left:r.start,width:1e-5,isSpanVisibleInView:r.isSpanVisibleInView};case"TIMESTAMPS_REVERSED":return{warning:(0,g.t)("Reversed start and end times"),left:r.start,width:r.end-r.start,isSpanVisibleInView:r.isSpanVisibleInView};case"TIMESTAMPS_STABLE":return{warning:void 0,left:r.start,width:r.end-r.start,isSpanVisibleInView:r.isSpanVisibleInView};default:return r}}renderMeasurements(){const{event:e,generateBounds:t}=this.props;if(this.state.showDetail)return null;const n=(0,fe.is)(e,t);return(0,x.tZ)(i.Fragment,{children:Array.from(n.values()).map((e=>{const n=Object.values(e.marks)[0],{timestamp:r}=n,s=(0,fe.vu)(r,t);return(0,S.ri)(s.left)&&(0,S.ri)(s.width)&&s.isSpanVisibleInView?(0,x.tZ)(me,{style:{left:`clamp(0%, ${(0,Z.yI)(s.left||0)}, calc(100% - 1px))`},failedThreshold:e.failedThreshold},String(r)):null}))})}renderSpanTreeConnector(e){let{hasToggler:t}=e;const{isLast:n,isRoot:r,treeDepth:s,continuingTreeDepths:i,span:a,showSpanTree:o}=this.props,d=(0,fe.Rr)(a);if(r)return t?(0,x.tZ)(ie.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1},`${d}-last`):null;const p=i.map((e=>{const t=(0,fe.h_)(e);if(0===t)return null;const n=-1*((s-t)*(ie.Ll/2)+2);return(0,x.tZ)(ie.UV,{style:{left:n},orphanBranch:(0,fe.yn)(e)},`${d}-${t}`)}));return t&&o&&p.push((0,x.tZ)(ie.UV,{style:{right:"15px",height:ee.d/2+"px",bottom:n?`-${ee.d/2+2}px`:"0",top:"auto"},orphanBranch:!1},`${d}-last-bottom`)),(0,x.tZ)(ie.DN,{isLast:n,hasToggler:t,orphanBranch:(0,fe.ro)(a),children:p})}renderSpanTreeToggler(e){let{left:t,errored:n}=e;const{numOfSpanChildren:r,isRoot:s,showSpanTree:i}=this.props,a=(0,x.tZ)(ie.jd,{direction:i?"up":"down"});if(r<=0)return(0,x.tZ)(ie.rw,{style:{left:`${t}px`},children:this.renderSpanTreeConnector({hasToggler:!1})});const o=s?null:(0,x.tZ)("div",{children:a});return(0,x.BX)(ie.rw,{style:{left:`${t}px`},hasToggler:!0,children:[this.renderSpanTreeConnector({hasToggler:!0}),(0,x.BX)(ie.U1,{disabled:!!s,isExpanded:i,errored:n,onClick:e=>{e.stopPropagation(),s||this.props.toggleSpanTree()},children:[(0,x.tZ)(J.Z,{value:r}),o]})]})}renderTitle(e){var t;const{generateContentSpanBarRef:n}=this.props,{span:r,treeDepth:s,groupOccurrence:i,toggleSpanGroup:a,toggleSiblingSpanGroup:o,groupType:d}=this.props;let p=[];"function"!=typeof a&&"function"!=typeof o||p.push((0,x.tZ)(Te,{onClick:e=>{e.stopPropagation(),e.preventDefault(),d===Se.YT.SIBLINGS&&"op"in r?null==o||o(r,null!=i?i:0):a&&a()},children:(0,x.tZ)("a",{href:"#regroup",onClick:e=>{e.preventDefault()},children:(0,g.t)("Regroup")})}));const l=(0,fe.yk)(r);l&&p.push(l),p=p.flatMap((e=>[e," — "]));const c=null!==(t=null==r?void 0:r.description)&&void 0!==t?t:(0,fe.Rr)(r),h=s*(ie.Ll/2)+0,u=Boolean(e&&e.length>0);return(0,x.BX)(se.mw,{"data-debug-id":"SpanBarTitleContainer",ref:n(),children:[this.renderSpanTreeToggler({left:h,errored:u}),(0,x.tZ)(se.Wh,{style:{left:`${h}px`,width:"100%"},children:(0,x.BX)(se.rv,{errored:u,children:[(0,x.tZ)("strong",{children:p}),c]})})]})}connectObservers(){this.spanRowDOMRef.current&&(this.disconnectObservers(),this.intersectionObserver=new IntersectionObserver((e=>e.forEach((e=>{if(!this._mounted)return;if(!(this.props.numOfSpans>le.bl))return;const t=this.props.spanNumber,n=document.getElementById("minimap-background-slider");if(!n)return;if(e.rootBounds){const t=Math.ceil(e.rootBounds.top);if(t!==le.ZR&&t>0){const e=t/this.zoomLevel,n=le.ZR/e;this.zoomLevel=n,this.connectObservers()}}const r=e.boundingClientRect,s=r.y+r.height;if(r.y<0&&s<0)return;const i=r.y-le.ZR,a=s-le.ZR;if(i>0&&a>0){const{span:r,treeDepth:s,organization:i}=this.props;if("type"in r)return;return i.features.includes("performance-span-tree-autoscroll")&&(e.isIntersecting?this.props.markSpanInView(r.span_id,s):this.props.markSpanOutOfView(r.span_id)),t<=1?void(n.style.top="0px"):void 0}if(a<=0){const{span:e,organization:t}=this.props;if("type"in e)return;return void(t.features.includes("performance-span-tree-autoscroll")&&this.props.markSpanOutOfView(e.span_id))}const o=(t-1)*le.rz+(1-e.intersectionRatio)*le.rz,d=this.props.numOfSpans+1-le.bl;n.style.top=t>d?`-${d*le.rz}px`:`-${o}px`}))),{threshold:ve,rootMargin:`-${le.ZR*this.zoomLevel}px 0px 0px 0px`}),this.intersectionObserver.observe(this.spanRowDOMRef.current))}disconnectObservers(){this.intersectionObserver&&this.intersectionObserver.disconnect()}renderDivider(e){if(this.state.showDetail)return(0,x.tZ)(re.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:t}=e;return(0,x.tZ)(re.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}getRelatedErrors(e){if(!e)return null;const{span:t}=this.props,{currentEvent:n}=e;return!(0,fe.hw)(t)&&n&&(0,pe.y3)(n)?n.errors.filter((e=>e.span===t.span_id)):null}getChildTransactions(e){if(!e)return null;const{span:t}=this.props,{trace:n}=e;return(0,fe.hw)(t)||!n?null:n.filter((e=>{let{parent_span_id:n}=e;return n===t.span_id}))}renderErrorBadge(e){return null!=e&&e.length?(0,x.tZ)(re.cS,{}):null}renderEmbeddedTransactionsBadge(e){const{toggleEmbeddedChildren:t,organization:n,showEmbeddedChildren:r}=this.props;if(!n.features.includes("unified-span-view"))return null;if(e&&1===e.length){const s=e[0];return(0,x.tZ)(ae.Z,{title:(0,x.tZ)("span",{children:r?(0,g.t)("This span is showing a direct child. Remove transaction to hide"):(0,g.t)("This span has a direct child. Add transaction to view")}),position:"top",containerDisplayMode:"block",children:(0,x.tZ)(re.mk,{expanded:r,onClick:()=>{t&&(r?(0,oe.ec)({eventKey:"span_view.embedded_child.hide",eventName:"Span View: Hide Embedded Transaction",organization_id:parseInt(n.id,10)}):(0,oe.ec)({eventKey:"span_view.embedded_child.show",eventName:"Span View: Show Embedded Transaction",organization_id:parseInt(n.id,10)}),t({orgSlug:n.slug,eventSlug:(0,de.JE)({id:s.event_id,project:s.project_slug})}))}})})}return null}renderWarningText(){let e=this.getBounds().warning;if(this.props.isEmbeddedTransactionTimeAdjusted){const t=(0,g.t)("All child span timestamps have been adjusted to account for mismatched client and server clocks.");e=e?`${e}. ${t}`:t}return e?(0,x.tZ)(ae.Z,{containerDisplayMode:"flex",title:e,children:(0,x.tZ)(be,{size:"xs"})}):null}renderHeader(e){let{dividerHandlerChildrenProps:t,errors:n,transactions:r}=e;const{span:s,spanBarColor:i,spanBarHatch:a,spanNumber:o}=this.props,d=s.start_timestamp,p=s.timestamp,l=Math.abs(p-d),c=(0,Z.bQ)(l),h=this.getBounds(),{dividerPosition:u,addGhostDividerLineRef:g}=t,m=(0,S.ri)(h.left)&&(0,S.ri)(h.width),f=(0,Z.ud)(h);return(0,x.BX)(te.Qc,{showDetail:this.state.showDetail,children:[(0,x.tZ)(te.E5,{"data-type":"span-row-cell",showDetail:this.state.showDetail,style:{width:`calc(${(0,Z.yI)(u)} - 0.5px)`,paddingTop:0},onClick:()=>{this.toggleDisplayDetail()},ref:this.spanTitleRef,children:this.renderTitle(n)}),(0,x.BX)(re.kP,{children:[this.renderDivider(t),this.renderErrorBadge(n),this.renderEmbeddedTransactionsBadge(r)]}),(0,x.BX)(te.E5,{"data-type":"span-row-cell",showDetail:this.state.showDetail,showStriping:o%2!=0,style:{width:`calc(${(0,Z.yI)(1-u)} - 0.5px)`},onClick:()=>{this.toggleDisplayDetail()},children:[m&&(0,x.tZ)(ne.e,{spanBarHatch:!!a,style:{backgroundColor:i,left:`min(${(0,Z.yI)(h.left||0)}, calc(100% - 1px))`,width:(0,Z.yI)(h.width||0)},children:(0,x.BX)(ne.R,{durationDisplay:f,showDetail:this.state.showDetail,spanBarHatch:!!a,children:[c,this.renderWarningText()]})}),this.renderMeasurements(),(0,x.tZ)(ue,{})]}),!this.state.showDetail&&(0,x.tZ)(re.Hr,{style:{width:`calc(${(0,Z.yI)(u)} + 0.5px)`,display:"none"},children:(0,x.tZ)(re.xN,{ref:g(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})]})}renderEmbeddedChildrenState(){const{fetchEmbeddedChildrenState:e}=this.props;switch(e){case"loading_embedded_transactions":return(0,x.tZ)(K.V,{children:(0,x.tZ)("span",{children:(0,g.t)("Loading embedded transaction")})});case"error_fetching_embedded_transactions":return(0,x.tZ)(K.V,{children:(0,x.tZ)("span",{children:(0,g.t)("Error loading embedded transaction")})});default:return null}}render(){const{spanNumber:e}=this.props,t=this.getBounds(),{isSpanVisibleInView:n}=t;return(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(te.X2,{ref:this.spanRowDOMRef,visible:n,showBorder:this.state.showDetail,"data-test-id":`span-row-${e}`,children:(0,x.tZ)(f.$,{children:e=>{const t=this.getRelatedErrors(e),r=this.getChildTransactions(e);return(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(z.$,{children:e=>this.renderHeader({dividerHandlerChildrenProps:e,errors:t,transactions:r})}),this.renderDetail({isVisible:n,transactions:r,errors:t})]})}})}),this.renderEmbeddedChildrenState()]})}}we.displayName="SpanBar";const be=(0,s.Z)(E.FC,{target:"e1nt6cx1"})("margin-left:",(0,m.Z)(.25),";margin-bottom:",(0,m.Z)(.25),";"),Te=(0,s.Z)("span",{target:"e1nt6cx0"})(""),ye=we;var Ze=n("../node_modules/lodash/countBy.js"),Ee=n.n(Ze),xe=n("./app/utils/theme.tsx");function De(e){const{treeDepth:t,spanGrouping:n,renderSpanTreeConnector:r,toggleSpanGroup:s}=e,i=t*(ie.Ll/2)+0;return(0,x.BX)(ie.rw,{style:{left:`${i}px`},hasToggler:!0,children:[r(),(0,x.tZ)(ie.U1,{disabled:!1,isExpanded:!1,errored:!1,isSpanGroupToggler:!0,onClick:e=>{e.stopPropagation(),s()},children:(0,x.tZ)(J.Z,{value:n.length})})]})}function Ce(e){const{addDividerLineRef:t}=e;return(0,x.tZ)(re.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}function Ne(e,t){const n=(0,fe.is)(e,t);return(0,x.tZ)(i.Fragment,{children:Array.from(n).map((e=>{let[n,r]=e;const s=(0,fe.vu)(n,t);return(0,S.ri)(s.left)&&(0,S.ri)(s.width)&&s.isSpanVisibleInView?(0,x.tZ)(me,{style:{left:`clamp(0%, ${(0,Z.yI)(s.left||0)}, calc(100% - 1px))`},failedThreshold:r.failedThreshold},String(n)):null}))})}function Be(e){const t=(0,i.useRef)(null),{onWheel:n}=e;return(0,i.useEffect)((()=>{const e=t.current,r=e=>{Math.abs(e.deltaY)>Math.abs(e.deltaX)||(e.preventDefault(),e.stopPropagation(),Math.abs(e.deltaY)!==Math.abs(e.deltaX)&&n(e.deltaX))};return e&&e.addEventListener("wheel",r,{passive:!1}),()=>{e&&e.removeEventListener("wheel",r)}}),[n]),(0,x.tZ)(z.$,{children:n=>{const{generateBounds:r,toggleSpanGroup:s,span:i,treeDepth:a,spanNumber:o,event:d,spanGrouping:p}=e,{isSpanVisibleInView:l}=r({startTimestamp:i.start_timestamp,endTimestamp:i.timestamp}),{dividerPosition:c,addGhostDividerLineRef:h}=n,{generateContentSpanBarRef:u}=e,g=a*(ie.Ll/2)+0;return(0,x.tZ)(w.$,{children:i=>{let{registerScrollFn:a}=i;return p.forEach((e=>{a((0,fe.ct)(e.span.span_id),s,!0)})),(0,x.tZ)(te.X2,{visible:l,showBorder:!1,"data-test-id":`span-row-${o}`,children:(0,x.BX)(te.Qc,{children:[(0,x.tZ)(te.E5,{"data-type":"span-row-cell",style:{width:`calc(${(0,Z.yI)(c)} - 0.5px)`,paddingTop:0},onClick:()=>e.toggleSpanGroup(),ref:t,children:(0,x.BX)(se.mw,{ref:u(),children:[De(e),(0,x.tZ)(se.Wh,{style:{left:`${g}px`,width:"100%"},children:(0,x.tZ)(se.$D,{children:e.renderGroupSpansTitle()})})]})}),(0,x.tZ)(re.kP,{children:Ce(n)}),(0,x.BX)(te.E5,{"data-type":"span-row-cell",showStriping:o%2!=0,style:{width:`calc(${(0,Z.yI)(1-c)} - 0.5px)`},onClick:()=>e.toggleSpanGroup(),children:[e.renderSpanRectangles(),Ne(d,r),(0,x.tZ)(ue,{})]}),(0,x.tZ)(re.Hr,{style:{width:`calc(${(0,Z.yI)(c)} + 0.5px)`,display:"none"},children:(0,x.tZ)(re.xN,{ref:h(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})]})})}})}})}function Oe(e){const{continuingTreeDepths:t,event:n,generateBounds:r,span:s,spanGrouping:i,spanNumber:a,toggleSpanGroup:o,onWheel:d,generateContentSpanBarRef:p}=e;return(0,x.tZ)(Be,{"data-test-id":"span-descendant-group-bar",event:n,span:s,spanGrouping:i,treeDepth:e.treeDepth,spanNumber:a,generateBounds:r,toggleSpanGroup:o,renderSpanTreeConnector:function(){const{treeDepth:n}=e,r=t.map((e=>{const t=(0,fe.h_)(e);if(0===t)return null;const r=-1*((n-t)*(ie.Ll/2)+2);return(0,x.tZ)(ie.UV,{style:{left:r},orphanBranch:(0,fe.yn)(e)},`span-group-${t}`)}));return r.push((0,x.tZ)(ie.UV,{style:{right:"15px",height:ee.d/2+"px",bottom:`-${ee.d/2+1}px`,top:"auto"},orphanBranch:!1},"collapsed-span-group-row-bottom")),(0,x.tZ)(ie.DN,{isLast:!0,hasToggler:!0,orphanBranch:(0,fe.ro)(s),children:r})},renderGroupSpansTitle:function(){if(0===i.length)return"";const e=Ee()(i,(e=>(0,fe.yk)(e.span))),t=Object.keys(e).length>1,[n]=Object.entries(e).reduce(((e,t)=>{let[n,r]=t;return r>e[1]?[n,r]:e}));return(0,x.tZ)("strong",{children:`${(0,g.t)("Autogrouped ")}— ${n}${t?(0,g.t)(" and more"):""}`})},renderSpanRectangles:function(){const e=(0,fe.sT)(i,r),t=(0,Z.ud)(e),{startTimestamp:n,endTimestamp:s}=(0,fe.ll)(i),a=Math.abs(s-n),o=(0,Z.bQ)(a);return(0,x.tZ)(ne.e,{spanBarHatch:!1,style:{backgroundColor:xe.ZP.blue300,left:`min(${(0,Z.yI)(e.left||0)}, calc(100% - 1px))`,width:(0,Z.yI)(e.width||0)},children:(0,x.tZ)(ne.R,{durationDisplay:t,showDetail:!1,spanBarHatch:!1,children:o})})},onWheel:d,generateContentSpanBarRef:p})}function Re(e){let{bounds:t}=e;return(0,x.tZ)(ne.e,{spanBarHatch:!1,style:{backgroundColor:xe.ZP.blue300,left:`min(${(0,Z.yI)(t.left||0)}, calc(100% - 1px))`,width:(0,Z.yI)(t.width||0)}})}function Ie(e){let{bounds:t,spanGrouping:n}=e;const{startTimestamp:r,endTimestamp:s}=(0,fe.ll)(n),i=Math.abs(s-r),a=(0,Z.ud)(t),o=(0,Z.bQ)(i);return(0,x.tZ)(ne.e,{spanBarHatch:!1,style:{left:`min(${(0,Z.yI)(t.left||0)}, calc(100% - 1px))`,width:(0,Z.yI)(t.width||0)},children:(0,x.tZ)(ne.R,{durationDisplay:a,showDetail:!1,spanBarHatch:!1,children:o})})}function _e(e){const{continuingTreeDepths:t,event:n,generateBounds:r,isLastSibling:s,span:a,spanGrouping:o,spanNumber:d,occurrence:p,toggleSiblingSpanGroup:l,onWheel:c,generateContentSpanBarRef:h}=e;return(0,x.tZ)(Be,{event:n,span:a,spanGrouping:o,treeDepth:e.treeDepth,spanNumber:d,generateBounds:r,toggleSpanGroup:()=>null==l?void 0:l(o[0].span,p),renderSpanTreeConnector:function(){const{treeDepth:n}=e,r=t.map((e=>{const t=(0,fe.h_)(e);if(0===t)return null;const r=-1*((n-t)*(ie.Ll/2)+2);return(0,x.tZ)(ie.UV,{style:{left:r},orphanBranch:(0,fe.yn)(e)},`span-group-${t}`)}));return(0,x.tZ)(ie.DN,{isLast:s,hasToggler:!0,orphanBranch:(0,fe.ro)(a),children:r})},renderGroupSpansTitle:function(){if(0===o.length)return"";const e=o[0].span.op,t=o[0].span.description;return t&&e?(0,x.BX)(i.Fragment,{children:[(0,x.tZ)("strong",{children:`${(0,g.t)("Autogrouped")} — ${e} — `}),t]}):t?(0,x.tZ)("strong",{children:`${(0,g.t)("Autogrouped")} — ${t}`}):e?(0,x.tZ)("strong",{children:`${(0,g.t)("Autogrouped")} — ${e}`}):(0,x.tZ)("strong",{children:`${(0,g.t)("Autogrouped")} — ${(0,g.t)("siblings")}`})},renderSpanRectangles:function(){return(0,x.BX)(i.Fragment,{children:[o.map(((e,t)=>(0,x.tZ)(Re,{spanGrouping:o,bounds:(0,fe.sT)([o[t]],r)},t))),(0,x.tZ)(Ie,{spanGrouping:o,bounds:(0,fe.sT)(o,r)})]})},onWheel:c,generateContentSpanBarRef:h})}De.displayName="renderGroupedSpansToggler",Ce.displayName="renderDivider",Ne.displayName="renderMeasurements",Be.displayName="SpanGroupBar",Oe.displayName="SpanDescendantGroupBar",Re.displayName="SpanRectangle",Ie.displayName="SpanRectangleOverlay",_e.displayName="SpanSiblingGroupBar";class ke extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"toggleSpanTree",(e=>()=>{this.props.waterfallModel.toggleSpanSubTree(e),this.props.updateScrollState()}))}componentDidMount(){(0,fe.kP)(this.props.spans.length)}shouldComponentUpdate(e){return this.props.dragProps.isDragging!==e.dragProps.isDragging||this.props.dragProps.isWindowSelectionDragging!==e.dragProps.isWindowSelectionDragging||!(e.dragProps.isDragging||e.dragProps.isWindowSelectionDragging||Y()(this.props.spans,e.spans))}componentDidUpdate(e){Y()(e.filterSpans,this.props.filterSpans)&&Y()(e.spans,this.props.spans)||this.props.updateScrollState()}generateInfoMessage(e){const{isCurrentSpanHidden:t,numOfSpansOutOfViewAbove:n,isCurrentSpanFilteredOut:r,numOfFilteredSpansAbove:s}=e,i=[];return!t&&n>0&&i.push((0,x.BX)("span",{children:[(0,x.tZ)("strong",{children:n})," ",(0,g.t)("spans out of view")]},"spans-out-of-view")),!r&&s>0&&(t||(1===s?i.push((0,x.tZ)("span",{children:(0,g._N)("[numOfSpans] hidden span",{numOfSpans:(0,x.tZ)("strong",{children:s})})},"spans-filtered")):i.push((0,x.tZ)("span",{children:(0,g._N)("[numOfSpans] hidden spans",{numOfSpans:(0,x.tZ)("strong",{children:s})})},"spans-filtered")))),i.length<=0?null:(0,x.tZ)(K.V,{children:i})}generateLimitExceededMessage(){const{waterfallModel:e}=this.props,{parsedTrace:t}=e;return function(e){const{traceEndTimestamp:t,spans:n}=e;if(n.length<999)return!0;return t-n.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)).timestamp<.1}(t)?null:(0,x.tZ)(K.V,{children:(0,g.t)("The next spans are unavailable. You may have exceeded the span limit or need to address missing instrumentation.")})}render(){const{waterfallModel:e,spans:t,organization:n,dragProps:r,onWheel:s,generateContentSpanBarRef:i,markSpanOutOfView:a,markSpanInView:o,storeSpanBar:d}=this.props,p=e.generateBounds({viewStart:r.viewWindowStart,viewEnd:r.viewWindowEnd}),l=t.reduce(((e,t)=>{switch(t.type){case"root_span":case"span":case"span_group_chain":return e+1;default:return e}}),0),{spanTree:c,numOfSpansOutOfViewAbove:h,numOfFilteredSpansAbove:u}=t.reduce(((t,r)=>{const{type:c}=r;switch(r.type){case"filtered_out":return t.numOfFilteredSpansAbove+=1,t;case"out_of_view":return t.numOfSpansOutOfViewAbove+=1,t}if(t.numOfFilteredSpansAbove>0||t.numOfSpansOutOfViewAbove>0){const e=this.generateInfoMessage({isCurrentSpanHidden:!1,numOfSpansOutOfViewAbove:t.numOfSpansOutOfViewAbove,isCurrentSpanFilteredOut:!1,numOfFilteredSpansAbove:t.numOfFilteredSpansAbove});t.spanTree.push(e)}const h=t.spanNumber,{span:u,treeDepth:g,continuingTreeDepths:m}=r;if("span_group_chain"===r.type)return t.spanTree.push((0,x.tZ)(Oe,{event:e.event,span:u,generateBounds:p,treeDepth:g,continuingTreeDepths:m,spanNumber:h,spanGrouping:r.spanNestedGrouping,toggleSpanGroup:r.toggleNestedSpanGroup,onWheel:s,generateContentSpanBarRef:i},`${h}-span-group`)),t.spanNumber=h+1,t;var S;if("span_group_siblings"===r.type)return t.spanTree.push((0,x.tZ)(_e,{event:e.event,span:u,generateBounds:p,treeDepth:g,continuingTreeDepths:m,spanNumber:h,spanGrouping:r.spanSiblingGrouping,toggleSiblingSpanGroup:r.toggleSiblingSpanGroup,isLastSibling:null!==(S=r.isLastSibling)&&void 0!==S&&S,occurrence:r.occurrence,onWheel:s,generateContentSpanBarRef:i},`${h}-span-sibling`)),t.spanNumber=h+1,t;const f=(0,fe.Rr)(u,`span-${h}`),v=r.isLastSibling,w="root_span"===c,b=(0,Z.hd)((0,fe.yk)(u)),T=r.numOfSpanChildren;let y,E,D;return t.numOfFilteredSpansAbove=0,t.numOfSpansOutOfViewAbove=0,"span"===r.type&&(y=r.toggleNestedSpanGroup),"span"===r.type&&r.isFirstSiblingOfGroup&&(E=r.toggleSiblingSpanGroup),y?D=Se.YT.DESCENDANTS:E&&(D=Se.YT.SIBLINGS),t.spanTree.push((0,x.tZ)(ye,{organization:n,event:e.event,spanBarColor:b,spanBarHatch:"gap"===c,span:u,showSpanTree:!e.hiddenSpanSubTrees.has((0,fe.Rr)(u)),numOfSpanChildren:T,trace:e.parsedTrace,generateBounds:p,toggleSpanTree:this.toggleSpanTree((0,fe.Rr)(u)),treeDepth:g,continuingTreeDepths:m,spanNumber:h,isLast:v,isRoot:w,showEmbeddedChildren:r.showEmbeddedChildren,toggleEmbeddedChildren:r.toggleEmbeddedChildren,toggleSiblingSpanGroup:E,fetchEmbeddedChildrenState:r.fetchEmbeddedChildrenState,toggleSpanGroup:y,numOfSpans:l,groupType:D,groupOccurrence:r.groupOccurrence,isEmbeddedTransactionTimeAdjusted:r.isEmbeddedTransactionTimeAdjusted,onWheel:s,generateContentSpanBarRef:i,markSpanOutOfView:a,markSpanInView:o,storeSpanBar:d},f)),t.spanNumber=h+1,t}),{numOfSpansOutOfViewAbove:0,numOfFilteredSpansAbove:0,spanTree:[],spanNumber:1}),g=this.generateInfoMessage({isCurrentSpanHidden:!1,numOfSpansOutOfViewAbove:h,isCurrentSpanFilteredOut:!1,numOfFilteredSpansAbove:u});return(0,x.BX)(Ge,{ref:this.props.traceViewRef,children:[c,g,this.generateLimitExceededMessage()]})}}ke.displayName="SpanTree";const Ge=(0,s.Z)("div",{target:"eh9cla10"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),Le=(0,q.Iw)(ke);class Ae extends i.PureComponent{constructor(){super(...arguments),(0,r.Z)(this,"traceViewRef",(0,i.createRef)()),(0,r.Z)(this,"virtualScrollBarContainerRef",(0,i.createRef)()),(0,r.Z)(this,"minimapInteractiveRef",(0,i.createRef)()),(0,r.Z)(this,"renderHeader",(e=>(0,x.tZ)(o.Qj,{children:()=>{const{waterfallModel:t}=this.props;return(0,x.tZ)(X.ZP,{organization:this.props.organization,minimapInteractiveRef:this.minimapInteractiveRef,dragProps:e,trace:t.parsedTrace,event:t.event,virtualScrollBarContainerRef:this.virtualScrollBarContainerRef,operationNameFilters:t.operationNameFilters,rootSpan:t.rootSpan.span,spans:t.getWaterfall({viewStart:0,viewEnd:1}),generateBounds:t.generateBounds({viewStart:0,viewEnd:1})})}})))}render(){const{organization:e,waterfallModel:t}=this.props;return(0,fe.PA)(t.event)?(0,x.tZ)(U,{interactiveLayerRef:this.minimapInteractiveRef,children:n=>(0,x.tZ)(o.Qj,{children:()=>{const r=t.parsedTrace;return(0,x.tZ)(P.z,{interactiveLayerRef:this.minimapInteractiveRef,dragProps:n,trace:r,children:(0,x.tZ)(z.z,{interactiveLayerRef:this.traceViewRef,children:(0,x.tZ)(z.$,{children:r=>(0,x.BX)(q.zt,{dividerPosition:r.dividerPosition,interactiveLayerRef:this.virtualScrollBarContainerRef,dragProps:n,children:[this.renderHeader(n),(0,x.tZ)(o.Qj,{children:()=>(0,x.tZ)(F.BZ,{id:"SpanTree",children:(0,x.tZ)(Le,{traceViewRef:this.traceViewRef,dragProps:n,organization:e,waterfallModel:t,filterSpans:t.filterSpans,spans:t.getWaterfall({viewStart:n.viewWindowStart,viewEnd:n.viewWindowEnd})})})})]})})})})}})}):(0,x.tZ)(V.Z,{children:(0,x.tZ)("p",{children:(0,g.t)("There is no trace for this transaction")})})}}Ae.displayName="TraceView";const Me=Ae;var Ve=n("../node_modules/lodash/pick.js"),Fe=n.n(Ve),Pe=n("../node_modules/mobx/dist/mobx.esm.js"),ze=n("./app/api.tsx"),We=n("./app/utils/fuzzySearch.tsx");class je{constructor(e,t,n){var s,i;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,r.Z)(this,"api",void 0),(0,r.Z)(this,"span",void 0),(0,r.Z)(this,"children",[]),(0,r.Z)(this,"isRoot",void 0),(0,r.Z)(this,"fetchEmbeddedChildrenState","idle"),(0,r.Z)(this,"showEmbeddedChildren",!1),(0,r.Z)(this,"embeddedChildren",[]),(0,r.Z)(this,"isEmbeddedTransactionTimeAdjusted",!1),(0,r.Z)(this,"isNestedSpanGroupExpanded",!1),(0,r.Z)(this,"expandedSiblingGroups",new Set),(0,r.Z)(this,"isSpanFilteredOut",((e,t)=>{const{operationNameFilters:n,filterSpans:r}=e;if("active_filter"===n.type){const e=(0,fe.yk)(t.span);if("string"==typeof e&&!n.operationNames.has(e))return!0}return!!r&&!r.spanIDs.has((0,fe.Rr)(t.span))})),(0,r.Z)(this,"getSpansList",(e=>{const{operationNameFilters:t,generateBounds:n,isLastSibling:r,hiddenSpanSubTrees:s,spanAncestors:i,filterSpans:a,previousSiblingEndTimestamp:o,event:d,isOnlySibling:p,spanNestedGrouping:l,toggleNestedSpanGroup:c,isNestedSpanGroupExpanded:h,addTraceBounds:u,removeTraceBounds:g}=e;let{treeDepth:m,continuingTreeDepths:S}=e;const f=(0,fe.Rr)(this.span),v=new Set(i);v.add(f);const w=this.showEmbeddedChildren?[...this.embeddedChildren,...this.children]:this.children,b=p&&!this.isRoot&&1===w.length,T=b,y=s.has(f),Z=p&&!this.isRoot&&(1!==w.length||y),E=T&&(void 0===l||Array.isArray(l)&&0===l.length);if(Z&&Array.isArray(l)&&l.length>=1&&!h&&(m+=1,1===l.length)){const e=(0,fe.ro)(l[0].span)?{type:"orphan",depth:l[0].treeDepth}:l[0].treeDepth;l[0].isLastSibling||(S=[...S,e])}const x=Z&&Array.isArray(l)&&l.length>1,D={type:this.isRoot?"root_span":"span",span:this.span,numOfSpanChildren:w.length,treeDepth:m,isLastSibling:r,continuingTreeDepths:S,fetchEmbeddedChildrenState:this.fetchEmbeddedChildrenState,showEmbeddedChildren:this.showEmbeddedChildren,toggleEmbeddedChildren:this.toggleEmbeddedChildren({addTraceBounds:u,removeTraceBounds:g}),toggleNestedSpanGroup:x&&c&&!h?c:E&&this.isNestedSpanGroupExpanded&&!y?this.toggleNestedSpanGroup:void 0,toggleSiblingSpanGroup:void 0,isEmbeddedTransactionTimeAdjusted:this.isEmbeddedTransactionTimeAdjusted};"root_span"===D.type&&delete D.toggleNestedSpanGroup;const C=(0,fe.ro)(this.span)?{type:"orphan",depth:m}:m,N=T&&!Z&&(void 0===c&&!this.isNestedSpanGroupExpanded||void 0!==c&&!h),B=r||N?S:[...S,C];for(const e of s)if(i.has(e))return[];const O=[],R={},I=(e,t)=>{if(!t.length)return;const n=`${e.span.op}.${e.span.description}`;R[n]?R[n]+=1:R[n]=1,O.push({group:t,occurrence:R[n]})};if((null==w?void 0:w.length)>=5){let e=w[0],t=[e];for(let n=1;n<w.length;n++){const r=w[n];e.span.op===r.span.op&&e.span.description===r.span.description&&0===r.children.length?t.push(r):(I(e,t),r.children.length?(t=[r],O.push({group:t}),t=[]):t=[r]),e=r}I(e,t)}else w.length>=1&&O.push({group:w});const _=(y?[]:O).reduce(((r,i,o)=>{let{group:p,occurrence:S}=i;if(p.length<5)return p.forEach(((e,i)=>{r.descendants.push(...e.getSpansList({operationNameFilters:t,generateBounds:n,treeDepth:N?m:m+1,isLastSibling:o===O.length-1&&i===p.length-1,continuingTreeDepths:B,hiddenSpanSubTrees:s,spanAncestors:new Set(v),filterSpans:a,previousSiblingEndTimestamp:r.previousSiblingEndTimestamp,event:d,isOnlySibling:1===w.length,spanNestedGrouping:T?[...null!=l?l:[],D]:void 0,toggleNestedSpanGroup:b?void 0===c?this.toggleNestedSpanGroup:c:void 0,isNestedSpanGroupExpanded:!!b&&(void 0===c?this.isNestedSpanGroupExpanded:h),addTraceBounds:u,removeTraceBounds:g})),r.previousSiblingEndTimestamp=e.span.timestamp})),r;const f=(0,fe.PQ)(p[0].span,S);if(this.expandedSiblingGroups.has(f))return p.forEach(((t,n)=>{if(this.isSpanFilteredOut(e,t))r.descendants.push({type:"filtered_out",span:t.span});else{const e={type:"span",span:t.span,numOfSpanChildren:0,treeDepth:m+1,isLastSibling:n===p.length-1&&o===O.length-1,isFirstSiblingOfGroup:0===n,groupOccurrence:S,continuingTreeDepths:B,fetchEmbeddedChildrenState:t.fetchEmbeddedChildrenState,showEmbeddedChildren:t.showEmbeddedChildren,toggleEmbeddedChildren:t.toggleEmbeddedChildren({addTraceBounds:u,removeTraceBounds:g}),toggleNestedSpanGroup:void 0,toggleSiblingSpanGroup:0===n?this.toggleSiblingSpanGroup:void 0,isEmbeddedTransactionTimeAdjusted:t.isEmbeddedTransactionTimeAdjusted};r.previousSiblingEndTimestamp=t.span.timestamp,r.descendants.push(e)}})),r;if(this.isSpanFilteredOut(e,p[0]))return p.forEach((e=>r.descendants.push({type:"filtered_out",span:e.span}))),r;if(!n({startTimestamp:p[0].span.start_timestamp,endTimestamp:p[p.length-1].span.timestamp}).isSpanVisibleInView)return p.forEach((e=>r.descendants.push({type:"out_of_view",span:e.span}))),r;const y=p.map(((e,t)=>({type:"span",span:e.span,numOfSpanChildren:0,treeDepth:m+1,isLastSibling:t===p.length-1&&o===O.length-1,isFirstSiblingOfGroup:0===t,groupOccurrence:S,continuingTreeDepths:B,fetchEmbeddedChildrenState:e.fetchEmbeddedChildrenState,showEmbeddedChildren:e.showEmbeddedChildren,toggleEmbeddedChildren:e.toggleEmbeddedChildren({addTraceBounds:u,removeTraceBounds:g}),toggleNestedSpanGroup:void 0,toggleSiblingSpanGroup:0===t?this.toggleSiblingSpanGroup:void 0,isEmbeddedTransactionTimeAdjusted:e.isEmbeddedTransactionTimeAdjusted}))),Z={type:"span_group_siblings",span:this.span,treeDepth:m+1,continuingTreeDepths:B,spanSiblingGrouping:y,isLastSibling:o===O.length-1,occurrence:null!=S?S:0,toggleSiblingSpanGroup:this.toggleSiblingSpanGroup};return r.previousSiblingEndTimestamp=y[y.length-1].span.timestamp,r.descendants.push(Z),r}),{descendants:[],previousSiblingEndTimestamp:void 0}).descendants;if(this.isSpanFilteredOut(e,this))return[{type:"filtered_out",span:this.span},..._];if(!n({startTimestamp:this.span.start_timestamp,endTimestamp:this.span.timestamp}).isSpanVisibleInView)return[{type:"out_of_view",span:this.span},..._];if(N)return[..._];if(Z&&Array.isArray(l)&&l.length>1&&!h&&"span"===D.type)return[{type:"span_group_chain",span:this.span,treeDepth:m-1,continuingTreeDepths:S,spanNestedGrouping:l,isNestedSpanGroupExpanded:h,toggleNestedSpanGroup:D.toggleNestedSpanGroup,toggleSiblingSpanGroup:void 0},{...D,toggleNestedSpanGroup:void 0},..._];if(E&&this.isNestedSpanGroupExpanded&&!y&&_.length<=1&&"span"===D.type&&(D.toggleNestedSpanGroup=void 0),Z&&Array.isArray(l)&&1===l.length){if(!h){const e=l[0].span;if(n({startTimestamp:e.start_timestamp,endTimestamp:e.timestamp}).isSpanVisibleInView)return[l[0],D,..._]}return[D,..._]}const k=this.generateSpanGap(d,o,m,S);return k?[k,D,..._]:[D,..._]})),(0,r.Z)(this,"toggleEmbeddedChildren",(e=>{let{addTraceBounds:t,removeTraceBounds:n}=e;return e=>{if(this.showEmbeddedChildren=!this.showEmbeddedChildren,this.fetchEmbeddedChildrenState="idle",this.showEmbeddedChildren||this.embeddedChildren.length>0&&this.embeddedChildren.forEach((e=>{n(e.generateTraceBounds().spanId)})),this.showEmbeddedChildren){if(0===this.embeddedChildren.length)return this.fetchEmbeddedTransactions({...e,addTraceBounds:t});this.embeddedChildren.forEach((e=>{t(e.generateTraceBounds())}))}return Promise.resolve(void 0)}})),(0,r.Z)(this,"toggleNestedSpanGroup",(()=>{this.isNestedSpanGroupExpanded=!this.isNestedSpanGroupExpanded})),(0,r.Z)(this,"toggleSiblingSpanGroup",((e,t)=>{const n=(0,fe.PQ)(e,t);this.expandedSiblingGroups.has(n)?this.expandedSiblingGroups.delete(n):this.expandedSiblingGroups.add(n)})),(0,r.Z)(this,"generateTraceBounds",(()=>({spanId:this.span.span_id,traceStartTimestamp:this.span.start_timestamp,traceEndTimestamp:this.span.timestamp}))),this.api=n,this.span=e,this.isRoot=a;const o=(0,fe.Rr)(e),d=null!==(s=null===(i=t)||void 0===i?void 0:i[o])&&void 0!==s?s:[];delete(t={...t})[o],this.children=d.map((e=>new je(e,t,n))),(0,Pe.rC)(this,{operationNameCounts:Pe.Fl.struct,showEmbeddedChildren:Pe.LO,embeddedChildren:Pe.LO,fetchEmbeddedChildrenState:Pe.LO,toggleEmbeddedChildren:Pe.aD,fetchEmbeddedTransactions:Pe.aD,isNestedSpanGroupExpanded:Pe.LO,toggleNestedSpanGroup:Pe.aD,expandedSiblingGroups:Pe.LO,toggleSiblingSpanGroup:Pe.aD,isEmbeddedTransactionTimeAdjusted:Pe.LO})}get operationNameCounts(){const e=new Map,t=this.span.op;"string"==typeof t&&t.length>0&&e.set(t,1);for(const t of this.children){const r=t.operationNameCounts;for(const[t,s]of r){var n;e.set(t,(null!==(n=e.get(t))&&void 0!==n?n:0)+s)}}return new Map([...e].sort(((e,t)=>String(e[0]).localeCompare(t[0],void 0,{sensitivity:"base"}))))}generateSpanGap(e,t,n,r){if(!(0,fe.PC)(e)&&"number"==typeof t&&t<this.span.start_timestamp&&this.span.start_timestamp-t>=.1)return{type:"gap",span:{type:"gap",start_timestamp:t||this.span.start_timestamp,timestamp:this.span.start_timestamp,description:(0,g.t)("Missing instrumentation"),isOrphan:(0,fe.ro)(this.span)},numOfSpanChildren:0,treeDepth:n,isLastSibling:!1,continuingTreeDepths:r,fetchEmbeddedChildrenState:"idle",showEmbeddedChildren:!1,toggleEmbeddedChildren:void 0,isEmbeddedTransactionTimeAdjusted:this.isEmbeddedTransactionTimeAdjusted}}fetchEmbeddedTransactions(e){let{orgSlug:t,eventSlug:n,addTraceBounds:r}=e;const s=`/organizations/${t}/events/${n}/`;return this.fetchEmbeddedChildrenState="loading_embedded_transactions",this.api.requestPromise(s,{method:"GET",query:{}}).then((0,Pe.aD)("fetchEmbeddedTransactionsSuccess",(e=>{if(!e)return;const t=(0,fe.k9)(e);if(t.traceStartTimestamp<this.span.start_timestamp||t.traceEndTimestamp>this.span.timestamp){const e=this.span.start_timestamp-t.traceStartTimestamp;t.traceStartTimestamp+=e,t.traceEndTimestamp+=e,t.spans.forEach((t=>{t.start_timestamp+=e,t.timestamp+=e})),this.isEmbeddedTransactionTimeAdjusted=!0}const n=(0,fe.n0)(t),s=new je(n,t.childSpans,this.api,!1);this.embeddedChildren=[s],this.fetchEmbeddedChildrenState="idle",r(s.generateTraceBounds())}))).catch((0,Pe.aD)("fetchEmbeddedTransactionsError",(()=>{this.embeddedChildren=[],this.fetchEmbeddedChildrenState="error_fetching_embedded_transactions"})))}}const He=je,$e=class{constructor(e){(0,r.Z)(this,"api",new ze.KU),(0,r.Z)(this,"event",void 0),(0,r.Z)(this,"rootSpan",void 0),(0,r.Z)(this,"parsedTrace",void 0),(0,r.Z)(this,"fuse",void 0),(0,r.Z)(this,"operationNameFilters",D),(0,r.Z)(this,"filterSpans",void 0),(0,r.Z)(this,"searchQuery",void 0),(0,r.Z)(this,"hiddenSpanSubTrees",void 0),(0,r.Z)(this,"traceBounds",void 0),(0,r.Z)(this,"toggleOperationNameFilter",(e=>{this.operationNameFilters=function(e,t){if("no_filter"===e.type)return{type:"active_filter",operationNames:new Set([t])};const{operationNames:n}=e;return n.has(t)?n.delete(t):n.add(t),n.size>0?{type:"active_filter",operationNames:n}:{type:"no_filter"}}(this.operationNameFilters,e)})),(0,r.Z)(this,"toggleAllOperationNameFilters",(()=>{const e=Array.from(this.operationNameCounts.keys());this.operationNameFilters=function(e,t){return"no_filter"===e.type?{type:"active_filter",operationNames:new Set(t)}:e.operationNames.size===t.length?{type:"no_filter"}:{type:"active_filter",operationNames:new Set(t)}}(this.operationNameFilters,e)})),(0,r.Z)(this,"toggleSpanSubTree",(e=>{this.hiddenSpanSubTrees.has(e)?this.hiddenSpanSubTrees.delete(e):this.hiddenSpanSubTrees.add(e)})),(0,r.Z)(this,"addTraceBounds",(e=>{this.traceBounds.push(e),this.parsedTrace={...this.parsedTrace,...this.getTraceBounds()}})),(0,r.Z)(this,"removeTraceBounds",(e=>{this.traceBounds=this.traceBounds.filter((t=>t.spanId!==e)),0===this.traceBounds.length&&(this.traceBounds=[this.rootSpan.generateTraceBounds()]),this.parsedTrace={...this.parsedTrace,...this.getTraceBounds()}})),(0,r.Z)(this,"getTraceBounds",(()=>(0===this.traceBounds.length&&(this.traceBounds=[this.rootSpan.generateTraceBounds()]),this.traceBounds.reduce(((e,t)=>({traceStartTimestamp:Math.min(e.traceStartTimestamp,t.traceStartTimestamp),traceEndTimestamp:Math.max(e.traceEndTimestamp,t.traceEndTimestamp)})),{traceStartTimestamp:this.traceBounds[0].traceStartTimestamp,traceEndTimestamp:this.traceBounds[0].traceEndTimestamp})))),(0,r.Z)(this,"generateBounds",(e=>{let{viewStart:t,viewEnd:n}=e;return(0,fe.IG)({...this.getTraceBounds(),viewStart:t,viewEnd:n})})),(0,r.Z)(this,"getWaterfall",(e=>{let{viewStart:t,viewEnd:n}=e;const r=this.generateBounds({viewStart:t,viewEnd:n});return this.rootSpan.getSpansList({operationNameFilters:this.operationNameFilters,generateBounds:r,treeDepth:0,isLastSibling:!0,continuingTreeDepths:[],hiddenSpanSubTrees:this.hiddenSpanSubTrees,spanAncestors:new Set,filterSpans:this.filterSpans,previousSiblingEndTimestamp:void 0,event:this.event,isOnlySibling:!0,spanNestedGrouping:void 0,toggleNestedSpanGroup:void 0,isNestedSpanGroupExpanded:!1,addTraceBounds:this.addTraceBounds,removeTraceBounds:this.removeTraceBounds})})),this.event=e,this.parsedTrace=(0,fe.k9)(e);const t=(0,fe.n0)(this.parsedTrace);this.rootSpan=new He(t,this.parsedTrace.childSpans,this.api,!0),this.traceBounds=[this.rootSpan.generateTraceBounds()],this.indexSearch(this.parsedTrace,t),this.hiddenSpanSubTrees=new Set,(0,Pe.rC)(this,{parsedTrace:Pe.LO,rootSpan:Pe.LO,operationNameFilters:Pe.LO,toggleOperationNameFilter:Pe.aD,toggleAllOperationNameFilters:Pe.aD,operationNameCounts:Pe.Fl.struct,filterSpans:Pe.LO,searchQuery:Pe.LO,querySpanSearch:Pe.aD,hiddenSpanSubTrees:Pe.LO,toggleSpanSubTree:Pe.aD,traceBounds:Pe.LO,addTraceBounds:Pe.aD,removeTraceBounds:Pe.aD})}isEvent(e){return Y()(this.event,e)}get operationNameCounts(){return this.rootSpan.operationNameCounts}async indexSearch(e,t){this.filterSpans=void 0,this.searchQuery=void 0;const{spans:n}=e,r=[t,...n].map((e=>{var t;const n=[],r=Fe()(e,["span_id","start_timestamp","timestamp","op","description"]),s=Object.values(r).filter((e=>!!e)).map((e=>String(e)));n.push(...s);let i=[],a=[];const o=null==e?void 0:e.tags;o&&(i=Object.keys(o),a=Object.values(o));const d=null!==(t=null==e?void 0:e.data)&&void 0!==t?t:{};let p=[],l=[];return d&&(p=Object.keys(d),l=Object.values(d).map((e=>JSON.stringify(e,null,4)||""))),{span:e,indexed:n,tagKeys:i,tagValues:a,dataKeys:p,dataValues:l}}));this.fuse=await(0,We.I)(r,{keys:["indexed","tagKeys","tagValues","dataKeys","dataValues"],includeMatches:!1,threshold:.6,location:0,distance:100,maxPatternLength:32})}querySpanSearch(e){if(!e)return void(void 0!==this.filterSpans&&(this.filterSpans=void 0,this.searchQuery=void 0));if(!this.fuse)return;const t=this.fuse.search(e),n=t.reduce(((e,t)=>{const n=(0,fe.Rr)(t.item.span);return n&&e.add(n),e}),new Set);this.searchQuery=e,this.filterSpans={spanIDs:n,results:t}}};class Ue extends i.PureComponent{constructor(){super(...arguments),(0,r.Z)(this,"state",{parsedTrace:(0,fe.k9)(this.props.event),waterfallModel:new $e(this.props.event)}),(0,r.Z)(this,"handleSpanFilter",(e=>{const{waterfallModel:t}=this.state;t.querySpanSearch(e)}))}static getDerivedStateFromProps(e,t){return t.waterfallModel.isEvent(e.event)?t:{...t,parsedTrace:(0,fe.k9)(e.event),waterfallModel:new $e(e.event)}}renderTraceErrorsAlert(e){let{isLoading:t,errors:n,parsedTrace:r}=e;if(t)return null;if(!n||n.length<=0)return null;const s=1===n.length?(0,g.t)("There is an error event associated with this transaction event."):(0,g.tn)("There are %s error events associated with this transaction event.","There are %s error events associated with this transaction event.",n.length),i={};return n.forEach((e=>{if(!i[e.span])if(r.rootSpanID===e.span)i[e.span]={operation:r.op,errorsCount:0};else{const t=r.spans.find((t=>t.span_id===e.span));if(null==t||!t.op)return;i[e.span]={operation:t.op,errorsCount:0}}i[e.span].errorsCount++})),(0,x.tZ)(Je,{children:(0,x.BX)(d.Z,{type:"error",showIcon:!0,children:[(0,x.tZ)(et,{children:s}),(0,x.tZ)(w.$,{children:e=>{let{scrollToHash:t}=e;return(0,x.tZ)(l.Z,{symbol:"bullet",children:Object.entries(i).map((e=>{let[n,{operation:r,errorsCount:s}]=e;return(0,x.tZ)(c.Z,{children:(0,g._N)("[errors] [link]",{errors:(0,g.tn)("%s error in ","%s errors in ",s),link:(0,x.tZ)(Qe,{onClick:(0,fe.rF)(n,t,this.props.location),children:r})})},n)}))})}})]})})}render(){const{event:e,organization:t}=this.props,{parsedTrace:n,waterfallModel:r}=this.state;return(0,x.tZ)(qe,{hasErrors:!(0,S.z)(e.errors),children:(0,x.tZ)(f.$,{children:e=>{var s;return(0,x.BX)(w.z,{children:[this.renderTraceErrorsAlert({isLoading:(null==e?void 0:e.isLoading)||!1,errors:null==e||null===(s=e.currentEvent)||void 0===s?void 0:s.errors,parsedTrace:n}),(0,x.tZ)(o.Qj,{children:()=>(0,x.BX)(Ye,{children:[(0,x.tZ)(M,{operationNameCounts:r.operationNameCounts,operationNameFilter:r.operationNameFilters,toggleOperationNameFilter:r.toggleOperationNameFilter,toggleAllOperationNameFilters:r.toggleAllOperationNameFilters}),(0,x.tZ)(Ke,{defaultQuery:"",query:r.searchQuery||"",placeholder:(0,g.t)("Search for spans"),onSearch:this.handleSpanFilter})]})}),(0,x.BX)(h.s_,{children:[(0,x.tZ)(o.Qj,{children:()=>(0,x.tZ)(Me,{waterfallModel:r,organization:t})}),(0,x.tZ)(Xe,{children:(0,x.tZ)(p.Z,{target:"span_tree",position:"bottom"})})]})]})}})})}}Ue.displayName="SpansInterface";const Xe=(0,s.Z)("div",{target:"eizh0q96"})({name:"6jsqox",styles:"height:0;width:0;margin-left:50%"}),qe=(0,s.Z)("div",{target:"eizh0q95"})((e=>e.hasErrors&&`\n  padding: ${(0,m.Z)(2)} 0;\n\n  @media (min-width: ${e.theme.breakpoints.small}) {\n    padding: ${(0,m.Z)(3)} 0 0 0;\n  }\n  `),";"),Qe=(0,s.Z)("a",{target:"eizh0q94"})("color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),Ye=(0,s.Z)("div",{target:"eizh0q93"})("display:flex;width:100%;margin-bottom:",(0,m.Z)(1),";"),Ke=(0,s.Z)(u.Z,{target:"eizh0q92"})({name:"1ff36h2",styles:"flex-grow:1"}),Je=(0,s.Z)("div",{target:"eizh0q91"})("margin-bottom:",(0,m.Z)(1),";"),et=(0,s.Z)("div",{target:"eizh0q90"})("margin-bottom:",(0,m.Z)(1),";"),tt=(0,a.withRouter)((0,v.Z)(Ue))},"./app/types/breadcrumbs.tsx":(e,t,n)=>{let r,s;function i(e){return![s.HTTP,s.NAVIGATION].includes(e.type)}n.d(t,{T5:()=>i,kS:()=>s,nU:()=>r}),n("../node_modules/core-js/modules/es.array.includes.js"),function(e){e.FATAL="fatal",e.ERROR="error",e.WARNING="warning",e.INFO="info",e.DEBUG="debug",e.UNDEFINED="undefined"}(r||(r={})),function(e){e.INFO="info",e.DEBUG="debug",e.MESSAGE="message",e.QUERY="query",e.UI="ui",e.USER="user",e.EXCEPTION="exception",e.WARNING="warning",e.ERROR="error",e.DEFAULT="default",e.HTTP="http",e.NAVIGATION="navigation",e.SYSTEM="system",e.SESSION="session",e.TRANSACTION="transaction",e.INIT="init"}(s||(s={}))},"./app/utils/performance/quickTrace/quickTraceContext.tsx":(e,t,n)=>{n.d(t,{$:()=>i,z:()=>s});const r=(0,n("../node_modules/react/index.js").createContext)(void 0),s=r.Provider,i=r.Consumer}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_interfaces_breadcrumbs_breadcrumb_type_index_tsx-app_components_events_-5f76ed.c12840611f3ea719d9de2362a2d6e1ef.js.map