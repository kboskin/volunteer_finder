(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_builder_builderBreadCrumbs_tsx-app_views_alerts_rules_issue_index_tsx-app_vi-f9200f","node_modules_lodash_mean_js"],{"./app/components/charts/eventsRequest.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>T});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("../node_modules/lodash/isEqual.js"),i=s.n(a),o=s("../node_modules/lodash/omitBy.js"),l=s.n(o),d=s("./app/actionCreators/events.tsx"),u=s("./app/actionCreators/indicator.tsx"),c=s("./app/components/charts/loadingPanel.tsx"),h=s("./app/components/charts/utils.tsx"),p=s("./app/locale.tsx"),m=s("./app/utils.tsx"),g=s("./app/utils/discover/fields.tsx"),v=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const f=["api","children","organization","loading","queryBatching","generatePathname"],y=e=>l()(e,((e,t)=>f.includes(t)));class b extends r.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,n.Z)(this,"unmounting",!1),(0,n.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,onError:s,expired:n,name:r,hideError:a,...i}=this.props;let o,l=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),n)o=(0,p.t)("%s has an invalid date range. Please try a more recent date range.",r),(0,u.Iw)(o,{append:!0}),this.setState({errored:!0,errorMessage:o});else try{e.clear(),l=await(0,d.lI)(e,i)}catch(e){o=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,p.t)("Error loading chart data"),a||(0,u.Iw)(o),s&&s(o),this.setState({errored:!0,errorMessage:o})}this.unmounting||this.setState({reloading:!1,timeseriesData:l,fetchedWithPrevious:i.includePrevious})}})),(0,n.Z)(this,"getData",(e=>{const{fetchedWithPrevious:t}=this.state,{period:s,includePrevious:n}=this.props,r=t||(0,h.Sw)(n,s),a=Math.floor(e.length/2);return{current:r?e.slice(a):e,previous:r?e.slice(0,a):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){i()(y(e),y(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>1e3*e;return e.map(((e,s)=>{let[n,r]=e;return{name:t(n,r,s),value:r.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)}}))}transformPreviousPeriodData(e,t,s){return t?{seriesName:null!=s?s:"Previous",data:this.calculateTotalsPerTimestamp(t,((t,s,n)=>1e3*e[n][0])),stack:"previous"}:null}transformAggregatedTimeseries(e){return{seriesName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t){return[{seriesName:t||"Current",data:e.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)}}))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{comparisonCount:s}=t;return e+(null!=s?s:0)}),0)}}))}]}processData(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const{data:r,isMetricsData:a,totals:i}=e,{includeTransformedData:o,includeTimeAggregation:l,timeAggregationSeriesName:d,currentSeriesNames:u,previousSeriesNames:c,comparisonDelta:p}=this.props,{current:m,previous:g}=this.getData(r);return{data:o?this.transformTimeseriesData(m,null!=n?n:null==u?void 0:u[s]):[],comparisonData:o&&p?this.transformComparisonTimeseriesData(m):[],allData:r,originalData:m,totals:i,isMetricsData:a,originalPreviousData:g,previousData:o?this.transformPreviousPeriodData(m,g,null!==(t=n?(0,h.TE)(n):void 0)&&void 0!==t?t:null==c?void 0:c[s]):null,timeAggregatedData:l?this.transformAggregatedTimeseries(m,d||""):{},timeframe:e.start&&e.end?g?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...s}=this.props,{topEvents:n}=this.props,{timeseriesData:r,reloading:a,errored:i,errorMessage:o}=this.state,l=this.props.loading||null===r;if(t&&l)return(0,v.tZ)(c.Z,{"data-test-id":"events-request-loading"});if((0,h.Xe)(r,(0,m.ri)(n))){let t;const n={},d=Object.keys(r).map(((e,s)=>{const a=r[e],i=this.processData(a,s,(0,g.bQ)(e));return t||(t=i.timeframe),i.isMetricsData&&(n[e]={isMetricsData:i.isMetricsData}),[a.order||0,i.data[0],i.previousData,{isMetricsData:i.isMetricsData}]})).sort(((e,t)=>e[0]-t[0])),u=d.map((e=>e[1])),c=d.some((e=>null===e[2]))?void 0:d.map((e=>e[2]));return e({loading:l,reloading:a,errored:i,errorMessage:o,results:u,timeframe:t,previousTimeseriesData:c,seriesAdditionalInfo:n,...s})}if(r){var d,u;const{data:t,comparisonData:n,allData:c,originalData:h,totals:p,originalPreviousData:m,previousData:g,timeAggregatedData:v,timeframe:f,isMetricsData:y}=this.processData(r);return e({loading:l,reloading:a,errored:i,errorMessage:o,seriesAdditionalInfo:{[null!==(d=null===(u=this.props.currentSeriesNames)||void 0===u?void 0:u[0])&&void 0!==d?d:"current"]:{isMetricsData:y}},timeseriesData:t,comparisonTimeseriesData:n,allTimeseriesData:c,originalTimeseriesData:h,timeseriesTotals:p,originalPreviousTimeseriesData:m,previousTimeseriesData:g?[g]:g,timeAggregatedData:v,timeframe:f,...s})}return e({loading:l,reloading:a,errored:i,errorMessage:o,...s})}}b.displayName="EventsRequest",(0,n.Z)(b,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const T=b},"./app/components/charts/optionSelector.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),a=s("./app/components/featureBadge.tsx"),i=s("./app/components/forms/compactSelect.tsx"),o=s("./app/components/truncate.tsx"),l=s("./app/utils.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{options:t,onChange:s,selected:n,title:a,featureType:u,multiple:h,...p}=e;const m=(0,r.useMemo)((()=>t.map((e=>({...e,label:(0,d.tZ)(o.Z,{value:String(e.label),maxLength:60,expandDirection:"left"})})))),[t]);return(0,d.tZ)(i.Z,{options:m,value:n,onChange:function(e){s(h?e.map((e=>e.value)):e.value)},isOptionDisabled:function(e){return e.disabled||h&&3===n.length&&!n.includes(e.value)},multiple:h,triggerProps:{size:"small",borderless:!0,prefix:(0,d.BX)(r.Fragment,{children:[a,(0,l.ri)(u)?(0,d.tZ)(c,{type:u}):null]})},placement:"bottom right",...p})}u.displayName="OptionSelector";const c=(0,n.Z)(a.Z,{target:"e1a4edto0"})({name:"6og82r",styles:"margin-left:0px"}),h=u},"./app/components/externalIssues/abstractExternalIssueForm.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>g});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),a=s("../node_modules/lodash/debounce.js"),i=s.n(a),o=s("../node_modules/query-string/index.js"),l=s("./app/components/asyncComponent.tsx"),d=s("./app/components/forms/fieldFromConfig.tsx"),u=s("./app/components/forms/form.tsx"),c=s("./app/components/forms/model.tsx"),h=s("./app/components/questionTooltip.tsx"),p=s("./app/locale.tsx"),m=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class g extends l.Z{constructor(){var e;super(...arguments),e=this,(0,n.Z)(this,"shouldRenderBadRequests",!0),(0,n.Z)(this,"model",new c.Z),(0,n.Z)(this,"refetchConfig",(()=>{const{action:e,dynamicFieldValues:t}=this.state,s={action:e,...t},n=this.getEndPointString();this.api.request(n,{method:"GET",query:s,success:(e,t,s)=>{this.handleRequestSuccess({stateKey:"integrationDetails",data:e,resp:s},!0)},error:e=>{this.handleError(e,["integrationDetails",n,null,null])}})})),(0,n.Z)(this,"getConfigName",(()=>{const{action:e}=this.state;switch(e){case"create":return"createIssueConfig";case"link":return"linkIssueConfig";default:throw new Error("illegal action")}})),(0,n.Z)(this,"getDynamicFields",(e=>{const{integrationDetails:t}=this.state,s=(e||t||{})[this.getConfigName()];return Object.fromEntries((s||[]).filter((e=>e.updatesForm)).map((e=>[e.name,e.default||null])))})),(0,n.Z)(this,"onRequestSuccess",(e=>{let{stateKey:t,data:s}=e;"integrationDetails"===t&&(this.handleReceiveIntegrationDetails(s),this.setState({dynamicFieldValues:this.getDynamicFields(s)}))})),(0,n.Z)(this,"onFieldChange",((e,t)=>{const{dynamicFieldValues:s}=this.state;this.getDynamicFields().hasOwnProperty(e)&&s&&(s[e]=t,this.setState({dynamicFieldValues:s,reloading:!0,error:!1,remainingRequests:1},this.refetchConfig))})),(0,n.Z)(this,"updateFetchedFieldOptionsCache",((e,t)=>{const{fetchedFieldOptionsCache:s}=this.state;this.setState({fetchedFieldOptionsCache:{...s,[e.name]:t.map((e=>[e.value,e.label]))}})})),(0,n.Z)(this,"ensureCurrentOption",((e,t)=>{const s=this.getDefaultOptions(e).find((t=>t.value===this.model.getValue(e.name)));if(!s)return t;"string"==typeof s.label&&(s.label=(0,m.BX)(r.Fragment,{children:[(0,m.tZ)(h.Z,{title:(0,p._N)("This is your current [label].",{label:e.label}),size:"xs"})," ",s.label]}));const n=t.findIndex((e=>e.value===(null==s?void 0:s.value)));if(n>=0){const e=t;return e[n]=s,e}return[...t,s]})),(0,n.Z)(this,"getOptions",((e,t)=>new Promise(((s,n)=>t?this.debouncedOptionLoad(e,t,((t,r)=>{t?n(t):(r=this.ensureCurrentOption(e,r),this.updateFetchedFieldOptionsCache(e,r),s(r))})):s(this.getDefaultOptions(e)))))),(0,n.Z)(this,"debouncedOptionLoad",i()((async(e,t,s)=>{const{dynamicFieldValues:n}=this.state,r=o.stringify({...n,field:e.name,query:t}),a=e.url||"",i=a.includes("?")?"&":"?";try{const e=await fetch(a+i+r);s(null,e.ok?await e.json():[])}catch(e){s(e)}}),200,{trailing:!0})),(0,n.Z)(this,"getDefaultOptions",(e=>(e.choices||[]).map((e=>{let[t,s]=e;return{value:t,label:s}})))),(0,n.Z)(this,"getFieldProps",(e=>e.url?{async:!0,autoload:!0,cache:!1,loadOptions:t=>this.getOptions(e,t),defaultOptions:this.getDefaultOptions(e),onBlurResetsInput:!1,onCloseResetsInput:!1,onSelectResetsInput:!1}:{})),(0,n.Z)(this,"handleReceiveIntegrationDetails",(e=>{})),(0,n.Z)(this,"renderNavTabs",(()=>null)),(0,n.Z)(this,"renderBodyText",(()=>null)),(0,n.Z)(this,"getTitle",(()=>(0,p._N)("Issue Link Settings",{}))),(0,n.Z)(this,"getFormProps",(()=>{throw new Error("Method 'getFormProps()' must be implemented.")})),(0,n.Z)(this,"getDefaultFormProps",(()=>({footerClass:"modal-footer",onFieldChange:this.onFieldChange,submitDisabled:this.state.reloading,model:this.model}))),(0,n.Z)(this,"getCleanedFields",(()=>{const{fetchedFieldOptionsCache:e,integrationDetails:t}=this.state;return((t||{})[this.getConfigName()]||[]).map((t=>{const s={...t};return null!=e&&e.hasOwnProperty(t.name)&&(s.choices=e[t.name]),s}))})),(0,n.Z)(this,"renderForm",(function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(t||[]).reduce(((e,t)=>(e[t.name]=t.multiple&&t.default===[]?"":t.default,e)),{}),{Header:a,Body:i}=e.props;return(0,m.BX)(r.Fragment,{children:[(0,m.tZ)(a,{closeButton:!0,children:e.getTitle()}),e.renderNavTabs(),(0,m.tZ)(i,{children:e.shouldRenderLoading?e.renderLoading():(0,m.BX)(r.Fragment,{children:[e.renderBodyText(),(0,m.tZ)(u.Z,{initialData:n,...e.getFormProps(),children:(t||[]).filter((e=>e.hasOwnProperty("name"))).map((e=>({...e,noOptionsMessage:()=>"No options. Type to search."}))).map(((t,n)=>(0,m.BX)(r.Fragment,{children:[(0,m.tZ)(d.Z,{disabled:e.state.reloading,field:t,flexibleControlStateSize:!0,inline:!1,stacked:!0,...e.getFieldProps(t)}),s[t.name]&&s[t.name]]},`${t.name}-${n}`)))})]})})]})}))}getDefaultState(){return{...super.getDefaultState(),action:"create",dynamicFieldValues:null,fetchedFieldOptionsCache:{},integrationDetails:null}}getEndPointString(){throw new Error("Method 'getEndPointString()' must be implemented.")}renderComponent(){return this.state.error?this.renderError(new Error("Unable to load all required endpoints")):this.renderBody()}}},"./app/components/selectMembers/index.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>T});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),i=s("../node_modules/lodash/debounce.js"),o=s.n(i),l=s("./app/components/forms/selectControl.tsx"),d=s("./app/components/idBadge/index.tsx"),u=s("./app/components/tooltip.tsx"),c=s("./app/locale.tsx"),h=s("./app/stores/memberListStore.tsx"),p=s("./app/utils/callIfFunction.tsx"),m=s("./app/utils/withApi.tsx"),g=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const v=e=>`${e.email&&e.email.toLowerCase()} ${e.name&&e.name.toLowerCase()}`;class f extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{loading:!1,inputValue:"",options:null,memberListLoading:!h.Z.isLoaded()}),(0,n.Z)(this,"unlisteners",[h.Z.listen((()=>{this.setState({memberListLoading:!h.Z.isLoaded()})}),void 0)]),(0,n.Z)(this,"renderUserBadge",(e=>(0,g.tZ)(d.Z,{avatarSize:24,user:e,hideEmail:!0,useLink:!1}))),(0,n.Z)(this,"createMentionableUser",(e=>({value:e.id,label:this.renderUserBadge(e),searchKey:v(e),actor:{type:"user",id:e.id,name:e.name}}))),(0,n.Z)(this,"createUnmentionableUser",(e=>{let{user:t}=e;return{...this.createMentionableUser(t),disabled:!0,label:(0,g.tZ)(y,{children:(0,g.tZ)(u.Z,{position:"left",title:(0,c.t)("%s is not a member of project",t.name||t.email),children:this.renderUserBadge(t)})})}})),(0,n.Z)(this,"handleChange",(e=>{this.props.onChange(e)})),(0,n.Z)(this,"handleInputChange",(e=>{this.setState({inputValue:e}),this.props.onInputChange&&this.props.onInputChange(e)})),(0,n.Z)(this,"queryMembers",o()(((e,t)=>{const{api:s,organization:n}=this.props;return s?s.requestPromise(`/organizations/${n.slug}/members/`,{query:{query:e}}).then((e=>t(null,e)),(e=>t(e))):null}),250)),(0,n.Z)(this,"handleLoadOptions",(()=>{const e=this.getMentionableUsers(),t=e.map((e=>{let{actor:t}=e;return t.id}));return new Promise(((e,t)=>{this.queryMembers(this.state.inputValue,((s,n)=>{s?t(s):e(n)}))})).then((e=>e?e.filter((e=>{let{user:s}=e;return s&&-1===t.indexOf(s.id)})).map(this.createUnmentionableUser):[])).then((t=>{const s=[...e,...t];return this.setState({options:s}),s}))}))}componentWillUnmount(){this.unlisteners.forEach(p.g)}getMentionableUsers(){return h.Z.getAll().map(this.createMentionableUser)}render(){var e;const{placeholder:t,styles:s}=this.props;return this.state.memberListLoading?(0,g.tZ)(b,{isDisabled:!0,placeholder:(0,c.t)("Loading")}):(0,g.tZ)(b,{filterOption:(e,t)=>{var s,n;return(null==e||null===(s=e.data)||void 0===s||null===(n=s.searchKey)||void 0===n?void 0:n.indexOf(t))>-1},loadOptions:this.handleLoadOptions,isOptionDisabled:e=>e.disabled,defaultOptions:!0,async:!0,isDisabled:this.props.disabled,cacheOptions:!1,placeholder:t,onInputChange:this.handleInputChange,onChange:this.handleChange,value:null===(e=this.state.options)||void 0===e?void 0:e.find((e=>{let{value:t}=e;return t===this.props.value})),styles:{...null!=s?s:{},option:(e,t)=>({...e,svg:{color:t.isSelected&&t.theme.white}})}})}}f.displayName="SelectMembers";const y=(0,r.Z)("div",{target:"efbhsy21"})({name:"v6ye5b",styles:"display:flex;opacity:0.5;overflow:hidden"}),b=(0,r.Z)(l.Z,{target:"efbhsy20"})({name:"1b41ikp",styles:".Select-value{display:flex;align-items:center;}.Select-input{margin-left:32px;}"}),T=(0,m.Z)(f)},"./app/utils/discover/charts.tsx":(e,t,s)=>{"use strict";s.d(t,{CX:()=>o,gu:()=>l});var n=s("./app/locale.tsx"),r=s("./app/utils.tsx"),a=s("./app/utils/discover/fields.tsx"),i=s("./app/utils/formatters.tsx");function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(0,r.ri)(e))return"—";switch((0,a.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,i.rl)(e,2);case"duration":return(0,i.g9)(e/1e3,2,!0);default:return e.toString()}}function l(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch((0,a.Px)(t)){case"integer":case"number":return s?(0,i.Du)(e):e.toLocaleString();case"percentage":return(0,i.rl)(e,0);case"duration":return d(e);default:return e.toString()}}function d(e){if(0===e)return"0";if(e>=i.ps){const t=(e/i.ps).toFixed(0);return(0,n.t)("%swk",t)}if(e>=i.x4){const t=(e/i.x4).toFixed(0);return(0,n.t)("%sd",t)}if(e>=i.kr){const t=(e/i.kr).toFixed(0);return(0,n.t)("%shr",t)}if(e>=i.EB){const t=(e/i.EB).toFixed(0);return(0,n.t)("%smin",t)}if(e>=i.sh){const t=(e/i.sh).toFixed(0);return(0,n.t)("%ss",t)}const t=e.toFixed(0);return(0,n.t)("%sms",t)}},"./app/utils/environment.tsx":(e,t,s)=>{"use strict";function n(e){return e.name?encodeURIComponent(e.name):e.displayName?encodeURIComponent(e.displayName):"none"}function r(e){return e.name||e.displayName||"(No Environment)"}s.d(t,{G:()=>r,z:()=>n})},"./app/utils/performance/urls.ts":(e,t,s)=>{"use strict";s.d(t,{D:()=>a});var n=s("./app/components/events/interfaces/spans/utils.tsx"),r=s("./app/utils.tsx");function a(e,t,s,a,i){const o={...a||{},transaction:s};(0,r.ri)(o.transaction)||delete o.transaction;const l={pathname:`/organizations/${e}/performance/${t}/`,query:o,hash:(0,r.ri)(i)?(0,n.ct)(i):void 0};return(0,r.ri)(l.hash)||delete l.hash,l}},"./app/utils/recreateRoute.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s("../node_modules/lodash/findLastIndex.js"),r=s.n(n),a=s("./app/utils/replaceRouterParams.tsx");function i(e,t){var s,n;const{routes:i,params:o,location:l,stepBack:d}=t,u=i.map((e=>{let{path:t}=e;return t||""}));let c,h;"string"!=typeof e?(h=i.indexOf(e)+1,c=r()(u.slice(0,h),(e=>"/"===e[0]))):c=r()(u,(e=>"/"===e[0]));let p=u.slice(c,h);void 0!==d&&(p=p.slice(0,d));const m=null!==(s=null==l?void 0:l.search)&&void 0!==s?s:"",g=null!==(n=null==l?void 0:l.hash)&&void 0!==n?n:"",v=`${p.join("")}${"string"!=typeof e?"":e}${m}${g}`;return(0,a.Z)(v,o)}},"./app/utils/replaceAtArrayIndex.tsx":(e,t,s)=>{"use strict";function n(e,t,s){const n=[...e];return n.splice(t,1,s),n}s.d(t,{m:()=>n}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js")},"./app/utils/routeTitle.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=function(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;const r=`${e} - ${t}`,a=n?`${r} - ${n}`:r;return s?`${a} - Sentry`:a}},"./app/views/alerts/builder/builderBreadCrumbs.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>v});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react-router/es/index.js")),a=s("./app/components/breadcrumbs.tsx"),i=s("./app/components/idBadge/index.tsx"),o=s("./app/locale.tsx"),l=s("./app/styles/space.tsx"),d=s("./app/utils/isActiveSuperuser.tsx"),u=s("./app/utils/recreateRoute.tsx"),c=s("./app/utils/useProjects.tsx"),h=s("./app/views/settings/components/settingsBreadcrumb/menuItem.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{title:t,alertName:s,projectSlug:n,routes:a,canChangeProject:l,location:m,organization:v,alertType:f}=e;const{projects:y}=(0,c.Z)(),b=(0,d.M)(),T=y.find((e=>{let{slug:t}=e;return n===t})),Z=v.features.includes("alert-wizard-v3"),x=(0,p.tZ)(i.Z,{project:null!=T?T:{slug:n},avatarSize:18,disableLink:!0}),S={to:`/organizations/${v.slug}/alerts/rules/?project=${null==T?void 0:T.id}`,label:x},C=l?{onSelect:e=>{let{value:t}=e;r.browserHistory.push((0,u.Z)("",{routes:a,params:Z?{orgId:v.slug,alertType:f}:{orgId:v.slug,projectId:t},location:m}))},label:x,items:y.filter((e=>e.isMember||b)).map(((e,t)=>({index:t,value:e.slug,label:(0,p.tZ)(h.Z,{children:(0,p.tZ)(i.Z,{project:e,avatarProps:{consistentWidth:!0},avatarSize:18,disableLink:!0})}),searchKey:e.slug})))}:S,A=[{to:`/organizations/${v.slug}/alerts/rules/`,label:(0,o.t)("Alerts"),preservePageFilters:!0},...Z?[]:[C],{label:t,...s?{to:`/organizations/${v.slug}/alerts/${n}/wizard`,preservePageFilters:!0}:{}}];return s&&A.push({label:s}),(0,p.tZ)(g,{crumbs:A})}m.displayName="BuilderBreadCrumbs";const g=(0,n.Z)(a.Z,{target:"eykqk0t0"})("font-size:18px;margin-bottom:",(0,l.Z)(3),";"),v=m},"./app/views/alerts/rules/issue/index.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>Je});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),i=s("../node_modules/react-router/es/index.js"),o=s("../node_modules/react-select/dist/index-4322c0ed.browser.esm.js"),l=s("../node_modules/classnames/index.js"),d=s.n(l),u=s("../node_modules/lodash/cloneDeep.js"),c=s.n(u),h=s("../node_modules/lodash/omit.js"),p=s.n(h),m=s("../node_modules/lodash/set.js"),g=s.n(m),v=s("./app/actionCreators/indicator.tsx"),f=s("./app/actionCreators/onboardingTasks.tsx"),y=s("./app/components/acl/access.tsx"),b=s("./app/components/acl/feature.tsx"),T=s("./app/components/alert.tsx"),Z=s("./app/components/button.tsx"),x=s("./app/components/confirm.tsx"),S=s("./app/components/forms/controls/input.tsx"),C=s("./app/components/forms/field/index.tsx"),A=s("./app/components/forms/field/fieldHelp.tsx"),E=s("./app/components/forms/form.tsx"),R=s("./app/components/forms/formField/index.tsx"),w=s("./app/components/forms/selectControl.tsx"),_=s("./app/components/forms/selectField.tsx"),I=s("./app/components/forms/teamSelector.tsx"),j=s("./app/components/idBadge/index.tsx"),N=s("./app/components/list/index.tsx"),D=s("./app/components/list/listItem.tsx"),O=s("./app/components/loadingMask.tsx"),F=s("./app/components/panels/index.tsx"),z=s("./app/constants/index.tsx"),P=s("./app/icons/index.tsx"),M=s("./app/locale.tsx"),q=s("./app/styles/space.tsx"),U=s("./app/types/index.tsx"),L=s("./app/utils/analytics.tsx"),V=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),k=s("./app/utils/environment.tsx"),W=s("./app/utils/isActiveSuperuser.tsx"),B=s("./app/utils/recreateRoute.tsx"),$=s("./app/utils/routeTitle.tsx"),H=s("./app/utils/withOrganization.tsx"),X=s("./app/utils/withProjects.tsx");const Y=["sentry.rules.conditions.event_frequency.EventFrequencyCondition","sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition","sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition"],G={"sentry.rules.conditions.event_frequency.EventFrequencyCondition":"Number of events in an issue is...","sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition":"Number of users affected by an issue is...","sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition":"Percent of sessions affected by an issue is..."},K={count:"more than {value} in {interval}",percent:"{value}% higher in {interval} compared to {comparisonInterval} ago"},Q=[["count",K.count],["percent",K.percent]],J=[["5m","5 minutes"],["15m","15 minutes"],["1h","one hour"],["1d","one day"],["1w","one week"],["30d","30 days"]];var ee=s("./app/views/asyncView.tsx"),te=s("./app/components/featureBadge.tsx"),se=s("./app/views/projectInstall/issueAlertOptions.tsx"),ne=s("./app/actionCreators/modal.tsx"),re=s("./app/components/links/externalLink.tsx"),ae=s("./app/data/platformCategories.tsx");let ie,oe;!function(e){e.IssueOwners="IssueOwners",e.Team="Team",e.Member="Member"}(ie||(ie={})),function(e){e.Unassigned="Unassigned",e.Team="Team",e.Member="Member"}(oe||(oe={}));var le=s("./app/components/selectMembers/index.tsx"),de=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class ue extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"handleChange",((e,t)=>{const{onChange:s,ruleData:n}=this.props;if(t===n[e])return;const r={...n,[e]:t};"targetType"===e&&(r.targetIdentifier=""),s(r)})),(0,n.Z)(this,"handleChangeActorType",(e=>{this.handleChange("targetType",e.value)})),(0,n.Z)(this,"handleChangeActorId",(e=>{this.handleChange("targetIdentifier",e.value)}))}render(){const{disabled:e,loading:t,project:s,organization:n,ruleData:r,memberValue:a,teamValue:i,options:o}=this.props,l=r.targetType===i,d=r.targetType===a,u={control:e=>({...e,minHeight:"28px",height:"28px"})};return(0,de.BX)(ce,{children:[(0,de.tZ)(w.Z,{isClearable:!1,isDisabled:e||t,value:r.targetType,styles:u,options:o,onChange:this.handleChangeActorType}),l?(0,de.tZ)(I.Z,{disabled:e,project:s,value:`${r.targetIdentifier}`,styles:u,onChange:this.handleChangeActorId,useId:!0},i):d?(0,de.tZ)(le.Z,{disabled:e,project:s,organization:n,value:`${r.targetIdentifier}`,styles:u,onChange:this.handleChangeActorId},l?i:a):null]})}}ue.displayName="MemberTeamFields";const ce=(0,r.Z)(F.Lv,{target:"e7hhv040"})("display:grid;grid-template-columns:200px 200px;padding:0;align-items:center;gap:",(0,q.Z)(2),";"),he=ue;var pe=s("./app/views/alerts/rules/issue/sentryAppRuleModal.tsx"),me=s("./app/components/externalIssues/abstractExternalIssueForm.tsx");const ge=["Sprint"];class ve extends me.Z{constructor(){super(...arguments),(0,n.Z)(this,"handleReceiveIntegrationDetails",(e=>{this.setState({issueConfigFieldsCache:e[this.getConfigName()]})})),(0,n.Z)(this,"getValidAndSavableFieldNames",(()=>{const{issueConfigFieldsCache:e}=this.state;return(e||[]).filter((e=>e.hasOwnProperty("name"))).map((e=>e.name))})),(0,n.Z)(this,"cleanData",(e=>{const{instance:t}=this.props,{issueConfigFieldsCache:s}=this.state,n=this.getValidAndSavableFieldNames(),r={};null!=t&&t.hasOwnProperty("integration")&&(r.integration=t.integration),r.dynamic_form_fields=s;for(const[t,s]of Object.entries(e))n.includes(t)&&(r[t]=s);return r})),(0,n.Z)(this,"onFormSubmit",((e,t,s,n,r)=>{const{onSubmitAction:a,closeModal:i}=this.props,{fetchedFieldOptionsCache:o}=this.state;n.preventDefault(),n.stopPropagation(),r.validateForm()&&(a(this.cleanData(e),o),(0,v.S9)((0,M.t)("Changes applied.")),i())})),(0,n.Z)(this,"getFormProps",(()=>{const{closeModal:e}=this.props;return{...this.getDefaultFormProps(),cancelLabel:(0,M.t)("Close"),onCancel:e,onSubmit:this.onFormSubmit,submitLabel:(0,M.t)("Apply Changes")}})),(0,n.Z)(this,"cleanFields",(()=>{const{instance:e}=this.props,t=[{name:"title",label:"Title",type:"string",default:"This will be the same as the Sentry Issue.",disabled:!0},{name:"description",label:"Description",type:"string",default:"This will be generated from the Sentry Issue details.",disabled:!0}];return t.concat(this.getCleanedFields().filter((e=>!t.map((e=>e.name)).includes(e.name))).map((t=>(e.hasOwnProperty(t.name)&&(t.default=e[t.name]||t.default),t))))})),(0,n.Z)(this,"renderBodyText",(()=>{const{ticketType:e,link:t}=this.props;return(0,de.tZ)(fe,{children:(0,M._N)("When this alert is triggered [ticketType] will be created with the following fields. It will also [linkToDocs] with the new Sentry Issue.",{linkToDocs:(0,de.tZ)(re.Z,{href:t,children:(0,M.t)("stay in sync")}),ticketType:e})})}))}getDefaultState(){const{instance:e}=this.props,t=Object.values((null==e?void 0:e.dynamic_form_fields)||{});return{...super.getDefaultState(),fetchedFieldOptionsCache:Object.fromEntries(t.map((e=>[e.name,e.choices]))),issueConfigFieldsCache:t}}getEndpoints(){const{instance:e}=this.props,t=(e.dynamic_form_fields||[]).filter((e=>e.updatesForm)).filter((t=>e.hasOwnProperty(t.name))).reduce(((t,s)=>{let{name:n}=s;return t[n]=e[n],t}),{action:"create"});return[["integrationDetails",this.getEndPointString(),{query:t}]]}getEndPointString(){const{instance:e,organization:t}=this.props;return`/organizations/${t.slug}/integrations/${e.integration}/?ignored=${ge}`}getErrors(){const e={};for(const t of this.cleanFields())"select"===t.type&&t.default&&((t.choices||[]).find((e=>{let[s,n]=e;return Array.isArray(t.default)?t.default.includes(s):s===t.default}))||(e[t.name]=(0,de.tZ)(ye,{children:`Could not fetch saved option for ${t.label}. Please reselect.`})));return e}render(){return this.renderForm(this.cleanFields(),this.getErrors())}}ve.displayName="TicketRuleModal";const fe=(0,r.Z)("div",{target:"e1bl7x491"})("margin-bottom:",(0,q.Z)(3),";"),ye=(0,r.Z)("label",{target:"e1bl7x490"})("padding-bottom:",(0,q.Z)(2),";color:",(e=>e.theme.errorText),";"),be=ve;function Te(e){let{data:t,index:s,disabled:n,name:r,fieldConfig:i,onPropertyChange:o}=e;const l=t[r]&&"boolean"!=typeof t[r]?t[r]:"";return(0,a.useEffect)((()=>{""!==l||"sentry.rules.filters.issue_occurrences.IssueOccurrencesFilter"!==t.id||isNaN(Number(i.placeholder))||o(s,r,`${i.placeholder}`)}),[o,s,r,i.placeholder,t.id]),(0,de.tZ)(we,{type:"number",name:r,value:l,placeholder:`${i.placeholder}`,disabled:n,onChange:e=>o(s,r,e.target.value)})}function Ze(e){let{data:t,organization:s,project:n,disabled:r,onMemberTeamChange:a}=e;const i=void 0!==t.targetType&&`${t.targetType}`.length>0;return(0,de.tZ)(he,{disabled:r,project:n,organization:s,loading:!i,ruleData:t,onChange:a,options:[{value:oe.Unassigned,label:(0,M.t)("No One")},{value:oe.Team,label:(0,M.t)("Team")},{value:oe.Member,label:(0,M.t)("Member")}],memberValue:oe.Member,teamValue:oe.Team})}function xe(e){let{data:t,organization:s,project:n,disabled:r,onMemberTeamChange:a}=e;const i=void 0!==t.targetType&&`${t.targetType}`.length>0;return(0,de.tZ)(he,{disabled:r,project:n,organization:s,loading:!i,ruleData:t,onChange:a,options:[{value:ie.IssueOwners,label:(0,M.t)("Issue Owners")},{value:ie.Team,label:(0,M.t)("Team")},{value:ie.Member,label:(0,M.t)("Member")}],memberValue:ie.Member,teamValue:ie.Team})}function Se(e){let t,{data:s,disabled:n,index:r,onPropertyChange:a,onReset:i,name:o,fieldConfig:l}=e;t=void 0===s[o]&&l.choices.length?l.initial?`${l.initial}`:`${l.choices[0][0]}`:`${s[o]}`;const d=l.choices.map((e=>{let[t,s]=e;return{value:`${t}`,label:s}}));return(0,de.tZ)(_e,{isClearable:!1,name:o,value:t,styles:{control:e=>({...e,minHeight:"28px",height:"28px"})},disabled:n,options:d,onChange:e=>{let{value:t}=e;l.resetsForm?i(r,o,t):a(r,o,t)}})}function Ce(e){let{data:t,index:s,onPropertyChange:n,disabled:r,name:a,fieldConfig:i}=e;const o=t[a]&&"boolean"!=typeof t[a]?t[a]:"";return(0,de.tZ)(Re,{type:"text",name:a,value:o,placeholder:`${i.placeholder}`,disabled:r,onChange:e=>n(s,a,e.target.value)})}function Ae(e){let{index:t,data:s,node:n,organization:r,project:i,disabled:o,onDelete:l,onPropertyChange:d,onReset:u}=e;const c=(0,a.useCallback)((()=>{l(t)}),[t,l]),h=(0,a.useCallback)((e=>{let{targetType:s,targetIdentifier:n}=e;d(t,"targetType",`${s}`),d(t,"targetIdentifier",`${n}`)}),[t,d]);function p(e,n){const a={index:t,name:e,fieldConfig:n,data:s,organization:r,project:i,disabled:o,onMemberTeamChange:h,onPropertyChange:d,onReset:u};switch(n.type){case"choice":return(0,de.tZ)(Se,{...a});case"number":return(0,de.tZ)(Te,{...a});case"string":return(0,de.tZ)(Ce,{...a});case"mailAction":return(0,de.tZ)(xe,{...a});case"assignee":return(0,de.tZ)(Ze,{...a});default:return null}}const m=(0,a.useCallback)(((e,s)=>{e.dynamic_form_fields=(e.dynamic_form_fields||[]).map((t=>(t.name in e&&null!=s&&s.hasOwnProperty(t.name)&&(t.choices=s[t.name]),t)));for(const[s,n]of Object.entries(e))d(t,s,n)}),[t,d]),g=(0,a.useCallback)((e=>{for(const[s,n]of Object.entries(e))d(t,s,n)}),[t,d]),{actionType:v,id:f,sentryAppInstallationUuid:y}=n||{},b="ticket"===v,T="sentryapp"===v&&y,x=f===se.r;return(0,de.BX)(Ne,{children:[(0,de.BX)(je,{children:[(0,de.BX)(De,{children:[x&&(0,de.tZ)(ze,{type:"new"}),(0,de.tZ)("input",{type:"hidden",name:"id",value:s.id}),function(){if(!n)return(0,de.tZ)(Ie,{children:"This node failed to render. It may have migrated to another section of the alert conditions"});const{label:e,formFields:t}=n,r=e.split(/({\w+})/).map(((e,n)=>{if(!/^{\w+}$/.test(e))return(0,de.tZ)(Ie,{children:e},n);const r=e.slice(1,-1);return"value"!==r||"is"!==s.match&&"ns"!==s.match?(0,de.tZ)(Ie,{children:t&&t.hasOwnProperty(r)?p(r,t[r]):e},r):null})),[i,...o]=r;return(0,de.BX)(a.Fragment,{children:[i,o]})}(),b&&n&&(0,de.tZ)(Z.ZP,{size:"small",icon:(0,de.tZ)(P.iC,{size:"xs"}),type:"button",onClick:()=>(0,ne.openModal)((e=>(0,de.tZ)(be,{...e,formFields:n.formFields||{},link:n.link,ticketType:n.ticketType,instance:s,index:t,onSubmitAction:m,organization:r}))),children:(0,M.t)("Issue Link Settings")}),T&&n&&(0,de.tZ)(Z.ZP,{size:"small",icon:(0,de.tZ)(P.iC,{size:"xs"}),type:"button",disabled:Boolean(s.disabled)||o,onClick:()=>{(0,ne.openModal)((e=>(0,de.tZ)(pe.Z,{...e,sentryAppInstallationUuid:y,config:n.formFields,appName:n.prompt,onSubmitSuccess:g,resetValues:s})),{allowClickClose:!1})},children:(0,M.t)("Settings")})]}),(0,de.tZ)(Oe,{disabled:o,"aria-label":(0,M.t)("Delete Node"),onClick:c,type:"button",size:"small",icon:(0,de.tZ)(P.Fz,{})})]}),s.id===se.r?i.platform&&ae.an.includes(i.platform)?(0,de.tZ)(Fe,{type:"warning",children:(0,M._N)("Percent of sessions affected is approximated by the ratio of the issue frequency to the number of sessions in the project. [link:Learn more.]",{link:(0,de.tZ)(re.Z,{href:"https://docs.sentry.io/product/alerts/create-alerts/issue-alert-config/"})})}):(0,de.tZ)(Fe,{type:"error",children:(0,M._N)("This project doesn't support sessions. [link:View supported platforms]",{link:(0,de.tZ)(re.Z,{href:"https://docs.sentry.io/product/releases/health/setup/"})})}):"sentry.integrations.slack.notify_action.SlackNotifyServiceAction"===s.id?(0,de.tZ)(Fe,{type:"info",showIcon:!0,trailingItems:(0,de.tZ)(Z.ZP,{href:"https://docs.sentry.io/product/integrations/notification-incidents/slack/#rate-limiting-error",size:"xsmall",children:(0,M.t)("Learn More")}),children:(0,M.t)("Having rate limiting problems? Enter a channel or user ID.")}):"sentry.mail.actions.NotifyEmailAction"===s.id&&s.targetType===ie.IssueOwners?(0,de.tZ)(Fe,{type:"warning",children:(0,M._N)("If there are no matching [issueOwners], ownership is determined by the [ownershipSettings].",{issueOwners:(0,de.tZ)(re.Z,{href:"https://docs.sentry.io/product/error-monitoring/issue-owners/",children:(0,M.t)("issue owners")}),ownershipSettings:(0,de.tZ)(re.Z,{href:`/settings/${r.slug}/projects/${i.slug}/ownership/`,children:(0,M.t)("ownership settings")})})}):null]})}Te.displayName="NumberField",Ze.displayName="AssigneeFilterFields",xe.displayName="MailActionFields",Se.displayName="ChoiceField",Ce.displayName="TextField",Ae.displayName="RuleNode";const Ee=Ae,Re=(0,r.Z)(S.Z,{target:"e1tfo63u9"})({name:"1jf5uxw",styles:"width:auto;height:28px"}),we=(0,r.Z)(S.Z,{target:"e1tfo63u8"})({name:"oshb5x",styles:"width:90px;height:28px"}),_e=(0,r.Z)(w.Z,{target:"e1tfo63u7"})({name:"educr3",styles:"width:180px"}),Ie=(0,r.Z)("span",{target:"e1tfo63u6"})("margin-right:",(0,q.Z)(1),";padding-top:",(0,q.Z)(.5),";padding-bottom:",(0,q.Z)(.5),";"),je=(0,r.Z)("div",{target:"e1tfo63u5"})("display:flex;align-items:center;padding:",(0,q.Z)(1),";"),Ne=(0,r.Z)("div",{target:"e1tfo63u4"})("background-color:",(e=>e.theme.backgroundSecondary),";border-radius:",(e=>e.theme.borderRadius),";border:1px ",(e=>e.theme.innerBorder)," solid;"),De=(0,r.Z)("div",{target:"e1tfo63u3"})({name:"c61zw8",styles:"display:flex;align-items:center;flex:1;flex-wrap:wrap"}),Oe=(0,r.Z)(Z.ZP,{target:"e1tfo63u2"})({name:"ozd7xs",styles:"flex-shrink:0"}),Fe=(0,r.Z)(T.Z,{target:"e1tfo63u1"})("border-top-left-radius:0;border-top-right-radius:0;border-width:0;border-top:1px ",(e=>e.theme.innerBorder)," solid;margin:0;padding:",(0,q.Z)(1)," ",(0,q.Z)(1),";font-size:",(e=>e.theme.fontSizeSmall),";"),ze=(0,r.Z)(te.Z,{target:"e1tfo63u0"})("margin:0 ",(0,q.Z)(1)," 0 0;");class Pe extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"propertyChangeTimeout",void 0),(0,n.Z)(this,"getNode",((e,t)=>{const{nodes:s,items:n,organization:r,onPropertyChange:a}=this.props,i=s?s.find((t=>t.id===e)):null;if(!i)return null;if(!r.features.includes("change-alerts")||!Y.includes(i.id))return i;const o=n[t];let l={...i,label:i.label.replace("..."," {comparisonType}"),formFields:{...i.formFields,comparisonType:{type:"choice",choices:Q,initial:"select"}}};return!o.comparisonType&&o.value&&o.name&&(o.comparisonType=void 0===o.comparisonInterval?"count":"percent"),o.comparisonType&&(l={...l,label:l.label.replace("{comparisonType}",K[o.comparisonType])},"percent"===o.comparisonType&&(o.comparisonInterval||(window.clearTimeout(this.propertyChangeTimeout),this.propertyChangeTimeout=window.setTimeout((()=>a(t,"comparisonInterval","1w")))),l={...l,formFields:{...l.formFields,comparisonInterval:{type:"choice",choices:J,initial:"1w"}}})),l}))}componentWillUnmount(){window.clearTimeout(this.propertyChangeTimeout)}render(){var e,t;const{onAddRow:s,onResetRow:n,onDeleteRow:r,onPropertyChange:i,nodes:o,placeholder:l,items:d,organization:u,project:c,disabled:h,error:p,selectType:m}=this.props,g=null===(e=c.features)||void 0===e||null===(t=e.includes)||void 0===t?void 0:t.call(e,"issue-alerts-targeting"),v=o?o.filter((e=>{let{enabled:t}=e;return t})):[],f=e=>e.map((e=>{var t;const s=e.id===se.r;return e.id.includes("NotifyEmailAction")?{value:e.id,label:(0,M.t)("Issue Owners, Team, or Member")}:{value:e.id,label:(0,de.BX)(a.Fragment,{children:[s&&(0,de.tZ)(Le,{type:"new",noTooltip:!0}),g&&(null===(t=e.prompt)||void 0===t?void 0:t.length)>0?e.prompt:e.label]})}}));let y=m?[]:f(v);if("grouped"===m){const e=v.reduce(((e,t)=>("ticket"===t.actionType?e.ticket.push(t):t.id.includes("event_frequency")?e.frequency.push(t):t.id.includes("sentry.rules.conditions")&&!t.id.includes("event_frequency")?e.change.push(t):t.id.includes("sentry.integrations")||t.id.includes("notify_event")?e.notifyIntegration.push(t):e.notify.push(t),e)),{notify:[],notifyIntegration:[],ticket:[],change:[],frequency:[]});y=Object.entries(e).filter((e=>{let[t,s]=e;return s.length})).map((e=>{let[t,s]=e;return{label:{notify:(0,M.t)("Send notification to…"),notifyIntegration:(0,M.t)("Notify integration…"),ticket:(0,M.t)("Create new…"),change:(0,M.t)("Issue state change"),frequency:(0,M.t)("Issue frequency")}[t],options:f(s)}}))}return(0,de.BX)(a.Fragment,{children:[(0,de.BX)(Ue,{children:[p,d.map(((e,t)=>(0,de.tZ)(Ee,{index:t,node:this.getNode(e.id,t),onDelete:r,onPropertyChange:i,onReset:n,data:e,organization:u,project:c,disabled:h},t)))]}),(0,de.tZ)(qe,{placeholder:l,value:null,onChange:e=>s(e?e.value:e),options:y,disabled:h})]})}}Pe.displayName="RuleNodeList";const Me=Pe,qe=(0,r.Z)(w.Z,{target:"e13db82a2"})({name:"1d3w5wq",styles:"width:100%"}),Ue=(0,r.Z)("div",{target:"e13db82a1"})("display:grid;margin-bottom:",(0,q.Z)(1),";gap:",(0,q.Z)(1),";@media (max-width: ",(e=>e.theme.breakpoints.medium),"){grid-auto-flow:row;}"),Le=(0,r.Z)(te.Z,{target:"e13db82a0"})("margin:0 ",(0,q.Z)(1)," 0 0;");var Ve=s("./app/components/asyncComponent.tsx"),ke=s("./app/components/tooltip.tsx"),We=s("./app/plugins/components/pluginIcon.tsx"),Be=s("./app/stores/configStore.tsx");class $e extends Ve.Z{getEndpoints(){const{projectSlug:e,organization:t}=this.props;return[["detailedProject",`/projects/${t.slug}/${e}/?expand=hasAlertIntegration`]]}renderLoading(){return null}renderError(){return null}renderBody(){const{organization:e}=this.props,{detailedProject:t}=this.state;if(!t||t.hasAlertIntegrationInstalled)return null;const s="?referrer=issue-alert-builder",n=Be.Z.getConfig().isSelfHosted?{href:`https://develop.sentry.dev/integrations/slack/${s}`}:{to:`/settings/${e.slug}/integrations/slack/${s}`};return(0,de.tZ)(ke.Z,{title:(0,M.t)("Send Alerts to Slack. Install the integration now."),children:(0,de.tZ)(Z.ZP,{size:"small",icon:(0,de.tZ)(We.ZP,{pluginId:"slack",size:16}),...n,children:(0,M.t)("Set Up Slack Now")})})}}const He=[{value:"5",label:(0,M.t)("5 minutes")},{value:"10",label:(0,M.t)("10 minutes")},{value:"30",label:(0,M.t)("30 minutes")},{value:"60",label:(0,M.t)("60 minutes")},{value:"180",label:(0,M.t)("3 hours")},{value:"720",label:(0,M.t)("12 hours")},{value:"1440",label:(0,M.t)("24 hours")},{value:"10080",label:(0,M.t)("1 week")},{value:"43200",label:(0,M.t)("30 days")}],Xe=[{value:"all",label:(0,M.t)("all")},{value:"any",label:(0,M.t)("any")},{value:"none",label:(0,M.t)("none")}],Ye=[{value:"all",label:(0,M.t)("all")},{value:"any",label:(0,M.t)("any")}],Ge={actionMatch:"all",filterMatch:"all",actions:[],conditions:[],filters:[],name:"",frequency:30,environment:z.UZ};function Ke(e){var t;return null!==(t=null==e?void 0:e.hasOwnProperty("id"))&&void 0!==t&&t}class Qe extends ee.Z{constructor(){super(...arguments),(0,n.Z)(this,"pollingTimeout",void 0),(0,n.Z)(this,"pollHandler",(async e=>{if(Date.now()>e)return(0,v.Iw)((0,M.t)("Looking for that channel took too long :(")),void this.setState({loading:!1});const{organization:t}=this.props,{uuid:s,project:n}=this.state,r=this.state.rule;try{const a=await this.api.requestPromise(`/projects/${t.slug}/${n.slug}/rule-task/${s}/`),{status:i,rule:o,error:l}=a;if("pending"===i)return window.clearTimeout(this.pollingTimeout),void(this.pollingTimeout=window.setTimeout((()=>{this.pollHandler(e)}),1e3));if("failed"===i&&(this.setState({detailedError:{actions:[l||(0,M.t)("An error occurred")]},loading:!1}),this.handleRuleSaveFailure((0,M.t)("An error occurred"))),o){const e=!(Ke(r)&&`${r.id}/`);this.handleRuleSuccess(e,o)}}catch{this.handleRuleSaveFailure((0,M.t)("An error occurred")),this.setState({loading:!1})}})),(0,n.Z)(this,"handleRuleSuccess",((e,t)=>{const{organization:s,router:n}=this.props,{project:r}=this.state;this.setState({detailedError:null,loading:!1,rule:t}),(0,f.T)(null,s,{task:U.ve.ALERT_RULE,status:"complete"}),L.oF.endTransaction({name:"saveAlertRule"}),n.push({pathname:`/organizations/${s.slug}/alerts/rules/${r.slug}/${t.id}/details/`}),(0,v.S9)(e?(0,M.t)("Created alert rule"):(0,M.t)("Updated alert rule"))})),(0,n.Z)(this,"handleSubmit",(async()=>{const{project:e,rule:t}=this.state,s=Ke(t)?`${t.id}/`:"",n=!s,{organization:r}=this.props,a=`/projects/${r.slug}/${e.slug}/rules/${s}`;t&&t.environment===z.UZ&&delete t.environment,(0,v.E3)();try{const e=L.oF.startTransaction({name:"saveAlertRule"});if(e.setTag("type","issue"),e.setTag("operation",n?"create":"edit"),t){for(const s of t.actions){const t=s.id.split("."),n=t[t.length-1];"SlackNotifyServiceAction"===n&&e.setTag(n,!0)}e.setData("actions",t.actions)}const[s,,r]=await this.api.requestPromise(a,{includeAllArgs:!0,method:n?"POST":"PUT",data:t,query:{duplicateRule:this.isDuplicateRule?"true":"false",wizardV3:this.hasAlertWizardV3?"true":"false"}});202===(null==r?void 0:r.status)?(this.setState({detailedError:null,loading:!0,uuid:s.uuid}),this.fetchStatus(),(0,v.E3)((0,M.t)("Looking through all your channels..."))):this.handleRuleSuccess(n,s)}catch(e){this.setState({detailedError:e.responseJSON||{__all__:"Unknown error"},loading:!1}),this.handleRuleSaveFailure((0,M.t)("An error occurred"))}})),(0,n.Z)(this,"handleDeleteRule",(async()=>{const{project:e,rule:t}=this.state,s=Ke(t)?`${t.id}/`:"",n=!s,{organization:r}=this.props;if(n)return;const a=`/projects/${r.slug}/${e.slug}/rules/${s}`;(0,v.E3)((0,M.t)("Deleting..."));try{await this.api.requestPromise(a,{method:"DELETE"}),(0,v.S9)((0,M.t)("Deleted alert rule")),i.browserHistory.replace((0,B.Z)("",{...this.props,stepBack:-2}))}catch(e){this.setState({detailedError:e.responseJSON||{__all__:"Unknown error"}}),(0,v.Iw)((0,M.t)("There was a problem deleting the alert"))}})),(0,n.Z)(this,"handleCancel",(()=>{const{organization:e,router:t}=this.props;t.push(`/organizations/${e.slug}/alerts/rules/`)})),(0,n.Z)(this,"hasError",(e=>{const{detailedError:t}=this.state;return!!t&&t.hasOwnProperty(e)})),(0,n.Z)(this,"handleEnvironmentChange",(e=>{e===z.UZ?this.handleChange("environment",null):this.handleChange("environment",e)})),(0,n.Z)(this,"handleChange",((e,t)=>{this.setState((s=>{const n=c()(s);return g()(n,`rule[${e}]`,t),{...n,detailedError:p()(s.detailedError,e)}}))})),(0,n.Z)(this,"handlePropertyChange",((e,t,s,n)=>{this.setState((r=>{const a=c()(r);return g()(a,`rule[${e}][${t}][${s}]`,n),a}))})),(0,n.Z)(this,"getInitialValue",((e,t)=>{var s,n;const r=null===(s=this.state.configs)||void 0===s||null===(n=s[e])||void 0===n?void 0:n.find((e=>e.id===t)),a=(null==r?void 0:r.id)&&this.props.organization.features.includes("change-alerts")&&Y.includes(r.id);return null!=r&&r.formFields?Object.fromEntries(Object.entries(r.formFields).map((e=>{var t,s,n;let[r,i]=e;return[r,a&&"interval"===r?"1h":null!==(t=null==i?void 0:i.initial)&&void 0!==t?t:null==i||null===(s=i.choices)||void 0===s||null===(n=s[0])||void 0===n?void 0:n[0]]})).filter((e=>{let[,t]=e;return!!t}))):{}})),(0,n.Z)(this,"handleResetRow",((e,t,s,n)=>{this.setState((r=>{const a=c()(r),i=a.rule[e][t].id,o={...this.getInitialValue(e,i),id:i,[s]:n};return g()(a,`rule[${e}][${t}]`,o),a}))})),(0,n.Z)(this,"handleAddRow",((e,t)=>{this.setState((s=>{const n=c()(s),r={...this.getInitialValue(e,t),id:t},a=s.rule?s.rule[e]:[];return g()(n,`rule[${e}]`,[...a,r]),n}));const{organization:s}=this.props,{project:n}=this.state;(0,V.Z)("edit_alert_rule.add_row",{organization:s,project_id:n.id,type:e,name:t})})),(0,n.Z)(this,"handleDeleteRow",((e,t)=>{this.setState((s=>{const n=c()(s),r=s.rule?s.rule[e]:[];return s.rule&&r.splice(t,1),g()(n,`rule[${e}]`,r),n}))})),(0,n.Z)(this,"handleAddCondition",(e=>this.handleAddRow("conditions",e))),(0,n.Z)(this,"handleAddAction",(e=>this.handleAddRow("actions",e))),(0,n.Z)(this,"handleAddFilter",(e=>this.handleAddRow("filters",e))),(0,n.Z)(this,"handleDeleteCondition",(e=>this.handleDeleteRow("conditions",e))),(0,n.Z)(this,"handleDeleteAction",(e=>this.handleDeleteRow("actions",e))),(0,n.Z)(this,"handleDeleteFilter",(e=>this.handleDeleteRow("filters",e))),(0,n.Z)(this,"handleChangeConditionProperty",((e,t,s)=>this.handlePropertyChange("conditions",e,t,s))),(0,n.Z)(this,"handleChangeActionProperty",((e,t,s)=>this.handlePropertyChange("actions",e,t,s))),(0,n.Z)(this,"handleChangeFilterProperty",((e,t,s)=>this.handlePropertyChange("filters",e,t,s))),(0,n.Z)(this,"handleResetCondition",((e,t,s)=>this.handleResetRow("conditions",e,t,s))),(0,n.Z)(this,"handleResetAction",((e,t,s)=>this.handleResetRow("actions",e,t,s))),(0,n.Z)(this,"handleResetFilter",((e,t,s)=>this.handleResetRow("filters",e,t,s))),(0,n.Z)(this,"handleValidateRuleName",(()=>{var e;(null===(e=this.state.rule)||void 0===e||!e.name.trim())&&this.setState((e=>({detailedError:{...e.detailedError,name:[(0,M.t)("Field Required")]}})))})),(0,n.Z)(this,"getTeamId",(()=>{const{rule:e}=this.state,t=null==e?void 0:e.owner;return t&&t.split(":")[1]})),(0,n.Z)(this,"handleOwnerChange",(e=>{let{value:t}=e;const s=t&&`team:${t}`;this.handleChange("owner",s)}))}get isDuplicateRule(){const{location:e,organization:t}=this.props,s="true"===(null==e?void 0:e.query.createFromDuplicate);return t.features.includes("duplicate-alert-rule")&&s&&(null==e?void 0:e.query.duplicateRuleId)}get hasAlertWizardV3(){return this.props.organization.features.includes("alert-wizard-v3")}componentWillUnmount(){window.clearTimeout(this.pollingTimeout)}componentDidUpdate(e,t){t.project.id!==this.state.project.id&&this.fetchEnvironments()}getTitle(){const{organization:e}=this.props,{rule:t,project:s}=this.state,n=null==t?void 0:t.name;return(0,$.Z)(n?(0,M.t)("Alert %s",n):"",e.slug,!1,null==s?void 0:s.slug)}getDefaultState(){var e;const{userTeamIds:t,project:s}=this.props,n={...super.getDefaultState(),configs:null,detailedError:null,rule:{...Ge},environments:[],uuid:null,project:s},r=new Set(s.teams.map((e=>{let{id:t}=e;return t}))),a=null!==(e=t.find((e=>r.has(e))))&&void 0!==e?e:null;return n.rule.owner=a&&`team:${a}`,n}getEndpoints(){var e,t;const{organization:s,location:{query:n},params:{ruleId:r,orgId:a}}=this.props,i=null!==(e=null===(t=this.state)||void 0===t?void 0:t.project)&&void 0!==e?e:this.props.project,o=s.features.includes("duplicate-alert-rule"),l=[["environments",`/projects/${a}/${i.slug}/environments/`],["configs",`/projects/${a}/${i.slug}/rules/configuration/`]];return r&&l.push(["rule",`/projects/${a}/${i.slug}/rules/${r}/`]),o&&!r&&n.createFromDuplicate&&n.duplicateRuleId&&l.push(["duplicateTargetRule",`/projects/${a}/${i.slug}/rules/${n.duplicateRuleId}/`]),l}onRequestSuccess(e){let{stateKey:t,data:s}=e;var n,r;"rule"===t&&s.name&&(null===(n=(r=this.props).onChangeTitle)||void 0===n||n.call(r,s.name)),"duplicateTargetRule"===t&&this.setState({rule:{...p()(s,["id"]),name:s.name+" copy"}})}onLoadAllEndpointsSuccess(){const{rule:e}=this.state;e&&((null==e?void 0:e.errors)||[]).map((e=>{let{detail:t}=e;return(0,v.Iw)(t,{append:!0})}))}fetchEnvironments(){const{params:{orgId:e}}=this.props,{project:t}=this.state;this.api.requestPromise(`/projects/${e}/${t.slug}/environments/`,{query:{visibility:"visible"}}).then((e=>this.setState({environments:e}))).catch((e=>(0,v.Iw)((0,M.t)("Unable to fetch environments"))))}fetchStatus(){const e=Date.now()+18e4;window.clearTimeout(this.pollingTimeout),this.pollingTimeout=window.setTimeout((()=>{this.pollHandler(e)}),1e3)}handleRuleSaveFailure(e){(0,v.Iw)(e),L.oF.endTransaction({name:"saveAlertRule"})}getConditions(){var e,t,s;const{organization:n}=this.props;var r,a;return n.features.includes("change-alerts")?null!==(e=null===(t=this.state.configs)||void 0===t||null===(s=t.conditions)||void 0===s?void 0:s.map((e=>Y.includes(e.id)?{...e,label:G[e.id]}:e)))&&void 0!==e?e:null:null!==(r=null===(a=this.state.configs)||void 0===a?void 0:a.conditions)&&void 0!==r?r:null}renderLoading(){return this.renderBody()}renderError(){return(0,de.tZ)(T.Z,{type:"error",showIcon:!0,children:(0,M.t)("Unable to access this alert rule -- check to make sure you have the correct permissions")})}renderRuleName(e){var t;const{rule:s,detailedError:n}=this.state,{name:r}=s||{};return(0,de.tZ)(ft,{hasAlertWizardV3:this.hasAlertWizardV3,label:this.hasAlertWizardV3?null:(0,M.t)("Alert name"),help:this.hasAlertWizardV3?null:(0,M.t)("Add a name for this alert"),error:null==n||null===(t=n.name)||void 0===t?void 0:t[0],disabled:e,required:!0,stacked:!0,flexibleControlStateSize:!!this.hasAlertWizardV3||void 0,children:(0,de.tZ)(S.Z,{type:"text",name:"name",value:r,"data-test-id":"alert-name",placeholder:this.hasAlertWizardV3?(0,M.t)("Enter Alert Name"):(0,M.t)("My Rule Name"),onChange:e=>this.handleChange("name",e.target.value),onBlur:this.handleValidateRuleName,disabled:e})})}renderTeamSelect(e){var t;const{rule:s,project:n}=this.state,r=null==s||null===(t=s.owner)||void 0===t?void 0:t.split(":")[1];return(0,de.tZ)(ft,{hasAlertWizardV3:this.hasAlertWizardV3,extraMargin:!0,label:this.hasAlertWizardV3?null:(0,M.t)("Team"),help:this.hasAlertWizardV3?null:(0,M.t)("The team that can edit this alert."),disabled:e,flexibleControlStateSize:!!this.hasAlertWizardV3||void 0,children:(0,de.tZ)(I.Z,{value:this.getTeamId(),project:n,onChange:this.handleOwnerChange,teamFilter:e=>e.isMember||e.id===r,useId:!0,includeUnassigned:!0,disabled:e})})}renderIdBadge(e){return(0,de.tZ)(j.Z,{project:e,avatarProps:{consistentWidth:!0},avatarSize:18,disableLink:!0,hideName:!0})}renderProjectSelect(e){const{project:t,projects:s,organization:n}=this.props,r=n.features.includes("open-membership"),a=s.filter((e=>e.hasAccess&&e.isMember)),i=s.filter((e=>e.hasAccess&&!e.isMember)),l=a.map((e=>({value:e.id,label:e.slug,leadingItems:this.renderIdBadge(e)}))),d=[{label:(0,M.t)("My Projects"),options:l},{label:(0,M.t)("All Projects"),options:i.map((e=>({value:e.id,label:e.slug,leadingItems:this.renderIdBadge(e)})))}],u=r||(0,W.M)()?d:l;return(0,de.tZ)(R.Z,{name:"projectId",inline:!1,style:{padding:0},flexibleControlStateSize:!0,children:n=>{let{onChange:r,onBlur:a,model:i}=n;const l=s.find((e=>{let{id:t}=e;return t===i.getValue("projectId")}))||t;return(0,de.tZ)(w.Z,{disabled:e,value:l.id,styles:{container:e=>({...e,marginBottom:`${(0,q.Z)(1)}`})},options:u,onChange:e=>{var t,n;let{value:o}=e;const d=null!==(t=s.find((e=>{let{id:t}=e;return t===o})))&&void 0!==t?t:l,u=null===(n=i.getValue("owner"))||void 0===n?void 0:n.split(":")[1];u&&void 0===d.teams.find((e=>{let{id:t}=e;return t===u}))&&d.teams.length&&this.handleOwnerChange({value:d.teams[0].id}),this.setState({project:d}),r(o,{}),a(o,{})},components:{SingleValue:e=>(0,de.tZ)(o.y.ValueContainer,{...e,children:(0,de.tZ)(j.Z,{project:l,avatarProps:{consistentWidth:!0},avatarSize:18,disableLink:!0})})}})}})}renderActionInterval(e){const{rule:t}=this.state,{frequency:s}=t||{};return(0,de.tZ)(yt,{hasAlertWizardV3:this.hasAlertWizardV3,label:this.hasAlertWizardV3?null:(0,M.t)("Action Interval"),help:this.hasAlertWizardV3?null:(0,M.t)("Perform these actions once this often for an issue"),clearable:!1,name:"frequency",className:this.hasError("frequency")?" error":"",value:s,required:!0,options:He,onChange:e=>this.handleChange("frequency",e),disabled:e,flexibleControlStateSize:!!this.hasAlertWizardV3||void 0})}renderBody(){var e;const{organization:t}=this.props,{environments:s,project:n,rule:r,detailedError:i,loading:o}=this.state,{actions:l,filters:u,conditions:c,frequency:h}=r||{},p=[{value:z.UZ,label:(0,M.t)("All Environments")},...null!==(e=null==s?void 0:s.map((e=>({value:e.name,label:(0,k.G)(e)}))))&&void 0!==e?e:[]],m=r&&r.environment?r.environment:z.UZ;return(0,de.tZ)(y.Z,{access:["alerts:write"],children:e=>{var s,g,v,f;let{hasAccess:y}=e;const T=o||!((0,W.M)()||y);return(0,de.tZ)(et,{onCancel:this.handleCancel,onSubmit:this.handleSubmit,initialData:{...r,environment:m,frequency:`${h}`,projectId:n.id},submitDisabled:T,submitLabel:(0,M.t)("Save Rule"),extraButton:Ke(r)?(0,de.tZ)(x.Z,{disabled:T,priority:"danger",confirmText:(0,M.t)("Delete Rule"),onConfirm:this.handleDeleteRule,header:(0,M.t)("Delete Rule"),message:(0,M.t)("Are you sure you want to delete this rule?"),children:(0,de.tZ)(Z.ZP,{priority:"danger",type:"button",children:(0,M.t)("Delete Rule")})}):null,children:(0,de.BX)(N.Z,{symbol:"colored-numeric",children:[o&&(0,de.tZ)(gt,{"data-test-id":"loading-mask"}),(0,de.tZ)(nt,{children:(0,M.t)("Add alert settings")}),this.hasAlertWizardV3?(0,de.BX)(vt,{children:[(0,de.tZ)(yt,{hasAlertWizardV3:this.hasAlertWizardV3,className:d()({error:this.hasError("environment")}),placeholder:(0,M.t)("Select an Environment"),clearable:!1,name:"environment",options:p,onChange:e=>this.handleEnvironmentChange(e),disabled:T,flexibleControlStateSize:!0}),this.renderProjectSelect(T)]}):(0,de.tZ)(F.s_,{children:(0,de.BX)(F.N,{children:[(0,de.tZ)(_.Z,{className:d()({error:this.hasError("environment")}),label:(0,M.t)("Environment"),help:(0,M.t)("Choose an environment for these conditions to apply to"),placeholder:(0,M.t)("Select an Environment"),clearable:!1,name:"environment",options:p,onChange:e=>this.handleEnvironmentChange(e),disabled:T}),this.renderTeamSelect(T),this.renderRuleName(T)]})}),(0,de.BX)(at,{children:[(0,M.t)("Set conditions"),(0,de.tZ)($e,{projectSlug:n.slug,organization:t})]}),(0,de.tZ)(tt,{children:(0,de.BX)(F.N,{children:[(0,de.BX)(it,{children:[(0,de.tZ)(dt,{}),(0,de.BX)(ot,{children:[(0,de.tZ)(ct,{children:(0,de.tZ)(P.g6,{color:"gray200",isCircled:!0,direction:"right",size:"sm"})}),(0,de.tZ)(b.Z,{features:["projects:alert-filters"],project:n,children:e=>{let{hasFeature:s}=e;return(0,de.BX)(lt,{children:[(0,de.tZ)(ut,{children:(0,M._N)("[when:When] an event is captured by Sentry and [selector] of the following happens",{when:(0,de.tZ)(ht,{}),selector:(0,de.tZ)(pt,{children:(0,de.tZ)(mt,{className:d()({error:this.hasError("actionMatch")}),inline:!1,styles:{control:e=>({...e,minHeight:"20px",height:"20px"})},isSearchable:!1,isClearable:!1,name:"actionMatch",required:!0,flexibleControlStateSize:!0,options:s?Ye:Xe,onChange:e=>this.handleChange("actionMatch",e),disabled:T})})})}),(0,de.tZ)(Me,{nodes:this.getConditions(),items:null!=c?c:[],selectType:"grouped",placeholder:s?(0,M.t)("Add optional trigger..."):(0,M.t)("Add optional condition..."),onPropertyChange:this.handleChangeConditionProperty,onAddRow:this.handleAddCondition,onResetRow:this.handleResetCondition,onDeleteRow:this.handleDeleteCondition,organization:t,project:n,disabled:T,error:this.hasError("conditions")&&(0,de.tZ)(st,{type:"error",children:null==i?void 0:i.conditions[0]})})]})}})]})]}),(0,de.tZ)(b.Z,{features:["organizations:alert-filters","projects:alert-filters"],organization:t,project:n,requireAll:!1,children:(0,de.BX)(it,{children:[(0,de.tZ)(dt,{}),(0,de.BX)(ot,{children:[(0,de.tZ)(ct,{children:(0,de.tZ)(P.g6,{color:"gray200",isCircled:!0,direction:"right",size:"sm"})}),(0,de.BX)(lt,{children:[(0,de.tZ)(ut,{children:(0,M._N)("[if:If] [selector] of these filters match",{if:(0,de.tZ)(ht,{}),selector:(0,de.tZ)(pt,{children:(0,de.tZ)(mt,{className:d()({error:this.hasError("filterMatch")}),inline:!1,styles:{control:e=>({...e,minHeight:"20px",height:"20px"})},isSearchable:!1,isClearable:!1,name:"filterMatch",required:!0,flexibleControlStateSize:!0,options:Xe,onChange:e=>this.handleChange("filterMatch",e),disabled:T})})})}),(0,de.tZ)(Me,{nodes:null!==(s=null===(g=this.state.configs)||void 0===g?void 0:g.filters)&&void 0!==s?s:null,items:null!=u?u:[],placeholder:(0,M.t)("Add optional filter..."),onPropertyChange:this.handleChangeFilterProperty,onAddRow:this.handleAddFilter,onResetRow:this.handleResetFilter,onDeleteRow:this.handleDeleteFilter,organization:t,project:n,disabled:T,error:this.hasError("filters")&&(0,de.tZ)(st,{type:"error",children:null==i?void 0:i.filters[0]})})]})]})]})}),(0,de.tZ)(it,{children:(0,de.BX)(ot,{children:[(0,de.tZ)(ct,{children:(0,de.tZ)(P.g6,{isCircled:!0,color:"gray200",direction:"right",size:"sm"})}),(0,de.BX)(lt,{children:[(0,de.tZ)(ut,{children:(0,M._N)("[then:Then] perform these actions",{then:(0,de.tZ)(ht,{})})}),(0,de.tZ)(Me,{nodes:null!==(v=null===(f=this.state.configs)||void 0===f?void 0:f.actions)&&void 0!==v?v:null,selectType:"grouped",items:null!=l?l:[],placeholder:(0,M.t)("Add action..."),onPropertyChange:this.handleChangeActionProperty,onAddRow:this.handleAddAction,onResetRow:this.handleResetAction,onDeleteRow:this.handleDeleteAction,organization:t,project:n,disabled:T,error:this.hasError("actions")&&(0,de.tZ)(st,{type:"error",children:null==i?void 0:i.actions[0]})})]})]})})]})}),(0,de.BX)(nt,{children:[(0,M.t)("Set action interval"),(0,de.tZ)(rt,{children:(0,M.t)("Perform the actions above once this often for an issue")})]}),this.hasAlertWizardV3?this.renderActionInterval(T):(0,de.tZ)(F.s_,{children:(0,de.tZ)(F.N,{children:this.renderActionInterval(T)})}),this.hasAlertWizardV3&&(0,de.BX)(a.Fragment,{children:[(0,de.tZ)(nt,{children:(0,M.t)("Establish ownership")}),this.renderRuleName(T),this.renderTeamSelect(T)]})]})},Ke(r)?r.id:void 0)}})}}const Je=(0,H.Z)((0,X.Z)(Qe)),et=(0,r.Z)(E.Z,{target:"ey7y4ii18"})({name:"bjn8wh",styles:"position:relative"}),tt=(0,r.Z)(F.s_,{target:"ey7y4ii17"})("padding-top:",(0,q.Z)(.5),";padding-bottom:",(0,q.Z)(2),";"),st=(0,r.Z)(T.Z,{target:"ey7y4ii16"})({name:"1ykowef",styles:"margin-bottom:0"}),nt=(0,r.Z)(D.Z,{target:"ey7y4ii15"})("margin:",(0,q.Z)(2)," 0 ",(0,q.Z)(1)," 0;font-size:",(e=>e.theme.fontSizeExtraLarge),";"),rt=(0,r.Z)(A.Z,{target:"ey7y4ii14"})({name:"1i9vogi",styles:"margin-top:0"}),at=(0,r.Z)(nt,{target:"ey7y4ii13"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),it=(0,r.Z)("div",{target:"ey7y4ii12"})("position:relative;display:flex;align-items:flex-start;margin:",(0,q.Z)(4)," ",(0,q.Z)(4)," ",(0,q.Z)(3)," ",(0,q.Z)(1),";"),ot=(0,r.Z)("div",{target:"ey7y4ii11"})({name:"dxf6zn",styles:"position:relative;display:flex;align-items:flex-start;flex-grow:1"}),lt=(0,r.Z)("div",{target:"ey7y4ii10"})({name:"1ff36h2",styles:"flex-grow:1"}),dt=(0,r.Z)("div",{target:"ey7y4ii9"})("position:absolute;height:100%;top:28px;left:19px;border-right:1px ",(e=>e.theme.gray200)," dashed;"),ut=(0,r.Z)("div",{target:"ey7y4ii8"})("margin-bottom:",(0,q.Z)(.5),";"),ct=(0,r.Z)("div",{target:"ey7y4ii7"})("display:flex;align-items:center;padding:",(0,q.Z)(.5)," ",(0,q.Z)(1.5),";"),ht=(0,r.Z)("span",{target:"ey7y4ii6"})("display:inline-block;min-width:56px;background-color:",(e=>e.theme.purple300),";padding:0 ",(0,q.Z)(.75),";border-radius:",(e=>e.theme.borderRadius),";color:",(e=>e.theme.white),";text-transform:uppercase;text-align:center;font-size:",(e=>e.theme.fontSizeMedium),";font-weight:600;line-height:1.5;"),pt=(0,r.Z)("div",{target:"ey7y4ii5"})("display:inline-block;margin:0 ",(0,q.Z)(.5),";width:80px;"),mt=(0,r.Z)(_.Z,{target:"ey7y4ii4"})({name:"1xnv1j2",styles:"padding:0;font-weight:normal;text-transform:none"}),gt=(0,r.Z)(O.Z,{target:"ey7y4ii3"})({name:"2ux4k9",styles:"opacity:0.6;z-index:1"}),vt=(0,r.Z)("div",{target:"ey7y4ii2"})("display:grid;grid-template-columns:1fr 1fr;gap:",(0,q.Z)(1),";"),ft=(0,r.Z)(C.Z,{target:"ey7y4ii1"})(":last-child{padding-bottom:",(0,q.Z)(2),";}",(e=>e.hasAlertWizardV3&&`\n    border-bottom: none;\n    padding: 0;\n\n    & > div {\n      padding: 0;\n      width: 100%;\n    }\n\n    margin-bottom: ${e.extraMargin?"60px":(0,q.Z)(1)};\n  `),";"),yt=(0,r.Z)(_.Z,{target:"ey7y4ii0"})((e=>e.hasAlertWizardV3&&`\n    border-bottom: none;\n    padding: 0;\n\n    & > div {\n      padding: 0;\n      width: 100%;\n    }\n\n    margin-bottom: ${(0,q.Z)(1)};\n  `),";")},"./app/views/alerts/rules/issue/sentryAppRuleModal.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("./app/actionCreators/modal.tsx"),i=s("./app/locale.tsx"),o=s("./app/styles/space.tsx"),l=s("./app/views/organizationIntegrations/sentryAppExternalForm.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const u=e=>{let{Header:t,Body:s,sentryAppInstallationUuid:n,appName:o,config:u,resetValues:h,onSubmitSuccess:p}=e;return(0,d.BX)(r.Fragment,{children:[(0,d.BX)(t,{closeButton:!0,children:[(0,d.tZ)("div",{children:(0,i._N)("[name] Settings",{name:o})}),u.description&&(0,d.tZ)(c,{children:u.description})]}),(0,d.tZ)(s,{children:(0,d.tZ)(l.Z,{sentryAppInstallationUuid:n,appName:o,config:(null==h?void 0:h.formFields)||u,element:"alert-rule-action",action:"create",onSubmitSuccess:function(){p(...arguments),(0,a.closeModal)()},resetValues:{settings:null==h?void 0:h.settings}})})]})};u.displayName="SentryAppRuleModal";const c=(0,n.Z)("div",{target:"e1tzb5e70"})("padding-top:",(0,o.Z)(0),";color:",(e=>e.theme.subText),";"),h=u},"./app/views/alerts/rules/metric/constants.tsx":(e,t,s)=>{"use strict";s.d(t,{H9:()=>A,Hq:()=>R,KP:()=>T,Ng:()=>c,P1:()=>p,Q6:()=>E,Vr:()=>u,W7:()=>S,XU:()=>y,Yp:()=>x,b1:()=>o,bp:()=>f,ep:()=>C,hh:()=>h,kV:()=>d,nM:()=>Z,rQ:()=>b,wT:()=>l,yq:()=>m}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js");var n=s("./app/locale.tsx"),r=s("./app/utils/performance/vitals/constants.tsx"),a=s("./app/views/alerts/rules/metric/types.tsx"),i=s("./app/views/alerts/utils/index.tsx");const o=1,l=60,d=10080,u="count()",c="p95(transaction.duration)",h={[a.qz.ERRORS]:"event.type:error",[a.qz.TRANSACTIONS]:"event.type:transaction"},p={[a.Yh.ERROR_DEFAULT]:"event.type:[error, default]",[a.Yh.ERROR]:"event.type:error",[a.Yh.DEFAULT]:"event.type:default",[a.Yh.TRANSACTION]:"event.type:transaction"},m={aggregations:["count","count_unique"],fields:["user"]},g=["avg","percentile","p50","p75","p95","p99","p100"],v=[...g,"failure_rate","apdex","count"],f=["dataset","eventTypes","aggregate","query","timeWindow","thresholdPeriod","projects","environment","resolveThreshold","thresholdType","owner","name","projectId","comparisonDelta"],y=["alertThreshold","label"],b=["type","targetType","targetIdentifier","inputChannelId","options"],T=[{value:5,label:(0,n.t)("same time 5 minutes ago")},{value:15,label:(0,n.t)("same time 15 minutes ago")},{value:60,label:(0,n.t)("same time one hour ago")},{value:1440,label:(0,n.t)("same time one day ago")},{value:10080,label:(0,n.t)("same time one week ago")},{value:43200,label:(0,n.t)("same time one month ago")}];function Z(e,t){return"custom"===e&&t===a.qz.ERRORS?m:{aggregations:"apdex"===e||"custom"===e?v:g,fields:["transaction.duration"],measurementKeys:Object.keys(r.r9)}}const x={aggregations:v,fields:["transaction.duration"],measurementKeys:Object.keys(r.r9)};function S(e){return{label:e,alertThreshold:"",actions:[]}}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{dataset:a.qz.ERRORS,eventTypes:[a.GM.ERROR],aggregate:u,query:"",timeWindow:60,thresholdPeriod:1,triggers:[S(a.F4.CRITICAL),S(a.F4.WARNING)],projects:[],environment:null,resolveThreshold:"",thresholdType:a.lT.ABOVE,...e}}function A(e){var t;const s=(0,i.A4)(e.query),n=s?i.Ey[s.source]:i.Ey.error;let r=e.getYAxis();return"transactions"===n.dataset&&/^p\d{2,3}\(\)/.test(e.getYAxis())&&(r=e.getYAxis().slice(0,3)+"(transaction.duration)"),{...C(),...n,query:null!==(t=null==s?void 0:s.query)&&void 0!==t?t:e.query,aggregate:r,environment:e.environment.length?e.environment[0]:null}}function E(e){const{eventTypes:t,aggregate:s,dataset:n}=e,r={};return(0,i.Eb)(s)&&(r.thresholdType=a.lT.BELOW,r.timeWindow=a.Tb.ONE_HOUR),s.includes("apdex")&&(r.thresholdType=a.lT.BELOW),{...C(r),eventTypes:[t],aggregate:s,dataset:n}}function R(e,t){return(0,i.Eb)(e)||t===a.t6.CHANGE?"%":e.includes("measurements.cls")?"":e.includes("duration")||e.includes("measurements")?"ms":""}},"./app/views/alerts/rules/metric/ruleForm.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>ks});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("./app/actionCreators/indicator.tsx")),i=s("./app/actionCreators/tags.tsx"),o=s("./app/components/acl/access.tsx"),l=s("./app/components/asyncComponent.tsx"),d=s("./app/components/button.tsx"),u=s("./app/components/charts/styles.tsx"),c=s("./app/components/circleIndicator.tsx"),h=s("./app/components/confirm.tsx"),p=s("./app/components/forms/form.tsx"),m=s("./app/components/list/index.tsx"),g=s("./app/components/list/listItem.tsx"),v=s("./app/locale.tsx"),f=s("./app/stores/indicatorStore.tsx"),y=s("./app/styles/space.tsx"),b=s("./app/utils.tsx"),T=s("./app/utils/analytics.tsx"),Z=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),x=s("./app/utils/isActiveSuperuser.tsx"),S=s("./app/utils/withProjects.tsx"),C=s("../node_modules/react/index.js"),A=s("./app/components/forms/formField/index.tsx"),E=s("./app/components/forms/teamSelector.tsx"),R=s("./app/components/forms/textField.tsx"),w=s("./app/components/panels/index.tsx"),_=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function I(e){let{disabled:t,project:s,hasAlertWizardV3:n}=e;const r=()=>(0,_.tZ)(N,{"data-test-id":"alert-name",hasAlertWizardV3:n,disabled:t,name:"name",label:n?null:(0,v.t)("Rule Name"),help:n?null:(0,v.t)("Add a name so it’s easy to find later."),placeholder:n?(0,v.t)("Enter Alert Name"):(0,v.t)("Something really bad happened"),required:!0,flexibleControlStateSize:!0}),a=()=>(0,_.tZ)(D,{hasAlertWizardV3:n,extraMargin:!0,name:"owner",label:n?null:(0,v.t)("Team"),help:n?null:(0,v.t)("The team that can edit this alert."),disabled:t,flexibleControlStateSize:!0,children:e=>{let{model:n}=e;const r=n.getValue("owner"),a=r&&r.split(":")[1];return(0,_.tZ)(E.Z,{value:a,project:s,onChange:e=>{let{value:t}=e;return n.setValue("owner",t&&`team:${t}`)},teamFilter:e=>e.isMember||e.id===a,useId:!0,includeUnassigned:!0,disabled:t})}});return n?(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(j,{children:(0,v.t)("Establish ownership")}),r(),a()]}):(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(j,{children:(0,v.t)("Add a rule name and team")}),(0,_.tZ)(w.s_,{children:(0,_.BX)(w.N,{children:[r(),a()]})})]})}const j=(0,r.Z)(g.Z,{target:"etj3rxo2"})("margin:",(0,y.Z)(2)," 0 ",(0,y.Z)(1)," 0;font-size:",(e=>e.theme.fontSizeExtraLarge),";"),N=(0,r.Z)(R.Z,{target:"etj3rxo1"})((e=>e.hasAlertWizardV3&&`\n    border-bottom: none;\n    padding: 0;\n\n    & > div {\n      padding: 0;\n      width: 100%;\n    }\n\n    margin-bottom: ${(0,y.Z)(1)};\n  `),";"),D=(0,r.Z)(A.Z,{target:"etj3rxo0"})((e=>e.hasAlertWizardV3&&`\n    padding: 0;\n\n    & > div {\n      padding: 0;\n      width: 100%;\n    }\n\n    margin-bottom: ${e.extraMargin?"60px":(0,y.Z)(1)};\n  `),";");var O=s("./app/components/acl/feature.tsx"),F=s("./app/components/forms/controls/radioGroup.tsx"),z=s("./app/components/forms/selectControl.tsx"),P=s("./app/views/alerts/rules/metric/constants.tsx"),M=s("./app/views/alerts/rules/metric/utils/isCrashFreeAlert.tsx"),q=s("./app/views/alerts/rules/metric/types.tsx");const U=(0,r.Z)(g.Z,{target:"e1w97v53"})("margin-bottom:",(0,y.Z)(1),";font-size:",(e=>e.theme.fontSizeExtraLarge),";line-height:1.3;"),L=(0,r.Z)("div",{target:"e1w97v52"})("display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;margin-bottom:",(e=>e.hasAlertWizardV3?(0,y.Z)(2):(0,y.Z)(4)),";"),V=(0,r.Z)("div",{target:"e1w97v51"})({name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"}),k=(0,r.Z)(F.Z,{target:"e1w97v50"})("flex:1;",(e=>e.hasAlertWizardV3&&"gap: 0;")," &>label{",(e=>e.hasAlertWizardV3&&"height: 33px;"),";}"),W=e=>{let{organization:t,dataset:s,disabled:n,comparisonType:r,onComparisonDeltaChange:a,onComparisonTypeChange:i,hasAlertWizardV3:o,comparisonDelta:l}=e;return(0,M.I)(s)?null:(0,_.BX)(O.Z,{features:["organizations:change-alerts"],organization:t,children:[!o&&(0,_.tZ)(U,{children:(0,v.t)("Select threshold type")}),(0,_.tZ)(L,{hasAlertWizardV3:o,children:(0,_.tZ)(k,{hasAlertWizardV3:o,disabled:n,choices:[[q.t6.COUNT,o?"Static: above or below {x}":"Count"],[q.t6.CHANGE,o?r===q.t6.COUNT?(0,v.t)("Percent Change: {x%} higher or lower compared to previous period"):(0,_.BX)(V,{onClick:e=>e.preventDefault(),children:[(0,v.t)("Percent Change: {x%} higher or lower compared to"),(0,_.tZ)(z.Z,{name:"comparisonDelta",styles:{container:e=>({...e,marginLeft:(0,y.Z)(1)}),control:e=>({...e,minHeight:30,minWidth:500,maxWidth:1e3}),valueContainer:e=>({...e,padding:0}),singleValue:e=>({...e})},value:l,onChange:e=>{let{value:t}=e;return a(t)},options:P.KP,required:r===q.t6.CHANGE})]}):(0,v.t)("Percent Change")]],value:r,label:(0,v.t)("Threshold Type"),onChange:e=>i(e)})})]})};var B=s("./app/utils/removeAtArrayIndex.tsx"),$=s("./app/utils/replaceAtArrayIndex.tsx"),H=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/@sentry/hub/esm/exports.js")),X=s("./app/actionCreators/modal.tsx"),Y=s("./app/components/alert.tsx"),G=s("./app/components/loadingIndicator.tsx"),K=s("./app/icons/index.tsx"),Q=s("./app/utils/guid.tsx"),J=s("./app/utils/withOrganization.tsx"),ee=s("./app/views/alerts/rules/issue/sentryAppRuleModal.tsx"),te=s("./app/components/forms/controls/input.tsx");function se(e){let{action:t,disabled:s,onChange:n}=e;return t.targetType!==q.Lm.SPECIFIC||t.type!==q.Us.SLACK?null:(0,_.tZ)(te.Z,{type:"text",autoComplete:"off",disabled:s,value:t.inputChannelId||"",onChange:e=>{n(e.target.value)},placeholder:(0,v.t)("optional: channel ID or user ID")},"inputChannelId")}se.displayName="ActionSpecificTargetSelector";const ne=se;var re=s("./app/components/selectMembers/index.tsx");const ae=e=>{switch(e){case q.Us.SLACK:return"@username or #channel";case q.Us.MSTEAMS:return"username or channel";case q.Us.PAGERDUTY:return"service";default:throw Error("Not implemented")}};function ie(e){const{action:t,availableAction:s,disabled:n,loading:r,onChange:a,organization:i,project:o}=e,l=e=>{a(e.value)},d=e=>{a(e.target.value)};switch(t.targetType){case q.Lm.TEAM:case q.Lm.USER:return t.targetType===q.Lm.TEAM?(0,_.tZ)(E.Z,{disabled:n,project:o,value:t.targetIdentifier,onChange:l,useId:!0},"team"):(0,_.tZ)(re.Z,{disabled:n,project:o,organization:i,value:t.targetIdentifier,onChange:l},"member");case q.Lm.SPECIFIC:return null!=s&&s.options?(0,_.tZ)(z.Z,{isDisabled:n||r,value:t.targetIdentifier,options:s.options,onChange:l}):(0,_.tZ)(te.Z,{type:"text",autoComplete:"off",disabled:n,value:t.targetIdentifier||"",onChange:d,placeholder:ae(t.type)},t.type);default:return null}}function oe(e){return(0,_.tZ)(d.ZP,{type:"button",size:"small",icon:(0,_.tZ)(K.Fz,{size:"xs"}),"aria-label":(0,v.t)("Remove action"),...e,onClick:t=>{const{triggerIndex:s,index:n,onClick:r}=e;r(s,n,t)}})}oe.displayName="DeleteActionButton";const le=(e,t)=>({unsavedId:(0,Q.E)(),unsavedDateCreated:null!=t?t:(new Date).toISOString(),type:e.type,targetType:e&&e.allowedTargetTypes&&e.allowedTargetTypes.length>0?e.allowedTargetTypes[0]:null,targetIdentifier:e.sentryAppId||"",inputChannelId:null,integrationId:e.integrationId,sentryAppId:e.sentryAppId,options:e.options||null}),de=e=>{let{type:t,integrationId:s,sentryAppId:n}=e;return s?`${t}-${s}`:n?`${t}-${n}`:t},ue=e=>{let{type:t,integrationName:s,sentryAppName:n,status:r}=e;if(n)return r&&"published"!==r?`${n} (${r})`:`${n}`;const a=q.LO[t];return s?`${a} - ${s}`:a};class ce extends C.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"handleAddAction",(()=>{const{availableActions:e,onAdd:t}=this.props,s=null==e?void 0:e[0];if(!s)return(0,a.Iw)((0,v.t)("There was a problem adding an action")),void H.Tb(new Error("Unable to add an action"));t(0,le(s))})),(0,n.Z)(this,"handleDeleteAction",((e,t)=>{const{triggers:s,onChange:n}=this.props,{actions:r}=s[e];n(e,s,(0,B.E)(r,t))})),(0,n.Z)(this,"handleChangeActionLevel",((e,t,s)=>{const{triggers:n,onChange:r}=this.props,{id:a,...i}=n[e].actions[t];i.unsavedId=(0,Q.E)(),n[s.value].actions.push(i),r(s.value,n,n[s.value].actions),this.handleDeleteAction(e,t)})),(0,n.Z)(this,"handleChangeActionType",((e,t,s)=>{var n;const{triggers:r,onChange:i,availableActions:o}=this.props,{actions:l}=r[e],d=null==o?void 0:o.find((e=>de(e)===s.value));if(!d)return(0,a.Iw)((0,v.t)("There was a problem changing an action")),void H.Tb(new Error("Unable to change an action type"));const u=null!==(n=l[t].dateCreated)&&void 0!==n?n:l[t].unsavedDateCreated,c=le(d,u);i(e,r,(0,$.m)(l,t,c))})),(0,n.Z)(this,"handleChangeTarget",((e,t,s)=>{const{triggers:n,onChange:r}=this.props,{actions:a}=n[e],i={...a[t],targetType:s.value,targetIdentifier:""};r(e,n,(0,$.m)(a,t,i))})),(0,n.Z)(this,"updateParentFromSentryAppRule",((e,t,s)=>{const{triggers:n,onChange:r}=this.props,{actions:a}=n[e],i={...a[t],...s};r(e,n,(0,$.m)(a,t,i))}))}handleChangeKey(e,t,s,n){const{triggers:r,onChange:a}=this.props,{actions:i}=r[e],o={...i[t],[s]:n};a(e,r,(0,$.m)(i,t,o))}conditionallyRenderHelpfulBanner(e,t){const{triggers:s}=this.props,{actions:n}=s[e];return"slack"!=={...n[t]}.type?null:(0,_.tZ)(Te,{type:"info",showIcon:!0,trailingItems:(0,_.tZ)(d.ZP,{href:"https://docs.sentry.io/product/integrations/notification-incidents/slack/#rate-limiting-error",size:"xsmall",children:(0,v.t)("Learn More")}),children:(0,v.t)("Having rate limiting problems? Enter a channel or user ID.")})}render(){const{availableActions:e,currentProject:t,disabled:s,loading:n,organization:r,projects:a,triggers:i,hasAlertWizardV3:o}=this.props,l=a.find((e=>{let{slug:s}=e;return s===t})),u=null==e?void 0:e.map((e=>({value:de(e),label:ue(e)}))),c=[{value:0,label:"Critical Status"},{value:1,label:"Warning Status"}],h=i.flatMap(((t,s)=>t.actions.map(((t,n)=>{var r;const a=null==e?void 0:e.find((e=>de(e)===de(t)));return{dateCreated:new Date(null!==(r=t.dateCreated)&&void 0!==r?r:t.unsavedDateCreated).getTime(),triggerIndex:s,action:t,actionIdx:n,availableAction:a}})))).sort(((e,t)=>e.dateCreated-t.dateCreated));return(0,_.BX)(C.Fragment,{children:[(0,_.BX)(be,{children:[o?(0,v.t)("Set actions"):(0,v.t)("Perform actions"),!o&&(0,_.tZ)(me,{children:(0,v.t)("When any of the thresholds above are met, perform an action such as sending an email or using an integration.")})]}),n&&(0,_.tZ)(G.Z,{}),h.map((e=>{var t,a,o;let{action:h,actionIdx:p,triggerIndex:m,availableAction:g}=e;const f=(null===(t=i[m].actions[p])||void 0===t?void 0:t.disabled)||s;return(0,_.BX)("div",{children:[(0,_.tZ)(fe,{children:(0,_.BX)(ge,{children:[(0,_.BX)(ve,{children:[(0,_.tZ)(z.Z,{name:"select-level","aria-label":(0,v.t)("Select a status level"),isDisabled:s||n,placeholder:(0,v.t)("Select Level"),onChange:this.handleChangeActionLevel.bind(this,m,p),value:m,options:c}),(0,_.tZ)(z.Z,{name:"select-action","aria-label":(0,v.t)("Select an Action"),isDisabled:s||n,placeholder:(0,v.t)("Select Action"),onChange:this.handleChangeActionType.bind(this,m,p),value:de(h),options:null!=u?u:[]}),g&&g.allowedTargetTypes.length>1?(0,_.tZ)(z.Z,{isDisabled:s||n,value:h.targetType,options:null==g||null===(o=g.allowedTargetTypes)||void 0===o?void 0:o.map((e=>({value:e,label:q.hd[e]}))),onChange:this.handleChangeTarget.bind(this,m,p)}):g&&"sentry_app"===g.type&&g.settings?(0,_.tZ)(d.ZP,{icon:(0,_.tZ)(K.iC,{}),type:"button",disabled:f,onClick:()=>{(0,X.openModal)((e=>(0,_.tZ)(ee.Z,{...e,sentryAppInstallationUuid:g.sentryAppInstallationUuid,config:g.settings,appName:g.sentryAppName,onSubmitSuccess:this.updateParentFromSentryAppRule.bind(this,m,p),resetValues:i[m].actions[p]||{}})),{allowClickClose:!1})},children:(0,v.t)("Settings")}):null,(0,_.tZ)(ie,{action:h,availableAction:g,disabled:s,loading:n,onChange:this.handleChangeKey.bind(this,m,p,"targetIdentifier"),organization:r,project:l}),(0,_.tZ)(ne,{action:h,disabled:s,onChange:this.handleChangeKey.bind(this,m,p,"inputChannelId")})]}),(0,_.tZ)(oe,{triggerIndex:m,index:p,onClick:this.handleDeleteAction,disabled:s})]})}),this.conditionallyRenderHelpfulBanner(m,p)]},null!==(a=h.id)&&void 0!==a?a:h.unsavedId)})),(0,_.tZ)(pe,{children:(0,_.tZ)(d.ZP,{type:"button",disabled:s||n,icon:(0,_.tZ)(K.N_,{isCircled:!0,color:"gray300"}),onClick:this.handleAddAction,children:(0,v.t)("Add Action")})})]})}}ce.displayName="ActionsPanel";const he=(0,r.Z)(ce,{target:"e1sw62qy8"})("margin-top:",(0,y.Z)(4),";"),pe=(0,r.Z)("div",{target:"e1sw62qy7"})("margin-top:",(0,y.Z)(1),";margin-bottom:",(0,y.Z)(3),";"),me=(0,r.Z)("p",{target:"e1sw62qy6"})("color:",(e=>e.theme.subText),";margin-bottom:",(0,y.Z)(1),";font-size:",(e=>e.theme.fontSizeLarge),";"),ge=(0,r.Z)(w.Lv,{target:"e1sw62qy5"})("display:flex;align-items:center;border-bottom:0;padding:",(0,y.Z)(1),";"),ve=(0,r.Z)("div",{target:"e1sw62qy4"})("display:flex;width:100%;margin-right:",(0,y.Z)(1),";>*{flex:0 1 200px;&:not(:last-child){margin-right:",(0,y.Z)(1),";}}"),fe=(0,r.Z)("div",{target:"e1sw62qy3"})("background-color:",(e=>e.theme.backgroundSecondary),";border:1px ",(e=>e.theme.border)," solid;border-radius:",(e=>e.theme.borderRadius)," ",(e=>e.theme.borderRadius)," 0 0;&:last-child{border-radius:",(e=>e.theme.borderRadius),";}"),ye=(0,r.Z)(g.Z,{target:"e1sw62qy2"})("margin:",(0,y.Z)(2)," 0 ",(0,y.Z)(3)," 0;font-size:",(e=>e.theme.fontSizeExtraLarge),";"),be=(0,r.Z)(ye,{target:"e1sw62qy1"})({name:"18d4xiq",styles:"margin-bottom:0;line-height:1.3"}),Te=(0,r.Z)(Y.Z,{target:"e1sw62qy0"})("border-radius:0 0 ",(e=>e.theme.borderRadius)," ",(e=>e.theme.borderRadius),";border:1px ",(e=>e.theme.border)," solid;border-top-width:0;margin:0;padding:",(0,y.Z)(1)," ",(0,y.Z)(1),";font-size:",(e=>e.theme.fontSizeSmall),";"),Ze=(0,J.Z)(he);var xe=s("./app/actionCreators/members.tsx"),Se=s("./app/components/forms/field/index.tsx"),Ce=s("./app/utils/withApi.tsx"),Ae=s("./app/utils/withConfig.tsx");class Ee extends C.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isClicked:!1})}render(){const{onChange:e,axis:t,step:s,shiftStep:n,...r}=this.props,a="x"===(null!=t?t:"x");return(0,_.BX)(Re,{...r,onMouseDown:e=>{0===e.button&&((0,T.ec)({eventName:"Number Drag Control: Clicked",eventKey:"number_drag_control.clicked",organization_id:null}),e.currentTarget.requestPointerLock(),this.setState({isClicked:!0}))},onMouseUp:()=>{document.exitPointerLock(),this.setState({isClicked:!1})},onMouseMove:t=>{var r;if(!this.state.isClicked)return;const i=a?t.movementX:-1*t.movementY,o=(i>0?Math.ceil(i/100):Math.floor(i/100))*(null!==(r=t.shiftKey?n:s)&&void 0!==r?r:1);e(o,t)},isActive:this.state.isClicked,isX:a,children:[(0,_.tZ)(K.CC,{direction:a?"left":"up",size:"8px"}),(0,_.tZ)(K.CC,{direction:a?"right":"down",size:"8px"})]})}}Ee.displayName="NumberDragControl";const Re=(0,r.Z)("div",{target:"e1l792q50"})("display:grid;padding:",(0,y.Z)(.5),";",(e=>e.isX?"grid-template-columns: max-content max-content":"grid-template-rows: max-content max-content"),";cursor:",(e=>e.isX?"ew-resize":"ns-resize"),";color:",(e=>e.isActive?e.theme.gray500:e.theme.gray300),";background:",(e=>e.isActive&&e.theme.backgroundSecondary),";border-radius:2px;"),we=Ee;var _e=s("./app/components/tooltip.tsx");class Ie extends C.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{currentValue:null}),(0,n.Z)(this,"handleThresholdChange",(e=>{const{value:t}=e.target;if(!/^[0-9]*\.?[0-9]*$/.test(t))return;const{onChange:s,thresholdType:n}=this.props;if(""===t)return this.setState({currentValue:null}),void s({thresholdType:n,threshold:""},e);if(/\.+0*$/.test(t))return void this.setState({currentValue:t});const r=Number(t);this.setState({currentValue:null}),s({thresholdType:n,threshold:r},e)})),(0,n.Z)(this,"handleThresholdBlur",(e=>{if(null===this.state.currentValue)return;const{onChange:t,thresholdType:s}=this.props;t({thresholdType:s,threshold:Number(this.state.currentValue)},e),this.setState({currentValue:null})})),(0,n.Z)(this,"handleTypeChange",(e=>{let{value:t}=e;const{onThresholdTypeChange:s}=this.props;s(t)})),(0,n.Z)(this,"handleDragChange",((e,t)=>{const{onChange:s,thresholdType:n,threshold:r}=this.props;s({thresholdType:n,threshold:(r||0)+e},t)})),(0,n.Z)(this,"handleThresholdPeriodChange",(e=>{let{value:t}=e;this.props.onThresholdPeriodChange(t)}))}render(){var e;const{currentValue:t}=this.state,{thresholdPeriod:s,thresholdType:n,comparisonType:r,hideControl:a,threshold:i,placeholder:o,type:l,onChange:d,onThresholdTypeChange:u,disabled:c,disableThresholdType:h}=this.props;return(0,_.BX)(je,{children:[(0,_.BX)(Ne,{comparisonType:r,children:[(0,_.tZ)(De,{children:(0,_.tZ)(z.Z,{isDisabled:c||h,name:`${l}ThresholdType`,value:n,options:[{value:q.lT.BELOW,label:r===q.t6.COUNT?a?(0,v.t)("When below Critical or Warning"):(0,v.t)("Below"):a?(0,v.t)("When lower than Critical or Warning"):(0,v.t)("Lower than")},{value:q.lT.ABOVE,label:r===q.t6.COUNT?a?(0,v.t)("When above Critical or Warning"):(0,v.t)("Above"):a?(0,v.t)("When higher than Critical or Warning"):(0,v.t)("Higher than")}],components:h?{DropdownIndicator:null}:void 0,styles:h?{control:e=>({...e,cursor:"not-allowed",pointerEvents:"auto"})}:void 0,onChange:this.handleTypeChange})}),!a&&(0,_.BX)(Oe,{comparisonType:r,children:[(0,_.BX)(ze,{children:[(0,_.tZ)(Fe,{disabled:c,name:`${l}Threshold`,"data-test-id":`${l}-threshold`,placeholder:o,value:null!==(e=null!=t?t:i)&&void 0!==e?e:"",onChange:this.handleThresholdChange,onBlur:this.handleThresholdBlur,"data-lpignore":"true"}),(0,_.tZ)(Me,{children:(0,_.tZ)(_e.Z,{title:(0,v._N)("Drag to adjust threshold[break]You can hold shift to fine tune",{break:(0,_.tZ)("br",{})}),children:(0,_.tZ)(we,{step:5,axis:"y",onChange:this.handleDragChange})})})]}),r===q.t6.CHANGE&&(0,_.tZ)(Pe,{children:"%"})]})]}),!a&&(0,_.tZ)(O.Z,{features:["metric-alert-threshold-period"],children:(0,_.tZ)(De,{children:(0,_.tZ)(z.Z,{isDisabled:c,name:"thresholdPeriod",value:s,options:[1,2,5,10,20].map((e=>({value:e,label:(0,v.tn)("For %s minute","For %s minutes",e)}))),onChange:this.handleThresholdPeriodChange})})})]})}}Ie.displayName="ThresholdControl";const je=(0,r.Z)("div",{target:"e1gmdxsa7"})("display:flex;align-items:center;gap:",(0,y.Z)(1),";"),Ne=(0,r.Z)("div",{target:"e1gmdxsa6"})("flex:2;display:flex;align-items:center;flex-direction:",(e=>e.comparisonType===q.t6.COUNT?"row":"row-reverse"),";gap:",(0,y.Z)(1),";"),De=(0,r.Z)("div",{target:"e1gmdxsa5"})({name:"82a6rk",styles:"flex:1"}),Oe=(0,r.Z)("div",{target:"e1gmdxsa4"})({name:"7or6jb",styles:"flex:1;display:flex;flex-direction:row;align-items:center"}),Fe=(0,r.Z)(te.Z,{target:"e1gmdxsa3"})({name:"1k18kha",styles:"height:40px"}),ze=(0,r.Z)("div",{target:"e1gmdxsa2"})({name:"1ly0j98",styles:"position:relative;display:flex;flex-direction:row;align-items:center"}),Pe=(0,r.Z)("div",{target:"e1gmdxsa1"})("margin-left:",(0,y.Z)(1),";"),Me=(0,r.Z)("div",{target:"e1gmdxsa0"})({name:"39il5g",styles:"position:absolute;top:4px;right:12px"}),qe=Ie;var Ue=s("./app/views/alerts/utils/index.tsx");class Le extends C.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"handleChangeThreshold",(e=>{const{onChange:t,trigger:s}=this.props;t({...s,alertThreshold:e.threshold},{alertThreshold:e.threshold})}))}render(){const{disabled:e,error:t,trigger:s,isCritical:n,thresholdType:r,thresholdPeriod:a,hasAlertWizardV3:i,hideControl:o,comparisonType:l,fieldHelp:d,triggerLabel:u,placeholder:c,onThresholdTypeChange:h,onThresholdPeriodChange:p}=this.props;return(0,_.tZ)(Xe,{label:u,help:d,required:n,error:t&&t.alertThreshold,hasAlertWizardV3:i,children:(0,_.tZ)(qe,{disabled:e,disableThresholdType:!n,type:s.label,thresholdType:r,thresholdPeriod:a,hideControl:o,threshold:s.alertThreshold,comparisonType:l,placeholder:c,onChange:this.handleChangeThreshold,onThresholdTypeChange:h,onThresholdPeriodChange:p})})}}Le.displayName="TriggerFormItem";class Ve extends C.Component{constructor(){super(...arguments),(0,n.Z)(this,"handleChangeTrigger",(e=>(t,s)=>{const{onChange:n}=this.props;n(e,t,s)})),(0,n.Z)(this,"handleChangeResolveTrigger",((e,t)=>{const{onResolveThresholdChange:s}=this.props;s(e.alertThreshold)}))}componentDidMount(){const{api:e,organization:t}=this.props;(0,xe.MA)(e,t.slug)}getCriticalThresholdPlaceholder(e,t){return e.includes("failure_rate")?"0.05":(0,Ue.Eb)(e)?"97":t===q.t6.CHANGE?"100":"300"}getIndicator(e){const{hasAlertWizardV3:t}=this.props;return e===q.F4.CRITICAL?t?(0,_.tZ)(He,{color:"red300",size:"sm"}):(0,_.tZ)(ke,{size:12}):e===q.F4.WARNING?t?(0,_.tZ)(He,{color:"yellow300",size:"sm"}):(0,_.tZ)(We,{size:12}):t?(0,_.tZ)(He,{color:"green300",size:"sm"}):(0,_.tZ)(Be,{size:12})}render(){const{api:e,config:t,disabled:s,errors:n,organization:r,triggers:a,thresholdType:i,thresholdPeriod:o,comparisonType:l,aggregate:d,resolveThreshold:u,projects:c,hasAlertWizardV3:h,onThresholdTypeChange:p,onThresholdPeriodChange:m}=this.props,g={label:q.F4.RESOLVE,alertThreshold:u,actions:[]},f=(0,P.Hq)(d,l);return(0,_.BX)(C.Fragment,{children:[a.map(((a,g)=>{const y=0===g;return(0,_.tZ)(Le,{api:e,config:t,disabled:s,error:n&&n.get(g),trigger:a,thresholdPeriod:o,thresholdType:i,comparisonType:l,aggregate:d,resolveThreshold:u,organization:r,projects:c,triggerIndex:g,isCritical:y,hasAlertWizardV3:h,fieldHelp:h?null:(0,v._N)("The threshold[units] that will activate the [severity] status.",{severity:y?(0,v.t)("critical"):(0,v.t)("warning"),units:f?` (${f})`:""}),triggerLabel:(0,_.BX)($e,{children:[this.getIndicator(y?q.F4.CRITICAL:q.F4.WARNING),y?(0,v.t)("Critical"):(0,v.t)("Warning")]}),placeholder:y?`${this.getCriticalThresholdPlaceholder(d,l)}${l===q.t6.COUNT?f:""}`:(0,v.t)("None"),onChange:this.handleChangeTrigger(g),onThresholdTypeChange:p,onThresholdPeriodChange:m},g)})),(0,_.tZ)(Le,{api:e,config:t,disabled:s,error:n&&n.get(2),trigger:g,thresholdPeriod:o,thresholdType:+!i,comparisonType:l,aggregate:d,resolveThreshold:u,organization:r,projects:c,triggerIndex:2,isCritical:!1,hasAlertWizardV3:h,fieldHelp:h?null:(0,v._N)("The threshold[units] that will activate the resolved status.",{units:f?` (${f})`:""}),triggerLabel:(0,_.BX)($e,{children:[this.getIndicator(q.F4.RESOLVE),(0,v.t)("Resolved")]}),placeholder:(0,v.t)("Automatic"),onChange:this.handleChangeResolveTrigger,onThresholdTypeChange:p,onThresholdPeriodChange:m})]})}}Ve.displayName="TriggerFormContainer";const ke=(0,r.Z)(c.Z,{target:"ebmwntt5"})("background:",(e=>e.theme.red300),";margin-right:",(0,y.Z)(1),";"),We=(0,r.Z)(c.Z,{target:"ebmwntt4"})("background:",(e=>e.theme.yellow300),";margin-right:",(0,y.Z)(1),";"),Be=(0,r.Z)(c.Z,{target:"ebmwntt3"})("background:",(e=>e.theme.green300),";margin-right:",(0,y.Z)(1),";"),$e=(0,r.Z)("div",{target:"ebmwntt2"})({name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"}),He=(0,r.Z)(K.Sq,{target:"ebmwntt1"})("margin-right:",(0,y.Z)(.75),";"),Xe=(0,r.Z)(Se.Z,{target:"ebmwntt0"})({name:"1ivpj7k",styles:"&>label>div:first-child>span{display:flex;flex-direction:row;}"}),Ye=(0,Ae.Z)((0,Ce.Z)(Ve));class Ge extends C.Component{constructor(){super(...arguments),(0,n.Z)(this,"handleDeleteTrigger",(e=>{const{triggers:t,onChange:s}=this.props;s((0,B.E)(t,e))})),(0,n.Z)(this,"handleChangeTrigger",((e,t,s)=>{const{triggers:n,onChange:r}=this.props;r((0,$.m)(n,e,t),e,s)})),(0,n.Z)(this,"handleAddAction",((e,t)=>{const{onChange:s,triggers:n}=this.props,r=n[e],a=[...r.actions,t];s((0,$.m)(n,e,{...r,actions:a}),e,{actions:a})})),(0,n.Z)(this,"handleChangeActions",((e,t,s)=>{const{onChange:n}=this.props,r=t[e];n((0,$.m)(t,e,{...r,actions:s}),e,{actions:s})}))}render(){const{availableActions:e,currentProject:t,errors:s,organization:n,projects:r,triggers:a,disabled:i,aggregate:o,thresholdType:l,thresholdPeriod:d,comparisonType:u,resolveThreshold:c,hasAlertWizardV3:h,onThresholdTypeChange:p,onResolveThresholdChange:m,onThresholdPeriodChange:g}=this.props;return(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(w.s_,{children:(0,_.tZ)(w.N,{children:(0,_.tZ)(Ye,{disabled:i,errors:s,organization:n,projects:r,triggers:a,aggregate:o,resolveThreshold:c,thresholdType:l,thresholdPeriod:d,comparisonType:u,hasAlertWizardV3:h,onChange:this.handleChangeTrigger,onThresholdTypeChange:p,onResolveThresholdChange:m,onThresholdPeriodChange:g})})}),(0,_.tZ)(Ze,{disabled:i,loading:null===e,error:!1,availableActions:e,currentProject:t,organization:n,hasAlertWizardV3:h,projects:r,triggers:a,onChange:this.handleChangeActions,onAdd:this.handleAddAction})]})}}Ge.displayName="Triggers";const Ke=Ge;var Qe=s("../node_modules/lodash/capitalize.js"),Je=s.n(Qe),et=s("../node_modules/lodash/maxBy.js"),tt=s.n(et),st=s("../node_modules/lodash/minBy.js"),nt=s.n(st),rt=s("./app/actionCreators/events.tsx"),at=s("./app/components/charts/eventsRequest.tsx"),it=s("./app/components/charts/optionSelector.tsx"),ot=s("./app/components/charts/sessionsRequest.tsx"),lt=s("./app/components/loadingMask.tsx"),dt=s("./app/components/placeholder.tsx"),ut=s("./app/utils/sessions.tsx"),ct=s("./app/components/charts/components/markLine.tsx"),ht=s("./app/utils/formatters.tsx"),pt=s("./app/utils/theme.tsx"),mt=s("./app/views/alerts/utils/getChangeStatus.tsx"),gt=s("./app/views/alerts/wizard/options.tsx"),vt=s("./app/views/alerts/wizard/utils.tsx"),ft=s("../node_modules/color/index.js"),yt=s.n(ft),bt=s("../node_modules/lodash/debounce.js"),Tt=s.n(bt),Zt=s("../node_modules/lodash/flatten.js"),xt=s.n(Zt),St=s("./app/components/charts/areaChart.tsx");s("../node_modules/echarts/lib/component/graphic.js");var Ct=s("./app/components/charts/components/tooltip.tsx"),At=s("./app/components/charts/series/lineSeries.tsx"),Et=s("./app/constants/index.tsx"),Rt=s("./app/constants/chartPalette.tsx");const wt={left:(0,y.Z)(2),right:(0,y.Z)(2),top:(0,y.Z)(4),bottom:(0,y.Z)(2)},_t={RESOLUTION_FILL:yt()(pt.ZP.green200).alpha(.1).rgb().string(),CRITICAL_FILL:yt()(pt.ZP.red300).alpha(.25).rgb().string(),WARNING_FILL:yt()(pt.ZP.yellow200).alpha(.1).rgb().string()};class It extends C.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"state",{width:-1,height:-1,yAxisMax:null,yAxisMin:null}),(0,n.Z)(this,"ref",null),(0,n.Z)(this,"handleUpdateChartAxis",(()=>{var e,t;const{triggers:s,resolveThreshold:n,hideThresholdLines:r}=this.props,a=null===(e=this.ref)||void 0===e||null===(t=e.getEchartsInstance)||void 0===t?void 0:t.call(e);if(!r&&a){const e=[n||null,...s.map((e=>e.alertThreshold||null))].filter((e=>null!==e));this.updateChartAxis(Math.min(...e),Math.max(...e))}})),(0,n.Z)(this,"updateChartAxis",Tt()(((e,t)=>{const{minValue:s,maxValue:n,aggregate:r}=this.props,a=(0,Ue.QR)(r);let i=a&&n?this.clampMaxValue(Math.ceil(n*Ue.t3)):null,o=a&&s?Math.floor(s/Ue.t3):0;"number"==typeof n&&t>n&&(i=t),"number"==typeof s&&e<s&&(o=Math.floor(e/Ue.t3)),this.setState({yAxisMax:i,yAxisMin:o},this.forceUpdate)}),150)),(0,n.Z)(this,"updateDimensions",(()=>{var e,t,s;const n=null===(e=this.ref)||void 0===e||null===(t=e.getEchartsInstance)||void 0===t?void 0:t.call(e);if(!n||null===(s=n.getWidth)||void 0===s||!s.call(n))return;const r=n.getWidth(),a=n.getHeight();r===this.state.width&&a===this.state.height||this.setState({width:r,height:a})})),(0,n.Z)(this,"handleRef",(e=>{e&&!this.ref&&(this.ref=e,this.updateDimensions(),this.handleUpdateChartAxis()),e||(this.ref=null)})),(0,n.Z)(this,"getThresholdLine",((e,t,s)=>{var n,r,a;const{thresholdType:i,resolveThreshold:o,maxValue:l,hideThresholdLines:d}=this.props,u="alertThreshold"===t?this.getChartPixelForThreshold(e[t]):this.getChartPixelForThreshold(o),c=i===q.lT.BELOW,h=null===(n=this.ref)||void 0===n||null===(r=n.getEchartsInstance)||void 0===r?void 0:r.call(n);if("number"!=typeof u||isNaN(u)||!this.state.height||!h||d)return[];const p=h.convertToPixel({yAxisIndex:0},`${this.state.yAxisMin}`),m="number"==typeof p?p:0,g=100*Math.round(Math.max(null!=l?l:1,null!==(a=this.state.yAxisMax)&&void 0!==a?a:1))/100,v=15+(g<=1?15:8*`${null!=g?g:""}`.length),f=this.state.width-parseInt(wt.right.slice(0,-2),10)-v,y=e.label===q.F4.CRITICAL;return[{type:"line",invisible:null===u,draggable:!1,position:[v,u],shape:{y1:1,y2:1,x1:7,x2:f},style:{stroke:s?pt.ZP.green300:y?pt.ZP.red300:pt.ZP.yellow300,lineDash:[2]},silent:!0,z:100},...null!==u?[{type:"rect",draggable:!1,silent:!0,position:s!==c?[v+7,u+1]:[v+7,20],shape:{width:f-7,height:s!==c?m-u:u-20},style:{fill:s?_t.RESOLUTION_FILL:y?_t.CRITICAL_FILL:_t.WARNING_FILL},z:100}]:[]]})),(0,n.Z)(this,"getChartPixelForThreshold",(e=>{var t,s;const n=null===(t=this.ref)||void 0===t||null===(s=t.getEchartsInstance)||void 0===s?void 0:s.call(t);return""!==e&&n&&n.convertToPixel({yAxisIndex:0},`${e}`)}))}componentDidMount(){this.handleUpdateChartAxis()}componentDidUpdate(e){this.props.triggers===e.triggers&&this.props.data===e.data&&this.props.comparisonData===e.comparisonData&&this.props.comparisonMarkLines===e.comparisonMarkLines||this.handleUpdateChartAxis()}clampMaxValue(e){return(0,Ue.Eb)(this.props.aggregate)&&e>100?100:e}render(){var e,t;const{data:s,triggers:n,period:r,aggregate:a,comparisonData:i,comparisonSeriesName:o,comparisonMarkLines:l,minutesThresholdToDisplaySeconds:d,thresholdType:u}=this.props,c=null==s?void 0:s.map((e=>{let{data:t,...s}=e;return{...s,data:t.slice(0,-1)}})),h=null==i?void 0:i.map((e=>{let{data:t,...s}=e;return{...s,data:t.slice(0,-1)}})),p={tooltip:{valueFormatter:e=>(0,Ue.qn)(e,a,a),formatAxisLabel:(e,t,s,r,a,i,l)=>{const d=(0,Ct.J)(e,t,s,r,a,i),c=Array.isArray(l)?l:[l],h=c.length>1?c[0].data[1]:void 0,p=c.length>1?c.find((e=>{let{seriesName:t}=e;return t===o})):void 0,m=null==p?void 0:p.data[1];if(void 0===m||void 0===h||0===m)return`<span>${d}</span>`;const g=100*(h-m)/m,v=(0,mt.R)(g,u,n);return`<span>${d}<span style="color:${v===q.F4.CRITICAL?pt.ZP.red300:v===q.F4.WARNING?pt.ZP.yellow300:pt.ZP.green300};margin-left:10px;">\n            ${1===Math.sign(g)?"+":"-"}${Math.abs(g).toFixed(2)}%</span></span>`}},yAxis:{min:null!==(e=this.state.yAxisMin)&&void 0!==e?e:void 0,max:null!==(t=this.state.yAxisMax)&&void 0!==t?t:void 0,axisLabel:{formatter:e=>(0,Ue.lR)(e,s[0].seriesName,a)}}};return(0,_.tZ)(St.T,{isGroupedByDate:!0,showTimeInTooltip:!0,minutesThresholdToDisplaySeconds:d,period:Et.GY||r,forwardedRef:this.handleRef,grid:wt,...p,graphic:{elements:xt()(n.map((e=>[...this.getThresholdLine(e,"alertThreshold",!1),...this.getThresholdLine(e,"resolveThreshold",!0)])))},colors:Rt.Z[0],series:[...c,...l],additionalSeries:h.map((e=>{let{data:t,...s}=e;return(0,At.Z)({name:o,data:t.map((e=>{let{name:t,value:s}=e;return[t,s]})),lineStyle:{color:pt.ZP.gray200,type:"dashed",width:1},itemStyle:{color:pt.ZP.gray200},animation:!1,animationThreshold:1,animationDuration:0,...s})})),onFinished:()=>{this.updateDimensions()}})}}It.displayName="ThresholdsChart",(0,n.Z)(It,"defaultProps",{data:[],comparisonData:[],comparisonMarkLines:[]});const jt={[q.XH.SIX_HOURS]:(0,v.t)("Last 6 hours"),[q.XH.ONE_DAY]:(0,v.t)("Last 24 hours"),[q.XH.THREE_DAYS]:(0,v.t)("Last 3 days"),[q.XH.SEVEN_DAYS]:(0,v.t)("Last 7 days"),[q.XH.FOURTEEN_DAYS]:(0,v.t)("Last 14 days"),[q.XH.THIRTY_DAYS]:(0,v.t)("Last 30 days")},Nt=[q.XH.ONE_DAY,q.XH.THREE_DAYS,q.XH.SEVEN_DAYS,q.XH.FOURTEEN_DAYS,q.XH.THIRTY_DAYS],Dt={[q.Tb.ONE_MINUTE]:[q.XH.SIX_HOURS,q.XH.ONE_DAY,q.XH.THREE_DAYS,q.XH.SEVEN_DAYS],[q.Tb.FIVE_MINUTES]:Nt,[q.Tb.TEN_MINUTES]:Nt,[q.Tb.FIFTEEN_MINUTES]:Nt,[q.Tb.THIRTY_MINUTES]:Nt,[q.Tb.ONE_HOUR]:Nt,[q.Tb.TWO_HOURS]:Nt,[q.Tb.FOUR_HOURS]:[q.XH.THREE_DAYS,q.XH.SEVEN_DAYS,q.XH.FOURTEEN_DAYS,q.XH.THIRTY_DAYS],[q.Tb.ONE_DAY]:[q.XH.THIRTY_DAYS]},Ot={[q.Tb.THIRTY_MINUTES]:"30m",[q.Tb.ONE_HOUR]:"1h",[q.Tb.TWO_HOURS]:"2h",[q.Tb.FOUR_HOURS]:"4h",[q.Tb.ONE_DAY]:"1d"},Ft={[q.lK.CRASH_FREE_SESSIONS]:(0,v.t)("Total Sessions"),[q.lK.CRASH_FREE_USERS]:(0,v.t)("Total Users")};class zt extends C.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"state",{statsPeriod:q.XH.SEVEN_DAYS,totalCount:null}),(0,n.Z)(this,"handleStatsPeriodChange",(e=>{this.setState({statsPeriod:e})})),(0,n.Z)(this,"getStatsPeriod",(()=>{const{statsPeriod:e}=this.state,{timeWindow:t}=this.props,s=this.availableTimePeriods[t];return s.includes(e)?e:s[s.length-1]}))}componentDidMount(){(0,Ue.Eb)(this.props.aggregate)||this.fetchTotalCount()}componentDidUpdate(e,t){const{query:s,environment:n,timeWindow:r,aggregate:a,projects:i}=this.props,{statsPeriod:o}=this.state;(0,Ue.Eb)(a)||e.projects===i&&e.environment===n&&e.query===s&&e.timeWindow===r&&t.statsPeriod===o||this.fetchTotalCount()}get availableTimePeriods(){return(0,Ue.Eb)(this.props.aggregate)?{...Dt,[q.Tb.THIRTY_MINUTES]:[q.XH.SIX_HOURS]}:Dt}get comparisonSeriesName(){var e;return Je()((null===(e=P.KP.find((e=>{let{value:t}=e;return t===this.props.comparisonDelta})))||void 0===e?void 0:e.label)||"")}async fetchTotalCount(){const{api:e,organization:t,environment:s,projects:n,query:r}=this.props,a=this.getStatsPeriod();try{const i=await(0,rt.JE)(e,t.slug,{field:[],project:n.map((e=>{let{id:t}=e;return t})),query:r,statsPeriod:a,environment:s?[s]:[]});this.setState({totalCount:i})}catch(e){this.setState({totalCount:null})}}renderChart(){var e,t,s,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;const{triggers:c,resolveThreshold:h,thresholdType:p,header:m,timeWindow:g,aggregate:f,comparisonType:y}=this.props,{statsPeriod:b,totalCount:T}=this.state,Z=this.availableTimePeriods[g],x=this.getStatsPeriod();return(0,_.BX)(C.Fragment,{children:[m,(0,_.tZ)(Mt,{visible:i}),a?(0,_.tZ)(qt,{}):(0,_.tZ)(It,{period:b,minValue:null===(e=nt()(null===(t=r[0])||void 0===t?void 0:t.data,(e=>{let{value:t}=e;return t})))||void 0===e?void 0:e.value,maxValue:null===(s=tt()(null===(n=r[0])||void 0===n?void 0:n.data,(e=>{let{value:t}=e;return t})))||void 0===s?void 0:s.value,data:r,comparisonData:null!=o?o:[],comparisonSeriesName:this.comparisonSeriesName,comparisonMarkLines:null!=l?l:[],hideThresholdLines:y===q.t6.CHANGE,triggers:c,resolveThreshold:h,thresholdType:p,aggregate:f,minutesThresholdToDisplaySeconds:d}),(0,_.BX)(u.xx,{children:[(0,_.BX)(u.m2,{children:[(0,_.tZ)(u.OT,{children:(0,Ue.Eb)(f)?Ft[f]:(0,v.t)("Total Events")}),(0,_.tZ)(u.uN,{children:null!==T?T.toLocaleString():"—"})]}),(0,_.tZ)(u.m2,{children:(0,_.tZ)(it.Z,{options:Z.map((e=>({label:jt[e],value:e,disabled:a||i}))),selected:x,onChange:this.handleStatsPeriodChange,title:(0,v.t)("Display")})})]})]})}render(){const{api:e,organization:t,projects:s,timeWindow:n,query:r,aggregate:a,environment:i,comparisonDelta:o,triggers:l,thresholdType:d}=this.props,u=this.getStatsPeriod(),c=Boolean(t.features.includes("change-alerts")&&o);return(0,Ue.Eb)(a)?(0,_.tZ)(ot.Z,{api:e,organization:t,project:s.map((e=>{let{id:t}=e;return Number(t)})),environment:i?[i]:void 0,statsPeriod:u,query:r,interval:Ot[n],field:Ue.Vc[a],groupBy:["session.status"],children:e=>{let{loading:t,reloading:s,response:n}=e;const{groups:r,intervals:i}=n||{},o=[{seriesName:gt.gb[(0,vt.k)({aggregate:a,dataset:q.qz.SESSIONS})],data:(0,ut.FS)(r,i,Ue.Vc[a])}];return this.renderChart(o,t,s,void 0,void 0,ut.VH)}}):(0,_.tZ)(at.Z,{api:e,organization:t,query:r,environment:i?[i]:void 0,project:s.map((e=>{let{id:t}=e;return Number(t)})),interval:`${n}m`,comparisonDelta:o&&60*o,period:u,yAxis:a,includePrevious:!1,currentSeriesNames:[a],partial:!1,children:e=>{let{loading:t,reloading:s,timeseriesData:r,comparisonTimeseriesData:a}=e,i=[];return c&&a&&(i=function(){var e,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const o=[];if(void 0!==(null==s||null===(e=s[0])||void 0===e?void 0:e.data)&&s[0].data.length>1&&void 0!==(null==n||null===(t=n[0])||void 0===t?void 0:t.data)&&n[0].data.length>1){const e=n[0].data,t=s[0].data;if(a.some((e=>{let{alertThreshold:t}=e;return"number"==typeof t}))){const s=t[e.length-1].name-r*ht.EB;return e.forEach(((s,n)=>{let{name:r,value:l}=s;const d=t[n].value,u=0===l?0===d?0:1/0:(d-l)/l*100,c=(0,mt.R)(u,i,a);0!==n&&n!==e.length-1&&c===o[o.length-1].status||o.push({name:r,status:c})})),o.slice(0,-1).map(((e,t)=>{let{name:n,status:r}=e;return{seriesName:(0,v.t)("status"),type:"line",markLine:(0,ct.Z)({silent:!0,lineStyle:{color:r===q.F4.CRITICAL?pt.ZP.red300:r===q.F4.WARNING?pt.ZP.yellow300:pt.ZP.green300,type:"solid",width:4},data:[[{coord:[n,0]},{coord:[Math.min(o[t+1].name,s),0]}]]}),data:[]}}))}}return[]}(r,a,n,l,d)),this.renderChart(r,t,s,a,i)}})}}zt.displayName="TriggersChart";const Pt=(0,Ce.Z)(zt),Mt=(0,r.Z)(lt.Z,{target:"e17sbfy61"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;"),qt=(0,r.Z)(dt.Z,{target:"e17sbfy60"})("margin:0 0 ",(0,y.Z)(2),";height:184px;");var Ut=s("./app/views/alerts/rules/metric/utils/getEventTypeFilter.tsx");function Lt(e){return(0,b.ri)(e)&&""!==e}var Vt=s("./app/views/alerts/types.tsx");function kt(e){return!!e.id}var Wt=s("../node_modules/react-select/dist/index-4322c0ed.browser.esm.js"),Bt=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),$t=s("../node_modules/lodash/pick.js"),Ht=s.n($t),Xt=s("./app/components/events/searchBar.tsx"),Yt=s("./app/components/forms/selectField.tsx"),Gt=s("./app/components/idBadge/index.tsx"),Kt=s("./app/utils/discover/fields.tsx"),Qt=s("./app/utils/environment.tsx"),Jt=s("../node_modules/lodash/findKey.js"),es=s.n(Jt),ts=s("./app/views/eventsV2/table/queryField.tsx"),ss=s("./app/views/eventsV2/table/types.tsx"),ns=s("./app/views/eventsV2/utils.tsx"),rs=s("./app/utils/discover/types.tsx"),as=s("./app/utils/tokenizeSearch.tsx"),is=s("./app/utils/discover/eventView.tsx");function os(e){var t;const{orgSlug:s,projects:n,incident:r,stats:a,extraQueryParams:i}=e;if(!(n&&n.length&&r&&a))return"";const o=`${r.alertRule.timeWindow}m`,{start:l,end:d}=(0,Ue.Eq)(a),u={id:void 0,name:r&&r.title||"",orderby:`-${(0,Kt.LY)(r.alertRule.aggregate)}`,yAxis:r.alertRule.aggregate?[r.alertRule.aggregate]:void 0,query:null!==(t=null==r?void 0:r.discoverQuery)&&void 0!==t?t:"",projects:n.filter((e=>{let{slug:t}=e;return r.projects.includes(t)})).map((e=>{let{id:t}=e;return Number(t)})),version:2,fields:r.alertRule.dataset===q.qz.ERRORS?["issue","count()","count_unique(user)"]:["transaction",r.alertRule.aggregate],start:l,end:d,...i},c=is.ZP.fromSavedQuery(u),{query:h,...p}=c.getResultsViewUrlTarget(s);return{query:{...h,interval:o},...p}}var ls=s("./app/views/performance/transactionSummary/utils.tsx");const ds=[{name:(0,v.t)("Error count"),match:/^count\(\)/,validDataset:[q.qz.ERRORS],default:"count()",makeCtaParams:cs},{name:(0,v.t)("Users affected"),match:/^count_unique\(user\)/,validDataset:[q.qz.ERRORS],default:"count_unique(user)",makeCtaParams:cs},{name:(0,v.t)("Latency"),match:/^(p[0-9]{2,3}|percentile\(transaction\.duration,[^)]+\)|avg\([^)]+\))/,validDataset:[q.qz.TRANSACTIONS],default:"percentile(transaction.duration, 0.95)",makeCtaParams:e=>us({opts:e,tooltip:(0,v.t)("Latency by Transaction")})},{name:(0,v.t)("Apdex"),match:/^apdex\([0-9.]+\)/,validDataset:[q.qz.TRANSACTIONS],default:"apdex(300)",makeCtaParams:e=>us({opts:e,tooltip:(0,v.t)("Apdex by Transaction")})},{name:(0,v.t)("Transaction Count"),match:/^count\(\)/,validDataset:[q.qz.TRANSACTIONS],default:"count()",makeCtaParams:e=>us({opts:e})},{name:(0,v.t)("Failure rate"),match:/^failure_rate\(\)/,validDataset:[q.qz.TRANSACTIONS],default:"failure_rate()",makeCtaParams:function(e){var t,s;let{orgSlug:n,incident:r,projects:a,stats:i}=e;if(!r||!i)return{to:"",buttonText:(0,v.t)("Incident details")};const o=null===(s=new as.MY(null!==(t=r.discoverQuery)&&void 0!==t?t:"").getFilterValues("transaction"))||void 0===s?void 0:s.find((e=>!e.includes("*")));return{to:os({orgSlug:n,projects:a,incident:r,stats:i,extraQueryParams:void 0!==o?{fields:["transaction.status","count()"],orderby:"-count",display:rs.DC.TOP5}:{fields:["transaction","failure_rate()"],orderby:"-failure_rate",display:rs.DC.TOP5}}),buttonText:(0,v.t)("Open in Discover"),title:void 0===o?(0,v.t)("Failure rate by transaction"):void 0}}}];function us(e){var t,s;const{opts:{orgSlug:n,projects:r,incident:a,stats:i},tooltip:o}=e;if(!a||!i)return{to:"",buttonText:(0,v.t)("Incident details")};const l=null===(s=new as.MY(null!==(t=a.discoverQuery)&&void 0!==t?t:"").getFilterValues("transaction"))||void 0===s?void 0:s.find((e=>!e.includes("*")));if(void 0!==l){const e=(0,Ue.Eq)(i);return{to:(0,ls.e1)({orgSlug:n,transaction:l,projectID:r.filter((e=>{let{slug:t}=e;return a.projects.includes(t)})).map((e=>{let{id:t}=e;return t})),query:{...e}}),buttonText:(0,v.t)("View Transaction Summary"),title:l}}const d={fields:[...new Set(["transaction","count()",a.alertRule.aggregate])],orderby:"-count",display:rs.DC.TOP5};return{to:os({orgSlug:n,projects:r,incident:a,stats:i,extraQueryParams:d}),buttonText:(0,v.t)("Open in Discover"),title:o}}function cs(e){let{orgSlug:t,projects:s,incident:n,stats:r}=e;if(!n)return{buttonText:(0,v.t)("Open in Discover"),to:""};const a={display:rs.DC.TOP5};return{buttonText:(0,v.t)("Open in Discover"),to:os({orgSlug:t,projects:s,incident:n,stats:r,extraQueryParams:a})}}const hs=e=>{let t,{dataset:s,alertType:n}=e,r=!1,a=!1;n?(t=(0,P.nM)(n,s),r=gt.F7.has(n),a=gt.LH.has(n)):t=s===q.qz.ERRORS?P.yq:P.Yp;const i=Object.fromEntries(t.aggregations.map((e=>{if("count_unique"===e){const t=Kt.lx[e];return t.getFieldOverrides=()=>({defaultValue:"tags[sentry:user]"}),[e,t]}return[e,Kt.lx[e]]}))),o=Object.fromEntries(t.fields.map((e=>"user"===e?["tags[sentry:user]","string"]:[e,Kt._f[e]]))),{measurementKeys:l}=t;return{fieldOptionsConfig:{aggregations:i,fields:o,measurementKeys:l},hidePrimarySelector:r,hideParameterSelector:a}},ps=e=>{let{name:t,model:s}=e;const n=s.getValue(t),r=ds.filter((e=>e.validDataset.includes(s.getValue("dataset")))).map((e=>({...e,selected:e.match.test(n)}))).map(((e,n,r)=>(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(_e.Z,{title:(0,v.t)("This preset is selected"),disabled:!e.selected,children:(0,_.tZ)(vs,{type:"button",onClick:()=>s.setValue(t,e.default),disabled:e.selected,children:e.name})}),n+1<r.length&&", "]},e.name)));return(0,v._N)("Choose an aggregate function. Not sure what to select, try a preset: [presets]",{presets:r})},ms=e=>{let{organization:t,columnWidth:s,inFieldLabels:n,alertType:r,...a}=e;return(0,_.tZ)(A.Z,{help:ps,...a,children:e=>{var a;let{onChange:i,value:o,model:l,disabled:d}=e;const u=l.getValue("dataset"),{fieldOptionsConfig:c,hidePrimarySelector:h,hideParameterSelector:p}=hs({dataset:u,alertType:r}),m=(0,ns.R0)({organization:t,...c}),g=(0,Kt.nr)(null!=o?o:""),v=null===(a=m[(null==g?void 0:g.kind)===ss.L.FUNCTION?`function:${g.function[0]}`:""])||void 0===a?void 0:a.value,f=((null==v?void 0:v.kind)===ss.L.FUNCTION?v.meta.parameters.length:0)-(p?1:0)-(h?1:0);return(0,_.tZ)(C.Fragment,{children:(0,_.tZ)(gs,{filterPrimaryOptions:e=>e.value.kind===ss.L.FUNCTION,fieldOptions:m,fieldValue:g,onChange:e=>i((0,Kt.sN)(e),{}),columnWidth:s,gridColumns:f+1,inFieldLabels:n,shouldRenderTag:!1,disabled:d,hideParameterSelector:p,hidePrimarySelector:h})})}})};ms.displayName="MetricField";const gs=(0,r.Z)(ts.q,{target:"e1a5h5oy1"})((e=>e.columnWidth&&(0,Bt.iv)("width:",e.gridColumns*e.columnWidth,"px;","")),";"),vs=(0,r.Z)(d.ZP,{target:"e1a5h5oy0"})((e=>e.disabled&&(0,Bt.iv)("color:",e.theme.textColor,";&:hover,&:focus{color:",e.theme.textColor,";}","")),";");vs.defaultProps={priority:"link",borderless:!0};const fs=ms,ys=[{label:(0,v.t)("ERRORS"),options:[{label:gt.gb.num_errors,value:"num_errors"},{label:gt.gb.users_experiencing_errors,value:"users_experiencing_errors"}]},{label:(0,v.t)("SESSIONS"),options:[{label:gt.gb.crash_free_sessions,value:"crash_free_sessions"},{label:gt.gb.crash_free_users,value:"crash_free_users"}]},{label:(0,v.t)("PERFORMANCE"),options:[{label:gt.gb.throughput,value:"throughput"},{label:gt.gb.trans_duration,value:"trans_duration"},{label:gt.gb.apdex,value:"apdex"},{label:gt.gb.failure_rate,value:"failure_rate"},{label:gt.gb.lcp,value:"lcp"},{label:gt.gb.fid,value:"fid"},{label:gt.gb.cls,value:"cls"}]},{label:(0,v.t)("CUSTOM"),options:[{label:gt.gb.custom,value:"custom"}]}];function bs(e){let{organization:t,columnWidth:s,inFieldLabels:n,alertType:r,...a}=e;return(0,_.tZ)(A.Z,{...a,children:e=>{var a,i;let{onChange:o,value:l,model:d,disabled:u}=e;const c=d.getValue("dataset"),h=[...null!==(a=d.getValue("eventTypes"))&&void 0!==a?a:[]],p="custom"===r?r:es()(gt.FZ,(e=>((e,t)=>{var s,n,r,a,i,o,l,d;const u=(0,Kt.nr)(e.aggregate),c=(0,Kt.nr)(t);return e.aggregate===t||"function"===u.kind&&"function"===c.kind&&("apdex"===(null===(s=u.function)||void 0===s?void 0:s[0])&&"apdex"===(null===(n=c.function)||void 0===n?void 0:n[0])||(null!==(r=u.function)&&void 0!==r&&r[1]&&null!==(a=c.function)&&void 0!==a&&a[1]?(null===(i=u.function)||void 0===i?void 0:i[1])===(null===(o=c.function)||void 0===o?void 0:o[1]):(null===(l=u.function)||void 0===l?void 0:l[0])===(null===(d=c.function)||void 0===d?void 0:d[0])))})(e,l)&&((e,s)=>e.dataset===s||t.features.includes("alert-crash-free-metrics")&&(e.aggregate===q.lK.CRASH_FREE_SESSIONS||e.aggregate===q.lK.CRASH_FREE_USERS)&&s===q.qz.METRICS)(e,c)&&((e,t,s)=>s===q.lK.CRASH_FREE_SESSIONS||s===q.lK.CRASH_FREE_USERS||t.includes(e.eventTypes))(e,h,l)))||"num_errors",{fieldOptionsConfig:m,hidePrimarySelector:g,hideParameterSelector:v}=hs({dataset:c,alertType:r}),f=(0,ns.R0)({organization:t,...m}),y=(0,Kt.nr)(null!=l?l:""),b=null===(i=f[(null==y?void 0:y.kind)===ss.L.FUNCTION?`function:${y.function[0]}`:""])||void 0===i?void 0:i.value,T=1+((null==b?void 0:b.kind)===ss.L.FUNCTION?b.meta.parameters.length:0)-(v?1:0)-(g?1:0);return(0,_.BX)(Ts,{hideGap:T<1,children:[(0,_.tZ)(z.Z,{value:p,options:ys,onChange:e=>{const t=gt.FZ[e.value];d.setValue("aggregate",t.aggregate),d.setValue("dataset",t.dataset),d.setValue("eventTypes",[t.eventTypes])}}),(0,_.tZ)(Zs,{filterPrimaryOptions:e=>e.value.kind===ss.L.FUNCTION,fieldOptions:f,fieldValue:y,onChange:e=>o((0,Kt.sN)(e),{}),columnWidth:s,gridColumns:T,inFieldLabels:n,shouldRenderTag:!1,disabled:u,hideParameterSelector:v,hidePrimarySelector:g})]})}})}bs.displayName="WizardField";const Ts=(0,r.Z)("div",{target:"erovx8d1"})("display:grid;grid-template-columns:1fr auto;gap:",(e=>e.hideGap?(0,y.Z)(0):(0,y.Z)(1)),";"),Zs=(0,r.Z)(ts.q,{target:"erovx8d0"})((e=>e.columnWidth&&(0,Bt.iv)("width:",e.gridColumns*e.columnWidth,"px;","")),";"),xs={[q.Tb.ONE_MINUTE]:(0,v.t)("1 minute"),[q.Tb.FIVE_MINUTES]:(0,v.t)("5 minutes"),[q.Tb.TEN_MINUTES]:(0,v.t)("10 minutes"),[q.Tb.FIFTEEN_MINUTES]:(0,v.t)("15 minutes"),[q.Tb.THIRTY_MINUTES]:(0,v.t)("30 minutes"),[q.Tb.ONE_HOUR]:(0,v.t)("1 hour"),[q.Tb.TWO_HOURS]:(0,v.t)("2 hours"),[q.Tb.FOUR_HOURS]:(0,v.t)("4 hours"),[q.Tb.ONE_DAY]:(0,v.t)("24 hours")};class Ss extends C.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"state",{environments:null}),(0,n.Z)(this,"formElemBaseStyle",{padding:`${(0,y.Z)(.5)}`,border:"none"})}componentDidMount(){this.fetchData()}componentDidUpdate(e){e.project.id!==this.props.project.id&&this.fetchData()}async fetchData(){const{api:e,organization:t,project:s}=this.props;try{const n=await e.requestPromise(`/projects/${t.slug}/${s.slug}/environments/`,{query:{visibility:"visible"}});this.setState({environments:n})}catch(e){(0,a.Iw)((0,v.t)("Unable to fetch environments"))}}get timeWindowOptions(){let e=xs;return(0,M.I)(this.props.dataset)&&(e=Ht()(xs,[q.Tb.ONE_HOUR,q.Tb.TWO_HOURS,q.Tb.FOUR_HOURS,q.Tb.ONE_DAY])),Object.entries(e).map((e=>{let[t,s]=e;return{value:parseInt(t,10),label:this.props.hasAlertWizardV3?(0,v._N)("[timeWindow] interval",{timeWindow:"s"===s.slice(-1)?s.slice(0,-1):s}):s}}))}get searchPlaceholder(){switch(this.props.dataset){case q.qz.ERRORS:return(0,v.t)("Filter events by level, message, and other properties…");case q.qz.METRICS:case q.qz.SESSIONS:return(0,v.t)("Filter sessions by release version…");case q.qz.TRANSACTIONS:default:return(0,v.t)("Filter transactions by URL, tags, and other properties…")}}get searchSupportedTags(){if((0,M.I)(this.props.dataset))return{release:{key:"release",name:"release"}}}renderEventTypeFilter(){const{organization:e,disabled:t,alertType:s}=this.props,n=[{label:(0,v.t)("Errors"),options:[{value:q.Yh.ERROR_DEFAULT,label:Ue.CM[q.Yh.ERROR_DEFAULT]},{value:q.Yh.DEFAULT,label:Ue.CM[q.Yh.DEFAULT]},{value:q.Yh.ERROR,label:Ue.CM[q.Yh.ERROR]}]}];return e.features.includes("performance-view")&&"custom"===s&&n.push({label:(0,v.t)("Transactions"),options:[{value:q.Yh.TRANSACTION,label:Ue.CM[q.Yh.TRANSACTION]}]}),(0,_.tZ)(A.Z,{name:"datasource",inline:!1,style:{...this.formElemBaseStyle,minWidth:300,flex:2},flexibleControlStateSize:!0,children:e=>{let{onChange:s,onBlur:r,model:a}=e;const i=a.getValue("dataset"),o=a.getValue("eventTypes"),l=(0,Ue.KC)(i,o);return(0,_.tZ)(z.Z,{value:l,inFieldLabel:(0,v.t)("Events: "),onChange:e=>{var t;const n=e.value;s(n,{}),r(n,{}),"transaction"===n?a.setValue("aggregate",P.Ng):a.setValue("aggregate",P.Vr);const{dataset:i,eventTypes:o}=null!==(t=Ue.Ey[n])&&void 0!==t?t:{};a.setValue("dataset",i),a.setValue("eventTypes",o)},options:n,isDisabled:t})}})}renderIdBadge(e){return(0,_.tZ)(Gt.Z,{project:e,avatarProps:{consistentWidth:!0},avatarSize:18,disableLink:!0,hideName:!0})}renderProjectSelector(){const{project:e,projects:t,disabled:s,organization:n,disableProjectSelector:r}=this.props,a=n.features.includes("open-membership"),i=t.filter((e=>e.hasAccess&&e.isMember)),o=t.filter((e=>e.hasAccess&&!e.isMember)),l=i.map((e=>({value:e.id,label:e.slug,leadingItems:this.renderIdBadge(e)}))),d=[{label:(0,v.t)("My Projects"),options:l},{label:(0,v.t)("All Projects"),options:o.map((e=>({value:e.id,label:e.slug,leadingItems:this.renderIdBadge(e)})))}],u=a||(0,x.M)()?d:l;return(0,_.tZ)(A.Z,{name:"projectId",inline:!1,style:{...this.formElemBaseStyle,minWidth:300,flex:2},flexibleControlStateSize:!0,children:n=>{let{onChange:a,onBlur:i,model:o}=n;const l=t.find((e=>{let{id:t}=e;return t===o.getValue("projectId")}))||e;return(0,_.tZ)(z.Z,{isDisabled:s||r,value:l.id,options:u,onChange:e=>{var s,n;let{value:r}=e;const d=null!==(s=t.find((e=>{let{id:t}=e;return t===r})))&&void 0!==s?s:l,u=null===(n=o.getValue("owner"))||void 0===n?void 0:n.split(":")[1];u&&void 0===d.teams.find((e=>{let{id:t}=e;return t===u}))&&d.teams.length&&o.setValue("owner",`team:${d.teams[0].id}`),a(r,{}),i(r,{})},components:{SingleValue:e=>(0,_.tZ)(Wt.y.ValueContainer,{...e,children:(0,_.tZ)(Gt.Z,{project:l,avatarProps:{consistentWidth:!0},avatarSize:18,disableLink:!0})})}})}})}renderInterval(){const{organization:e,disabled:t,alertType:s,hasAlertWizardV3:n,timeWindow:r,comparisonDelta:a,comparisonType:i,onTimeWindowChange:o,onComparisonDeltaChange:l}=this.props,{labelText:d,timeWindowText:u}=(0,gt.mp)(s),c=n?(0,v.t)("Define your metric"):d;return(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(_s,{children:(0,_.BX)(Cs,{children:[(0,_.tZ)("div",{children:c}),!n&&(0,_.tZ)(_e.Z,{title:(0,v.t)("Time window over which the metric is evaluated. Alerts are evaluated every minute regardless of this value."),children:(0,_.tZ)(K.BS,{size:"sm",color:"gray200"})})]})}),(0,_.BX)(Is,{children:[n?(0,_.tZ)(bs,{name:"aggregate",help:null,organization:e,disabled:t,style:{...this.formElemBaseStyle,flex:1},inline:!1,flexibleControlStateSize:!0,columnWidth:200,alertType:s,required:!0}):(0,_.tZ)(fs,{name:"aggregate",help:null,organization:e,disabled:t,style:{...this.formElemBaseStyle},inline:!1,flexibleControlStateSize:!0,columnWidth:200,alertType:s,required:!0}),!n&&u&&(0,_.tZ)(js,{children:u}),(0,_.tZ)(z.Z,{name:"timeWindow",styles:{control:e=>({...e,minWidth:n?200:130,maxWidth:300}),container:e=>({...e,margin:n?`${(0,y.Z)(.5)}`:0})},options:this.timeWindowOptions,required:!0,isDisabled:t,value:r,onChange:e=>{let{value:t}=e;return o(t)},inline:!1,flexibleControlStateSize:!0}),!n&&(0,_.tZ)(O.Z,{features:["organizations:change-alerts"],organization:e,children:i===q.t6.CHANGE&&(0,_.BX)(Ns,{children:[(0,v.t)(" compared to "),(0,_.tZ)(z.Z,{name:"comparisonDelta",styles:{container:e=>({...e,marginLeft:(0,y.Z)(1)}),control:e=>({...e,minWidth:500,maxWidth:1e3})},value:a,onChange:e=>{let{value:t}=e;return l(t)},options:P.KP,required:i===q.t6.CHANGE})]})})]})]})}render(){var e;const{organization:t,disabled:s,onFilterSearch:n,allowChangeEventTypes:r,hasAlertWizardV3:a,dataset:i}=this.props,{environments:o}=this.state,l=[{value:null,label:(0,v.t)("All Environments")},...null!==(e=null==o?void 0:o.map((e=>({value:e.name,label:(0,Qt.G)(e)}))))&&void 0!==e?e:[]],d=Object.values({...Kt.Zl,...Kt.$n}),u="events"===i?[...d,"transaction","transaction.duration","transaction.op","transaction.status"]:[];return(0,_.BX)(C.Fragment,{children:[(0,_.tZ)(As,{children:(0,_.tZ)(Es,{children:this.props.thresholdChart})}),a&&this.renderInterval(),(0,_.tZ)(_s,{children:(0,v.t)("Filter events")}),(0,_.BX)(Is,{noMargin:!0,columns:1+(r?1:0)+(a?1:0),children:[a&&this.renderProjectSelector(),(0,_.tZ)(Yt.Z,{name:"environment",placeholder:(0,v.t)("All Environments"),style:{...this.formElemBaseStyle,minWidth:230,flex:1},styles:{singleValue:e=>({...e}),option:e=>({...e})},options:l,isDisabled:s||null===this.state.environments,isClearable:!0,inline:!1,flexibleControlStateSize:!0}),r&&this.renderEventTypeFilter()]}),(0,_.tZ)(Is,{children:(0,_.tZ)(A.Z,{name:"query",inline:!1,style:{...this.formElemBaseStyle,flex:"6 0 500px"},flexibleControlStateSize:!0,children:e=>{var r;let{onChange:a,onBlur:o,onKeyDown:l,initialData:d}=e;return(0,_.tZ)(Rs,{children:(0,_.tZ)(ws,{searchSource:"alert_builder",defaultQuery:null!==(r=null==d?void 0:d.query)&&void 0!==r?r:"",omitTags:["event.type","release.version","release.stage","release.package","release.build","project",...u],includeSessionTagsValues:i===q.qz.SESSIONS,disabled:s,useFormWrapper:!1,organization:t,placeholder:this.searchPlaceholder,onChange:a,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation()),null==l||l(e)},onBlur:e=>{n(e),o(e)},onSearch:e=>{n(e),a(e,{})},...this.searchSupportedTags?{supportedTags:this.searchSupportedTags}:{},hasRecentSearches:i!==q.qz.SESSIONS})})}})}),!a&&this.renderInterval()]})}}Ss.displayName="RuleConditionsForm";const Cs=(0,r.Z)("div",{target:"e3ltgsh8"})("display:flex;span{margin-left:",(0,y.Z)(1),";}"),As=(0,r.Z)(w.s_,{target:"e3ltgsh7"})("margin-bottom:",(0,y.Z)(4),";"),Es=(0,r.Z)(w.N,{target:"e3ltgsh6"})("ol,h4{margin-bottom:",(0,y.Z)(1),";}"),Rs=(0,r.Z)("div",{target:"e3ltgsh5"})({name:"zjik7",styles:"display:flex"}),ws=(0,r.Z)(Xt.Z,{target:"e3ltgsh4"})({name:"1ff36h2",styles:"flex-grow:1"}),_s=(0,r.Z)(g.Z,{target:"e3ltgsh3"})("margin-bottom:",(0,y.Z)(1),";font-size:",(e=>e.theme.fontSizeExtraLarge),";line-height:1.3;"),Is=(0,r.Z)("div",{target:"e3ltgsh2"})("display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;margin-bottom:",(e=>e.noMargin?0:(0,y.Z)(4)),";",(e=>void 0!==e.columns&&(0,Bt.iv)("display:grid;grid-template-columns:repeat(",e.columns,", auto);","")),";"),js=(0,r.Z)("div",{target:"e3ltgsh1"})("margin:",(0,y.Z)(1),";"),Ns=(0,r.Z)("div",{target:"e3ltgsh0"})("margin-left:",(0,y.Z)(1),";display:flex;flex-direction:row;align-items:center;"),Ds=(0,S.Z)(Ss),Os=e=>""===e||!(0,b.ri)(e);class Fs extends l.Z{constructor(){super(...arguments),(0,n.Z)(this,"pollingTimeout",void 0),(0,n.Z)(this,"resetPollingState",(e=>{f.Z.remove(e),this.setState({loading:!1,uuid:void 0})})),(0,n.Z)(this,"pollHandler",(async(e,t,s)=>{if(Date.now()>t)return(0,a.Iw)((0,v.t)("Looking for that channel took too long :(")),void this.resetPollingState(s);const{organization:n,onSubmitSuccess:r,params:{ruleId:i}}=this.props,{uuid:o,project:l}=this.state;try{const d=await this.api.requestPromise(`/projects/${n.slug}/${l.slug}/alert-rule-task/${o}/`),{status:u,alertRule:c,error:h}=d;if("pending"===u)return window.clearTimeout(this.pollingTimeout),void(this.pollingTimeout=window.setTimeout((()=>{this.pollHandler(e,t,s)}),1e3));this.resetPollingState(s),"failed"===u&&this.handleRuleSaveFailure(h),c&&((0,a.S9)(i?(0,v.t)("Updated alert rule"):(0,v.t)("Created alert rule")),r&&r(c,e))}catch{this.handleRuleSaveFailure((0,v.t)("An error occurred")),this.resetPollingState(s)}})),(0,n.Z)(this,"isValidTrigger",((e,t,s,n)=>{const{alertThreshold:r}=t,{thresholdType:a}=this.state;if(!Lt(r)||!Lt(n))return!0;const i=a===q.lT.BELOW?r-1<n+1:r+1>n-1,o=s.get(e)||{};if(i)return!0;const l=a===q.lT.BELOW;let d="";return d="number"!=typeof n?l?(0,v.t)("Resolution threshold must be greater than alert"):(0,v.t)("Resolution threshold must be less than alert"):l?(0,v.t)("Alert threshold must be less than resolution"):(0,v.t)("Alert threshold must be greater than resolution"),s.set(e,{...o,alertThreshold:d}),!1})),(0,n.Z)(this,"handleFieldChange",((e,t)=>{const{projects:s}=this.props;["aggregate","dataset","eventTypes","timeWindow","environment","comparisonDelta","projectId"].includes(e)&&this.setState((n=>{let{project:r}=n;return{[e]:t,project:"projectId"===e?s.find((e=>{let{id:s}=e;return s===t})):r}}))})),(0,n.Z)(this,"handleFilterUpdate",(e=>{const{organization:t,sessionId:s}=this.props;(0,Z.Z)("alert_builder.filter",{organization:t,session_id:s,query:e}),this.setState({query:e})})),(0,n.Z)(this,"handleSubmit",(async(e,t,s,n,r)=>{const i=r.validateForm(),o=this.validateTriggers(),l=0===Array.from(o).length;if(l||this.setState((e=>({triggerErrors:new Map([...o,...e.triggerErrors])}))),!i||!l){const e=[!i&&(0,v.t)("name"),!i&&!l&&(0,v.t)("and"),!l&&(0,v.t)("critical threshold")].filter((e=>e));return void(0,a.Iw)((0,v.t)("Alert not valid: missing %s",e.join(" ")))}const{organization:d,rule:u,onSubmitSuccess:c,location:h,sessionId:p,params:{ruleId:m}}=this.props,{project:g,aggregate:y,resolveThreshold:b,triggers:Z,thresholdType:x,thresholdPeriod:S,comparisonDelta:C,uuid:A,timeWindow:E}=this.state,R=Z.filter((e=>e.label!==q.F4.WARNING||!Os(e.alertThreshold))),w=f.Z.addMessage((0,v.t)("Saving your alert rule, hold on..."),"loading");try{var _;const e=T.oF.startTransaction({name:"saveAlertRule"});e.setTag("type",Vt.ok.METRIC),e.setTag("operation",u.id?"edit":"create");for(const t of R)for(const s of t.actions)"slack"===s.type&&e.setTag(s.type,!0);e.setData("actions",R),this.setState({loading:!0});const[t,,s]=await function(e,t,s,n,r){const a=kt(n),i=`/projects/${t}/${s}/alert-rules/${kt(n)?`${n.id}/`:""}`,o=a?"PUT":"POST";return e.requestPromise(i,{method:o,data:n,query:r,includeAllArgs:!0})}(this.api,d.slug,g.slug,{...u,...r.getTransformedData(),triggers:R,resolveThreshold:Os(b)?null:b,thresholdType:x,thresholdPeriod:S,comparisonDelta:null!=C?C:null,timeWindow:E,aggregate:y},{duplicateRule:this.isDuplicateRule?"true":"false",wizardV3:this.hasAlertWizardV3?"true":"false",referrer:null==h||null===(_=h.query)||void 0===_?void 0:_.referrer,sessionId:p});202===(null==s?void 0:s.status)?A||(this.setState({loading:!0,uuid:t.uuid}),this.fetchStatus(r)):(f.Z.remove(w),this.setState({loading:!1}),(0,a.S9)(m?(0,v.t)("Updated alert rule"):(0,v.t)("Created alert rule")),c&&c(t,r))}catch(e){f.Z.remove(w),this.setState({loading:!1});const t=null!=e&&e.responseJSON?Array.isArray(null==e?void 0:e.responseJSON)?null==e?void 0:e.responseJSON:Object.values(null==e?void 0:e.responseJSON):[],s=t.length>0?`: ${t.join(", ")}`:"";this.handleRuleSaveFailure((0,v.t)("Unable to save alert%s",s))}})),(0,n.Z)(this,"handleChangeTriggers",((e,t)=>{this.setState((s=>{let n=s.triggerErrors;const r=this.validateTriggers(e,s.thresholdType,s.resolveThreshold,t);return n=r,0===Array.from(r).length&&(0,a.B8)(),{triggers:e,triggerErrors:n}}))})),(0,n.Z)(this,"handleThresholdTypeChange",(e=>{const{triggers:t}=this.state,s=this.validateTriggers(t,e);this.setState((t=>({thresholdType:e,triggerErrors:new Map([...s,...t.triggerErrors])})))})),(0,n.Z)(this,"handleThresholdPeriodChange",(e=>{this.setState({thresholdPeriod:e})})),(0,n.Z)(this,"handleResolveThresholdChange",(e=>{this.setState((t=>{const s=this.validateTriggers(t.triggers,t.thresholdType,e);return 0===Array.from(s).length&&(0,a.B8)(),{resolveThreshold:e,triggerErrors:s}}))})),(0,n.Z)(this,"handleComparisonTypeChange",(e=>{var t;const s=e===q.t6.COUNT?void 0:null!==(t=this.state.comparisonDelta)&&void 0!==t?t:P.kV,n=this.state.comparisonDelta?P.b1:P.wT;this.setState({comparisonType:e,comparisonDelta:s,timeWindow:n})})),(0,n.Z)(this,"handleDeleteRule",(async()=>{const{params:e}=this.props,{orgId:t,projectId:s,ruleId:n}=e;try{await this.api.requestPromise(`/projects/${t}/${s}/alert-rules/${n}/`,{method:"DELETE"}),this.goBack()}catch(e){(0,a.Iw)((0,v.t)("Error deleting rule"))}})),(0,n.Z)(this,"handleRuleSaveFailure",(e=>{(0,a.Iw)(e),T.oF.endTransaction({name:"saveAlertRule"})})),(0,n.Z)(this,"handleCancel",(()=>{this.goBack()}))}get isDuplicateRule(){return Boolean(this.props.isDuplicateRule)}get hasAlertWizardV3(){return this.props.organization.features.includes("alert-wizard-v3")}componentDidMount(){const{organization:e}=this.props,{project:t}=this.state;(0,i.q3)(this.api,e.slug,[t.id])}componentWillUnmount(){window.clearTimeout(this.pollingTimeout)}getDefaultState(){var e,t,s,n,r;const{rule:a,location:i}=this.props,o=[...a.triggers],{aggregate:l,eventTypes:d,dataset:u,name:c}=null!==(e=null==i?void 0:i.query)&&void 0!==e?e:{},h="string"==typeof d?[d]:d;return 2!==o.length&&o.push((0,P.W7)(q.F4.WARNING)),{...super.getDefaultState(),name:null!==(t=null!=c?c:a.name)&&void 0!==t?t:"",aggregate:null!=l?l:a.aggregate,dataset:null!=u?u:a.dataset,eventTypes:null!=h?h:a.eventTypes,query:null!==(s=a.query)&&void 0!==s?s:"",timeWindow:a.timeWindow,environment:a.environment||null,triggerErrors:new Map,availableActions:null,triggers:o,resolveThreshold:a.resolveThreshold,thresholdType:a.thresholdType,thresholdPeriod:null!==(n=a.thresholdPeriod)&&void 0!==n?n:1,comparisonDelta:null!==(r=a.comparisonDelta)&&void 0!==r?r:void 0,comparisonType:a.comparisonDelta?q.t6.CHANGE:q.t6.COUNT,project:this.props.project,owner:a.owner}}getEndpoints(){const{orgId:e}=this.props.params;return[["availableActions",`/organizations/${e}/alert-rules/available-actions/`]]}goBack(){const{router:e}=this.props,{orgId:t}=this.props.params;e.push(`/organizations/${t}/alerts/rules/`)}fetchStatus(e){const t=f.Z.addMessage((0,v.t)("Looking for your slack channel (this can take a while)"),"loading"),s=Date.now()+18e4;window.clearTimeout(this.pollingTimeout),this.pollingTimeout=window.setTimeout((()=>{this.pollHandler(e,s,t)}),1e3)}validateFieldInTrigger(e){let{errors:t,triggerIndex:s,field:n,message:r,isValid:a}=e;if(a()){const{[n]:e,...r}=t.get(s)||{};return Object.keys(r).length>0?t.set(s,r):t.delete(s),t}t.has(s)||t.set(s,{});const i=t.get(s);return t.set(s,{...i,[n]:r}),t}validateTriggers(){var e,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.triggers,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.thresholdType,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.resolveThreshold,a=arguments.length>3?arguments[3]:void 0;const i=new Map,o=["label","alertThreshold"];s.forEach(((e,t)=>{o.forEach((s=>{this.validateFieldInTrigger({errors:i,triggerIndex:t,isValid:()=>e.label===q.F4.CRITICAL?!Os(e[s]):0===e.actions.length||!Os(e[s]),field:s,message:(0,v.t)("Field is required")})})),this.isValidTrigger(null!=a?a:t,e,i,r)}));const l=s.findIndex((e=>{let{label:t}=e;return t===q.F4.CRITICAL})),d=1^l,u=s[l],c=s[d],h=Os(c.alertThreshold),p=null!==(e=c.alertThreshold)&&void 0!==e?e:0,m=null!==(t=u.alertThreshold)&&void 0!==t?t:0;return(n===q.lT.ABOVE?p>m:p<m)&&!h&&[l,d].forEach((e=>{var t;const s=null!==(t=i.get(e))&&void 0!==t?t:{};i.set(e,{...s,alertThreshold:n===q.lT.BELOW?(0,v.t)("Warning threshold must be greater than critical alert"):(0,v.t)("Warning threshold must be less than critical alert")})})),i}renderLoading(){return this.renderBody()}renderBody(){const{organization:e,ruleId:t,rule:s,onSubmitSuccess:n,router:r,disableProjectSelector:a}=this.props,{name:i,query:l,project:u,timeWindow:c,triggers:g,aggregate:f,environment:y,thresholdType:b,thresholdPeriod:T,comparisonDelta:Z,comparisonType:S,resolveThreshold:C,loading:A,eventTypes:E,dataset:R}=this.state,w=(0,Ut.m)(this.state.dataset,E),j=`${l} ${w}`.trim(),N={organization:e,projects:[u],triggers:g,query:(0,M.I)(R)?l:j,aggregate:f,timeWindow:c,environment:y,resolveThreshold:C,thresholdType:b,comparisonDelta:Z,comparisonType:S},D=(0,vt.k)({aggregate:f,dataset:R}),O=(0,_.tZ)(Pt,{...N,header:(0,_.BX)(Ms,{children:[(0,_.tZ)(qs,{children:gt.gb[D]}),!(0,M.I)(R)&&(0,_.BX)(Us,{children:[(0,_.tZ)(Ls,{size:8}),(0,_.tZ)(Vs,{children:f}),"event.type:",null==E?void 0:E.join(",")]})]})}),F=t=>(0,_.tZ)(Ke,{disabled:t,projects:[u],errors:this.state.triggerErrors,triggers:g,aggregate:f,resolveThreshold:C,thresholdPeriod:T,thresholdType:b,comparisonType:S,currentProject:u.slug,organization:e,availableActions:this.state.availableActions,hasAlertWizardV3:this.hasAlertWizardV3,onChange:this.handleChangeTriggers,onThresholdTypeChange:this.handleThresholdTypeChange,onThresholdPeriodChange:this.handleThresholdPeriodChange,onResolveThresholdChange:this.handleResolveThresholdChange}),z=e=>(0,_.tZ)(I,{disabled:e,project:u,hasAlertWizardV3:this.hasAlertWizardV3}),P=t=>(0,_.tZ)(W,{comparisonType:S,dataset:R,disabled:t,onComparisonDeltaChange:e=>this.handleFieldChange("comparisonDelta",e),onComparisonTypeChange:this.handleComparisonTypeChange,organization:e,hasAlertWizardV3:this.hasAlertWizardV3,comparisonDelta:Z});return(0,_.tZ)(o.Z,{access:["alerts:write"],children:o=>{let{hasAccess:g}=o;const y=A||!((0,x.M)()||g);return(0,_.tZ)(p.Z,{apiMethod:t?"PUT":"POST",apiEndpoint:`/organizations/${e.slug}/alert-rules/${t?`${t}/`:""}`,submitDisabled:y,initialData:{name:i,dataset:R,eventTypes:E,aggregate:f,query:l,timeWindow:s.timeWindow,environment:s.environment||null,owner:s.owner,projectId:u.id},saveOnBlur:!1,onSubmit:this.handleSubmit,onSubmitSuccess:n,onCancel:this.handleCancel,onFieldChange:this.handleFieldChange,extraButton:s.id?(0,_.tZ)(h.Z,{disabled:y,message:(0,v.t)("Are you sure you want to delete this alert rule?"),header:(0,v.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,v.t)("Delete Rule"),onConfirm:this.handleDeleteRule,children:(0,_.tZ)(d.ZP,{type:"button",priority:"danger",children:(0,v.t)("Delete Rule")})}):null,submitLabel:(0,v.t)("Save Rule"),children:(0,_.BX)(m.Z,{symbol:"colored-numeric",children:[(0,_.tZ)(Ds,{api:this.api,project:u,organization:e,router:r,disabled:y,thresholdChart:O,onFilterSearch:this.handleFilterUpdate,allowChangeEventTypes:"custom"===D||R===q.qz.ERRORS,alertType:D,hasAlertWizardV3:this.hasAlertWizardV3,dataset:R,timeWindow:c,comparisonType:S,comparisonDelta:Z,onComparisonDeltaChange:e=>this.handleFieldChange("comparisonDelta",e),onTimeWindowChange:e=>this.handleFieldChange("timeWindow",e),disableProjectSelector:a}),!this.hasAlertWizardV3&&P(y),(0,_.tZ)(Ps,{children:this.hasAlertWizardV3?(0,v.t)("Set thresholds"):(0,v.t)("Set thresholds to trigger alert")}),this.hasAlertWizardV3&&P(y),F(y),z(y)]})})}})}}const zs=(0,r.Z)(g.Z,{target:"e3evdii6"})("margin:",(0,y.Z)(2)," 0 ",(0,y.Z)(1)," 0;font-size:",(e=>e.theme.fontSizeExtraLarge),";"),Ps=(0,r.Z)(zs,{target:"e3evdii5"})({name:"1i9vogi",styles:"margin-top:0"}),Ms=(0,r.Z)("div",{target:"e3evdii4"})("padding:",(0,y.Z)(2)," ",(0,y.Z)(3)," 0 ",(0,y.Z)(3),";margin-bottom:-",(0,y.Z)(1.5),";"),qs=(0,r.Z)(u.ws,{target:"e3evdii3"})({name:"bjn8wh",styles:"position:relative"}),Us=(0,r.Z)("div",{target:"e3evdii2"})("font-size:",(e=>e.theme.fontSizeSmall),";font-family:",(e=>e.theme.text.family),";font-weight:normal;color:",(e=>e.theme.textColor),";"),Ls=(0,r.Z)(c.Z,{target:"e3evdii1"})("background:",(e=>e.theme.formText),";height:",(0,y.Z)(1),";margin-right:",(0,y.Z)(.5),";"),Vs=(0,r.Z)("span",{target:"e3evdii0"})("margin-right:",(0,y.Z)(1),";"),ks=(0,S.Z)(Fs)},"./app/views/alerts/rules/metric/types.tsx":(e,t,s)=>{"use strict";s.d(t,{F4:()=>a,GM:()=>l,LO:()=>m,Lm:()=>g,Tb:()=>h,Us:()=>p,XH:()=>c,Yh:()=>d,hd:()=>v,lK:()=>u,lT:()=>r,qz:()=>o,t6:()=>i});var n=s("./app/locale.tsx");let r,a,i,o,l,d,u,c,h,p;!function(e){e[e.ABOVE=0]="ABOVE",e[e.BELOW=1]="BELOW"}(r||(r={})),function(e){e.CRITICAL="critical",e.WARNING="warning",e.RESOLVE="resolve"}(a||(a={})),function(e){e.COUNT="count",e.CHANGE="change"}(i||(i={})),function(e){e.ERRORS="events",e.TRANSACTIONS="transactions",e.SESSIONS="sessions",e.METRICS="metrics"}(o||(o={})),function(e){e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction",e.USER="user",e.SESSION="session"}(l||(l={})),function(e){e.ERROR_DEFAULT="error_default",e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction"}(d||(d={})),function(e){e.CRASH_FREE_SESSIONS="percentage(sessions_crashed, sessions) AS _crash_rate_alert_aggregate",e.CRASH_FREE_USERS="percentage(users_crashed, users) AS _crash_rate_alert_aggregate"}(u||(u={})),function(e){e.SIX_HOURS="6h",e.ONE_DAY="1d",e.THREE_DAYS="3d",e.SEVEN_DAYS="10000m",e.FOURTEEN_DAYS="14d",e.THIRTY_DAYS="30d"}(c||(c={})),function(e){e[e.ONE_MINUTE=1]="ONE_MINUTE",e[e.FIVE_MINUTES=5]="FIVE_MINUTES",e[e.TEN_MINUTES=10]="TEN_MINUTES",e[e.FIFTEEN_MINUTES=15]="FIFTEEN_MINUTES",e[e.THIRTY_MINUTES=30]="THIRTY_MINUTES",e[e.ONE_HOUR=60]="ONE_HOUR",e[e.TWO_HOURS=120]="TWO_HOURS",e[e.FOUR_HOURS=240]="FOUR_HOURS",e[e.ONE_DAY=1440]="ONE_DAY"}(h||(h={})),function(e){e.EMAIL="email",e.SLACK="slack",e.PAGERDUTY="pagerduty",e.MSTEAMS="msteams",e.SENTRY_APP="sentry_app"}(p||(p={}));const m={[p.EMAIL]:(0,n.t)("Emai​l"),[p.SLACK]:(0,n.t)("Slack"),[p.PAGERDUTY]:(0,n.t)("Pagerduty"),[p.MSTEAMS]:(0,n.t)("MS Teams"),[p.SENTRY_APP]:(0,n.t)("Notification")};let g;!function(e){e.SPECIFIC="specific",e.USER="user",e.TEAM="team",e.SENTRY_APP="sentry_app"}(g||(g={}));const v={[g.USER]:(0,n.t)("Member"),[g.TEAM]:(0,n.t)("Team")}},"./app/views/alerts/rules/metric/utils/getEventTypeFilter.tsx":(e,t,s)=>{"use strict";s.d(t,{m:()=>o,r:()=>i});var n=s("./app/views/alerts/utils/index.tsx"),r=s("./app/views/alerts/rules/metric/constants.tsx"),a=s("./app/views/alerts/rules/metric/types.tsx");function i(e){const{dataset:t,eventTypes:s}=e;return o(t,s)}function o(e,t){var s;return t?r.P1[null!==(s=(0,n.KC)(e,t))&&void 0!==s?s:a.Yh.ERROR]:r.hh[null!=e?e:a.qz.ERRORS]}},"./app/views/alerts/rules/metric/utils/isCrashFreeAlert.tsx":(e,t,s)=>{"use strict";s.d(t,{I:()=>r}),s("../node_modules/core-js/modules/es.array.includes.js");var n=s("./app/views/alerts/rules/metric/types.tsx");function r(e){return void 0!==e&&[n.qz.SESSIONS,n.qz.METRICS].includes(e)}},"./app/views/alerts/types.tsx":(e,t,s)=>{"use strict";let n,r,a,i,o,l;s.d(t,{Gb:()=>o,XO:()=>l,lm:()=>r,ok:()=>n,vt:()=>a}),function(e){e.METRIC="metric",e.ISSUE="issue"}(n||(n={})),function(e){e[e.CREATED=0]="CREATED",e[e.DETECTED=1]="DETECTED",e[e.STATUS_CHANGE=2]="STATUS_CHANGE",e[e.COMMENT=3]="COMMENT",e[e.STARTED=4]="STARTED"}(r||(r={})),function(e){e[e.OPENED=1]="OPENED",e[e.CLOSED=2]="CLOSED",e[e.WARNING=10]="WARNING",e[e.CRITICAL=20]="CRITICAL"}(a||(a={})),function(e){e[e.MANUAL=1]="MANUAL",e[e.RULE_UPDATED=2]="RULE_UPDATED",e[e.RULE_TRIGGERED=3]="RULE_TRIGGERED"}(i||(i={})),function(e){e[e.PENDING=0]="PENDING",e[e.SNAPSHOT=4]="SNAPSHOT",e[e.DISABLED=5]="DISABLED"}(o||(o={})),function(e){e.METRIC="alert_rule",e.ISSUE="rule"}(l||(l={}))},"./app/views/alerts/utils/getChangeStatus.tsx":(e,t,s)=>{"use strict";s.d(t,{R:()=>r});var n=s("./app/views/alerts/rules/metric/types.tsx");const r=(e,t,s)=>{const r=null==s?void 0:s.find((e=>e.label===n.F4.CRITICAL)),a=null==s?void 0:s.find((e=>e.label===n.F4.WARNING)),i="number"==typeof(null==r?void 0:r.alertThreshold)?r.alertThreshold:void 0,o="number"==typeof(null==a?void 0:a.alertThreshold)?a.alertThreshold:void 0;return t===n.lT.ABOVE&&i&&e>=i?n.F4.CRITICAL:t===n.lT.ABOVE&&o&&e>=o?n.F4.WARNING:t===n.lT.BELOW&&i&&-1*e>=i?n.F4.CRITICAL:t===n.lT.BELOW&&o&&-1*e>=o?n.F4.WARNING:""}},"./app/views/alerts/utils/index.tsx":(e,t,s)=>{"use strict";s.d(t,{A4:()=>f,CM:()=>m,Eb:()=>y,Eq:()=>h,Ey:()=>g,Gm:()=>p,Gu:()=>C,KC:()=>v,LI:()=>R,QR:()=>S,Vc:()=>b,g2:()=>A,lR:()=>T,qn:()=>Z,t3:()=>x}),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/core-js/modules/es.string.replace.js");var n=s("../node_modules/lodash/round.js"),r=s.n(n),a=s("./app/locale.tsx"),i=s("./app/types/index.tsx"),o=s("./app/utils.tsx"),l=s("./app/utils/dates.tsx"),d=s("./app/utils/discover/charts.tsx"),u=s("./app/views/alerts/rules/metric/types.tsx"),c=s("./app/views/alerts/types.tsx");function h(e){return{start:(0,l.v5)(1e3*e.eventStats.data[0][0]),end:(0,l.v5)(1e3*e.eventStats.data[e.eventStats.data.length-1][0])}}function p(e){return!e.hasOwnProperty("triggers")}const m={[u.qz.ERRORS]:(0,a.t)("Errors"),[u.qz.TRANSACTIONS]:(0,a.t)("Transactions"),[u.Yh.ERROR_DEFAULT]:"event.type:error OR event.type:default",[u.Yh.ERROR]:"event.type:error",[u.Yh.DEFAULT]:"event.type:default",[u.Yh.TRANSACTION]:"event.type:transaction"},g={[u.Yh.ERROR_DEFAULT]:{dataset:u.qz.ERRORS,eventTypes:[u.GM.ERROR,u.GM.DEFAULT]},[u.Yh.ERROR]:{dataset:u.qz.ERRORS,eventTypes:[u.GM.ERROR]},[u.Yh.DEFAULT]:{dataset:u.qz.ERRORS,eventTypes:[u.GM.DEFAULT]},[u.Yh.TRANSACTION]:{dataset:u.qz.TRANSACTIONS,eventTypes:[u.GM.TRANSACTION]}};function v(e,t){return e===u.qz.TRANSACTIONS?u.Yh.TRANSACTION:t?t.includes(u.GM.DEFAULT)&&t.includes(u.GM.ERROR)?u.Yh.ERROR_DEFAULT:t.includes(u.GM.DEFAULT)?u.Yh.DEFAULT:u.Yh.ERROR:u.Yh.ERROR}function f(e){let t=e.match(/\(?\bevent\.type:(error|default|transaction)\)?\WOR\W\(?event\.type:(error|default|transaction)\)?/i);return t?"default,error"!==t.slice(1,3).sort().join(",")?null:{source:u.Yh.ERROR_DEFAULT,query:e.replace(t[0],"").trim()}:(t=e.match(/(^|\s)event\.type:(error|default|transaction)/i),t&&u.Yh[t[2].toUpperCase()]?{source:u.Yh[t[2].toUpperCase()],query:e.replace(t[0],"").trim()}:null)}function y(e){return Object.values(u.lK).includes(e)}const b={[u.lK.CRASH_FREE_SESSIONS]:i.kI.SESSIONS,[u.lK.CRASH_FREE_USERS]:i.kI.USERS};function T(e,t,s){return y(s)?(0,o.ri)(e)?`${r()(e,2)}%`:"―":(0,d.gu)(e,t)}function Z(e,t,s){return y(s)?(0,o.ri)(e)?`${e}%`:"―":(0,d.CX)(e,t)}const x=1.03;function S(e){return y(e)}function C(e,t){return`/organizations/${e.slug}/alerts/rules/details/${t.alertRule.status===c.Gb.SNAPSHOT&&t.alertRule.originalAlertRuleId?t.alertRule.originalAlertRuleId:t.alertRule.id}/`}function A(e){return Array.isArray(e)||""===e?"all":["open","closed"].includes(e)?e:"all"}const E=["myteams","unassigned"];function R(e){return void 0===e?E:""===e?[]:Array.isArray(e)?e:[e]}},"./app/views/alerts/wizard/options.tsx":(e,t,s)=>{"use strict";s.d(t,{A_:()=>i,F4:()=>l,F7:()=>d,FZ:()=>o,LH:()=>u,gb:()=>a,mp:()=>c}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js");var n=s("./app/locale.tsx"),r=s("./app/views/alerts/rules/metric/types.tsx");const a={issues:(0,n.t)("Issues"),num_errors:(0,n.t)("Number of Errors"),users_experiencing_errors:(0,n.t)("Users Experiencing Errors"),throughput:(0,n.t)("Throughput"),trans_duration:(0,n.t)("Transaction Duration"),apdex:(0,n.t)("Apdex"),failure_rate:(0,n.t)("Failure Rate"),lcp:(0,n.t)("Largest Contentful Paint"),fid:(0,n.t)("First Input Delay"),cls:(0,n.t)("Cumulative Layout Shift"),custom:(0,n.t)("Custom Metric"),crash_free_sessions:(0,n.t)("Crash Free Session Rate"),crash_free_users:(0,n.t)("Crash Free User Rate")},i=e=>[{categoryHeading:(0,n.t)("Errors"),options:["issues","num_errors","users_experiencing_errors"]},...e.features.includes("crash-rate-alerts")?[{categoryHeading:(0,n.t)("Sessions"),options:["crash_free_sessions","crash_free_users"]}]:[],{categoryHeading:(0,n.t)("Performance"),options:["throughput","trans_duration","apdex","failure_rate","lcp","fid","cls"]},{categoryHeading:(0,n.t)("Other"),options:["custom"]}],o={num_errors:{aggregate:"count()",dataset:r.qz.ERRORS,eventTypes:r.GM.ERROR},users_experiencing_errors:{aggregate:"count_unique(user)",dataset:r.qz.ERRORS,eventTypes:r.GM.ERROR},throughput:{aggregate:"count()",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},trans_duration:{aggregate:"p95(transaction.duration)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},apdex:{aggregate:"apdex(300)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},failure_rate:{aggregate:"failure_rate()",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},lcp:{aggregate:"p95(measurements.lcp)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},fid:{aggregate:"p95(measurements.fid)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},cls:{aggregate:"p95(measurements.cls)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},custom:{aggregate:"p95(measurements.fp)",dataset:r.qz.TRANSACTIONS,eventTypes:r.GM.TRANSACTION},crash_free_sessions:{aggregate:r.lK.CRASH_FREE_SESSIONS,dataset:r.qz.SESSIONS,eventTypes:r.GM.SESSION},crash_free_users:{aggregate:r.lK.CRASH_FREE_USERS,dataset:r.qz.SESSIONS,eventTypes:r.GM.USER}},l=o.num_errors,d=new Set(["num_errors","users_experiencing_errors","throughput","apdex","failure_rate","crash_free_sessions","crash_free_users"]),u=new Set(["trans_duration","lcp","fid","cls"]);function c(e){const t=(0,n.t)("over");return"apdex"===e?{labelText:(0,n.t)("Select apdex threshold and time interval"),timeWindowText:t}:d.has(e)?{labelText:(0,n.t)("Select time interval")}:{labelText:(0,n.t)("Select function and time interval"),timeWindowText:t}}},"./app/views/alerts/wizard/utils.tsx":(e,t,s)=>{"use strict";s.d(t,{k:()=>a}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js");var n=s("./app/views/alerts/rules/metric/types.tsx");const r={[n.qz.ERRORS]:{num_errors:"count()",users_experiencing_errors:"count_unique(user)"},[n.qz.TRANSACTIONS]:{throughput:"count()",trans_duration:"transaction.duration",apdex:"apdex",failure_rate:"failure_rate()",lcp:"measurements.lcp",fid:"measurements.fid",cls:"measurements.cls"},[n.qz.SESSIONS]:{crash_free_sessions:n.lK.CRASH_FREE_SESSIONS,crash_free_users:n.lK.CRASH_FREE_USERS},[n.qz.METRICS]:{crash_free_sessions:n.lK.CRASH_FREE_SESSIONS,crash_free_users:n.lK.CRASH_FREE_USERS}};function a(e){let{aggregate:t,dataset:s}=e;const n=r[s],a=Object.entries(n).find((e=>{let[s,n]=e;return n&&t.includes(n)}));return a&&a[0]||"custom"}},"./app/views/asyncView.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s("./app/components/asyncComponent.tsx"),r=s("./app/components/sentryDocumentTitle.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends n.Z{getTitle(){return""}render(){return(0,a.tZ)(r.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/organizationIntegrations/sentryAppExternalForm.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>f});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),a=s("../node_modules/react-select/dist/Select-9fdb8cd0.browser.esm.js"),i=s("../node_modules/lodash/debounce.js"),o=s.n(i),l=s("./app/actionCreators/indicator.tsx"),d=s("./app/components/forms/fieldFromConfig.tsx"),u=s("./app/components/forms/form.tsx"),c=s("./app/components/forms/model.tsx"),h=s("./app/locale.tsx"),p=s("./app/utils/replaceAtArrayIndex.tsx"),m=s("./app/utils/withApi.tsx"),g=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class v extends r.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{optionsByField:new Map}),(0,n.Z)(this,"model",new c.Z),(0,n.Z)(this,"onSubmitError",(()=>{const{action:e,appName:t}=this.props;(0,l.Iw)((0,h.t)("Unable to %s %s %s.",e,t,this.getElementText()))})),(0,n.Z)(this,"getOptions",((e,t)=>new Promise((s=>{this.debouncedOptionLoad(e,t,s)})))),(0,n.Z)(this,"getElementText",(()=>{const{element:e}=this.props;switch(e){case"issue-link":return"issue";case"alert-rule-action":return"alert";default:return"connection"}})),(0,n.Z)(this,"getDefaultFieldValue",(e=>{const{resetValues:t,getFieldDefault:s}=this.props;let n;e.default&&s&&(n=s(e));const r=((t||{}).settings||[]).find((t=>t.name===e.name));return r&&(n=r.value),n})),(0,n.Z)(this,"debouncedOptionLoad",o()((async(e,t,s)=>{const n=(await this.makeExternalRequest(e,t)).map((e=>{let[t,s]=e;return{value:t,label:s}})),r=new Map(this.state.optionsByField);return r.set(e.name,n),this.setState({optionsByField:r}),s(n)}),200,{trailing:!0})),(0,n.Z)(this,"makeExternalRequest",(async(e,t)=>{const{extraRequestBody:s={},sentryAppInstallationUuid:n}=this.props,r={...s,uri:e.uri,query:t};if(e.depends_on){const t=e.depends_on.reduce(((e,t)=>(e[t]=this.model.getValue(t),e)),{});r.dependentData=JSON.stringify(t)}const{choices:a}=await this.props.api.requestPromise(`/sentry-app-installations/${n}/external-requests/`,{query:r});return a||[]})),(0,n.Z)(this,"handleFieldChange",(async e=>{const t=this.state;let s=t.required_fields||[],n=t.optional_fields||[];const r=s.concat(n).filter((t=>{let{depends_on:s}=t;return!!s&&s.includes(e)})),a=await Promise.all(r.map((e=>(this.model.setValue(e.name||"","",{quiet:!0}),this.makeExternalRequest(e,"")))));this.setState((e=>(s=e.required_fields||[],n=e.optional_fields||[],r.forEach(((e,t)=>{const r=a[t],i=s.indexOf(e),o=n.indexOf(e),l={...e,choices:r};i>-1?s=(0,p.m)(s,i,l):o>-1&&(n=(0,p.m)(n,o,l))})),{required_fields:s,optional_fields:n})))})),(0,n.Z)(this,"renderField",((e,t)=>{let s={...e,inline:!1,stacked:!0,flexibleControlStateSize:!0,required:t};const n=void 0===e.async||!!e.async;if("select"===s.type){const r=(e.choices||[]).map((e=>{let[t,s]=e;return{value:t,label:s}})),i=this.state.optionsByField.get(e.name)||r,o=!t,l=this.getDefaultFieldValue(e),d=(0,a.c)({});s={...s,options:i,defaultValue:l,defaultOptions:r,filterOption:d,allowClear:o},n&&(s.noOptionsMessage=()=>"Type to search"),e.depends_on&&e.depends_on.some((e=>{return!((t=this.model.getValue(e))||0===t);var t}))&&(s={...s,disabled:!0})}["text","textarea"].includes(s.type||"")&&(s={...s,defaultValue:this.getDefaultFieldValue(e)});const r=e.uri?{loadOptions:t=>this.getOptions(e,t),async:n,cache:!1,onSelectResetsInput:!1,onCloseResetsInput:!1,onBlurResetsInput:!1,autoload:!1}:{};return(0,g.tZ)(d.Z,{field:s,"data-test-id":e.name,...r},e.name)})),(0,n.Z)(this,"handleAlertRuleSubmit",((e,t)=>{const{sentryAppInstallationUuid:s}=this.props;this.model.validateForm()&&t({settings:Object.entries(e).map((e=>{let[t,s]=e;return{name:t,value:s}})),sentryAppInstallationUuid:s,hasSchemaFormConfig:!0})}))}componentDidMount(){this.resetStateFromProps()}componentDidUpdate(e){e.action!==this.props.action&&(this.model.reset(),this.resetStateFromProps())}resetStateFromProps(){const{config:e,action:t,extraFields:s,element:n}=this.props;if(this.setState({required_fields:e.required_fields,optional_fields:e.optional_fields}),"alert-rule-action"===n){const e=((this.props.resetValues||{}).settings||[]).reduce(((e,t)=>(e[t.name]=t.value,e)),{});this.model.setInitialData({...e})}else this.model.setInitialData({...s,action:t,uri:e.uri})}render(){const{sentryAppInstallationUuid:e,action:t,element:s,onSubmitSuccess:n}=this.props,r=this.state.required_fields||[],a=this.state.optional_fields||[];return e?(0,g.BX)(u.Z,{apiEndpoint:`/sentry-app-installations/${e}/external-issue-actions/`,apiMethod:"POST",onSubmit:"alert-rule-action"===s?this.handleAlertRuleSubmit:void 0,onSubmitSuccess:function(){n(...arguments)},onSubmitError:this.onSubmitError,onFieldChange:this.handleFieldChange,model:this.model,children:[r.map((e=>this.renderField(e,!0))),a.map((e=>this.renderField(e,!1)))]},t):""}}v.displayName="SentryAppExternalForm";const f=(0,m.Z)(v)},"./app/views/performance/transactionSummary/utils.tsx":(e,t,s)=>{"use strict";s.d(t,{K0:()=>d,PU:()=>c,Z6:()=>p,e1:()=>h,uI:()=>g,vd:()=>m,xf:()=>u});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/styles/space.tsx"),a=s("./app/utils/discover/urls.tsx"),i=s("./app/utils/performance/urls.ts"),o=s("./app/utils/tokenizeSearch.tsx"),l=s("./app/views/performance/traceDetails/utils.tsx");let d;function u(e){const t=c(e);return t.removeFilter("transaction"),t}function c(e){const t=new o.MY(e);return t.removeFilter("event.type"),t}function h(e){let{orgSlug:t,transaction:s,projectID:n,query:r,unselectedSeries:a="p100()",display:i,trendFunction:o,trendColumn:l,showTransactions:d,additionalQuery:c}=e;const h=function(e){let{orgSlug:t}=e;return`/organizations/${t}/performance/summary/`}({orgSlug:t});let p;return p="string"==typeof r.query?u(r.query).formatString():r.query,{pathname:h,query:{transaction:s,project:n,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:p,unselectedSeries:a,showTransactions:d,display:i,trendFunction:o,trendColumn:l,...c}}}function p(e){return(t,s,n)=>{const r=`${s.trace}`;return r?(0,l.YA)(t,r,e,{}):{}}}function m(e){return(t,s,n,r)=>{const o=(0,a.JE)(s);return(0,i.D)(t.slug,o,e,n,r)}}!function(e){e.FASTEST="fastest",e.SLOW="slow",e.OUTLIER="outlier",e.RECENT="recent"}(d||(d={}));const g=(0,n.Z)("div",{target:"e1radvp0"})("margin-top:",(0,r.Z)(3),";")},"./app/views/settings/components/settingsBreadcrumb/menuItem.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=(0,s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"e17hbpgs0"})("font-size:14px;",(e=>e.theme.overflowEllipsis),";")},"../node_modules/core-js/internals/a-constructor.js":(e,t,s)=>{var n=s("../node_modules/core-js/internals/is-constructor.js"),r=s("../node_modules/core-js/internals/try-to-string.js"),a=TypeError;e.exports=function(e){if(n(e))return e;throw a(r(e)+" is not a constructor")}},"../node_modules/core-js/internals/is-regexp.js":(e,t,s)=>{var n=s("../node_modules/core-js/internals/is-object.js"),r=s("../node_modules/core-js/internals/classof-raw.js"),a=s("../node_modules/core-js/internals/well-known-symbol.js")("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==r(e))}},"../node_modules/core-js/internals/regexp-get-flags.js":(e,t,s)=>{var n=s("../node_modules/core-js/internals/function-call.js"),r=s("../node_modules/core-js/internals/has-own-property.js"),a=s("../node_modules/core-js/internals/object-is-prototype-of.js"),i=s("../node_modules/core-js/internals/regexp-flags.js"),o=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in o||r(e,"flags")||!a(o,e)?t:n(i,e)}},"../node_modules/core-js/internals/species-constructor.js":(e,t,s)=>{var n=s("../node_modules/core-js/internals/an-object.js"),r=s("../node_modules/core-js/internals/a-constructor.js"),a=s("../node_modules/core-js/internals/well-known-symbol.js")("species");e.exports=function(e,t){var s,i=n(e).constructor;return void 0===i||null==(s=n(i)[a])?t:r(s)}},"../node_modules/core-js/modules/es.string.match-all.js":(e,t,s)=>{"use strict";var n=s("../node_modules/core-js/internals/export.js"),r=s("../node_modules/core-js/internals/function-call.js"),a=s("../node_modules/core-js/internals/function-uncurry-this.js"),i=s("../node_modules/core-js/internals/create-iterator-constructor.js"),o=s("../node_modules/core-js/internals/require-object-coercible.js"),l=s("../node_modules/core-js/internals/to-length.js"),d=s("../node_modules/core-js/internals/to-string.js"),u=s("../node_modules/core-js/internals/an-object.js"),c=s("../node_modules/core-js/internals/classof-raw.js"),h=s("../node_modules/core-js/internals/is-regexp.js"),p=s("../node_modules/core-js/internals/regexp-get-flags.js"),m=s("../node_modules/core-js/internals/get-method.js"),g=s("../node_modules/core-js/internals/define-built-in.js"),v=s("../node_modules/core-js/internals/fails.js"),f=s("../node_modules/core-js/internals/well-known-symbol.js"),y=s("../node_modules/core-js/internals/species-constructor.js"),b=s("../node_modules/core-js/internals/advance-string-index.js"),T=s("../node_modules/core-js/internals/regexp-exec-abstract.js"),Z=s("../node_modules/core-js/internals/internal-state.js"),x=s("../node_modules/core-js/internals/is-pure.js"),S=f("matchAll"),C="RegExp String Iterator",A=Z.set,E=Z.getterFor(C),R=RegExp.prototype,w=TypeError,_=a("".indexOf),I=a("".matchAll),j=!!I&&!v((function(){I("a",/./)})),N=i((function(e,t,s,n){A(this,{type:C,regexp:e,string:t,global:s,unicode:n,done:!1})}),"RegExp String",(function(){var e=E(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,s=e.string,n=T(t,s);return null===n?{value:void 0,done:e.done=!0}:e.global?(""===d(n[0])&&(t.lastIndex=b(s,l(t.lastIndex),e.unicode)),{value:n,done:!1}):(e.done=!0,{value:n,done:!1})})),D=function(e){var t,s,n,r=u(this),a=d(e),i=y(r,RegExp),o=d(p(r));return t=new i(i===RegExp?r.source:r,o),s=!!~_(o,"g"),n=!!~_(o,"u"),t.lastIndex=l(r.lastIndex),new N(t,a,s,n)};n({target:"String",proto:!0,forced:j},{matchAll:function(e){var t,s,n,a,i=o(this);if(null!=e){if(h(e)&&(t=d(o(p(e))),!~_(t,"g")))throw w("`.matchAll` does not allow non-global regexes");if(j)return I(i,e);if(void 0===(n=m(e,S))&&x&&"RegExp"==c(e)&&(n=D),n)return r(n,e,i)}else if(j)return I(i,e);return s=d(i),a=new RegExp(e,"g"),x?r(D,a,s):a[S](s)}}),x||S in R||g(R,S,D)},"../node_modules/lodash/_baseExtremum.js":(e,t,s)=>{var n=s("../node_modules/lodash/isSymbol.js");e.exports=function(e,t,s){for(var r=-1,a=e.length;++r<a;){var i=e[r],o=t(i);if(null!=o&&(void 0===l?o==o&&!n(o):s(o,l)))var l=o,d=i}return d}},"../node_modules/lodash/_baseFindKey.js":e=>{e.exports=function(e,t,s){var n;return s(e,(function(e,s,r){if(t(e,s,r))return n=s,!1})),n}},"../node_modules/lodash/_baseGt.js":e=>{e.exports=function(e,t){return e>t}},"../node_modules/lodash/_baseLt.js":e=>{e.exports=function(e,t){return e<t}},"../node_modules/lodash/_baseMean.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseSum.js");e.exports=function(e,t){var s=null==e?0:e.length;return s?n(e,t)/s:NaN}},"../node_modules/lodash/_baseSum.js":e=>{e.exports=function(e,t){for(var s,n=-1,r=e.length;++n<r;){var a=t(e[n]);void 0!==a&&(s=void 0===s?a:s+a)}return s}},"../node_modules/lodash/findKey.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseFindKey.js"),r=s("../node_modules/lodash/_baseForOwn.js"),a=s("../node_modules/lodash/_baseIteratee.js");e.exports=function(e,t){return n(e,a(t,3),r)}},"../node_modules/lodash/maxBy.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseExtremum.js"),r=s("../node_modules/lodash/_baseGt.js"),a=s("../node_modules/lodash/_baseIteratee.js");e.exports=function(e,t){return e&&e.length?n(e,a(t,2),r):void 0}},"../node_modules/lodash/mean.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseMean.js"),r=s("../node_modules/lodash/identity.js");e.exports=function(e){return n(e,r)}},"../node_modules/lodash/minBy.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseExtremum.js"),r=s("../node_modules/lodash/_baseIteratee.js"),a=s("../node_modules/lodash/_baseLt.js");e.exports=function(e,t){return e&&e.length?n(e,r(t,2),a):void 0}},"../node_modules/lodash/negate.js":e=>{e.exports=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},"../node_modules/lodash/omitBy.js":(e,t,s)=>{var n=s("../node_modules/lodash/_baseIteratee.js"),r=s("../node_modules/lodash/negate.js"),a=s("../node_modules/lodash/pickBy.js");e.exports=function(e,t){return a(e,r(n(t)))}}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_builder_builderBreadCrumbs_tsx-app_views_alerts_rules_issue_index_tsx-app_vi-f9200f.4071d6f73838955f95100ccc2902cba6.js.map