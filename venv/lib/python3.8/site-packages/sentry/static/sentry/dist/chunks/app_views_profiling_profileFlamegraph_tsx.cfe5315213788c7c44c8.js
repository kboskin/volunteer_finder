"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_profiling_profileFlamegraph_tsx"],{"./app/utils/profiling/units/units.ts":(e,t,n)=>{n.d(t,{ab:()=>a,s4:()=>o}),n("../node_modules/core-js/modules/es.error.cause.js");const i={nanoseconds:1e-9,microseconds:1e-6,milliseconds:.001,seconds:1},r=(e,t,n)=>e.toFixed(n)+t;function o(e){const t=i[e];if(void 0===t)throw new Error(`Cannot format from unit ${e}, duration mapping is not defined`);return e=>{const n=e*t;return n>=1?r(n,"s",2):n/.001>=1?r(n/.001,"ms",2):n/1e-6>=1?r(n/1e-6,"μs",2):r(n/1e-9,"ns",2)}}function s(e,t){return Math.floor(e).toString().padStart(t,"0")}function a(e){const t=i[e];if(void 0===t)throw new Error(`Cannot format from unit ${e}, duration mapping is not defined`);return e=>{const n=e*t,i=1e3*n;return`${s(n/60,2)}:${s(n%60,2)}.${s(i%1e3,3)}`}}},"./app/utils/useEffectAfterFirstRender.ts":(e,t,n)=>{n.d(t,{K:()=>o});var i=n("../node_modules/react/index.js");const r=[],o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;const n=(0,i.useRef)(!0);(0,i.useEffect)((()=>{n.current?n.current=!1:e()}),t)}},"./app/utils/usePrevious.tsx":(e,t,n)=>{n.d(t,{Z:()=>r});var i=n("../node_modules/react/index.js");const r=function(e){const t=(0,i.useRef)(e);return(0,i.useEffect)((()=>{t.current=e}),[e]),t.current}},"./app/views/profiling/profileFlamegraph.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>mn});var i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),o=n("./app/components/alert.tsx"),s=n("./app/components/loadingIndicator.tsx"),a=n("../node_modules/gl-matrix/esm/vec2.js"),l=n("./app/components/button.tsx"),c=n("./app/components/forms/compositeSelect.tsx"),h=n("./app/icons/index.tsx"),d=n("./app/locale.tsx"),u=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/react-router/es/index.js")),f=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),p=n("../node_modules/gl-matrix/esm/mat3.js");const g=e=>(t,n,i)=>{const r=n(t,i),o=t.length,s=new Array(4*o*6);for(let n=0;n<o;n++){const i=r.get(t[n].key),o=i?i.concat(1):e;for(let e=0;e<6;e++){const t=6*n*4+4*e;s[t]=o[0],s[t+1]=o[1],s[t+2]=o[2],s[t+3]=o[3]}}return{colorBuffer:s,colorMap:r}},m=e=>"number"==typeof e&&!isNaN(e);function v(e,t,n){if(!m(t)&&!m(n))throw new Error("Clamp requires at least a min or max parameter");if(m(t)&&m(n))return e<t?t:e>n?n:e;if(m(n))return e>n?n:e;if(m(t))return e<t?t:e;throw new Error("Unreachable case detected")}function w(e){return e.frame.name+(e.frame.file||"")}function y(e,t){return w(e)>w(t)?1:-1}const x=e=>t=>{const n=(e=>2*Math.abs((e=>e-Math.floor(e))(e)-.5)-1)(30*t),i=.9*t*360,r=e.C_0+e.C_d*n;return function(e,t,n){const i=n/60,r=t*(1-Math.abs(i%2-1)),[o,s,a]=i<1?[t,r,0]:i<2?[r,t,0]:i<3?[0,t,r]:i<4?[0,r,t]:i<5?[r,0,t]:[t,0,r],l=e-(.3*o+.59*s+.11*a);return[v(o+l,0,1),v(s+l,0,1),v(a+l,0,1)]}(e.L_0-e.L_d*n,r,i)},b=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;const i=new Map,r=[...e].sort(n),o=r.length;for(let n=0;n<o;n++)i.set(r[n].key,t(Math.floor(255*n/e.length)/256,r[n].frame));return i},C=(e,t)=>{const n=new Map,i=[...e].sort(((e,t)=>e.frame.name.localeCompare(t.frame.name))).filter((e=>e.node.isRecursive())),r=new Map;for(let e=0;e<i.length;e++){var o;const s=i[e],a=null!==(o=s.frame.name+s.frame.file)&&void 0!==o?o:"";if(!r.has(a)){const n=t(Math.floor(255*e/i.length)/256,s.frame);r.set(a,n)}n.set(s.key,r.get(a))}return n},E=(e,t)=>{const n=new Map,i={},r=[...((e,t)=>{const n=t;return[...e.reduce(((e,t)=>{const i=null==t?t:n(t);return null==i||e.has(i)||e.set(i,t),e}),new Map).values()]})(e,(e=>e.frame.image))].sort(((e,t)=>{var n,i;return(null!==(n=e.frame.image)&&void 0!==n?n:"")>(null!==(i=t.frame.image)&&void 0!==i?i:"")?1:-1}));for(let t=0;t<e.length;t++){var o;const n=e[t],r=null!==(o=n.frame.image)&&void 0!==o?o:"";i[r]||(i[r]=[]),i[r].push(n)}for(let e=0;e<r.length;e++){var s,a,l;const o=i[null!==(s=null===(a=r[e])||void 0===a||null===(l=a.frame)||void 0===l?void 0:l.image)&&void 0!==s?s:""];for(let i=0;i<o.length;i++)n.set(o[i].key,t(Math.floor(255*e/r.length)/256,o[i].frame))}return n},_=(e,t)=>{const n=new Map;for(let i=0;i<e.length;i++){const r=e[i];r.frame.is_application?n.set(r.key,t(.7,r.frame)):n.set(r.key,t(.09,r.frame))}return n};function S(e,t,n){const i=e.createShader(t);if(!i)throw new Error("Could not create shader");if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))return i;throw e.deleteShader(i),new Error("Failed to compile shader")}const R=new Map,I=(e,t)=>{for(const t of e)R.set(t,[t.width,t.height]);const n=new ResizeObserver((e=>{!function(e){for(const t of e){let e,n,i=window.devicePixelRatio;t.devicePixelContentBoxSize?(e=t.devicePixelContentBoxSize[0].inlineSize,n=t.devicePixelContentBoxSize[0].blockSize,i=1):t.contentBoxSize?t.contentBoxSize[0]?(e=t.contentBoxSize[0].inlineSize,n=t.contentBoxSize[0].blockSize):(e=t.contentBoxSize.inlineSize,n=t.contentBoxSize.blockSize):(e=t.contentRect.width,n=t.contentRect.height);const r=Math.round(e*i),o=Math.round(n*i);R.set(t.target,[r,o]),Z(t.target)}}(e),null==t||t()}));try{e.forEach((e=>{n.observe(e,{box:"device-pixel-content-box"})}))}catch(t){e.forEach((e=>{n.observe(e,{box:"content-box"})}))}return n};function Z(e){const t=R.get(e);if(!t){const t=e.clientWidth*window.devicePixelRatio,n=e.clientHeight*window.devicePixelRatio;return e.width=t,e.height=n,!1}const[n,i]=t,r=e.width!==n||e.height!==i;return r&&(e.width=n,e.height=i),r}const O=(e,t)=>p.al(t.width/e.width,0,0,0,t.height/e.height,0,t.x-e.x*(t.width/e.width),t.y-e.y*(t.height/e.height),1);class A{constructor(e,t,n,i){(0,f.Z)(this,"origin",void 0),(0,f.Z)(this,"size",void 0),this.origin=a.al(e,t),this.size=a.al(n,i)}clone(){return A.From(this)}isValid(){return this.toMatrix().every((e=>!isNaN(e)))}isEmpty(){return 0===this.width&&0===this.height}static Empty(){return new A(0,0,0,0)}static From(e){return new A(e.x,e.y,e.width,e.height)}get x(){return this.origin[0]}get y(){return this.origin[1]}get width(){return this.size[0]}get height(){return this.size[1]}get left(){return this.x}get right(){return this.left+this.width}get top(){return this.y}get bottom(){return this.top+this.height}static decode(e){let t=e;if("string"==typeof e&&(t=e.split(",")),!Array.isArray(t))return null;if(4!==t.length)return null;const n=new A(...t.map((e=>parseFloat(e))));return n.isValid()?n:null}static encode(e){return e.toString()}toString(){return[this.x,this.y,this.width,this.height].map((e=>Math.round(e))).join(",")}toMatrix(){const{width:e,height:t,x:n,y:i}=this;return p.al(e,0,0,0,t,0,n,i,1)}hasIntersectionWith(e){const t=Math.max(this.top,e.top);if(Math.max(t,Math.min(this.bottom,e.bottom))-t==0)return!1;const n=Math.max(this.left,e.left);return Math.max(n,Math.min(this.right,e.right))-n!=0}containsX(e){return e[0]>=this.left&&e[0]<=this.right}containsY(e){return e[1]>=this.top&&e[1]<=this.bottom}contains(e){return this.containsX(e)&&this.containsY(e)}containsRect(e){return this.left<=e.left&&e.right<=this.right}overlapsX(e){return this.left<=e.right&&this.right>=e.left}overlapsY(e){return this.top<=e.bottom&&this.bottom>=e.top}overlaps(e){return this.overlapsX(e)&&this.overlapsY(e)}transformRect(e){const t=this.x*e[0]+this.y*e[3]+e[6],n=this.x*e[1]+this.y*e[4]+e[7],i=this.width*e[0]+this.height*e[3],r=this.width*e[1]+this.height*e[4];return new A(t+(i<0?i:0),n+(r<0?r:0),Math.abs(i),Math.abs(r))}invertYTransform(){return p.al(1,0,0,0,-1,0,this.x,2*this.y+this.height,1)}withHeight(e){return new A(this.x,this.y,this.width,e)}withWidth(e){return new A(this.x,this.y,e,this.height)}withX(e){return new A(e,this.y,this.width,this.height)}withY(e){return new A(this.x,e,this.width,this.height)}toBounds(){return[this.x,this.y,this.x+this.width,this.y+this.height]}toArray(){return[this.x,this.y,this.width,this.height]}between(e){return new A(e.x,e.y,e.width/this.width,e.height/this.height)}translate(e,t){return new A(e,t,this.width,this.height)}translateX(e){return new A(e,this.y,this.width,this.height)}translateY(e){return new A(this.x,e,this.width,this.height)}scaleX(e){return new A(this.x,this.y,this.width*e,this.height)}scaleY(e){return new A(this.x,this.y,this.width,this.height*e)}scale(e,t){return new A(this.x*e,this.y*t,this.width*e,this.height*t)}scaleOriginBy(e,t){return new A(this.x*e,this.y*t,this.width,this.height)}scaledBy(e,t){return new A(this.x,this.y,this.width*e,this.height*t)}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}notEqualTo(e){return!this.equals(e)}}function T(e,t){const n="webgl"===t?e.getContext(t,{antialias:!1}):e.getContext(t);if(!n)throw new Error(`Could not get context ${t}`);return n}function M(e,t){if(!e)return A.Empty();const n=(t||T(document.createElement("canvas"),"2d")).measureText(e);return new A(0,0,n.width,n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}function F(e,t,n){let{low:i,high:r}=e,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(n<i||n>r)throw new Error(`Target has to be in range of low <= target <= high, got ${i} <= ${n} <= ${r}`);for(;;){if(r-i<=o)return[i,r];const e=(r+i)/2;t(e)<n?i=e:r=e}}function k(e,t){const n=t.getColorForFrame(e);return 4===n.length?`rgba(${n.slice(0,3).map((e=>255*e)).join(",")}, ${n[3]})`:`rgba(${n.map((e=>255*e)).join(",")}, 1.0)`}function L(e,t){if(t>=e.length)return e;const n=Math.floor(t/2),i=t-n-1;return`${e.substring(0,n)}…${e.substring(e.length-i+"…".length)}`}var P=n("./app/utils/useLocation.tsx");var N=n("./app/views/profiling/profileGroupProvider.tsx");function B(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return[e[1],e[2]]}var D=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function H(e){return["left heavy","call order"].includes(e)}function V(e){return["top down","bottom up"].includes(e)}function U(e){return["standalone","transaction"].includes(e)}function z(e){return{colorCoding:e.preferences.colorCoding,sorting:e.preferences.sorting,view:e.preferences.view,xAxis:e.preferences.xAxis,query:e.search.query,...e.position.view.isEmpty()?{fov:void 0}:{fov:A.encode(e.position.view)},..."number"==typeof e.profiles.threadId?{tid:e.profiles.threadId}:{}}}const X=function(e){const t=Object.keys(e);return(n,i)=>{const r={};for(const o of t)r[o]=e[o](n[o],i);return r}}({profiles:function(e,t){switch(t.type){case"set selected node":return{...e,selectedNode:t.payload};case"set thread id":return{...e,selectedNode:null,threadId:t.payload};default:return e}},position:function(e,t){return"checkpoint"===t.type?{view:A.From(t.payload)}:e},preferences:function(e,t){switch(t.type){case"set color coding":return{...e,colorCoding:t.payload};case"set sorting":return{...e,sorting:t.payload};case"set view":return{...e,view:t.payload};case"set xAxis":return{...e,xAxis:t.payload};default:return e}},search:function(e,t){switch(t.type){case"clear search":return{...e,query:"",index:null,results:null};case"set results":return{...e,...t.payload};case"set search index position":return{...e,index:t.payload};default:return e}}});function K(){const e=(0,P.T)(),t=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e[0]}();return(0,r.useEffect)((()=>{u.browserHistory.replace({...e,query:{...e.query,...z(t)}})}),[t]),null}const G=(0,r.createContext)(null),j={profiles:{threadId:null,selectedNode:null},position:{view:A.Empty()},preferences:{colorCoding:"by symbol name",sorting:"call order",view:"top down",xAxis:"standalone"},search:{index:null,results:null,query:""}};function W(e){var t,n,i,o,s,a,l,c,h,d,u,f,p,g,m,v,w,y,x,b,C,E,_;const[S]=(0,N.useProfileGroup)(),R=function(e,t){var n,i;const[o,s]=(0,r.useReducer)(function(e){return(t,n)=>{if(function(e){return!!e.type&&("undo"===e.type||"redo"===e.type)}(n))return function(e,t){if("undo"===t.type)return void 0===e.previous?e:e.previous;if("redo"===t.type)return void 0===e.next?e:e.next;throw new Error("Unreachable case")}(t,n);const i={next:void 0,previous:t,current:e(t.current,n)};return t.next=i,i}}(e),{current:t,previous:void 0,next:void 0});return[o.current,s,{previousState:null===(n=o.previous)||void 0===n?void 0:n.current,nextState:null===(i=o.next)||void 0===i?void 0:i.current}]}(X,{profiles:{selectedNode:null,threadId:null!==(t=null===(n=e.initialState)||void 0===n||null===(i=n.profiles)||void 0===i?void 0:i.threadId)&&void 0!==t?t:j.profiles.threadId},position:{view:null!==(o=null===(s=e.initialState)||void 0===s||null===(a=s.position)||void 0===a?void 0:a.view)&&void 0!==o?o:j.position.view},preferences:{colorCoding:null!==(l=null===(c=e.initialState)||void 0===c||null===(h=c.preferences)||void 0===h?void 0:h.colorCoding)&&void 0!==l?l:j.preferences.colorCoding,sorting:null!==(d=null===(u=e.initialState)||void 0===u||null===(f=u.preferences)||void 0===f?void 0:f.sorting)&&void 0!==d?d:j.preferences.sorting,view:null!==(p=null===(g=e.initialState)||void 0===g||null===(m=g.preferences)||void 0===m?void 0:m.view)&&void 0!==p?p:j.preferences.view,xAxis:null!==(v=null===(w=e.initialState)||void 0===w||null===(y=w.preferences)||void 0===y?void 0:y.xAxis)&&void 0!==v?v:j.preferences.xAxis},search:{...j.search,query:null!==(x=null===(b=e.initialState)||void 0===b||null===(C=b.search)||void 0===C?void 0:C.query)&&void 0!==x?x:j.search.query}});return(0,r.useEffect)((()=>{if(null===R[0].profiles.threadId&&"resolved"===S.type&&"number"==typeof S.data.activeProfileIndex){const e=S.data.profiles[S.data.activeProfileIndex].threadId;e&&R[1]({type:"set thread id",payload:e})}}),[null===(E=e.initialState)||void 0===E||null===(_=E.profiles)||void 0===_?void 0:_.threadId,S,R]),(0,D.tZ)(G.Provider,{value:R,children:e.children})}function Y(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphPreferences called outside of FlamegraphStateProvider");return[e[0].preferences,e[1]]}function q(e){let{canvasPoolManager:t}=e;const[{colorCoding:n,xAxis:i},o]=Y();return(0,D.BX)(r.Fragment,{children:[(0,D.tZ)(l.ZP,{size:"xsmall",onClick:()=>t.dispatch("resetZoom",[]),children:(0,d.t)("Reset Zoom")}),(0,D.tZ)(c.Z,{triggerLabel:(0,d.t)("Options"),triggerProps:{icon:(0,D.tZ)(h.OP,{size:"xs"}),size:"xsmall"},placement:"bottom right",sections:[{label:(0,d.t)("X Axis"),value:"x axis",defaultValue:i,options:Object.entries($).map((e=>{let[t,n]=e;return{label:n,value:t}})),onChange:e=>o({type:"set xAxis",payload:e})},{label:(0,d.t)("Color Coding"),value:"by symbol name",defaultValue:n,options:Object.entries(Q).map((e=>{let[t,n]=e;return{label:n,value:t}})),onChange:e=>o({type:"set color coding",payload:e})}]})]})}W.displayName="FlamegraphStateProvider",q.displayName="FlamegraphOptionsMenu";const $={standalone:(0,d.t)("Standalone"),transaction:(0,d.t)("Transaction")},Q={"by symbol name":(0,d.t)("By Symbol Name"),"by library":(0,d.t)("By Library"),"by system / application":(0,d.t)("By System / Application"),"by recursion":(0,d.t)("By Recursion")};var J=n("../node_modules/@sentry/hub/esm/exports.js"),ee=n("../node_modules/fuse.js/dist/fuse.esm.js"),te=n("./app/components/searchBar.tsx"),ne=n("./app/utils/profiling/profile/utils.tsx");const ie=/(.*)\/([dgimsuy])/,re=(0,ne.w_)((function(e){return Object.values(null!=e?e:{}).sort(((e,t)=>e.start===t.start?se(e.depth,t.depth,"asc"):se(e.start,t.start,"asc")))}));function oe(e,t,n){const i={};if(null!=(o=e)&&o.trim().length&&ie.test(o)){var r;const[n,o,s]=null!==(r=(e=>e.match(ie))(e))&&void 0!==r?r:[];let a=0;try{if(!o)throw new Error("Invalid RegExp");for(let e=0;e<t.length;e++){const n=t[e];new RegExp(o,null!=s?s:"g").test(n.frame.name.trim())&&(i[`${n.frame.name+(n.frame.file?n.frame.file:"")+String(n.start)}`]=n,a+=1)}}catch(e){J.uT(e.message)}return a<=0?null:i}var o;const s=n.search(e);if(s.length<=0)return null;for(let e=0;e<s.length;e++){const t=s[e];i[`${t.item.frame.name+(t.item.frame.file?t.item.frame.file:"")+String(t.item.start)}`]=t.item}return i}const se=(e,t,n)=>e===t?0:null==e?1:null==t?-1:"asc"===n?e-t:t-e;function ae(e){let{flamegraphs:t,canvasPoolManager:n}=e;const[i,o]=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphSearch called outside of FlamegraphStateProvider");return[e[0].search,e[1]]}(),s=(0,r.useMemo)((()=>Array.isArray(t)?t.reduce(((e,t)=>e.concat(t.frames)),[]):t.frames),[t]),a=(0,r.useMemo)((()=>new ee.default(s,{keys:["frame.name"],threshold:.3,includeMatches:!0})),[s]),l=(0,r.useCallback)((e=>{n.dispatch("zoomIntoFrame",[e])}),[n]);(0,r.useEffect)((()=>{if("number"!=typeof i.index)return;const e=re(i.results);e[i.index]&&l(e[i.index])}),[i.results,i.index,l]);const c=(0,r.useCallback)((e=>{o(e?{type:"set results",payload:{results:oe(e,s,a),query:e}}:{type:"clear search"})}),[o,s,a]),h=(0,r.useCallback)((()=>{const e=re(i.results);e.length&&(null!==i.index&&i.index!==e.length-1?o({type:"set search index position",payload:i.index+1}):o({type:"set search index position",payload:0}))}),[i.results,i.index,o]),u=(0,r.useCallback)((()=>{const e=re(i.results);e.length&&(null!==i.index&&0!==i.index?o({type:"set search index position",payload:i.index-1}):o({type:"set search index position",payload:e.length-1}))}),[i.results,i.index,o]),f=(0,r.useCallback)((e=>{"ArrowDown"===e.key?(e.preventDefault(),h()):"ArrowUp"===e.key&&(e.preventDefault(),u())}),[h,u]);return(0,D.tZ)(le,{placeholder:(0,d.t)("Find Frames"),query:i.query,onChange:c,onKeyDown:f})}ae.displayName="FlamegraphSearch";const le=(0,i.Z)(te.Z,{target:"esleofq0"})({name:"nduejp",styles:".search-input{height:28px;}flex:1 1 100%"});var ce=n("./app/styles/space.tsx");const he=(0,i.Z)("div",{target:"es1x3st0"})("display:flex;justify-content:space-between;align-items:center;margin:",(0,ce.Z)(1)," ",(0,ce.Z)(4),";gap:",(0,ce.Z)(1),";");var de=n("./app/components/buttonBar.tsx");function ue(e){let{view:t,onViewChange:n,sorting:i,onSortingChange:o}=e;return(0,D.BX)(r.Fragment,{children:[(0,D.BX)(de.ZP,{merged:!0,active:i,children:[(0,D.tZ)(l.ZP,{barId:"call order",size:"xsmall",onClick:()=>o("call order"),children:(0,d.t)("Call Order")}),(0,D.tZ)(l.ZP,{barId:"left heavy",size:"xsmall",onClick:()=>o("left heavy"),children:(0,d.t)("Left Heavy")})]}),(0,D.BX)(de.ZP,{merged:!0,active:t,children:[(0,D.tZ)(l.ZP,{barId:"bottom up",size:"xsmall",onClick:()=>n("bottom up"),children:(0,d.t)("Bottom Up")}),(0,D.tZ)(l.ZP,{barId:"top down",size:"xsmall",onClick:()=>n("top down"),children:(0,d.t)("Top Down")})]})]})}ue.displayName="FlamegraphViewSelectMenu";var fe=n("./app/stores/configStore.tsx"),pe=n("./app/stores/useLegacyStore.tsx"),ge=n("./app/utils/theme.tsx");const me="ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono', 'Roboto Mono',\n'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro', 'Fira Mono', 'Droid Sans Mono',\n'Courier New', monospace",ve=ge.Wb.text.familyMono,we={CONFIG:{HIGHLIGHT_RECURSION:!1},SIZES:{BAR_HEIGHT:20,BAR_FONT_SIZE:11,BAR_PADDING:4,FLAMEGRAPH_DEPTH_OFFSET:12,SPANS_DEPTH_OFFSET:4,SPANS_FONT_SIZE:10,SPANS_BAR_HEIGHT:14,REQUEST_TAIL_HEIGHT:8,REQUEST_BAR_HEIGHT:14,REQUEST_FONT_SIZE:10,REQUEST_DEPTH_OFFSET:4,MINIMAP_POSITION_OVERLAY_BORDER_WIDTH:2,MINIMAP_HEIGHT:100,TIMELINE_HEIGHT:20,LABEL_FONT_SIZE:10,LABEL_FONT_PADDING:6,FRAME_BORDER_WIDTH:2,HOVERED_FRAME_BORDER_WIDTH:1,TOOLTIP_FONT_SIZE:12,GRID_LINE_WIDTH:2},COLORS:{LABEL_FONT_COLOR:"#1f233a",BAR_LABEL_FONT_COLOR:"#000",GRID_LINE_COLOR:"#e5e7eb",GRID_FRAME_BACKGROUND_COLOR:"rgba(255, 255, 255, 0.8)",SEARCH_RESULT_FRAME_COLOR:"vec4(0.99, 0.70, 0.35, 1.0)",SELECTED_FRAME_BORDER_COLOR:"#005aff",HOVERED_FRAME_BORDER_COLOR:"rgba(0, 0, 0, 0.8)",CURSOR_CROSSHAIR:"#bbbbbb",SPAN_FRAME_BORDER:"rgba(200, 200, 200, 1)",SPAN_FRAME_BACKGROUND:"rgba(231, 231, 231, 0.5)",MINIMAP_POSITION_OVERLAY_COLOR:"rgba(0,0,0,0.1)",MINIMAP_POSITION_OVERLAY_BORDER_COLOR:"rgba(0,0,0, 0.2)",REQUEST_WAIT_TIME:"rgba(253,252,224, 1)",REQUEST_DNS_TIME:"rgba(57, 146, 152, 1)",REQUEST_TCP_TIME:"rgba(242, 146,57,1)",REQUEST_SSL_TIME:"rgba(207,84,218, 1)",REQUEST_2XX_RESPONSE:"rgba(218, 231, 209, 1)",REQUEST_4XX_RESPONSE:"rgba(255,96, 96, 1)",DIFFERENTIAL_INCREASE:[.98,.2058,.4381],DIFFERENTIAL_DECREASE:[.309,.2058,.98],COLOR_BUCKET:x({C_0:.25,C_d:.2,L_0:.8,L_d:.15}),COLOR_MAP:b,STACK_TO_COLOR:g([0,0,0,.035]),FRAME_FALLBACK_COLOR:[0,0,0,.035]},FONTS:{FONT:me,FRAME_FONT:ve}},ye={CONFIG:{HIGHLIGHT_RECURSION:!1},SIZES:{BAR_HEIGHT:20,BAR_FONT_SIZE:11,BAR_PADDING:4,FLAMEGRAPH_DEPTH_OFFSET:12,SPANS_DEPTH_OFFSET:4,SPANS_FONT_SIZE:10,SPANS_BAR_HEIGHT:14,REQUEST_TAIL_HEIGHT:8,REQUEST_BAR_HEIGHT:14,REQUEST_FONT_SIZE:10,REQUEST_DEPTH_OFFSET:4,MINIMAP_POSITION_OVERLAY_BORDER_WIDTH:2,MINIMAP_HEIGHT:100,TIMELINE_HEIGHT:20,LABEL_FONT_SIZE:10,LABEL_FONT_PADDING:6,FRAME_BORDER_WIDTH:2,HOVERED_FRAME_BORDER_WIDTH:1,TOOLTIP_FONT_SIZE:12,GRID_LINE_WIDTH:2},COLORS:{LABEL_FONT_COLOR:"rgba(255, 255, 255, 0.8)",BAR_LABEL_FONT_COLOR:"rgb(255 255 255 / 80%)",GRID_LINE_COLOR:"#222227",GRID_FRAME_BACKGROUND_COLOR:"rgba(0, 0, 0, 0.4)",SEARCH_RESULT_FRAME_COLOR:"vec4(0.99, 0.70, 0.35, 0.7)",SELECTED_FRAME_BORDER_COLOR:"#3482ea",HOVERED_FRAME_BORDER_COLOR:"rgba(255, 255, 255, 0.8)",CURSOR_CROSSHAIR:"#828285",SPAN_FRAME_BORDER:"#57575b",SPAN_FRAME_BACKGROUND:"rgba(232, 232, 232, 0.2)",REQUEST_WAIT_TIME:"rgba(253,252,224, 1)",REQUEST_DNS_TIME:"rgba(57, 146, 152, 1)",REQUEST_TCP_TIME:"rgba(242, 146,57,1)",REQUEST_SSL_TIME:"rgba(207,84,218, 1)",REQUEST_2XX_RESPONSE:"rgba(218, 231, 209, 1)",REQUEST_4XX_RESPONSE:"rgba(255,96, 96, 1)",MINIMAP_POSITION_OVERLAY_COLOR:"rgba(255,255,255,0.1)",MINIMAP_POSITION_OVERLAY_BORDER_COLOR:"rgba(255,255,255, 0.2)",DIFFERENTIAL_INCREASE:[.98,.2058,.4381],DIFFERENTIAL_DECREASE:[.309,.2058,.98],COLOR_BUCKET:x({C_0:.2,C_d:.1,L_0:.2,L_d:.1}),COLOR_MAP:b,STACK_TO_COLOR:g([1,1,1,.1]),FRAME_FALLBACK_COLOR:[1,1,1,.1]},FONTS:{FONT:me,FRAME_FONT:ve}},xe=(0,r.createContext)(null);function be(e){const{theme:t}=(0,pe.X)(fe.Z),n=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphPreferencesValue called outside of FlamegraphStateProvider");return e[0].preferences}(),i=(0,r.useMemo)((()=>{const e="light"===t?we:ye;switch(n.colorCoding){case"by symbol name":return e;case"by recursion":return{...e,COLORS:{...e.COLORS,COLOR_MAP:C}};case"by library":return{...e,COLORS:{...e.COLORS,COLOR_MAP:E}};case"by system / application":return{...e,COLORS:{...e.COLORS,COLOR_MAP:_}};default:throw new TypeError(`Unsupported flamegraph color coding ${n.colorCoding}`)}}),[t,n.colorCoding]);return(0,D.tZ)(xe.Provider,{value:i,children:e.children})}function Ce(){const e=(0,r.useContext)(xe);if(!e)throw new Error("useFlamegraphTheme was called outside of FlamegraphThemeProvider");return e}function Ee(e){let{container:t}=e;const[n,i]=(0,r.useState)(!1),[o,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(null),[c,h]=(0,r.useState)(null),d=function(){const[e,t]=(0,r.useState)(null),n=[],{tabIndex:i,setTabIndex:o,onKeyDown:s}=function(e){const[t,n]=(0,r.useState)(null),i=(0,r.useCallback)((i=>{0!==e.length&&("Escape"===i.key&&n(null),"ArrowDown"!==i.key&&"Tab"!==i.key||(i.preventDefault(),t===e.length-1||null===t?n(0):n((null!=t?t:0)+1)),("ArrowUp"===i.key||"Tab"===i.key&&i.shiftKey)&&(i.preventDefault(),n(0===t||null===t?e.length-1:(null!=t?t:0)-1)))}),[t,e]);return{tabIndex:t,setTabIndex:n,onKeyDown:i}}(n);return(0,r.useEffect)((()=>{e&&null===i&&e.focus()}),[e,i]),{menuRef:e,getItemProps:function(){const e=n.length;return n.push({id:e,node:null}),{tabIndex:i===e?0:-1,ref:t=>{n[e]&&(i===e&&(null==t||t.focus()),n[e].node=t)},onMouseEnter:()=>{o(e)},onKeyDown:s}},getMenuProps:function(){return{tabIndex:-1,ref:t,onKeyDown:s}},tabIndex:i,setTabIndex:o}}(),u=(0,r.useCallback)((e=>{e||d.setTabIndex(null),i(e)}),[d]),f=(0,r.useCallback)((()=>{const e=d.getMenuProps();return{...e,onKeyDown:t=>{"Escape"===t.key&&u(!1),e.onKeyDown(t)}}}),[d,u]),p=(0,r.useCallback)((()=>{const e=d.getItemProps();return{...e,onKeyDown:t=>{"Escape"===t.key&&u(!1),e.onKeyDown(t)}}}),[d,u]),g=(0,r.useCallback)((e=>{if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.getBoundingClientRect();l(new A(e.clientX-n.left,e.clientY-n.top,0,0)),u(!0)}),[u,t]);(0,r.useEffect)((()=>{const e=e=>{d.menuRef&&!d.menuRef.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[d.menuRef]),(0,r.useEffect)((()=>{if(!d.menuRef)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;s(new A(0,0,t.width,t.height))}));return e.observe(d.menuRef),()=>{e.disconnect()}}),[d.menuRef]),(0,r.useEffect)((()=>{if(!t)return;const e=new window.ResizeObserver((e=>{const t=e[0].contentRect;h(new A(0,0,t.width,t.height))}));return e.observe(t),()=>{e.disconnect()}}),[t]);const m=a&&c&&o?function(e,t,n){const i=Math.floor(t.height-n.height),r=t.top,o=t.left,s=Math.floor(t.right-n.width);return{left:v(e.x+6,o,s),top:v(e.y+6,r,i)}}(a,c,o):null;return{open:n,setOpen:u,position:m,containerCoordinates:c,contextMenuCoordinates:m,menuRef:d.menuRef,handleContextMenu:g,getMenuProps:f,getMenuItemProps:p}}be.displayName="FlamegraphThemeProvider";var _e=n("./app/utils/useEffectAfterFirstRender.ts");class Se{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,f.Z)(this,"node",void 0),(0,f.Z)(this,"parent",void 0),(0,f.Z)(this,"children",void 0),(0,f.Z)(this,"expanded",void 0),(0,f.Z)(this,"depth",void 0),this.node=e,this.parent=t,this.expanded=null!=i&&i,this.children=[],this.depth=n}getVisibleChildrenCount(){if(!this.expanded||!this.children.length)return 0;let e=0;const t=[...this.children];for(;t.length>0;){const n=t.pop();if(void 0===n)throw new Error("Undefined queue node, this should never happen");if(n.expanded)for(let e=0;e<n.children.length;e++)t.push(n.children[e]);e++}return e}setExpanded(e,t){if(e===this.expanded)return[];if(!e){const t=this.getVisibleChildrenCount();return this.expanded=e,new Array(t)}this.expanded=e;const n=[];function i(e){if(null!=t&&t.expandChildren&&(e.expanded=!0),n.push(e),e.expanded)for(let t=0;t<e.children.length;t++)i(e.children[t])}for(let e=0;e<this.children.length;e++)i(this.children[e]);return n}}class Re{constructor(e,t){(0,f.Z)(this,"roots",[]),(0,f.Z)(this,"flattened",[]),this.roots=e,this.flattened=t||Re.toExpandedList(this.roots)}static fromRoots(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1,n=arguments.length>2?arguments[2]:void 0;const i=[];function r(e,i,o,s){const a=new Se(e,i,s,!!n&&n.has(e));if(i&&t(a))for(let t=0;t<e.children.length;t++)r(e.children[t],a,i.children,s);else{o&&o.push(a);for(let t=0;t<e.children.length;t++)r(e.children[t],a,a.children,s+1)}}for(let t=0;t<e.length;t++)r(e[t],null,i,0);return new Re(i,void 0)}static toExpandedList(e){const t=[];function n(e){if(t.push(e),e.expanded)for(let t=0;t<e.children.length;t++)n(e.children[t])}for(let t=0;t<e.length;t++)n(e[t]);return t}expandNode(e,t,n){const i=e.setExpanded(t,n);return i.length?(e.expanded?this.flattened.splice(this.flattened.indexOf(e)+1,0,...i):this.flattened.splice(this.flattened.indexOf(e)+1,i.length),i):i}sort(e){if(!this.roots.length)return;function t(n){const i=n.children.sort(e);for(let e=0;e<i.length;e++)t(i[e])}const n=this.roots.sort(e);for(let e=0;e<n.length;e++)t(n[e]);this.flattened=Re.toExpandedList(this.roots)}getAllExpandedNodes(e){const t=new Set([...e]);function n(e){e.expanded&&t.add(e.node);for(let t=0;t<e.children.length;t++)n(e.children[t])}for(let e=0;e<this.roots.length;e++)n(this.roots[e]);return t}}function Ie(e,t){switch(t.type){case"set tab index key":return{...e,tabIndexKey:t.payload};case"set scroll top":return{...e,scrollTop:t.payload};case"set scroll height":return{...e,scrollHeight:t.payload};default:return e}}function Ze(e){let{ref:t}=e;t.current&&(t.current.style.opacity="0")}function Oe(e){let{ref:t,tabIndexKey:n,rowHeight:i,scrollTop:r,interaction:o}=e;t.current&&(t.current.style.left="0",t.current.style.right="0",t.current.style.height=`${i}px`,t.current.style.position="absolute",t.current.style.backgroundColor="active"===o?ge.ZP.blue300:ge.ZP.blue100,t.current.style.pointerEvents="none",t.current.style.willChange="transform, opacity",t.current.style.transform=`translateY(${i*n-r}px)`,t.current.style.opacity="1")}function Ae(e,t){if(!t.flattened.length||!e)return null;const n=t.flattened.findIndex((t=>t.node===e.node));return-1===n?null:n}function Te(e){var t,n,i,o;const s=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)(null),[c,h]=(0,r.useReducer)(Ie,{scrollTop:0,roots:e.roots,tabIndexKey:null,overscroll:null!==(t=e.overscroll)&&void 0!==t?t:5,scrollHeight:null!==(n=null===(i=e.scrollContainer)||void 0===i||null===(o=i.getBoundingClientRect())||void 0===o?void 0:o.height)&&void 0!==n?n:0}),d=(0,r.useRef)(c);d.current=c;const[u,f]=(0,r.useState)((()=>{const t=Re.fromRoots(e.roots,e.skipFunction);return e.sortFunction&&t.sort(e.sortFunction),t})),p=(0,r.useCallback)((()=>{for(const e of v.current)e.ref&&e.ref.dataset.hovered&&delete e.ref.dataset.hovered}),[]),g=(0,r.useRef)(new Set);(0,_e.K)((()=>{const t=u.getAllExpandedNodes(g.current),n=Re.fromRoots(e.roots,e.skipFunction,t);g.current=t,e.sortFunction&&n.sort(e.sortFunction);const i=Ae(d.current.tabIndexKey?u.flattened[d.current.tabIndexKey]:null,n);i?Oe({ref:s,tabIndexKey:i,rowHeight:e.rowHeight,scrollTop:d.current.scrollTop,interaction:"active"}):Ze({ref:s}),p(),Ze({ref:a}),h({type:"set tab index key",payload:i}),f(n)}),[e.roots,e.skipFunction,p]);const m=(0,r.useMemo)((()=>function(e){let{items:t,overscroll:n,rowHeight:i,scrollHeight:r,scrollTop:o}=e;const s=n*i,a=[],l={top:Math.max(o-s,0),bottom:Math.min(o+r+s,t.length*i)};let c=0,h=function(e){let{items:t,overscroll:n,rowHeight:i,scrollTop:r,viewport:o}=e;return t.length&&0!==o.top?Math.max(Math.floor(r/i)-n,0):0}({items:t,viewport:l,scrollTop:o,rowHeight:i,overscroll:n});const d=Math.ceil((r+2*s)/i),u=t.length;for(;c<d&&h<u;){const e=h*i,n=e+i;e>=l.top&&n<=l.bottom&&(a[c]={key:h,ref:null,styles:{position:"absolute",top:e},item:t[h]},c++),h++}return a}({items:u.flattened,scrollHeight:c.scrollHeight,scrollTop:c.scrollTop,overscroll:c.overscroll,rowHeight:e.rowHeight})),[u,c.overscroll,c.scrollHeight,c.scrollTop,e.rowHeight]),v=(0,r.useRef)(m);v.current=m;const w=(0,r.useRef)(void 0);(0,r.useEffect)((()=>{const t=e.scrollContainer;if(!t)return;const n=t=>{var n;t.target.firstChild.style.pointerEvents="none",void 0!==w.current&&(n=w.current,window.cancelAnimationFrame(n.id)),w.current=((e,n)=>{let i;Promise.resolve().then((()=>{i=Date.now()}));const r=()=>{void 0!==i&&Date.now()-i>=150?t.target.firstChild.style.pointerEvents="auto":o.id=window.requestAnimationFrame(r)},o={id:window.requestAnimationFrame(r)};return o})(),h({type:"set scroll top",payload:Math.max(t.target.scrollTop,0)}),null!==d.current.tabIndexKey&&Oe({ref:s,tabIndexKey:d.current.tabIndexKey,scrollTop:Math.max(t.target.scrollTop,0),interaction:"active",rowHeight:e.rowHeight}),p(),Ze({ref:a})};return t.addEventListener("scroll",n,{passive:!0}),()=>{t.removeEventListener("scroll",n)}}),[e.scrollContainer,e.rowHeight,p]),(0,r.useEffect)((()=>{const t=e.scrollContainer;if(!t)return;const n=n=>{if(n.target!==t)return;const i=n.target.getBoundingClientRect(),r=Math.floor((d.current.scrollTop+n.clientY-i.top)/e.rowHeight);u.flattened[r]&&(h({type:"set tab index key",payload:r}),Oe({ref:s,tabIndexKey:r,scrollTop:d.current.scrollTop,rowHeight:e.rowHeight,interaction:"active"}))},i=n=>{if(n.target!==t)return;const i=n.target.getBoundingClientRect(),r=Math.floor((d.current.scrollTop+n.clientY-i.top)/e.rowHeight);p();const o=v.current.find((e=>e.key===r));null!=o&&o.ref&&(o.ref.dataset.hovered="true"),u.flattened[r]&&r!==d.current.tabIndexKey&&Oe({ref:a,tabIndexKey:r,scrollTop:d.current.scrollTop,rowHeight:e.rowHeight,interaction:"hover"})};return t.addEventListener("click",n),t.addEventListener("mousemove",i),()=>{t.removeEventListener("click",n),t.removeEventListener("mousemove",i)}}),[e.rowHeight,e.scrollContainer,u.flattened,p]),(0,r.useEffect)((()=>{const t=e.scrollContainer;if(t)return t.addEventListener("mouseleave",n,{passive:!0}),()=>{t.removeEventListener("mouseleave",n)};function n(){p(),Ze({ref:a})}}),[p,e.scrollContainer]);const y=(0,r.useCallback)(((t,n)=>{var i;const r=d.current.tabIndexKey&&null!==(i=u.flattened[d.current.tabIndexKey])&&void 0!==i?i:null;u.expandNode(t,!t.expanded,n);const o=new Re(u.roots,u.flattened);g.current=o.getAllExpandedNodes(new Set);const a=Ae(r,o);null===a?Ze({ref:s}):Oe({ref:s,tabIndexKey:a,scrollTop:Math.max(d.current.scrollTop,0),interaction:"active",rowHeight:e.rowHeight}),h({type:"set tab index key",payload:a}),f(o)}),[u,e.rowHeight]),x=(0,r.useCallback)((t=>{var n;const i=d.current.tabIndexKey&&null!==(n=u.flattened[d.current.tabIndexKey])&&void 0!==n?n:null;u.sort(t);const r=new Re(u.roots,u.flattened),o=Ae(i,r);null===o?Ze({ref:s}):Oe({ref:s,tabIndexKey:o,scrollTop:Math.max(d.current.scrollTop,0),interaction:"active",rowHeight:e.rowHeight}),h({type:"set tab index key",payload:o}),f(r)}),[u,e.rowHeight]),b=(0,r.useCallback)((t=>n=>{h({type:"set tab index key",payload:t}),Oe({ref:s,tabIndexKey:t,scrollTop:c.scrollTop,rowHeight:e.rowHeight,interaction:"active"})}),[c.scrollTop,e.rowHeight]),C=(0,r.useCallback)((t=>{if(null!==d.current.tabIndexKey){if("Enter"===t.key&&y(u.flattened[d.current.tabIndexKey],{expandChildren:!0}),"ArrowDown"===t.key){t.preventDefault();const r=m.findIndex((e=>e.key===d.current.tabIndexKey));if(-1!==r){var n,i;const t=r+1;if(t>u.flattened.length-1)return;h({type:"set tab index key",payload:m[t].key}),Oe({ref:s,tabIndexKey:m[t].key,scrollTop:d.current.scrollTop,rowHeight:e.rowHeight,interaction:"active"}),null===(n=m[t].ref)||void 0===n||n.focus({preventScroll:!0}),null===(i=m[t].ref)||void 0===i||i.scrollIntoView({block:"nearest"})}}if("ArrowUp"===t.key){t.preventDefault();const n=m.findIndex((e=>e.key===d.current.tabIndexKey));if(-1!==n){var r,o;const t=n-1;if(t<0)return;h({type:"set tab index key",payload:m[t].key}),Oe({ref:s,tabIndexKey:m[t].key,scrollTop:d.current.scrollTop,rowHeight:e.rowHeight,interaction:"active"}),null===(r=m[t].ref)||void 0===r||r.focus({preventScroll:!0}),null===(o=m[t].ref)||void 0===o||o.scrollIntoView({block:"nearest"})}}}}),[y,m,u.flattened,e.rowHeight]),E=(0,r.useCallback)((t=>n=>{l.current!==t&&(p(),n.currentTarget.dataset.hovered="true",l.current=t),Oe({ref:a,tabIndexKey:t,scrollTop:c.scrollTop,rowHeight:e.rowHeight,interaction:"hover"})}),[c.scrollTop,e.rowHeight,p]);(0,r.useEffect)((()=>{if(!e.scrollContainer)return;let t;const n=new window.ResizeObserver((e=>{t=window.requestAnimationFrame((()=>{var t,n,i;h({type:"set scroll height",payload:null!==(t=null===(n=e[0])||void 0===n||null===(i=n.contentRect)||void 0===i?void 0:i.height)&&void 0!==t?t:0}),p(),Ze({ref:a})}))}));return n.observe(e.scrollContainer),()=>{"number"==typeof t&&window.cancelAnimationFrame(t),n.disconnect()}}),[e.scrollContainer,p]);const _=(0,r.useMemo)((()=>({height:"100%",overflow:"auto",position:"relative",willChange:"transform"})),[]),S=(0,r.useMemo)((()=>{const t=u.flattened.length*e.rowHeight;return{height:t,maxHeight:t}}),[u.flattened.length,e.rowHeight]),R=e.renderRow,I=(0,r.useMemo)((()=>{const e=[];for(let t=0;t<m.length;t++){const n=m[t];e.push(R(n,{handleRowClick:b(n.key),handleExpandTreeNode:y,handleRowKeyDown:C,handleRowMouseEnter:E(n.key),tabIndexKey:c.tabIndexKey}))}return e}),[m,b,C,c.tabIndexKey,E,y,R]);return(0,r.useEffect)((()=>{if(!e.scrollContainer)return;let t;const n=new window.ResizeObserver((e=>{t=window.requestAnimationFrame((()=>{var t,n,i;h({type:"set scroll height",payload:null!==(t=null===(n=e[0])||void 0===n||null===(i=n.contentRect)||void 0===i?void 0:i.height)&&void 0!==t?t:0})}))}));return n.observe(e.scrollContainer),()=>{"number"==typeof t&&window.cancelAnimationFrame(t),n.disconnect()}}),[e.scrollContainer]),{tree:u,items:m,renderedItems:I,tabIndexKey:c.tabIndexKey,dispatch:h,handleRowClick:b,handleRowKeyDown:C,handleRowMouseEnter:E,handleExpandTreeNode:y,handleSortingChange:x,scrollContainerStyles:_,containerStyles:S,clickedGhostRowRef:s,hoveredGhostRowRef:a}}const Me=(0,i.Z)((0,r.forwardRef)(((e,t)=>(0,D.tZ)("div",{ref:t,role:"menu",...e}))),{target:"em97tx410"})("position:absolute;font-size:",(e=>e.theme.fontSizeMedium),";z-index:",(e=>e.theme.zIndex.dropdown),";background:",(e=>e.theme.backgroundElevated),";border:1px solid ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:",(e=>e.theme.dropShadowHeavy),";width:auto;min-width:164px;overflow:auto;padding-bottom:",(0,ce.Z)(.5),";"),Fe=(0,i.Z)("div",{target:"em97tx49"})("cursor:pointer;display:flex;align-items:center;font-weight:normal;padding:0 ",(0,ce.Z)(1),";border-radius:",(e=>e.theme.borderRadius),";box-sizing:border-box;background:",(e=>0===e.tabIndex?e.theme.hover:void 0),";&:focus{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.hover),";outline:none;}"),ke=(0,i.Z)("label",{target:"em97tx48"})({name:"1h5wbu2",styles:"display:flex;align-items:center;font-weight:normal;margin:0;cursor:pointer;flex:1 1 100%"}),Le=(0,r.forwardRef)(((e,t)=>{const{children:n,checked:i,...r}=e;return(0,D.tZ)(He,{children:(0,D.tZ)(Fe,{ref:t,role:"menuitem",...r,children:(0,D.BX)(ke,{children:[(0,D.BX)(Pe,{children:[(0,D.tZ)(Be,{type:"checkbox",checked:i,onChange:()=>{}}),(0,D.tZ)(h.DL,{})]}),(0,D.tZ)(Ne,{children:n})]})})})})),Pe=(0,i.Z)("div",{target:"em97tx47"})("display:flex;align-items:center;height:1.4em;width:1em;gap:",(0,ce.Z)(1),";padding:",(0,ce.Z)(1)," 0;position:relative;"),Ne=(0,i.Z)("div",{target:"em97tx46"})("position:relative;width:100%;display:flex;gap:",(0,ce.Z)(.5),";justify-content:space-between;padding:",(0,ce.Z)(.5)," 0;margin-left:",(0,ce.Z)(.5),";text-transform:capitalize;margin-bottom:0;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"),Be=(0,i.Z)("input",{target:"em97tx45"})("position:absolute;opacity:0;cursor:pointer;height:0;padding-right:",(0,ce.Z)(1),";&+svg{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);width:1em;height:1.4em;display:none;}&:checked+svg{display:block;}"),De=(0,i.Z)((0,r.forwardRef)(((e,t)=>{const{children:n,...i}=e;return(0,D.tZ)(He,{children:(0,D.tZ)(Fe,{ref:t,role:"menuitem",...i,children:(0,D.tZ)(Ne,{children:n})})})})),{target:"em97tx44"})("cursor:pointer;color:",(e=>e.theme.textColor),";background:transparent;padding:0 ",(0,ce.Z)(.5),";&:focus{outline:none;}&:active:{background:transparent;}"),He=(0,i.Z)("div",{target:"em97tx43"})("padding:0 ",(0,ce.Z)(.5),";"),Ve=(0,i.Z)("div",{target:"em97tx42"})("padding-top:0;padding-bottom:",(0,ce.Z)(1),";&:last-of-type{padding-bottom:0;}"),Ue=(0,i.Z)((e=>{const{children:t,...n}=e;return(0,D.tZ)("div",{...n,children:t})}),{target:"em97tx41"})("text-transform:uppercase;line-height:1.5;font-weight:600;color:",(e=>e.theme.subText),";margin-bottom:0;cursor:default;font-size:75%;padding:",(0,ce.Z)(.5)," ",(0,ce.Z)(1.5),";"),ze=(0,i.Z)("div",{target:"em97tx40"})("width:100%;height:100%;position:absolute;left:0;top:0;z-index:",(e=>e.theme.zIndex.dropdown-1),";");function Xe(e){var t,n,i,o,s,a;return e.contextMenu.open?(0,D.BX)(r.Fragment,{children:[(0,D.tZ)(ze,{onClick:()=>e.contextMenu.setOpen(!1)}),(0,D.tZ)(Me,{...e.contextMenu.getMenuProps(),style:{position:"absolute",left:null!==(t=null===(n=e.contextMenu.position)||void 0===n?void 0:n.left)&&void 0!==t?t:-9999,top:null!==(i=null===(o=e.contextMenu.position)||void 0===o?void 0:o.top)&&void 0!==i?i:-9999,maxHeight:null!==(s=null===(a=e.contextMenu.containerCoordinates)||void 0===a?void 0:a.height)&&void 0!==s?s:"auto"},children:(0,D.BX)(Ve,{children:[(0,D.tZ)(Ue,{children:(0,d.t)("Flamegraph")}),(0,D.tZ)(De,{...e.contextMenu.getMenuItemProps(),onClick:e.onZoomIntoNodeClick,children:(0,d.t)("Scope view to this node")})]})})]}):null}function Ke(e,t){return e&&t?t/e*100:0}const Ge=(0,r.forwardRef)(((e,t)=>{let{node:n,flamegraphRenderer:i,referenceNode:o,onExpandClick:s,onContextMenu:a,tabIndex:l,onKeyDown:c,onClick:d,onMouseEnter:u,style:f}=e;const p=0===l,g=(0,r.useMemo)((()=>k(n.node,i)),[n,i]),m=(0,r.useCallback)((e=>{e.stopPropagation(),s(n,{expandChildren:e.metaKey})}),[n,s]);return(0,D.BX)(Qe,{ref:t,style:f,onContextMenu:a,tabIndex:l,isSelected:p,onKeyDown:c,onClick:d,onMouseEnter:u,children:[(0,D.BX)(wt,{isSelected:p,textAlign:"right",children:[i.flamegraph.formatter(n.node.node.selfWeight),(0,D.tZ)(je,{isSelected:p,weight:Ke(o.node.totalWeight,n.node.node.selfWeight)})]}),(0,D.tZ)(wt,{isSelected:p,noPadding:!0,textAlign:"right",children:(0,D.BX)(We,{children:[(0,D.BX)(qe,{children:[i.flamegraph.formatter(n.node.node.totalWeight),(0,D.tZ)(je,{isSelected:p,weight:Ke(o.node.totalWeight,n.node.node.totalWeight)})]}),(0,D.tZ)(Ye,{isSelected:p,children:n.node.node.frame.is_application?(0,D.tZ)(h.qO,{size:"xs"}):(0,D.tZ)(h.iC,{size:"xs"})})]})}),(0,D.tZ)(wt,{style:{paddingLeft:14*n.depth+8,width:"100%"},children:(0,D.BX)(Je,{children:[(0,D.tZ)(nt,{style:{backgroundColor:g}}),(0,D.tZ)(et,{tabIndex:-1,onClick:m,open:n.expanded,children:n.node.children.length>0?"›":null}),(0,D.tZ)(tt,{children:n.node.frame.name})]})})]})})),je=(0,i.Z)((e=>{const{weight:t,isSelected:n,...i}=e;return(0,D.BX)("div",{...i,children:[t.toFixed(1),"%",(0,D.tZ)($e,{style:{transform:`scaleX(${t/100})`}})]})}),{target:"e1h9r9vb9"})("display:inline-block;min-width:7ch;color:",(e=>e.isSelected?e.theme.white:e.theme.subText),";opacity:",(e=>e.isSelected?.8:1),";"),We=(0,i.Z)("div",{target:"e1h9r9vb8"})({name:"wvdp2q",styles:"display:flex;align-items:center;justify-content:flex-end;position:relative"}),Ye=(0,i.Z)("div",{target:"e1h9r9vb7"})("flex-shrink:0;width:26px;height:12px;display:flex;align-items:center;justify-content:center;color:",(e=>e.isSelected?e.theme.white:e.theme.subText),";opacity:",(e=>e.isSelected?.8:1),";"),qe=(0,i.Z)("div",{target:"e1h9r9vb6"})({name:"wxotm9",styles:"display:flex;align-items:center;position:relative;justify-content:flex-end;flex:1 1 100%"}),$e=(0,i.Z)("div",{target:"e1h9r9vb5"})("pointer-events:none;position:absolute;right:0;top:0;background-color:",(e=>e.theme.yellow100),";border-bottom:1px solid ",(e=>e.theme.yellow200),";transform-origin:center right;height:100%;width:100%;"),Qe=(0,i.Z)("div",{target:"e1h9r9vb4"})("display:flex;width:calc(100% + 400px);color:",(e=>e.isSelected?e.theme.white:"inherit"),";&:focus{outline:none;}&[data-hovered='true']:not([tabindex='0']){>div:first-child,>div:nth-child(2){background-color:#edf2fc!important;}}"),Je=(0,i.Z)("div",{target:"e1h9r9vb3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),et=(0,i.Z)("button",{target:"e1h9r9vb2"})("width:10px;height:10px;display:flex;padding:0;border:none;background-color:transparent;align-items:center;justify-content:center;user-select:none;transform:",(e=>e.open?"rotate(90deg)":"rotate(0deg)"),";"),tt=(0,i.Z)("span",{target:"e1h9r9vb1"})("margin-left:",(0,ce.Z)(.5),";"),nt=(0,i.Z)("div",{target:"e1h9r9vb0"})("width:12px;height:12px;border-radius:2px;display:inline-block;flex-shrink:0;margin-right:",(0,ce.Z)(.5),";");function it(e,t){if("total weight"===e)return"desc"===t?(e,t)=>t.node.node.totalWeight-e.node.node.totalWeight:(e,t)=>e.node.node.totalWeight-t.node.node.totalWeight;if("self weight"===e)return"desc"===t?(e,t)=>t.node.node.selfWeight-e.node.node.selfWeight:(e,t)=>e.node.node.selfWeight-t.node.node.selfWeight;if("name"===e)return"desc"===t?(e,t)=>e.node.frame.name.localeCompare(t.node.frame.name):(e,t)=>t.node.frame.name.localeCompare(e.node.frame.name);throw new Error(`Unknown sort property ${e}`)}function rt(e){return e.node.node.isDirectRecursive()}function ot(e){let{roots:t,flamegraphRenderer:n,canvasPoolManager:i,referenceNode:o,recursion:s}=e;const[a,l]=(0,r.useState)(null),[c,u]=(0,r.useState)("total weight"),[f,p]=(0,r.useState)("desc"),g=(0,r.useMemo)((()=>it(c,f)),[c,f]),[m,v]=(0,r.useState)(null),w=Ee({container:a}),y=(0,r.useCallback)((()=>{m&&i.dispatch("zoomIntoFrame",[m.node])}),[i,m]),x=(0,r.useCallback)(((e,t)=>{let{handleRowClick:i,handleRowMouseEnter:r,handleExpandTreeNode:s,handleRowKeyDown:a,tabIndexKey:l}=t;return(0,D.tZ)(Ge,{ref:t=>{e.ref=t},node:e.item,style:e.styles,referenceNode:o,tabIndex:l===e.key?0:1,flamegraphRenderer:n,onClick:i,onExpandClick:s,onKeyDown:a,onMouseEnter:r,onContextMenu:t=>{v(e.item),w.handleContextMenu(t)}})}),[w,n,o]),{renderedItems:b,scrollContainerStyles:C,containerStyles:E,handleSortingChange:_,clickedGhostRowRef:S,hoveredGhostRowRef:R}=Te({skipFunction:"collapsed"===s?rt:void 0,sortFunction:g,renderRow:x,scrollContainer:a,rowHeight:24,roots:t}),I=(0,r.useCallback)((e=>{const t=e===c?"asc"===f?"desc":"asc":"desc";p(t),u(e);const n=it(e,t);_(n)}),[c,f,_]);return(0,D.tZ)(lt,{children:(0,D.BX)(ct,{children:[(0,D.BX)(ut,{children:[(0,D.tZ)(ht,{children:(0,D.BX)(at,{onClick:()=>I("self weight"),children:[(0,d.t)("Self Time "),"self weight"===c?(0,D.tZ)(h.CC,{direction:"desc"===f?"down":"up"}):null]})}),(0,D.tZ)(ht,{children:(0,D.BX)(at,{onClick:()=>I("total weight"),children:[(0,d.t)("Total Time")," ","total weight"===c?(0,D.tZ)(h.CC,{direction:"desc"===f?"down":"up"}):null]})}),(0,D.tZ)(dt,{children:(0,D.BX)(at,{onClick:()=>I("name"),children:[(0,d.t)("Frame")," ","name"===c?(0,D.tZ)(h.CC,{direction:"desc"===f?"down":"up"}):null]})})]}),(0,D.tZ)(Xe,{onZoomIntoNodeClick:y,contextMenu:w}),(0,D.BX)("div",{style:{position:"relative",height:"100%",background:ge.ZP.white},children:[(0,D.tZ)("div",{ref:S}),(0,D.tZ)("div",{ref:R}),(0,D.tZ)("div",{ref:e=>l(e),style:C,onContextMenu:w.handleContextMenu,children:(0,D.BX)("div",{style:E,children:[b,(0,D.BX)(st,{children:[(0,D.tZ)(wt,{}),(0,D.tZ)(wt,{}),(0,D.tZ)(wt,{style:{width:"100%"}})]})]})})]})]})})}ot.displayName="FrameStackTable";const st=(0,i.Z)("div",{target:"ewf50xr6"})({name:"5zl1kz",styles:"display:flex;width:100%;pointer-events:none;position:absolute;height:100%;z-index:-1"}),at=(0,i.Z)("button",{target:"ewf50xr5"})("display:flex;width:100%;align-items:center;justify-content:space-between;padding:0 ",(0,ce.Z)(1),";border:none;background-color:",(e=>e.theme.surface400),";transition:background-color 100ms ease-in-out;&:hover{background-color:#edecee;}svg{width:10px;height:10px;}"),lt=(0,i.Z)("div",{target:"ewf50xr4"})("overflow:auto;width:100%;position:relative;background-color:",(e=>e.theme.surface100),";border-top:1px solid ",(e=>e.theme.border),";flex:1 1 100%;"),ct=(0,i.Z)("div",{target:"ewf50xr3"})("font-size:",(e=>e.theme.fontSizeSmall),";margin:0;overflow:auto;max-height:100%;height:100%;width:100%;display:flex;flex-direction:column;"),ht=(0,i.Z)("div",{target:"ewf50xr2"})("width:",164,"px;"),dt=(0,i.Z)("div",{target:"ewf50xr1"})({name:"10h7o7i",styles:"flex:1 1 100%"}),ut=(0,i.Z)("div",{target:"ewf50xr0"})("top:0;position:sticky;z-index:1;display:flex;flex:1;>div{position:relative;border-bottom:1px solid ",(e=>e.theme.border),";background-color:",(e=>e.theme.background),";white-space:nowrap;&:last-child{flex:1;}&:not(:last-child){border-right:1px solid ",(e=>e.theme.border),";}}");function ft(e){const t=Ce(),{selectedNode:n}=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphProfiles called outside of FlamegraphStateProvider");return e[0].profiles}(),[i,o]=(0,r.useState)("call order"),[s,a]=(0,r.useState)("all"),[c,h]=(0,r.useState)(null),u=(0,r.useMemo)((()=>{if(!n)return null;const e="all"!==s?function(e,t){const n=[],i=new Map;for(const r of e)for(n.push(r);n.length>0;){const e=n.pop();if(e){t(e)||i.set(e.key,e);for(let t=0;t<e.children.length;t++)n.push(e.children[e.children.length-t-1])}}const r=[],o=new Map;for(const e of i.values()){const t={...e,children:[]};let n=e.parent;for(;n&&!i.has(n.key);)n=n.parent;t.parent=(n?o.get(n.key):null)||null,t.parent?t.parent.children.push(t):r.push(t),o.set(t.key,t)}return r}([n],"application"===s?e=>!e.frame.is_application:"system"===s?e=>e.frame.is_application:()=>!1):[n];return"call order"===i?e:(0,ne.ql)(e)}),[n,i,s]),f=(0,r.useCallback)((e=>{h(e.currentTarget.checked?"collapsed":null)}),[]),p=(0,r.useCallback)((()=>{o("bottom up")}),[]),g=(0,r.useCallback)((()=>{o("call order")}),[]),m=(0,r.useCallback)((()=>{a("all")}),[]),v=(0,r.useCallback)((()=>{a("application")}),[]),w=(0,r.useCallback)((()=>{a("system")}),[]),{height:y,onMouseDown:x}=function(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(null),[i,o]=(0,r.useState)(e.initialHeight),s=(0,r.useCallback)((i=>{const r=t.current;null!==r&&(window.cancelAnimationFrame(r),t.current=null),t.current=window.requestAnimationFrame((()=>{if(!n.current)return;const t=[i.clientX,i.clientY],r=[n.current[0]-t[0],n.current[1]-t[1]];n.current=t,o((t=>{var n;return Math.max(null!==(n=e.minHeight)&&void 0!==n?n:0,t+r[1])}))}))}),[e.minHeight]),a=(0,r.useCallback)((()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a)}),[s]),l=(0,r.useCallback)((e=>{n.current=[e.clientX,e.clientY],document.addEventListener("mousemove",s,{passive:!0}),document.addEventListener("mouseup",a)}),[s,a]);return(0,r.useEffect)((()=>()=>{null!==t.current&&window.cancelAnimationFrame(t.current)})),{height:i,onMouseDown:l}}({initialHeight:(t.SIZES.FLAMEGRAPH_DEPTH_OFFSET+2)*t.SIZES.BAR_HEIGHT,minHeight:30});return n?(0,D.BX)(gt,{style:{height:y},children:[(0,D.BX)(vt,{children:[(0,D.tZ)("li",{className:"bottom up"===i?"active":void 0,children:(0,D.tZ)(l.ZP,{"data-title":(0,d.t)("Bottom Up"),priority:"link",size:"zero",onClick:p,children:(0,d.t)("Bottom Up")})}),(0,D.tZ)("li",{className:"call order"===i?"active":void 0,children:(0,D.tZ)(l.ZP,{"data-title":(0,d.t)("Call Order"),priority:"link",size:"zero",onClick:g,children:(0,d.t)("Call Order")})}),(0,D.tZ)(mt,{}),(0,D.tZ)("li",{className:"all"===s?"active":void 0,children:(0,D.tZ)(l.ZP,{"data-title":(0,d.t)("All Frames"),priority:"link",size:"zero",onClick:m,children:(0,d.t)("All Frames")})}),(0,D.tZ)("li",{className:"application"===s?"active":void 0,children:(0,D.tZ)(l.ZP,{"data-title":(0,d.t)("Application Frames"),priority:"link",size:"zero",onClick:v,children:(0,d.t)("Application Frames")})}),(0,D.tZ)("li",{className:"system"===s?"active":void 0,children:(0,D.tZ)(l.ZP,{"data-title":(0,d.t)("System Frames"),priority:"link",size:"zero",onClick:w,children:(0,d.t)("System Frames")})}),(0,D.tZ)(mt,{}),(0,D.tZ)("li",{children:(0,D.BX)(pt,{children:[(0,D.tZ)("input",{type:"checkbox",checked:"collapsed"===c,onChange:f}),(0,d.t)("Collapse recursion")]})}),(0,D.tZ)("li",{style:{flex:"1 1 100%",cursor:"ns-resize"},onMouseDown:x})]}),(0,D.tZ)(ot,{...e,recursion:c,roots:null!=u?u:[],referenceNode:n,canvasPoolManager:e.canvasPoolManager})]}):null}const pt=(0,i.Z)("label",{target:"egqij2z4"})("display:flex;align-items:center;white-space:nowrap;margin-bottom:0;height:100%;font-weight:normal;>input{margin:0 ",(0,ce.Z)(.5)," 0 0;}"),gt=(0,i.Z)("div",{target:"egqij2z3"})({name:"1vl6gtt",styles:"display:flex;flex-shrink:0;flex-direction:column"}),mt=(0,i.Z)("li",{target:"egqij2z2"})("width:1px;height:66%;margin:0 ",(0,ce.Z)(.5),";background:",(e=>e.theme.border),";transform:translateY(29%);"),vt=(0,i.Z)("ul",{target:"egqij2z1"})("display:flex;list-style-type:none;padding:0 ",(0,ce.Z)(1),";margin:0;border-top:1px solid ",(e=>e.theme.border),";background-color:",(e=>e.theme.surface400),";user-select:none;>li{font-size:",(e=>e.theme.fontSizeSmall),";margin-right:",(0,ce.Z)(1),";button{border:none;border-top:2px solid transparent;border-bottom:2px solid transparent;border-radius:0;margin:0;padding:",(0,ce.Z)(.5)," 0;color:",(e=>e.theme.textColor),";&::after{display:block;content:attr(data-title);font-weight:bold;height:1px;color:transparent;overflow:hidden;visibility:hidden;white-space:nowrap;}&:hover{color:",(e=>e.theme.textColor),";}}&.active button{font-weight:bold;border-bottom:2px solid ",(e=>e.theme.active),";}}"),wt=(0,i.Z)("div",{target:"egqij2z0"})("width:",164,"px;position:relative;white-space:nowrap;flex-shrink:0;padding:0 ",(e=>e.noPadding?0:(0,ce.Z)(1))," 0 0;text-align:",(e=>{var t;return null!==(t=e.textAlign)&&void 0!==t?t:"initial"}),";&:first-child,&:nth-child(2){position:sticky;z-index:1;background-color:",(e=>e.isSelected?e.theme.blue300:e.theme.background),";}&:first-child{left:0;}&:nth-child(2){left:",164,"px;}&:not(:last-child){border-right:1px solid ",(e=>e.theme.border),";}");class yt{constructor(){(0,f.Z)(this,"beforeFrameCallbacks",new Set),(0,f.Z)(this,"afterFrameCallbacks",new Set),(0,f.Z)(this,"onDisposeCallbacks",new Set),(0,f.Z)(this,"requestAnimationFrame",null),(0,f.Z)(this,"events",{transformConfigView:new Set,zoomIntoFrame:new Set,selectedNode:new Set,resetZoom:new Set,setConfigView:new Set})}onDispose(e){this.onDisposeCallbacks.has(e)||this.onDisposeCallbacks.add(e)}on(e,t){const n=this.events[e];n.has(t)||n.add(t)}off(e,t){const n=this.events[e];n.has(t)&&n.delete(t)}dispatch(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const t of this.events[e])t(...n)}registerCallback(e,t){t.has(e)||t.add(e)}unregisterCallback(e,t){t.has(e)&&t.delete(e)}registerBeforeFrameCallback(e){this.registerCallback(e,this.beforeFrameCallbacks)}unregisterBeforeFrameCallback(e){this.unregisterCallback(e,this.beforeFrameCallbacks)}registerAfterFrameCallback(e){this.registerCallback(e,this.afterFrameCallbacks)}unregisterAfterFrameCallback(e){this.unregisterCallback(e,this.afterFrameCallbacks)}dispose(){for(const e of this.onDisposeCallbacks)this.onDisposeCallbacks.delete(e),e();for(const e in this.events)this.events[e].clear()}drawSync(){for(const e of this.beforeFrameCallbacks)e();for(const e of this.afterFrameCallbacks)e()}draw(){this.requestAnimationFrame&&window.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=window.requestAnimationFrame((()=>{for(const e of this.beforeFrameCallbacks)e();for(const e of this.afterFrameCallbacks)e();this.requestAnimationFrame=null}))}}class xt{constructor(){(0,f.Z)(this,"schedulers",new Set)}registerScheduler(e){this.schedulers.has(e)||this.schedulers.add(e)}dispatch(e,t){for(const n of this.schedulers)n.dispatch(e,...t)}unregisterScheduler(e){this.schedulers.has(e)&&(e.dispose(),this.schedulers.delete(e))}drawSync(){for(const e of this.schedulers)e.drawSync()}draw(){for(const e of this.schedulers)e.draw()}}n("../node_modules/core-js/modules/es.typed-array.float32-array.js"),n("../node_modules/core-js/modules/es.typed-array.at.js"),n("../node_modules/core-js/modules/es.typed-array.fill.js"),n("../node_modules/core-js/modules/es.typed-array.set.js"),n("../node_modules/core-js/modules/es.typed-array.sort.js");class bt{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{draw_border:!1};(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"flamegraph",void 0),(0,f.Z)(this,"gl",null),(0,f.Z)(this,"program",null),(0,f.Z)(this,"theme",void 0),(0,f.Z)(this,"frames",[]),(0,f.Z)(this,"roots",[]),(0,f.Z)(this,"positions",[]),(0,f.Z)(this,"bounds",[]),(0,f.Z)(this,"colors",[]),(0,f.Z)(this,"colorMap",new Map),(0,f.Z)(this,"lastDragPosition",null),(0,f.Z)(this,"attributes",{a_position:null,a_color:null,a_bounds:null}),(0,f.Z)(this,"uniforms",{u_border_width:null,u_draw_border:null,u_is_search_result:null,u_model:null,u_projection:null}),(0,f.Z)(this,"options",void 0),this.flamegraph=t,this.canvas=e,this.theme=n,this.options=i,this.init()}init(){this.colors=new Array(24),this.frames=[...this.flamegraph.frames],this.roots=this.flamegraph.frames.filter((e=>!e.parent));const{colorBuffer:e,colorMap:t}=this.theme.COLORS.STACK_TO_COLOR(this.frames,this.theme.COLORS.COLOR_MAP,this.theme.COLORS.COLOR_BUCKET);this.colorMap=t,this.colors=e,this.initCanvasContext(),this.initVertices(),this.initShaders()}initVertices(){this.bounds=new Array(24*this.frames.length),this.positions=new Array(12*this.frames.length);const e=this.frames.length;for(let t=0;t<e;t++){const e=this.frames[t],n=e.start,i=e.end,r=e.depth,o=e.depth+1,s=12*t;this.positions[s]=n,this.positions[s+1]=r,this.positions[s+2]=i,this.positions[s+3]=r,this.positions[s+4]=n,this.positions[s+5]=o,this.positions[s+6]=n,this.positions[s+7]=o,this.positions[s+8]=i,this.positions[s+9]=r,this.positions[s+10]=i,this.positions[s+11]=o;const a=6*t*4;for(let e=0;e<6;e++){const t=a+4*e;this.bounds[t]=n,this.bounds[t+1]=r,this.bounds[t+2]=i,this.bounds[t+3]=o}}}initCanvasContext(){if(!this.canvas)throw new Error("Cannot initialize context from null canvas");if(this.gl=T(this.canvas,"webgl"),!this.gl)throw new Error("Uninitialized WebGL context");this.gl.enable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),Z(this.canvas)}initShaders(){if(!this.gl)throw new Error("Uninitialized WebGL context");this.uniforms={},this.attributes={};const e=S(this.gl,this.gl.VERTEX_SHADER,"\nattribute vec2 a_position;\nattribute vec4 a_color;\nattribute vec4 a_bounds;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying lowp vec4 v_color;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_color = a_color;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n}\n"),t=S(this.gl,this.gl.FRAGMENT_SHADER,(e=>`\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\nprecision mediump float;\n\nuniform bool u_is_search_result;\nuniform vec2 u_border_width;\nuniform bool u_draw_border;\n\nvarying lowp vec4 v_color;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n\n  if (u_is_search_result) {\n    gl_FragColor = ${this.theme.COLORS.SEARCH_RESULT_FRAME_COLOR};\n  } else if (u_draw_border) {\n    if(width <= u_border_width.x) {\n      if(v_pos.y > minY && v_pos.y < maxY){\n        gl_FragColor = vec4(v_color);\n      } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      }\n    } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n      gl_FragColor = vec4(v_color);\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else {\n    gl_FragColor = vec4(v_color);\n  }\n}\n`)());this.program=function(e,t,n){const i=e.createProgram();if(!i)throw new Error("Could not create program");if(e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;throw e.deleteProgram(i),new Error("Failed to create program")}(this.gl,e,t);const n=this.gl.getUniformLocation(this.program,"u_projection"),i=this.gl.getUniformLocation(this.program,"u_model"),r=this.gl.getUniformLocation(this.program,"u_is_search_result"),o=this.gl.getUniformLocation(this.program,"u_border_width"),s=this.gl.getUniformLocation(this.program,"u_draw_border");if(!n)throw new Error("Could not locate u_projection in shader");if(!i)throw new Error("Could not locate u_model in shader");if(!r)throw new Error("Could not locate u_is_search_result in shader");if(!o)throw new Error("Could not locate u_border_width in shader");if(!s)throw new Error("Could not locate u_draw_border in shader");this.uniforms.u_projection=n,this.uniforms.u_model=i,this.uniforms.u_is_search_result=r,this.uniforms.u_border_width=o,this.uniforms.u_draw_border=s;{const e=this.gl.getAttribLocation(this.program,"a_color");if(-1===e)throw new Error("Could not locate a_color in shader");this.attributes.a_color=e;const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.colors),this.gl.STATIC_DRAW);const n=4,i=this.gl.FLOAT,r=!1,o=0,s=0;this.gl.vertexAttribPointer(e,n,i,r,o,s),this.gl.enableVertexAttribArray(e)}{const e=this.gl.getAttribLocation(this.program,"a_position");if(-1===e)throw new Error("Could not locate a_color in shader");this.attributes.a_position=e;const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.positions),this.gl.STATIC_DRAW);const n=2,i=this.gl.FLOAT,r=!1,o=0,s=0;this.gl.vertexAttribPointer(e,n,i,r,o,s),this.gl.enableVertexAttribArray(e)}{const e=this.gl.getAttribLocation(this.program,"a_bounds");if(-1===e)throw new Error("Could not locate a_color in shader");this.attributes.a_bounds=e;const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.bounds),this.gl.STATIC_DRAW);const n=4,i=this.gl.FLOAT,r=!1,o=0,s=0;this.gl.vertexAttribPointer(e,n,i,r,o,s),this.gl.enableVertexAttribArray(e)}this.gl.useProgram(this.program)}getColorForFrame(e){var t;return null!==(t=this.colorMap.get(e.key))&&void 0!==t?t:this.theme.COLORS.FRAME_FALLBACK_COLOR}getHoveredNode(e){let t=null;const n=(i,r)=>{if(t)return;const o=new A(i.start,i.depth,i.end-i.start,1);if(o.containsX(e))if(o.containsY(e))t=i;else for(let e=0;e<i.children.length;e++)n(i.children[e],r+1)};for(let e=0;e<this.roots.length;e++)n(this.roots[e],0);return t}draw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.gl)throw new Error("Uninitialized WebGL context");if(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),!this.positions.length)return;this.gl.useProgram(this.program);const n=function(e,t){const n=p.Ue();return p.yR(n),p.Iu(n,n,a.al(-1,1)),p.bA(n,n,a.cs(a.Ue(),a.al(2,-2),a.al(e,t))),n}(this.gl.canvas.width,this.gl.canvas.height);this.gl.uniformMatrix3fv(this.uniforms.u_projection,!1,n),this.gl.uniformMatrix3fv(this.uniforms.u_model,!1,e),this.gl.uniform1i(this.uniforms.u_draw_border,this.options.draw_border?1:0),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);const i=new A(0,0,1,1),r=p.U_(p.Ue(),e),o=i.transformRect(r);this.gl.uniform2f(this.uniforms.u_border_width,o.width,o.height);const s=this.frames.length;let l;if(t)for(let e=0;e<s;e++){l=this.frames[e];const n=6*e;this.gl.uniform1i(this.uniforms.u_is_search_result,t[`${l.frame.name+(l.frame.file?l.frame.file:"")+String(l.start)}`]?1:0),this.gl.drawArrays(this.gl.TRIANGLES,n,6)}else{this.gl.uniform1i(this.uniforms.u_is_search_result,0);for(let e=0;e<s;e++){const t=6*e;this.gl.drawArrays(this.gl.TRIANGLES,t,6)}}}}class Ct{constructor(e,t,n){(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"context",void 0),(0,f.Z)(this,"theme",void 0),(0,f.Z)(this,"formatter",void 0),this.canvas=e,this.theme=t,this.formatter=n,this.context=T(e,"2d")}draw(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.context;r.font=`${this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio}px ${this.theme.FONTS.FONT}`,r.textBaseline="top",r.fillStyle=this.theme.COLORS.GRID_FRAME_BACKGROUND_COLOR,r.fillRect(0,1,t.width,this.theme.SIZES.LABEL_FONT_SIZE*window.devicePixelRatio+this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio*2-this.theme.SIZES.LABEL_FONT_PADDING),r.fillStyle=this.theme.COLORS.GRID_LINE_COLOR,r.fillRect(0,0,t.width,.5),r.fillRect(0,this.theme.SIZES.TIMELINE_HEIGHT*window.devicePixelRatio,t.width,.5);const o=function(e,t){const n=function(e,t){const n=200*e[0]+e[6];return n>1?Math.round(n):Math.round(10*n)/10}(t)-e.left;let i=Math.pow(10,Math.floor(Math.log10(n)));n/i>5?i*=5:n/i>2&&(i*=2);const r=[];let o=Math.ceil(e.left/i)*i;for(;o<=e.right;)r.push(o),o+=i;return r}(e,i);for(let e=0;e<o.length;e++){const i=Math.round(o[e]*n[0]+n[6]),s=this.formatter(o[e]);r.fillStyle=this.theme.COLORS.LABEL_FONT_COLOR,r.fillText(s,i-M(s,r).width-this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio,this.theme.SIZES.LABEL_FONT_PADDING*window.devicePixelRatio),r.strokeStyle=this.theme.COLORS.GRID_LINE_COLOR,r.lineWidth=this.theme.SIZES.GRID_LINE_WIDTH,r.strokeRect(i-.5,t.y,.5,t.height)}}}class Et{constructor(e){(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"context",void 0),this.canvas=e,this.context=T(e,"2d")}draw(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.context;const r=e.transformRect(n),o=r.withWidth(r.width-t.BORDER_WIDTH).withHeight(r.height-t.BORDER_WIDTH).translate(r.x+t.BORDER_WIDTH/2,r.y+t.BORDER_WIDTH/2);i.beginPath(),i.strokeStyle=t.BORDER_COLOR,i.lineWidth=t.BORDER_WIDTH,i.strokeRect(o.x,o.y,o.width,o.height)}}class _t{constructor(e,t,n){(0,f.Z)(this,"textCache",{}),(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"context",void 0),(0,f.Z)(this,"theme",void 0),(0,f.Z)(this,"flamegraph",void 0),this.canvas=e,this.theme=n,this.flamegraph=t,this.context=T(e,"2d"),Z(e)}measureAndCacheText(e){return this.textCache[e]||(this.textCache[e]=this.context.measureText(e).width),this.textCache[e]}maybeInvalidateCache(){const e="Who knows if this changed, font-display: swap wont tell me";if(void 0===this.textCache[e])return void this.measureAndCacheText(e);const t=this.context.measureText(e).width;t!==this.textCache[e]&&(this.textCache={[e]:t})}draw(e,t){this.maybeInvalidateCache(),this.context.font=`${this.theme.SIZES.BAR_FONT_SIZE*window.devicePixelRatio}px ${this.theme.FONTS.FRAME_FONT}`,this.context.textBaseline="alphabetic",this.context.fillStyle=this.theme.COLORS.LABEL_FONT_COLOR;const n=this.measureAndCacheText("…"),i=2*this.theme.SIZES.BAR_PADDING*window.devicePixelRatio,r=i/2,o=(this.theme.SIZES.BAR_HEIGHT-this.theme.SIZES.BAR_FONT_SIZE/2)*window.devicePixelRatio,s=[...this.flamegraph.roots];for(;s.length;){const a=s.pop();if(a.end<e.left||a.start>e.right)continue;const l=Math.max(a.start,e.left),c=Math.min(a.end,e.right),h=(c-l)*t[0]+t[3],d=(c-l)*t[1]+t[4],u=[l*t[0]+a.depth*t[3]+t[6]+(h<0?h:0),l*t[1]+a.depth*t[4]+t[7]+(d<0?d:0),h,d],f=u[2]-i;if(f<=n)continue;const p=u[1]+o,g=u[0]+r;this.context.fillText(L(a.frame.name,F({low:0,high:f},(e=>this.measureAndCacheText(a.frame.name.substring(0,e))),f)[0]),g,p);for(let e=0;e<a.children.length;e++)s.push(a.children[e])}}}var St=n("./app/utils/usePrevious.tsx");function Rt(e){let{bounds:t,flamegraphCanvas:n,cursor:i,flamegraphView:o,children:s}=e;const l=(0,r.useRef)(null),c=Ce(),h=a.kK(a.Ue(),i,o.fromConfigView(n.physicalSpace)),d=function(e,t){const n={left:e[0]+6,right:void 0,top:e[1]+6,bottom:void 0};return e[0]>t.width/2&&(n.left=void 0,n.right=t.width-e[0]),n}(a.kK(a.Ue(),h,n.physicalToLogicalSpace),t);return(0,D.tZ)(It,{ref:l,style:{...d,fontSize:c.SIZES.TOOLTIP_FONT_SIZE,fontFamily:c.FONTS.FONT,zIndex:ge.ZP.zIndex.tooltip,maxWidth:t.width},children:s})}Rt.displayName="BoundTooltip";const It=(0,i.Z)("div",{target:"emr26rc0"})("background:",(e=>e.theme.background),";position:absolute;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;pointer-events:none;user-select:none;border-radius:",(e=>e.theme.borderRadius),";padding:",(0,ce.Z)(.25)," ",(0,ce.Z)(1),";border:1px solid ",(e=>e.theme.border),";"),Zt=["by symbol name","by system / application","by library","by recursion"],Ot=["top down","bottom up"],At=["left heavy","call order"],Tt=["standalone","transaction"];function Mt(e){var t,n,i,o,s,a;const[l,c]=Y();return e.contextMenu.open?(0,D.BX)(r.Fragment,{children:[(0,D.tZ)(ze,{onClick:()=>e.contextMenu.setOpen(!1)}),(0,D.BX)(Me,{...e.contextMenu.getMenuProps(),style:{position:"absolute",left:null!==(t=null===(n=e.contextMenu.position)||void 0===n?void 0:n.left)&&void 0!==t?t:-9999,top:null!==(i=null===(o=e.contextMenu.position)||void 0===o?void 0:o.top)&&void 0!==i?i:-9999,maxHeight:null!==(s=null===(a=e.contextMenu.containerCoordinates)||void 0===a?void 0:a.height)&&void 0!==s?s:"auto"},children:[(0,D.BX)(Ve,{children:[(0,D.tZ)(Ue,{children:(0,d.t)("Color Coding")}),Zt.map(((t,n)=>(0,D.tZ)(Le,{...e.contextMenu.getMenuItemProps(),onClick:()=>c({type:"set color coding",payload:t}),checked:l.colorCoding===t,children:t},n)))]}),(0,D.BX)(Ve,{children:[(0,D.tZ)(Ue,{children:(0,d.t)("View")}),Ot.map(((t,n)=>(0,D.tZ)(Le,{...e.contextMenu.getMenuItemProps(),onClick:()=>c({type:"set view",payload:t}),checked:l.view===t,children:t},n)))]}),(0,D.BX)(Ve,{children:[(0,D.tZ)(Ue,{children:(0,d.t)("Sorting")}),At.map(((t,n)=>(0,D.tZ)(Le,{...e.contextMenu.getMenuItemProps(),onClick:()=>c({type:"set sorting",payload:t}),checked:l.sorting===t,children:t},n)))]}),(0,D.BX)(Ve,{children:[(0,D.tZ)(Ue,{children:(0,d.t)("X Axis")}),Tt.map(((t,n)=>(0,D.tZ)(Le,{...e.contextMenu.getMenuItemProps(),onClick:()=>c({type:"set xAxis",payload:t}),checked:l.xAxis===t,children:t},n)))]})]})]}):null}function Ft(e,t){return`(${Math.round(e.totalWeight/t.profile.duration*100)}%)`}function kt(e){var t;let{canvasPoolManager:n,canvasBounds:i,flamegraph:o,flamegraphCanvas:s,flamegraphCanvasRef:l,flamegraphOverlayCanvasRef:c,flamegraphView:h,setFlamegraphCanvasRef:d,setFlamegraphOverlayCanvasRef:u}=e;const f=Ce(),[g,m]=(0,r.useState)(null),[v,{previousState:w,nextState:y}]=B(),x=(0,r.useMemo)((()=>new yt),[]),[b,C]=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphState called outside of FlamegraphStateProvider");return e}(),[E,_]=(0,r.useState)(null),[S,R]=(0,r.useState)(null),I=(0,r.useMemo)((()=>l?new bt(l,o,f,{draw_border:!0}):null),[o,l,f]),Z=(0,r.useMemo)((()=>c?new _t(c,o,f):null),[o,c,f]),O=(0,r.useMemo)((()=>c?new Ct(c,f,o.formatter):null),[c,o,f]),T=(0,r.useMemo)((()=>c?new Et(c):null),[c]),M=(0,r.useMemo)((()=>S&&I?I.getHoveredNode(S):null),[S,I]);(0,r.useEffect)((()=>{const e=e=>{if(h&&"z"===e.key&&e.metaKey){const r=e.shiftKey?"redo":"undo";if("undo"===r){var t;const e=null==w||null===(t=w.position)||void 0===t?void 0:t.view;null!=e&&e.isEmpty()?n.dispatch("resetZoom",[]):!e||null!=e&&e.equals(h.configView)||n.dispatch("setConfigView",[e.withHeight(h.configView.height)])}if("redo"===r){var i;const e=null==y||null===(i=y.position)||void 0===i?void 0:i.view;e&&!e.equals(h.configView)&&n.dispatch("setConfigView",[e.withHeight(h.configView.height)])}C({type:r})}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[n,C,y,w,h]);const F=(0,St.Z)(g),L=(0,r.useRef)(null);(0,r.useEffect)((()=>{h&&(null===F&&g?L.current=h.configView.clone():L.current&&!L.current.equals(h.configView)&&v({type:"checkpoint",payload:h.configView.clone()}))}),[v,g,F,h]),(0,r.useEffect)((()=>{if(!s||!h||!I)return;const e=()=>{I.draw(h.fromConfigView(s.physicalSpace),b.search.results)};return x.registerBeforeFrameCallback(e),x.draw(),()=>{x.unregisterBeforeFrameCallback(e)}}),[s,I,b.search.results,x,h]),(0,r.useEffect)((()=>{if(!(s&&h&&Z&&O&&T))return;const e=()=>{Z.context.clearRect(0,0,Z.canvas.width,Z.canvas.height)},t=()=>{b.profiles.selectedNode&&T.draw(new A(b.profiles.selectedNode.start,b.profiles.selectedNode.depth,b.profiles.selectedNode.end-b.profiles.selectedNode.start,1),{BORDER_COLOR:f.COLORS.SELECTED_FRAME_BORDER_COLOR,BORDER_WIDTH:f.SIZES.FRAME_BORDER_WIDTH},h.fromConfigView(s.physicalSpace)),M&&b.profiles.selectedNode!==M&&T.draw(new A(M.start,M.depth,M.end-M.start,1),{BORDER_COLOR:f.COLORS.HOVERED_FRAME_BORDER_COLOR,BORDER_WIDTH:f.SIZES.HOVERED_FRAME_BORDER_WIDTH},h.fromConfigView(s.physicalSpace))},n=()=>{Z.draw(h.configView,h.fromConfigView(s.physicalSpace))},i=()=>{O.draw(h.configView,s.physicalSpace,h.fromConfigView(s.physicalSpace),h.toConfigView(s.logicalSpace))};return x.registerBeforeFrameCallback(e),x.registerBeforeFrameCallback(t),x.registerAfterFrameCallback(n),x.registerAfterFrameCallback(i),x.draw(),()=>{x.unregisterBeforeFrameCallback(e),x.unregisterBeforeFrameCallback(t),x.unregisterAfterFrameCallback(n),x.unregisterAfterFrameCallback(i)}}),[s,h,x,o,f,Z,O,b.profiles.selectedNode,M,T]),(0,r.useEffect)((()=>{if(!s||!h)return;const e=()=>{R(null)},t=()=>{R(null)};return x.on("resetZoom",e),x.on("zoomIntoFrame",t),()=>{x.off("resetZoom",e),x.off("zoomIntoFrame",t)}}),[s,n,C,x,h]),(0,r.useEffect)((()=>(n.registerScheduler(x),()=>n.unregisterScheduler(x))),[n,x]);const P=(0,r.useCallback)((e=>{const t=a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=a.bA(a.Ue(),t,window.devicePixelRatio);m("click"),_(n)}),[]),N=(0,r.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),!S)return m(null),void _(null);"click"===g&&(M&&b.profiles.selectedNode&&M===b.profiles.selectedNode&&n.dispatch("zoomIntoFrame",[M]),n.dispatch("selectedNode",[M]),C({type:"set selected node",payload:M})),m(null),_(null)}),[S,b.profiles.selectedNode,C,M,n,g]),H=(0,r.useCallback)((e=>{if(!s||!h||!E)return;const t=a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),i=a.bA(a.Ue(),t,window.devicePixelRatio),r=a.$X(a.Ue(),E,i);if(0===r[0]&&0===r[1])return;const o=p.U_(p.Ue(),h.fromConfigView(s.physicalSpace)),[l,c,d,u,f,g]=o,m=a.kK(a.Ue(),r,[l,c,d,u,f,g,0,0,0]);n.dispatch("transformConfigView",[p.vc(p.Ue(),m)]),_(i)}),[s,h,E,n]),V=(0,r.useCallback)((e=>{if(!s||!h)return;const t=h.getConfigViewCursor(a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),s);R(t),E?(H(e),m("pan")):m(null)}),[s,h,R,H,E]),U=(0,r.useCallback)((()=>{R(null),_(null),m(null)}),[]),z=(0,r.useCallback)((e=>{if(!s||!h)return;const t=p.yR(p.Ue()),i=1-.01*e.deltaY*-1,r=h.getConfigViewCursor(a.al(e.offsetX,e.offsetY),s),o=a.al(r[0],h.configView.y),l=a.Jp(a.Ue(),a.al(-1,-1),o),c=p.Iu(p.Ue(),t,o),d=p.bA(p.Ue(),c,a.al(i,1)),u=p.Iu(p.Ue(),d,l);n.dispatch("transformConfigView",[u])}),[s,h,n]),X=(0,r.useCallback)((e=>{if(!s||!h)return;const t=a.al(e.deltaX,e.deltaY),i=p.U_(p.Ue(),h.fromConfigView(s.physicalSpace)),[r,o,l,c,d,u]=i,f=a.kK(a.Ue(),t,[r,o,l,c,d,u,0,0,0]),g=p.vc(p.Ue(),f);n.dispatch("transformConfigView",[g])}),[s,h,n]);(0,r.useEffect)((()=>{if(!l)return;let e;function t(t){window.clearTimeout(e),e=window.setTimeout((()=>{m(null)}),300),t.preventDefault(),R(null),t.metaKey?(z(t),m("zoom")):(X(t),m("scroll"))}return l.addEventListener("wheel",t),()=>{window.clearTimeout(e),l.removeEventListener("wheel",t)}}),[l,z,X]);const K=Ee({container:l});return(0,D.BX)(r.Fragment,{children:[(0,D.BX)(Bt,{children:[(0,D.tZ)(Dt,{ref:e=>d(e),onMouseDown:P,onMouseUp:N,onMouseMove:V,onMouseLeave:U,onContextMenu:K.handleContextMenu,style:{cursor:"pan"===g?"grab":"default"}}),(0,D.tZ)(Dt,{ref:e=>u(e),style:{pointerEvents:"none"}}),(0,D.tZ)(Mt,{contextMenu:K}),s&&I&&h&&S&&null!=M&&null!==(t=M.frame)&&void 0!==t&&t.name?(0,D.BX)(Rt,{bounds:i,cursor:S,flamegraphCanvas:s,flamegraphView:h,children:[(0,D.BX)(Pt,{children:[(0,D.tZ)(Nt,{backgroundColor:k(M,I)}),I.flamegraph.formatter(M.node.totalWeight)," ",Ft(M.node,I.flamegraph)," ",M.frame.name]}),(0,D.BX)(Lt,{children:[I.flamegraph.timelineFormatter(M.start)," "," — ",I.flamegraph.timelineFormatter(M.end)]})]}):null]}),I?(0,D.tZ)(ft,{canvasPoolManager:n,flamegraphRenderer:I}):null]})}kt.displayName="FlamegraphZoomView";const Lt=(0,i.Z)("div",{target:"e1k891b74"})("color:",(e=>e.theme.subText),";"),Pt=(0,i.Z)("div",{target:"e1k891b73"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),Nt=(0,i.Z)("div",{target:"e1k891b72"})("width:12px;height:12px;min-width:12px;min-height:12px;border-radius:2px;display:inline-block;background-color:",(e=>e.backgroundColor),";margin-right:",(0,ce.Z)(1),";"),Bt=(0,i.Z)("div",{target:"e1k891b71"})({name:"1e6ma8a",styles:"display:flex;flex-direction:column;height:100%;position:relative"}),Dt=(0,i.Z)("canvas",{target:"e1k891b70"})({name:"yfg64d",styles:"left:0;top:0;width:100%;height:100%;user-select:none;position:absolute"});class Ht{constructor(e,t){(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"context",void 0),(0,f.Z)(this,"theme",void 0),this.canvas=e,this.theme=t,this.context=T(this.canvas,"2d")}draw(e,t,n){if(e.equals(t))return;const i=A.From(e).transformRect(n),r=A.From(t).transformRect(n),o=[i.x-this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH,i.y,i.width+this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH,i.height];this.context.fillStyle=this.theme.COLORS.MINIMAP_POSITION_OVERLAY_COLOR,this.context.strokeStyle=this.theme.COLORS.MINIMAP_POSITION_OVERLAY_BORDER_COLOR,this.context.lineWidth=this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH,this.context.beginPath(),this.context.rect(0,0,r.width,r.height),this.context.rect(...o),this.context.fill("evenodd"),this.context.strokeRect(...o)}}function Vt(e){let{canvasPoolManager:t,flamegraph:n,flamegraphMiniMapCanvas:i,flamegraphMiniMapCanvasRef:o,flamegraphMiniMapOverlayCanvasRef:s,flamegraphMiniMapView:l,setFlamegraphMiniMapCanvasRef:c,setFlamegraphMiniMapOverlayCanvasRef:h}=e;const d=Ce(),[u,f]=(0,r.useState)(null),[g]=B(),[m,v]=(0,r.useState)(null),w=(0,r.useMemo)((()=>new yt),[]),y=(0,r.useMemo)((()=>{if(!o)return null;const e=d.SIZES.MINIMAP_HEIGHT/(n.depth+d.SIZES.FLAMEGRAPH_DEPTH_OFFSET);return new bt(o,n,{...d,SIZES:{...d.SIZES,BAR_HEIGHT:e}})}),[n,o,d]),x=(0,r.useMemo)((()=>s?new Ht(s,d):null),[s,d]);(0,r.useEffect)((()=>{if(!i||!l||!y)return;const e=()=>{y.draw(l.fromConfigSpace(i.physicalSpace))};return w.registerBeforeFrameCallback(e),()=>{w.unregisterBeforeFrameCallback(e)}}),[i,y,w,l]),(0,r.useEffect)((()=>{if(!i||!l||!x)return;const e=()=>{x.context.clearRect(0,0,x.canvas.width,x.canvas.height)},t=()=>{x.draw(l.configView,l.configSpace,l.fromConfigSpace(i.physicalSpace))};return w.registerBeforeFrameCallback(e),w.registerAfterFrameCallback(t),w.draw(),()=>{w.unregisterBeforeFrameCallback(e),w.unregisterAfterFrameCallback(t)}}),[i,l,w,x]);const b=(0,St.Z)(u),C=(0,r.useRef)(null);(0,r.useEffect)((()=>{l&&(null===b&&u?C.current=l.configView.clone():C.current&&!C.current.equals(l.configView)&&g({type:"checkpoint",payload:l.configView.clone()}))}),[u,l,g,b]);const[E,_]=(0,r.useState)(null),[S,R]=(0,r.useState)(null);(0,r.useEffect)((()=>(t.registerScheduler(w),()=>t.unregisterScheduler(w))),[w,t]);const I=(0,r.useCallback)((e=>{if(!S||!i||!l)return;const n=a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),r=a.bA(a.Ue(),n,window.devicePixelRatio),o=a.$X(a.Ue(),r,S);if(0===o[0]&&0===o[1])return;const s=p.U_(p.Ue(),l.fromConfigSpace(i.physicalSpace)),c=a.kK(a.Ue(),o,s);t.dispatch("transformConfigView",[p.vc(p.Ue(),c)]),R(r)}),[i,l,S,t]),Z=(0,r.useCallback)((e=>{if(!i||!l)return;const n=l.getConfigSpaceCursor(a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),i);if(v(n),S)return I(e),void f("pan");if(E){const e=a.VV(a.Ue(),E,n),i=a.Fp(a.Ue(),E,n),r=new A(e[0],n[1]-l.configView.height/2,i[0]-e[0],l.configView.height);return t.dispatch("setConfigView",[r]),void f("select")}f(null)}),[i,l,t,S,I,E]),O=(0,r.useCallback)((e=>{if(i&&l){const n=a.al(.8*e.deltaX,e.deltaY),r=p.U_(p.Ue(),l.fromConfigView(i.physicalSpace)),[o,s,c,h,d,u]=r,f=a.kK(a.Ue(),n,[o,s,c,h,d,u,0,0,0]),g=p.vc(p.Ue(),f);t.dispatch("transformConfigView",[g])}}),[i,l,t]),T=(0,r.useCallback)((e=>{if(!i||!l)return;const n=p.yR(p.Ue()),r=1-.001*e.deltaY*-1,o=l.getConfigSpaceCursor(a.al(e.offsetX,e.offsetY),i),s=a.al(o[0],l.configView.y),c=a.Jp(a.Ue(),a.al(-1,-1),s),h=p.Iu(p.Ue(),n,s),d=p.bA(p.Ue(),h,a.al(r,1)),u=p.Iu(p.Ue(),d,c);t.dispatch("transformConfigView",[u])}),[i,l,t]),M=(0,r.useCallback)((e=>{if(!(m&&i&&l&&t))return;const n=a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),r=a.bA(a.Ue(),n,window.devicePixelRatio);if(l.configView.contains(m))R(r);else{const t=l.getConfigSpaceCursor(a.al(e.nativeEvent.offsetX,e.nativeEvent.offsetY),i);_(t)}f("select")}),[m,i,l,t]),F=(0,r.useCallback)((()=>{v(null),_(null),R(null),f(null)}),[]);return(0,r.useEffect)((()=>{if(!o)return;let e;function t(t){window.clearTimeout(e),e=window.setTimeout((()=>{f(null)}),300),t.preventDefault(),v(null),t.metaKey?(T(t),f("zoom")):(O(t),f("scroll"))}return o.addEventListener("wheel",t),()=>{window.clearTimeout(e),o.removeEventListener("wheel",t)}}),[o,T,O]),(0,r.useEffect)((()=>(window.addEventListener("mouseup",F),()=>{window.removeEventListener("mouseup",F)})),[F]),(0,r.useEffect)((()=>{if(!o)return;const e=e=>{e.preventDefault(),e.metaKey?T(e):O(e)};return o.addEventListener("wheel",e),()=>null==o?void 0:o.removeEventListener("wheel",e)}),[o,O,T]),(0,D.BX)(r.Fragment,{children:[(0,D.tZ)(Ut,{ref:e=>c(e),onMouseDown:M,onMouseMove:Z,onMouseLeave:F,cursor:m&&null!=l&&l.configView.contains(m)?"grab":"col-resize"}),(0,D.tZ)(zt,{ref:e=>h(e)})]})}Vt.displayName="FlamegraphZoomViewMinimap";const Ut=(0,i.Z)("canvas",{target:"eakt0gn1"})("width:100%;height:100%;position:absolute;left:0;top:0;cursor:",(e=>{var t;return null!==(t=e.cursor)&&void 0!==t?t:"default"}),";user-select:none;"),zt=(0,i.Z)(Ut,{target:"eakt0gn0"})({name:"je8g23",styles:"pointer-events:none"});var Xt=n("./app/utils/profiling/profile/importProfile.tsx");function Kt(e){let{onImport:t,children:n}=e;const[i,o]=(0,r.useState)("idle"),[s,a]=(0,r.useState)(null),l=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const n=e.dataTransfer.items[0].getAsFile();n&&(o("processing"),(0,Xt.T)(n).then((e=>{o("idle"),a(null),t(e)})).catch((e=>{o("idle"),a(e.message)})))}),[t]),c=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),o("dragover")}),[]),h=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),o("idle")}),[]),u=(0,r.useCallback)((e=>{e.preventDefault()}),[]);return(0,D.BX)(Gt,{onDragEnter:c,children:["idle"===i?null:(0,D.BX)(jt,{onDrop:l,onDragOver:u,onDragLeave:h,children:[(0,d.t)("Drop here"),(0,D.tZ)("p",{children:s})]}),n]})}Kt.displayName="ProfileDragDropImport";const Gt=(0,i.Z)("div",{target:"etzd2mc1"})({name:"1g8mdzl",styles:"display:flex;flex-direction:column;flex:1 1 100%"}),jt=(0,i.Z)("div",{target:"etzd2mc0"})("position:absolute;left:0;top:0;width:100%;height:100%;display:grid;grid:auto/50%;place-content:center;z-index:",(e=>e.theme.zIndex.modal),";text-align:center;");var Wt=n("./app/components/forms/compactSelect.tsx"),Yt=n("./app/utils.tsx"),qt=n("./app/utils/profiling/units/units.ts");function $t(e){let{threadId:t,onThreadIdChange:n,profileGroup:i}=e;const o=(0,r.useMemo)((()=>[...i.profiles].sort(Jt).map((e=>({label:e.name?`tid (${e.threadId}): ${e.name}`:`tid (${e.threadId})`,value:e.threadId,details:(0,D.tZ)(Qt,{duration:(0,qt.s4)(e.unit)(e.duration),samples:e.samples.length})})))),[i]),s=(0,r.useCallback)((e=>{(0,Yt.ri)(e)&&n(e.value)}),[n]);return(0,D.tZ)(Wt.Z,{triggerProps:{icon:(0,D.tZ)(h.Zd,{size:"xs"}),size:"xsmall"},options:o,value:t,onChange:s,isSearchable:!0})}function Qt(e){return(0,D.BX)(en,{children:[(0,D.tZ)("div",{children:e.duration}),(0,D.tZ)("div",{children:(0,d.tn)("%s sample","%s samples",e.samples)})]})}function Jt(e,t){return t.duration?e.duration?e.name.startsWith("(tid")&&t.name.startsWith("(tid")||e.name.startsWith("(tid")||t.name.startsWith("(tid")||e.name.includes("main")?-1:t.name.includes("main")?1:e.name>t.name?-1:1:1:-1}$t.displayName="ThreadMenuSelector",Qt.displayName="ThreadLabelDetails";const en=(0,i.Z)("div",{target:"esj78ii0"})("display:flex;flex-direction:row;justify-content:space-between;gap:",(0,ce.Z)(1),";");var tn=n("./app/utils/profiling/profile/profile.tsx");class nn{static Empty(){return new nn(tn.N.Empty(),0,{inverted:!1,leftHeavy:!1})}static From(e,t){let{inverted:n=!1,leftHeavy:i=!1}=t;return new nn(e.profile,e.profileIndex,{inverted:n,leftHeavy:i})}constructor(e,t){let{inverted:n=!1,leftHeavy:i=!1,configSpace:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,f.Z)(this,"profile",void 0),(0,f.Z)(this,"frames",[]),(0,f.Z)(this,"roots",[]),(0,f.Z)(this,"profileIndex",void 0),(0,f.Z)(this,"inverted",!1),(0,f.Z)(this,"leftHeavy",!1),(0,f.Z)(this,"depth",0),(0,f.Z)(this,"configSpace",new A(0,0,0,0)),(0,f.Z)(this,"formatter",void 0),(0,f.Z)(this,"timelineFormatter",void 0),(0,f.Z)(this,"frameIndex",{}),this.inverted=n,this.leftHeavy=i,this.profile=e,this.profileIndex=t,this.roots=[],this.frames=i?this.buildLeftHeavyGraph(e,r?r.x:0):this.buildCallOrderGraph(e,r?r.x:0),this.formatter=(0,qt.s4)(e.unit),this.timelineFormatter=(0,qt.ab)(e.unit),this.configSpace=new A(0,0,"microseconds"===this.profile.unit?1e6:"milliseconds"===this.profile.unit?1e3:1,this.depth),this.profile.duration&&(this.configSpace=new A(r?r.x:this.profile.startedAt,0,r?r.width:this.profile.duration,this.depth))}buildCallOrderGraph(e,t){const n=[],i=[];let r=0;return e.forEach(((e,n)=>{const o=(0,Yt.SI)(i),s={key:r,frame:e.frame,node:e,parent:o,children:[],depth:0,start:t+n,end:t+n};o&&o.children.push(s),i.push(s),1===i.length&&this.roots.push(s),r++}),((e,r)=>{const o=i.pop();if(!o)throw new Error("Unbalanced stack");o.end=t+r,o.depth=i.length,o.end-o.start!=0&&(n.unshift(o),this.depth=Math.max(o.depth,this.depth))})),n}buildLeftHeavyGraph(e,t){const n=[],i=[],r=e=>{e.children.sort(((e,t)=>-(e.totalWeight-t.totalWeight))),e.children.forEach((e=>r(e)))};r(e.appendOrderTree);let o=0;const s=(e,n)=>{const r=(0,Yt.SI)(i),s={key:o,frame:e.frame,node:e,parent:r,children:[],depth:0,start:t+n,end:t+n};r&&r.children.push(s),i.push(s),1===i.length&&this.roots.push(s),o++},a=(e,r)=>{const o=i.pop();if(!o)throw new Error("Unbalanced stack");o.end=t+r,o.depth=i.length,o.end-o.start!=0&&(n.unshift(o),this.depth=Math.max(o.depth,this.depth))};return function e(t,n){t.frame.isRoot()||s(t,n);let i=0;t.children.forEach((t=>{e(t,n+i),i+=t.totalWeight})),t.frame.isRoot()||a(0,n+t.totalWeight)}(e.appendOrderTree,0),n}setConfigSpace(e){return this.configSpace=e,this}}class rn{constructor(e,t){(0,f.Z)(this,"canvas",void 0),(0,f.Z)(this,"origin",void 0),(0,f.Z)(this,"physicalSpace",A.Empty()),(0,f.Z)(this,"logicalSpace",A.Empty()),(0,f.Z)(this,"physicalToLogicalSpace",p.Ue()),(0,f.Z)(this,"logicalToPhysicalSpace",p.Ue()),this.canvas=e,this.origin=t,this.initPhysicalSpace()}initPhysicalSpace(){this.physicalSpace=new A(this.origin[0],this.origin[1],this.canvas.width-this.origin[0],this.canvas.height-this.origin[1]),this.logicalSpace=this.physicalSpace.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),this.logicalToPhysicalSpace=O(this.logicalSpace,this.physicalSpace),this.physicalToLogicalSpace=O(this.physicalSpace,this.logicalSpace)}}class on{constructor(e){let{canvas:t,flamegraph:n,theme:i}=e;(0,f.Z)(this,"flamegraph",void 0),(0,f.Z)(this,"theme",void 0),(0,f.Z)(this,"configView",A.Empty()),(0,f.Z)(this,"configSpace",A.Empty()),this.flamegraph=n,this.theme=i,this.initConfigSpace(t)}_initConfigSpace(e){const t=this.theme.SIZES.BAR_HEIGHT*window.devicePixelRatio;this.configSpace=new A(0,0,this.flamegraph.configSpace.width,Math.max(this.flamegraph.depth+this.theme.SIZES.FLAMEGRAPH_DEPTH_OFFSET+1,e.physicalSpace.height/t))}_initConfigView(e,t){const n=this.theme.SIZES.BAR_HEIGHT*window.devicePixelRatio;this.configView=A.From(t).withHeight(e.physicalSpace.height/n)}initConfigSpace(e){this._initConfigSpace(e),this._initConfigView(e,this.configSpace)}resizeConfigSpace(e){this._initConfigSpace(e),this._initConfigView(e,this.configView)}resetConfigView(e){this._initConfigView(e,this.configSpace)}setConfigView(e){this.configView=function(e,t){let{width:n,height:i}=t;if(!e.isValid())throw new Error(e.toString());const r=v(e.width,n.min,n.max),o=v(e.height,i.min,i.max),s=n.max-r,a=o>=i.max?0:i.max-o,l=v(e.x,0,s),c=v(e.y,0,a);return new A(l,c,r,o)}(e,{width:{min:this.flamegraph.profile.minFrameDuration,max:this.configSpace.width},height:{min:0,max:this.configSpace.height}})}transformConfigView(e){this.setConfigView(this.configView.transformRect(e))}toConfigSpace(e){const t=O(e,this.configSpace);return this.flamegraph.inverted&&p.Jp(t,this.configSpace.invertYTransform(),t),t}toConfigView(e){const t=O(e,this.configView);return this.flamegraph.inverted&&p.Jp(t,this.configView.invertYTransform(),t),t}fromConfigSpace(e){const t=O(this.configSpace,e);return this.flamegraph.inverted&&p.Jp(t,e.invertYTransform(),t),t}fromConfigView(e){const t=O(this.configView,e);return this.flamegraph.inverted&&p.Jp(t,e.invertYTransform(),t),t}getConfigSpaceCursor(e,t){const n=a.kK(a.Ue(),e,t.logicalToPhysicalSpace);return a.kK(a.Ue(),n,this.toConfigSpace(t.physicalSpace))}getConfigViewCursor(e,t){const n=a.kK(a.Ue(),e,t.logicalToPhysicalSpace);return a.kK(a.Ue(),n,this.toConfigView(t.physicalSpace))}}function sn(e){const t=Math.min(...e.map((e=>e.startedAt))),n=Math.max(...e.map((e=>e.endedAt)));return new A(t,0,n-t,0)}function an(e){const t=function(){const[e,t]=(0,r.useState)(window.devicePixelRatio),n=(0,r.useCallback)((()=>{t(window.devicePixelRatio)}),[]);return(0,r.useLayoutEffect)((()=>(window.matchMedia(`(resolution: ${e}dppx)`).addEventListener("change",n,{once:!0}),()=>{window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).removeEventListener("change",n)})),[e,n]),e}(),n=Ce(),[{sorting:i,view:o,xAxis:s},l]=Y(),[{threadId:c},h]=function(){const e=(0,r.useContext)(G);if(null===e)throw new Error("useFlamegraphProfiles called outside of FlamegraphStateProvider");return[e[0].profiles,e[1]]}(),d=(0,r.useRef)(A.Empty()),[u,f]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[m,v]=(0,r.useState)(null),[w,y]=(0,r.useState)(null),x=(0,r.useMemo)((()=>new xt),[]),b=(0,r.useMemo)((()=>new yt),[]),C=(0,r.useMemo)((()=>{if("number"!=typeof c)return nn.Empty();const t=e.profiles.profiles.find((e=>e.threadId===c));return t?new nn(t,c,{inverted:"bottom up"===o,leftHeavy:"left heavy"===i,configSpace:"transaction"===s?sn(e.profiles.profiles):void 0}):nn.Empty()}),[e.profiles,i,c,o,s]),E=(0,r.useMemo)((()=>u?new rn(u,a.al(0,n.SIZES.TIMELINE_HEIGHT*t)):null),[t,u,n]),_=(0,r.useMemo)((()=>m?new rn(m,a.al(0,0)):null),[m]),S=((e,t)=>{const[n,i]=(0,r.useState)((()=>e(null))),o=(0,St.Z)(n);return(0,_e.K)((()=>{i(e(o))}),t),n})((e=>{if(!E)return null;const t=new on({canvas:E,flamegraph:C,theme:n});return(null==e?void 0:e.flamegraph.profile)===t.flamegraph.profile&&e.flamegraph.leftHeavy===t.flamegraph.leftHeavy&&t.setConfigView(e.configView.withHeight(t.configView.height)),t}),[C,E,n]);return(0,r.useEffect)((()=>{if(!E||!S)return;const e=e=>{S.setConfigView(e),x.draw()},t=e=>{S.transformConfigView(e),x.draw()},n=()=>{S.resetConfigView(E),x.draw()},i=e=>{S.setConfigView(new A(e.start,e.depth,e.end-e.start,S.configView.height)),x.draw()};return b.on("setConfigView",e),b.on("transformConfigView",t),b.on("resetZoom",n),b.on("zoomIntoFrame",i),()=>{b.off("setConfigView",e),b.off("transformConfigView",t),b.off("resetZoom",n),b.off("zoomIntoFrame",i)}}),[x,E,S,b]),(0,r.useEffect)((()=>(x.registerScheduler(b),()=>x.unregisterScheduler(b))),[x,b]),(0,r.useLayoutEffect)((()=>{if(!(S&&E&&_&&u&&p&&m&&w))return;const e=I([u,p],(()=>{const e=u.getBoundingClientRect();d.current=new A(e.x,e.y,e.width,e.height),E.initPhysicalSpace(),S.resizeConfigSpace(E),x.drawSync()})),t=I([m,w],(()=>{_.initPhysicalSpace(),x.drawSync()}));return()=>{e.disconnect(),t.disconnect()}}),[x,E,u,_,m,w,p,S]),(0,D.BX)(r.Fragment,{children:[(0,D.BX)(he,{children:[(0,D.tZ)($t,{profileGroup:e.profiles,threadId:c,onThreadIdChange:e=>h({type:"set thread id",payload:e})}),(0,D.tZ)(ue,{view:o,sorting:i,onSortingChange:e=>{l({type:"set sorting",payload:e})},onViewChange:e=>{l({type:"set view",payload:e})}}),(0,D.tZ)(ae,{flamegraphs:[C],canvasPoolManager:x}),(0,D.tZ)(q,{canvasPoolManager:x})]}),(0,D.tZ)(ln,{height:n.SIZES.MINIMAP_HEIGHT,children:(0,D.tZ)(Vt,{canvasPoolManager:x,flamegraph:C,flamegraphMiniMapCanvas:_,flamegraphMiniMapCanvasRef:m,flamegraphMiniMapOverlayCanvasRef:w,flamegraphMiniMapView:S,setFlamegraphMiniMapCanvasRef:v,setFlamegraphMiniMapOverlayCanvasRef:y})}),(0,D.tZ)(cn,{children:(0,D.tZ)(Kt,{onImport:e.onImport,children:(0,D.tZ)(kt,{canvasBounds:d.current,canvasPoolManager:x,flamegraph:C,flamegraphCanvas:E,flamegraphCanvasRef:u,flamegraphOverlayCanvasRef:p,flamegraphView:S,setFlamegraphCanvasRef:f,setFlamegraphOverlayCanvasRef:g})})})]})}an.displayName="Flamegraph";const ln=(0,i.Z)("div",{target:"e8zoc3q1"})("position:relative;height:",(e=>e.height),"px;flex-shrink:0;"),cn=(0,i.Z)("div",{target:"e8zoc3q0"})({name:"uzvu8f",styles:"position:relative;display:flex;flex:1 1 100%"});var hn=n("./app/components/sentryDocumentTitle.tsx"),dn=n("./app/utils/useOrganization.tsx");const un={name:"Loading",traceID:"",activeProfileIndex:0,profiles:[tn.N.Empty()]};function fn(){const e=(0,P.T)(),t=(0,dn.Z)(),[n,i]=(0,N.useProfileGroup)(),a=e=>{i({type:"resolved",data:e})},l=(0,r.useMemo)((()=>{return{profiles:{threadId:"string"!=typeof(t=e.query).tid||isNaN(parseInt(t.tid,10))?null:parseInt(t.tid,10)},position:{view:null!==(n=A.decode(t.fov))&&void 0!==n?n:A.Empty()},preferences:{colorCoding:(i=t.colorCoding,["by symbol name","by system / application","by library","by recursion"].includes(i)?t.colorCoding:j.preferences.colorCoding),sorting:H(t.sorting)?t.sorting:j.preferences.sorting,view:V(t.view)?t.view:j.preferences.view,xAxis:U(t.xAxis)?t.xAxis:j.preferences.xAxis},search:{query:"string"==typeof t.query?t.query:""}};var t,n,i}),[]);return(0,D.tZ)(r.Fragment,{children:(0,D.tZ)(hn.Z,{title:(0,d.t)("Profiling — Flamegraph"),orgSlug:t.slug,children:(0,D.tZ)(W,{initialState:l,children:(0,D.BX)(be,{children:[(0,D.tZ)(K,{}),(0,D.tZ)(gn,{children:"errored"===n.type?(0,D.tZ)(o.Z,{type:"error",showIcon:!0,children:n.error}):"loading"===n.type?(0,D.BX)(r.Fragment,{children:[(0,D.tZ)(an,{onImport:a,profiles:un}),(0,D.tZ)(pn,{children:(0,D.tZ)(s.Z,{})})]}):"resolved"===n.type?(0,D.tZ)(an,{onImport:a,profiles:n.data}):null})]})})})})}fn.displayName="ProfileFlamegraph";const pn=(0,i.Z)("div",{target:"e1eqglfo1"})({name:"1sjqn6p",styles:"position:absolute;display:flex;flex-direction:column;justify-content:center;width:100%;height:100%"}),gn=(0,i.Z)("div",{target:"e1eqglfo0"})({name:"1dfu8fu",styles:"display:flex;flex-direction:column;flex:1 1 100%;~footer{display:none;}"}),mn=fn}}]);
//# sourceMappingURL=../sourcemaps/app_views_profiling_profileFlamegraph_tsx.815fbbdf70210eedc1ac1fa450b53ab3.js.map