{"version":3,"file":"chunks/app_views_profiling_profileFlamegraph_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/profiling/units/units.ts","webpack:///./app/utils/useEffectAfterFirstRender.ts","webpack:///./app/utils/usePrevious.tsx","webpack:///./app/utils/profiling/colors/utils.tsx","webpack:///./app/utils/profiling/gl/utils.ts","webpack:///./app/utils/profiling/flamegraph/useFlamegraphState.ts","webpack:///./app/utils/profiling/flamegraph/flamegraphStateProvider/index.tsx","webpack:///./app/utils/useCombinedReducer.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphProfiles.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphZoomPosition.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphPreferences.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphSearch.tsx","webpack:///./app/utils/useUndoableReducer.tsx","webpack:///./app/utils/profiling/flamegraph/useFlamegraphPreferences.ts","webpack:///./app/components/profiling/flamegraphOptionsMenu.tsx","webpack:///./app/utils/profiling/validators/regExp.tsx","webpack:///./app/components/profiling/flamegraphSearch.tsx","webpack:///./app/utils/profiling/flamegraph/useFlamegraphSearch.ts","webpack:///./app/components/profiling/flamegraphToolbar.tsx","webpack:///./app/components/profiling/flamegraphViewSelectMenu.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphTheme.tsx","webpack:///./app/utils/profiling/flamegraph/flamegraphThemeProvider.tsx","webpack:///./app/utils/profiling/flamegraph/useFlamegraphTheme.ts","webpack:///./app/utils/profiling/hooks/useContextMenu.tsx","webpack:///./app/utils/profiling/hooks/useKeyboardNavigation.tsx","webpack:///./app/utils/profiling/hooks/useVirtualizedTree/VirtualizedTreeNode.tsx","webpack:///./app/utils/profiling/hooks/useVirtualizedTree/VirtualizedTree.tsx","webpack:///./app/utils/profiling/hooks/useVirtualizedTree/useVirtualizedTree.tsx","webpack:///./app/components/profiling/ProfilingContextMenu/profilingContextMenu.tsx","webpack:///./app/components/profiling/FrameStack/frameStackContextMenu.tsx","webpack:///./app/components/profiling/FrameStack/frameStackTableRow.tsx","webpack:///./app/components/profiling/FrameStack/frameStackTable.tsx","webpack:///./app/components/profiling/FrameStack/frameStack.tsx","webpack:///./app/utils/profiling/flamegraph/useFlamegraphProfiles.tsx","webpack:///./app/utils/profiling/filterFlamegraphTree.tsx","webpack:///./app/utils/profiling/hooks/useResizableDrawer.tsx","webpack:///./app/utils/profiling/canvasScheduler.tsx","webpack:///./app/utils/profiling/renderers/flamegraphRenderer.tsx","webpack:///./app/utils/profiling/renderers/shaders.tsx","webpack:///./app/utils/profiling/renderers/gridRenderer.tsx","webpack:///./app/utils/profiling/renderers/selectedFrameRenderer.tsx","webpack:///./app/utils/profiling/renderers/textRenderer.tsx","webpack:///./app/components/profiling/boundTooltip.tsx","webpack:///./app/components/profiling/flamegraphOptionsContextMenu.tsx","webpack:///./app/components/profiling/flamegraphZoomView.tsx","webpack:///./app/utils/profiling/renderers/positionIndicatorRenderer.tsx","webpack:///./app/components/profiling/flamegraphZoomViewMinimap.tsx","webpack:///./app/components/profiling/profileDragDropImport.tsx","webpack:///./app/components/profiling/threadSelector.tsx","webpack:///./app/utils/profiling/flamegraph.ts","webpack:///./app/utils/profiling/flamegraphCanvas.tsx","webpack:///./app/utils/profiling/flamegraphView.tsx","webpack:///./app/components/profiling/flamegraph.tsx","webpack:///./app/utils/useDevicePixelRatio.tsx","webpack:///./app/utils/useMemoWithPrevious.ts","webpack:///./app/views/profiling/profileFlamegraph.tsx"],"sourcesContent":["export function relativeChange(final: number, initial: number): number {\n  return (final - initial) / initial;\n}\n\ntype Unit = 'nanoseconds' | 'microseconds' | 'milliseconds' | 'seconds';\n\nconst durationMappings: Record<Unit, number> = {\n  nanoseconds: 1e-9,\n  microseconds: 1e-6,\n  milliseconds: 1e-3,\n  seconds: 1,\n};\n\nconst format = (v: number, abbrev: string, precision: number) => {\n  return v.toFixed(precision) + abbrev;\n};\n\nexport function makeFormatter(from: Unit | string): (value: number) => string {\n  const multiplier = durationMappings[from];\n\n  if (multiplier === undefined) {\n    throw new Error(`Cannot format from unit ${from}, duration mapping is not defined`);\n  }\n\n  return (value: number) => {\n    const duration = value * multiplier;\n\n    if (duration >= 1) {\n      return format(duration, 's', 2);\n    }\n    if (duration / 1e-3 >= 1) {\n      return format(duration / 1e-3, 'ms', 2);\n    }\n    if (duration / 1e-6 >= 1) {\n      return format(duration / 1e-6, 'μs', 2);\n    }\n    return format(duration / 1e-9, 'ns', 2);\n  };\n}\n\nfunction pad(n: number, slots: number) {\n  return Math.floor(n).toString().padStart(slots, '0');\n}\n\nexport function makeTimelineFormatter(from: Unit | string) {\n  const multiplier = durationMappings[from];\n\n  if (multiplier === undefined) {\n    throw new Error(`Cannot format from unit ${from}, duration mapping is not defined`);\n  }\n\n  return (value: number) => {\n    const s = value * multiplier;\n    const m = s / 60;\n    const ms = s * 1e3;\n\n    return `${pad(m, 2)}:${pad(s % 60, 2)}.${pad(ms % 1e3, 3)}`;\n  };\n}\n","import {useEffect, useRef} from 'react';\n\nconst NOOP: [] = [];\n\nconst useEffectAfterFirstRender = (\n  cb: React.EffectCallback,\n  deps: React.DependencyList = NOOP\n): void => {\n  const firstRender = useRef<boolean>(true);\n\n  useEffect(() => {\n    if (firstRender.current) {\n      firstRender.current = false;\n      return;\n    }\n\n    cb();\n  }, deps);\n};\n\nexport {useEffectAfterFirstRender};\n","import {useEffect, useRef} from 'react';\n\n/**\n * Provides previous prop or state inside of function components.\n * It’s possible that in the future React will provide a usePrevious Hook out of the box since it’s a relatively common use case.\n * @see {@link https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state}\n *\n * @returns 'ref.current' and therefore should not be used as a dependency of useEffect.\n * Mutable values like 'ref.current' are not valid dependencies of useEffect because changing them does not re-render the component.\n */\nfunction usePrevious<T>(value: T): T {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  const ref = useRef<T>(value);\n  // Store current value in ref\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n  // Return previous value (happens before update in useEffect above)\n  return ref.current;\n}\n\nexport default usePrevious;\n","import {ColorChannels, FlamegraphTheme, LCH} from '../flamegraph/flamegraphTheme';\nimport {FlamegraphFrame} from '../flamegraphFrame';\n\nconst uniqueBy = <T,>(arr: ReadonlyArray<T>, predicate: (t: T) => unknown): Array<T> => {\n  const cb = typeof predicate === 'function' ? predicate : (o: T) => o[predicate];\n\n  return [\n    ...arr\n      .reduce((map, item) => {\n        const key = item === null || item === undefined ? item : cb(item);\n\n        if (key === undefined || key === null) {\n          return map;\n        }\n        map.has(key) || map.set(key, item);\n\n        return map;\n      }, new Map())\n      .values(),\n  ];\n};\n\n// https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\nexport const fract = (x: number): number => x - Math.floor(x);\nexport const triangle = (x: number): number => 2.0 * Math.abs(fract(x) - 0.5) - 1.0;\nexport function fromLumaChromaHue(L: number, C: number, H: number): ColorChannels {\n  const hPrime = H / 60;\n  const X = C * (1 - Math.abs((hPrime % 2) - 1));\n  const [R1, G1, B1] =\n    hPrime < 1\n      ? [C, X, 0]\n      : hPrime < 2\n      ? [X, C, 0]\n      : hPrime < 3\n      ? [0, C, X]\n      : hPrime < 4\n      ? [0, X, C]\n      : hPrime < 5\n      ? [X, 0, C]\n      : [C, 0, X];\n\n  const m = L - (0.3 * R1 + 0.59 * G1 + 0.11 * B1);\n\n  return [clamp(R1 + m, 0, 1), clamp(G1 + m, 0, 1), clamp(B1 + m, 0, 1.0)];\n}\n\nexport const makeStackToColor = (\n  fallback: [number, number, number, number]\n): FlamegraphTheme['COLORS']['STACK_TO_COLOR'] => {\n  return (\n    frames: ReadonlyArray<FlamegraphFrame>,\n    colorMap: FlamegraphTheme['COLORS']['COLOR_MAP'],\n    colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET']\n  ) => {\n    const colors = colorMap(frames, colorBucket);\n    const length = frames.length;\n\n    // Length * number of frames * color components\n    const colorBuffer: number[] = new Array(length * 4 * 6);\n\n    for (let index = 0; index < length; index++) {\n      const c = colors.get(frames[index].key);\n      const colorWithAlpha = c ? c.concat(1) : fallback;\n\n      for (let i = 0; i < 6; i++) {\n        const offset = index * 6 * 4 + i * 4;\n        colorBuffer[offset] = colorWithAlpha[0];\n        colorBuffer[offset + 1] = colorWithAlpha[1];\n        colorBuffer[offset + 2] = colorWithAlpha[2];\n        colorBuffer[offset + 3] = colorWithAlpha[3];\n      }\n    }\n\n    return {\n      colorBuffer,\n      colorMap: colors,\n    };\n  };\n};\n\nexport const isNumber = (input: unknown): input is number => {\n  return typeof input === 'number' && !isNaN(input);\n};\n\nexport function clamp(number: number, min?: number, max?: number): number {\n  if (!isNumber(min) && !isNumber(max)) {\n    throw new Error('Clamp requires at least a min or max parameter');\n  }\n\n  if (isNumber(min) && isNumber(max)) {\n    return number < min ? min : number > max ? max : number;\n  }\n\n  if (isNumber(max)) {\n    return number > max ? max : number;\n  }\n\n  if (isNumber(min)) {\n    return number < min ? min : number;\n  }\n\n  throw new Error('Unreachable case detected');\n}\n\nexport function toRGBAString(r: number, g: number, b: number, alpha: number): string {\n  return `rgba(${clamp(r * 255, 0, 255)}, ${clamp(g * 255, 0, 255)}, ${clamp(\n    b * 255,\n    0,\n    255\n  )}, ${alpha})`;\n}\n\nexport function defaultFrameSortKey(frame: FlamegraphFrame): string {\n  return frame.frame.name + (frame.frame.file || '');\n}\n\nfunction defaultFrameSort(a: FlamegraphFrame, b: FlamegraphFrame): number {\n  return defaultFrameSortKey(a) > defaultFrameSortKey(b) ? 1 : -1;\n}\n\nexport const makeColorBucketTheme = (lch: LCH) => {\n  return (t: number): ColorChannels => {\n    const x = triangle(30.0 * t);\n    const H = 360.0 * (0.9 * t);\n    const C = lch.C_0 + lch.C_d * x;\n    const L = lch.L_0 - lch.L_d * x;\n    return fromLumaChromaHue(L, C, H);\n  };\n};\n\nexport const makeColorMap = (\n  frames: ReadonlyArray<FlamegraphFrame>,\n  colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET'],\n  sortBy: (a: FlamegraphFrame, b: FlamegraphFrame) => number = defaultFrameSort\n): Map<FlamegraphFrame['frame']['key'], ColorChannels> => {\n  const colors = new Map<FlamegraphFrame['key'], ColorChannels>();\n\n  const sortedFrames = [...frames].sort(sortBy);\n  const length = sortedFrames.length;\n\n  for (let i = 0; i < length; i++) {\n    colors.set(\n      sortedFrames[i].key,\n      colorBucket(Math.floor((255 * i) / frames.length) / 256, sortedFrames[i].frame)\n    );\n  }\n\n  return colors;\n};\n\nexport const makeColorMapByRecursion = (\n  frames: ReadonlyArray<FlamegraphFrame>,\n  colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET']\n): Map<FlamegraphFrame['frame']['key'], ColorChannels> => {\n  const colors = new Map<FlamegraphFrame['frame']['key'], ColorChannels>();\n\n  const sortedFrames = [...frames]\n    .sort((a, b) => a.frame.name.localeCompare(b.frame.name))\n    .filter(f => f.node.isRecursive());\n\n  const colorsByName = new Map<FlamegraphFrame['frame']['key'], ColorChannels>();\n\n  for (let i = 0; i < sortedFrames.length; i++) {\n    const frame = sortedFrames[i];\n    const nameKey = frame.frame.name + frame.frame.file ?? '';\n\n    if (!colorsByName.has(nameKey)) {\n      const color = colorBucket(\n        Math.floor((255 * i) / sortedFrames.length) / 256,\n        frame.frame\n      );\n\n      colorsByName.set(nameKey, color);\n    }\n\n    colors.set(frame.key, colorsByName.get(nameKey)!);\n  }\n\n  return colors;\n};\n\nexport const makeColorMapByImage = (\n  frames: ReadonlyArray<FlamegraphFrame>,\n  colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET']\n): Map<FlamegraphFrame['frame']['key'], ColorChannels> => {\n  const colors = new Map<FlamegraphFrame['frame']['key'], ColorChannels>();\n\n  const reverseFrameToImageIndex: Record<string, FlamegraphFrame[]> = {};\n\n  const uniqueFrames = uniqueBy(frames, f => f.frame.image);\n  const sortedFrames = [...uniqueFrames].sort((a, b) =>\n    (a.frame.image ?? '') > (b.frame.image ?? '') ? 1 : -1\n  );\n\n  for (let i = 0; i < frames.length; i++) {\n    const frame = frames[i];\n    const key = frame.frame.image ?? '';\n\n    if (!reverseFrameToImageIndex[key]) {\n      reverseFrameToImageIndex[key] = [];\n    }\n    reverseFrameToImageIndex[key].push(frame);\n  }\n\n  for (let i = 0; i < sortedFrames.length; i++) {\n    const imageFrames = reverseFrameToImageIndex[sortedFrames[i]?.frame?.image ?? ''];\n\n    for (let j = 0; j < imageFrames.length; j++) {\n      colors.set(\n        imageFrames[j].key,\n        colorBucket(\n          Math.floor((255 * i) / sortedFrames.length) / 256,\n          imageFrames[j].frame\n        )\n      );\n    }\n  }\n\n  return colors;\n};\n\nexport const makeColorMapBySystemVsApplication = (\n  frames: ReadonlyArray<FlamegraphFrame>,\n  colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET']\n): Map<FlamegraphFrame['frame']['key'], ColorChannels> => {\n  const colors = new Map<FlamegraphFrame['key'], ColorChannels>();\n\n  for (let i = 0; i < frames.length; i++) {\n    const frame = frames[i];\n\n    if (frame.frame.is_application) {\n      colors.set(frame.key, colorBucket(0.7, frame.frame));\n      continue;\n    }\n\n    colors.set(frame.key, colorBucket(0.09, frame.frame));\n  }\n\n  return colors;\n};\n","import {mat3, vec2} from 'gl-matrix';\n\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\n\nimport {clamp} from '../colors/utils';\n\nexport function createShader(\n  gl: WebGLRenderingContext,\n  type: WebGLRenderingContext['VERTEX_SHADER'] | WebGLRenderingContext['FRAGMENT_SHADER'],\n  source: string\n): WebGLShader {\n  const shader = gl.createShader(type);\n  if (!shader) {\n    throw new Error('Could not create shader');\n  }\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  gl.deleteShader(shader);\n  throw new Error('Failed to compile shader');\n}\n\nexport function createProgram(\n  gl: WebGLRenderingContext,\n  vertexShader: WebGLShader,\n  fragmentShader: WebGLShader\n): WebGLProgram {\n  const program = gl.createProgram();\n  if (!program) {\n    throw new Error('Could not create program');\n  }\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  gl.deleteProgram(program);\n  throw new Error('Failed to create program');\n}\n\n// Create a projection matrix with origins at 0,0 in top left corner, scaled to width/height\nexport function makeProjectionMatrix(width: number, height: number): mat3 {\n  const projectionMatrix = mat3.create();\n\n  mat3.identity(projectionMatrix);\n  mat3.translate(projectionMatrix, projectionMatrix, vec2.fromValues(-1, 1));\n  mat3.scale(\n    projectionMatrix,\n    projectionMatrix,\n    vec2.divide(vec2.create(), vec2.fromValues(2, -2), vec2.fromValues(width, height))\n  );\n\n  return projectionMatrix;\n}\n\nconst canvasToDisplaySizeMap = new Map<HTMLCanvasElement, [number, number]>();\n\nfunction onResize(entries: ResizeObserverEntry[]) {\n  for (const entry of entries) {\n    let width;\n    let height;\n    let dpr = window.devicePixelRatio;\n    // @ts-ignore use as a progressive enhancement, some browsers don't support this yet\n    if (entry.devicePixelContentBoxSize) {\n      // NOTE: Only this path gives the correct answer\n      // The other paths are imperfect fallbacks\n      // for browsers that don't provide anyway to do this\n      // @ts-ignore\n      width = entry.devicePixelContentBoxSize[0].inlineSize;\n      // @ts-ignore\n      height = entry.devicePixelContentBoxSize[0].blockSize;\n      dpr = 1; // it's already in width and height\n    } else if (entry.contentBoxSize) {\n      if (entry.contentBoxSize[0]) {\n        width = entry.contentBoxSize[0].inlineSize;\n        height = entry.contentBoxSize[0].blockSize;\n      } else {\n        // @ts-ignore\n        width = entry.contentBoxSize.inlineSize;\n        // @ts-ignore\n        height = entry.contentBoxSize.blockSize;\n      }\n    } else {\n      width = entry.contentRect.width;\n      height = entry.contentRect.height;\n    }\n    const displayWidth = Math.round(width * dpr);\n    const displayHeight = Math.round(height * dpr);\n    canvasToDisplaySizeMap.set(entry.target as HTMLCanvasElement, [\n      displayWidth,\n      displayHeight,\n    ]);\n\n    resizeCanvasToDisplaySize(entry.target as HTMLCanvasElement);\n  }\n}\n\nexport const watchForResize = (\n  canvas: HTMLCanvasElement[],\n  callback?: () => void\n): ResizeObserver => {\n  const handler: ResizeObserverCallback = entries => {\n    onResize(entries);\n    callback?.();\n  };\n\n  for (const c of canvas) {\n    canvasToDisplaySizeMap.set(c, [c.width, c.height]);\n  }\n\n  const resizeObserver = new ResizeObserver(handler);\n\n  try {\n    // only call us of the number of device pixels changed\n    canvas.forEach(c => {\n      resizeObserver.observe(c, {box: 'device-pixel-content-box'});\n    });\n  } catch (ex) {\n    // device-pixel-content-box is not supported so fallback to this\n    canvas.forEach(c => {\n      resizeObserver.observe(c, {box: 'content-box'});\n    });\n  }\n\n  return resizeObserver;\n};\n\nexport function resizeCanvasToDisplaySize(canvas: HTMLCanvasElement): boolean {\n  // Get the size the browser is displaying the canvas in device pixels.\n  const size = canvasToDisplaySizeMap.get(canvas);\n\n  if (!size) {\n    const displayWidth = canvas.clientWidth * window.devicePixelRatio;\n    const displayHeight = canvas.clientHeight * window.devicePixelRatio;\n\n    canvas.width = displayWidth;\n    canvas.height = displayHeight;\n\n    return false;\n  }\n\n  const [displayWidth, displayHeight] = size;\n  // Check if the canvas is not the same size.\n  const needResize = canvas.width !== displayWidth || canvas.height !== displayHeight;\n\n  if (needResize) {\n    // Make the canvas the same size\n    canvas.width = displayWidth;\n    canvas.height = displayHeight;\n  }\n\n  return needResize;\n}\n\nexport const Transform = {\n  betweenRect(from: Rect, to: Rect): Rect {\n    return new Rect(to.x, to.y, to.width / from.width, to.height / from.height);\n  },\n\n  transformMatrixBetweenRect(from: Rect, to: Rect): mat3 {\n    return mat3.fromValues(\n      to.width / from.width,\n      0,\n      0,\n      0,\n      to.height / from.height,\n      0,\n      to.x - from.x * (to.width / from.width),\n      to.y - from.y * (to.height / from.height),\n      1\n    );\n  },\n};\n\nexport class Rect {\n  origin: vec2;\n  size: vec2;\n\n  constructor(x: number, y: number, width: number, height: number) {\n    this.origin = vec2.fromValues(x, y);\n    this.size = vec2.fromValues(width, height);\n  }\n\n  clone(): Rect {\n    return Rect.From(this);\n  }\n\n  isValid(): boolean {\n    return this.toMatrix().every(n => !isNaN(n));\n  }\n\n  isEmpty(): boolean {\n    return this.width === 0 && this.height === 0;\n  }\n\n  static Empty(): Rect {\n    return new Rect(0, 0, 0, 0);\n  }\n\n  static From(rect: Rect): Rect {\n    return new Rect(rect.x, rect.y, rect.width, rect.height);\n  }\n\n  get x(): number {\n    return this.origin[0];\n  }\n  get y(): number {\n    return this.origin[1];\n  }\n  get width(): number {\n    return this.size[0];\n  }\n  get height(): number {\n    return this.size[1];\n  }\n  get left(): number {\n    return this.x;\n  }\n  get right(): number {\n    return this.left + this.width;\n  }\n  get top(): number {\n    return this.y;\n  }\n  get bottom(): number {\n    return this.top + this.height;\n  }\n\n  static decode(query: string | ReadonlyArray<string> | null | undefined): Rect | null {\n    let maybeEncodedRect = query;\n\n    if (typeof query === 'string') {\n      maybeEncodedRect = query.split(',');\n    }\n\n    if (!Array.isArray(maybeEncodedRect)) {\n      return null;\n    }\n\n    if (maybeEncodedRect.length !== 4) {\n      return null;\n    }\n\n    const rect = new Rect(\n      ...(maybeEncodedRect.map(p => parseFloat(p)) as [number, number, number, number])\n    );\n\n    if (rect.isValid()) {\n      return rect;\n    }\n\n    return null;\n  }\n\n  static encode(rect: Rect): string {\n    return rect.toString();\n  }\n\n  toString() {\n    return [this.x, this.y, this.width, this.height].map(n => Math.round(n)).join(',');\n  }\n\n  toMatrix(): mat3 {\n    const {width: w, height: h, x, y} = this;\n    // it's easier to display a matrix as a 3x3 array. WebGl matrices are row first and not column first\n    // https://webglfundamentals.org/webgl/lessons/webgl-matrix-vs-math.html\n    // prettier-ignore\n    return mat3.fromValues(\n      w, 0, 0,\n      0, h, 0,\n      x, y, 1\n    )\n  }\n\n  hasIntersectionWith(other: Rect): boolean {\n    const top = Math.max(this.top, other.top);\n    const bottom = Math.max(top, Math.min(this.bottom, other.bottom));\n    if (bottom - top === 0) {\n      return false;\n    }\n\n    const left = Math.max(this.left, other.left);\n    const right = Math.max(left, Math.min(this.right, other.right));\n\n    if (right - left === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  containsX(vec: vec2): boolean {\n    return vec[0] >= this.left && vec[0] <= this.right;\n  }\n  containsY(vec: vec2): boolean {\n    return vec[1] >= this.top && vec[1] <= this.bottom;\n  }\n\n  contains(vec: vec2): boolean {\n    return this.containsX(vec) && this.containsY(vec);\n  }\n\n  containsRect(rect: Rect): boolean {\n    return this.left <= rect.left && rect.right <= this.right;\n  }\n\n  overlapsX(other: Rect): boolean {\n    return this.left <= other.right && this.right >= other.left;\n  }\n\n  overlapsY(other: Rect): boolean {\n    return this.top <= other.bottom && this.bottom >= other.top;\n  }\n\n  overlaps(other: Rect): boolean {\n    return this.overlapsX(other) && this.overlapsY(other);\n  }\n\n  transformRect(transform: mat3): Rect {\n    const x = this.x * transform[0] + this.y * transform[3] + transform[6];\n    const y = this.x * transform[1] + this.y * transform[4] + transform[7];\n    const width = this.width * transform[0] + this.height * transform[3];\n    const height = this.width * transform[1] + this.height * transform[4];\n\n    return new Rect(\n      x + (width < 0 ? width : 0),\n      y + (height < 0 ? height : 0),\n      Math.abs(width),\n      Math.abs(height)\n    );\n  }\n\n  /**\n   * Returns a transform that inverts the y axis within the rect.\n   * This causes the bottom of the rect to be the top of the rect and vice versa.\n   */\n  invertYTransform(): mat3 {\n    return mat3.fromValues(1, 0, 0, 0, -1, 0, this.x, this.y * 2 + this.height, 1);\n  }\n\n  withHeight(height: number): Rect {\n    return new Rect(this.x, this.y, this.width, height);\n  }\n\n  withWidth(width: number): Rect {\n    return new Rect(this.x, this.y, width, this.height);\n  }\n\n  withX(x: number): Rect {\n    return new Rect(x, this.y, this.width, this.height);\n  }\n\n  withY(y: number) {\n    return new Rect(this.x, y, this.width, this.height);\n  }\n\n  toBounds(): [number, number, number, number] {\n    return [this.x, this.y, this.x + this.width, this.y + this.height];\n  }\n\n  toArray(): [number, number, number, number] {\n    return [this.x, this.y, this.width, this.height];\n  }\n\n  between(to: Rect): Rect {\n    return new Rect(to.x, to.y, to.width / this.width, to.height / this.height);\n  }\n\n  translate(x: number, y: number): Rect {\n    return new Rect(x, y, this.width, this.height);\n  }\n\n  translateX(x: number): Rect {\n    return new Rect(x, this.y, this.width, this.height);\n  }\n\n  translateY(y: number): Rect {\n    return new Rect(this.x, y, this.width, this.height);\n  }\n\n  scaleX(x: number): Rect {\n    return new Rect(this.x, this.y, this.width * x, this.height);\n  }\n\n  scaleY(y: number): Rect {\n    return new Rect(this.x, this.y, this.width, this.height * y);\n  }\n\n  scale(x: number, y: number): Rect {\n    return new Rect(this.x * x, this.y * y, this.width * x, this.height * y);\n  }\n\n  scaleOriginBy(x: number, y: number): Rect {\n    return new Rect(this.x * x, this.y * y, this.width, this.height);\n  }\n\n  scaledBy(x: number, y: number): Rect {\n    return new Rect(this.x, this.y, this.width * x, this.height * y);\n  }\n\n  equals(rect: Rect): boolean {\n    if (this.x !== rect.x) {\n      return false;\n    }\n    if (this.y !== rect.y) {\n      return false;\n    }\n    if (this.width !== rect.width) {\n      return false;\n    }\n    if (this.height !== rect.height) {\n      return false;\n    }\n    return true;\n  }\n\n  notEqualTo(rect: Rect): boolean {\n    return !this.equals(rect);\n  }\n}\n\nfunction getContext(canvas: HTMLCanvasElement, context: '2d'): CanvasRenderingContext2D;\nfunction getContext(canvas: HTMLCanvasElement, context: 'webgl'): WebGLRenderingContext;\nfunction getContext(canvas: HTMLCanvasElement, context: string): RenderingContext {\n  const ctx =\n    context === 'webgl'\n      ? canvas.getContext(context, {antialias: false})\n      : canvas.getContext(context);\n  if (!ctx) {\n    throw new Error(`Could not get context ${context}`);\n  }\n  return ctx;\n}\n\n// Exporting this like this instead of writing export function for each overload as\n// it breaks the lines and makes it harder to read.\nexport {getContext};\n\nexport function measureText(string: string, ctx?: CanvasRenderingContext2D): Rect {\n  if (!string) {\n    return Rect.Empty();\n  }\n\n  const context = ctx || getContext(document.createElement('canvas'), '2d');\n  const measures = context.measureText(string);\n\n  return new Rect(\n    0,\n    0,\n    measures.width,\n    // https://stackoverflow.com/questions/1134586/how-can-you-find-the-height-of-text-on-an-html-canvas\n    measures.actualBoundingBoxAscent + measures.actualBoundingBoxDescent\n  );\n}\n\n/** Find closest min and max value to target */\nexport function findRangeBinarySearch(\n  {low, high}: {high: number; low: number},\n  fn: (val: number) => number,\n  target: number,\n  precision = 1\n): [number, number] {\n  if (target < low || target > high) {\n    throw new Error(\n      `Target has to be in range of low <= target <= high, got ${low} <= ${target} <= ${high}`\n    );\n  }\n  // eslint-disable-next-line\n  while (true) {\n    if (high - low <= precision) {\n      return [low, high];\n    }\n\n    const mid = (high + low) / 2;\n    if (fn(mid) < target) {\n      low = mid;\n    } else {\n      high = mid;\n    }\n  }\n}\n\nexport function formatColorForFrame(\n  frame: FlamegraphFrame,\n  renderer: FlamegraphRenderer\n): string {\n  const color = renderer.getColorForFrame(frame);\n  if (color.length === 4) {\n    return `rgba(${color\n      .slice(0, 3)\n      .map(n => n * 255)\n      .join(',')}, ${color[3]})`;\n  }\n\n  return `rgba(${color.map(n => n * 255).join(',')}, 1.0)`;\n}\n\nexport const ELLIPSIS = '\\u2026';\nexport function trimTextCenter(text: string, low: number) {\n  if (low >= text.length) {\n    return text;\n  }\n  const prefixLength = Math.floor(low / 2);\n  // Use 1 character less than the low value to account for ellipsis\n  // and favor displaying the prefix\n  const postfixLength = low - prefixLength - 1;\n\n  return `${text.substring(0, prefixLength)}${ELLIPSIS}${text.substring(\n    text.length - postfixLength + ELLIPSIS.length\n  )}`;\n}\n\nexport function computeClampedConfigView(\n  newConfigView: Rect,\n  {width, height}: {height: {max: number; min: number}; width: {max: number; min: number}}\n) {\n  if (!newConfigView.isValid()) {\n    throw new Error(newConfigView.toString());\n  }\n  const clampedWidth = clamp(newConfigView.width, width.min, width.max);\n  const clampedHeight = clamp(newConfigView.height, height.min, height.max);\n\n  const maxX = width.max - clampedWidth;\n  const maxY = clampedHeight >= height.max ? 0 : height.max - clampedHeight;\n\n  const clampedX = clamp(newConfigView.x, 0, maxX);\n  const clampedY = clamp(newConfigView.y, 0, maxY);\n\n  return new Rect(clampedX, clampedY, clampedWidth, clampedHeight);\n}\n","import {useContext} from 'react';\n\nimport {\n  FlamegraphStateContext,\n  FlamegraphStateContextValue,\n} from './flamegraphStateProvider';\n\nexport function useFlamegraphState(): FlamegraphStateContextValue {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphState called outside of FlamegraphStateProvider');\n  }\n\n  return context;\n}\n\nexport function useFlamegraphStateValue(): FlamegraphStateContextValue[0] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphState called outside of FlamegraphStateProvider');\n  }\n\n  return context[0];\n}\n\nexport function useDispatchFlamegraphState(): [\n  FlamegraphStateContextValue[1],\n  FlamegraphStateContextValue[2]\n] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphState called outside of FlamegraphStateProvider');\n  }\n\n  return [context[1], context[2]];\n}\n","import {createContext, useEffect} from 'react';\nimport {browserHistory} from 'react-router';\nimport {Query} from 'history';\n\nimport {DeepPartial} from 'sentry/types/utils';\nimport {Rect} from 'sentry/utils/profiling/gl/utils';\nimport {makeCombinedReducers} from 'sentry/utils/useCombinedReducer';\nimport {useLocation} from 'sentry/utils/useLocation';\nimport {\n  UndoableReducer,\n  UndoableReducerAction,\n  useUndoableReducer,\n} from 'sentry/utils/useUndoableReducer';\n\nimport {useProfileGroup} from '../../../../views/profiling/profileGroupProvider';\nimport {useFlamegraphStateValue} from '../useFlamegraphState';\n\nimport {\n  FlamegraphAxisOptions,\n  FlamegraphColorCodings,\n  flamegraphPreferencesReducer,\n  FlamegraphSorting,\n  FlamegraphViewOptions,\n} from './flamegraphPreferences';\nimport {flamegraphProfilesReducer} from './flamegraphProfiles';\nimport {flamegraphSearchReducer} from './flamegraphSearch';\nimport {flamegraphZoomPositionReducer} from './flamegraphZoomPosition';\n\n// Intersect the types so we can properly guard\ntype PossibleQuery =\n  | Query\n  | (Pick<FlamegraphState['preferences'], 'colorCoding' | 'sorting' | 'view' | 'xAxis'> &\n      Pick<FlamegraphState['search'], 'query'>);\n\nfunction isColorCoding(\n  value: PossibleQuery['colorCoding'] | FlamegraphState['preferences']['colorCoding']\n): value is FlamegraphState['preferences']['colorCoding'] {\n  const values: FlamegraphColorCodings = [\n    'by symbol name',\n    'by system / application',\n    'by library',\n    'by recursion',\n  ];\n\n  return values.includes(value as any);\n}\n\nfunction isSorting(\n  value: PossibleQuery['sorting'] | FlamegraphState['preferences']['sorting']\n): value is FlamegraphState['preferences']['sorting'] {\n  const values: FlamegraphSorting = ['left heavy', 'call order'];\n  return values.includes(value as any);\n}\n\nfunction isView(\n  value: PossibleQuery['view'] | FlamegraphState['preferences']['view']\n): value is FlamegraphState['preferences']['view'] {\n  const values: FlamegraphViewOptions = ['top down', 'bottom up'];\n  return values.includes(value as any);\n}\n\nfunction isXAxis(\n  value: PossibleQuery['xAxis'] | FlamegraphState['preferences']['xAxis']\n): value is FlamegraphState['preferences']['xAxis'] {\n  const values: FlamegraphAxisOptions = ['standalone', 'transaction'];\n  return values.includes(value as any);\n}\n\nexport function decodeFlamegraphStateFromQueryParams(\n  query: Query\n): DeepPartial<FlamegraphState> {\n  return {\n    profiles: {\n      threadId:\n        typeof query.tid === 'string' && !isNaN(parseInt(query.tid, 10))\n          ? parseInt(query.tid, 10)\n          : null,\n    },\n    position: {view: Rect.decode(query.fov) ?? Rect.Empty()},\n    preferences: {\n      colorCoding: isColorCoding(query.colorCoding)\n        ? query.colorCoding\n        : DEFAULT_FLAMEGRAPH_STATE.preferences.colorCoding,\n      sorting: isSorting(query.sorting)\n        ? query.sorting\n        : DEFAULT_FLAMEGRAPH_STATE.preferences.sorting,\n      view: isView(query.view) ? query.view : DEFAULT_FLAMEGRAPH_STATE.preferences.view,\n      xAxis: isXAxis(query.xAxis)\n        ? query.xAxis\n        : DEFAULT_FLAMEGRAPH_STATE.preferences.xAxis,\n    },\n    search: {\n      query: typeof query.query === 'string' ? query.query : '',\n    },\n  };\n}\n\nexport function encodeFlamegraphStateToQueryParams(state: FlamegraphState) {\n  return {\n    colorCoding: state.preferences.colorCoding,\n    sorting: state.preferences.sorting,\n    view: state.preferences.view,\n    xAxis: state.preferences.xAxis,\n    query: state.search.query,\n    ...(state.position.view.isEmpty()\n      ? {fov: undefined}\n      : {fov: Rect.encode(state.position.view)}),\n    ...(typeof state.profiles.threadId === 'number'\n      ? {tid: state.profiles.threadId}\n      : {}),\n  };\n}\n\nexport const combinedReducers = makeCombinedReducers({\n  profiles: flamegraphProfilesReducer,\n  position: flamegraphZoomPositionReducer,\n  preferences: flamegraphPreferencesReducer,\n  search: flamegraphSearchReducer,\n});\n\nexport type FlamegraphState = React.ReducerState<FlamegraphStateReducer>['current'];\ntype FlamegraphAction = React.Dispatch<\n  UndoableReducerAction<React.ReducerAction<FlamegraphStateReducer>>\n>;\n\ntype FlamegraphStateReducer = UndoableReducer<typeof combinedReducers>;\n\nexport function FlamegraphStateQueryParamSync() {\n  const location = useLocation();\n  const state = useFlamegraphStateValue();\n\n  useEffect(() => {\n    browserHistory.replace({\n      ...location,\n      query: {\n        ...location.query,\n        ...encodeFlamegraphStateToQueryParams(state),\n      },\n    });\n    // We only want to sync the query params when the state changes\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state]);\n\n  return null;\n}\n\nexport type FlamegraphStateContextValue = [\n  FlamegraphState,\n  FlamegraphAction,\n  {\n    nextState: FlamegraphState | undefined;\n    previousState: FlamegraphState | undefined;\n  }\n];\n\nexport const FlamegraphStateContext = createContext<FlamegraphStateContextValue | null>(\n  null\n);\ninterface FlamegraphStateProviderProps {\n  children: React.ReactNode;\n  initialState?: DeepPartial<FlamegraphState>;\n}\n\nconst DEFAULT_FLAMEGRAPH_STATE: FlamegraphState = {\n  profiles: {\n    threadId: null,\n    selectedNode: null,\n  },\n  position: {\n    view: Rect.Empty(),\n  },\n  preferences: {\n    colorCoding: 'by symbol name',\n    sorting: 'call order',\n    view: 'top down',\n    xAxis: 'standalone',\n  },\n  search: {\n    index: null,\n    results: null,\n    query: '',\n  },\n};\n\nexport function FlamegraphStateProvider(\n  props: FlamegraphStateProviderProps\n): React.ReactElement {\n  const [profileGroup] = useProfileGroup();\n  const reducer = useUndoableReducer(combinedReducers, {\n    profiles: {\n      selectedNode: null,\n      threadId:\n        props.initialState?.profiles?.threadId ??\n        DEFAULT_FLAMEGRAPH_STATE.profiles.threadId,\n    },\n    position: {\n      view: (props.initialState?.position?.view ??\n        DEFAULT_FLAMEGRAPH_STATE.position.view) as Rect,\n    },\n    preferences: {\n      colorCoding:\n        props.initialState?.preferences?.colorCoding ??\n        DEFAULT_FLAMEGRAPH_STATE.preferences.colorCoding,\n      sorting:\n        props.initialState?.preferences?.sorting ??\n        DEFAULT_FLAMEGRAPH_STATE.preferences.sorting,\n      view:\n        props.initialState?.preferences?.view ??\n        DEFAULT_FLAMEGRAPH_STATE.preferences.view,\n      xAxis:\n        props.initialState?.preferences?.xAxis ??\n        DEFAULT_FLAMEGRAPH_STATE.preferences.xAxis,\n    },\n    search: {\n      ...DEFAULT_FLAMEGRAPH_STATE.search,\n      query: props.initialState?.search?.query ?? DEFAULT_FLAMEGRAPH_STATE.search.query,\n    },\n  });\n\n  useEffect(() => {\n    if (\n      reducer[0].profiles.threadId === null &&\n      profileGroup.type === 'resolved' &&\n      typeof profileGroup.data.activeProfileIndex === 'number'\n    ) {\n      const threadID =\n        profileGroup.data.profiles[profileGroup.data.activeProfileIndex].threadId;\n\n      if (threadID) {\n        reducer[1]({\n          type: 'set thread id',\n          payload: threadID,\n        });\n      }\n    }\n  }, [props.initialState?.profiles?.threadId, profileGroup, reducer]);\n\n  return (\n    <FlamegraphStateContext.Provider value={reducer}>\n      {props.children}\n    </FlamegraphStateContext.Provider>\n  );\n}\n","import {Reducer, ReducerAction, useReducer} from 'react';\n\ntype ReducersObject<S = any, A = any> = {\n  [K in keyof S]: Reducer<S, A>;\n};\n\ntype ReducersState<M> = M extends ReducersObject\n  ? {\n      [P in keyof M]: M[P] extends Reducer<infer S, any> ? S : never;\n    }\n  : never;\n\ntype ReducerFromReducersObject<M> = M extends {\n  [P in keyof M]: infer R;\n}\n  ? R extends Reducer<any, any>\n    ? R\n    : never\n  : never;\n\ntype AllReducerAction<M> = M extends ReducersObject\n  ? ReducerAction<ReducerFromReducersObject<M>>\n  : never;\n\ntype CombinedState<S> = {} & S;\nexport type CombinedReducer<M extends ReducersObject> = Reducer<\n  CombinedState<ReducersState<M>>,\n  AllReducerAction<M>\n>;\n\nexport function makeCombinedReducers<M extends ReducersObject>(\n  reducers: M\n): CombinedReducer<M> {\n  const keys: (keyof M)[] = Object.keys(reducers);\n\n  return (state, action) => {\n    const nextState = {} as ReducersState<M>;\n\n    for (const key of keys) {\n      nextState[key] = reducers[key](state[key], action);\n    }\n\n    return nextState;\n  };\n}\n\nexport function useCombinedReducer<M extends ReducersObject>(\n  reducers: M,\n  initialState: CombinedState<ReducersState<M>>\n): [CombinedState<ReducersState<M>>, React.Dispatch<AllReducerAction<M>>] {\n  return useReducer(makeCombinedReducers(reducers), initialState);\n}\n","import {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\n\ntype SetProfilesActiveIndex = {\n  payload: number;\n  type: 'set thread id';\n};\n\ntype SetSelectedNode = {\n  payload: FlamegraphFrame | null;\n  type: 'set selected node';\n};\n\ntype FlamegraphProfilesAction = SetProfilesActiveIndex | SetSelectedNode;\n\ntype FlamegraphProfilesState = {\n  selectedNode: FlamegraphFrame | null;\n  threadId: number | null;\n};\n\nexport function flamegraphProfilesReducer(\n  state: FlamegraphProfilesState,\n  action: FlamegraphProfilesAction\n): FlamegraphProfilesState {\n  switch (action.type) {\n    case 'set selected node': {\n      return {...state, selectedNode: action.payload};\n    }\n    case 'set thread id': {\n      // When the profile index changes, we want to drop the selected and hovered nodes\n      return {\n        ...state,\n        selectedNode: null,\n        threadId: action.payload,\n      };\n    }\n    default: {\n      return state;\n    }\n  }\n}\n","import {Rect} from 'sentry/utils/profiling/gl/utils';\n\ntype FlamegraphZoomPositionAction = {\n  payload: Rect;\n  type: 'checkpoint';\n};\n\ntype FlamegraphZoomPosition = {\n  view: Rect;\n};\n\nexport function flamegraphZoomPositionReducer(\n  state: FlamegraphZoomPosition,\n  action: FlamegraphZoomPositionAction\n): FlamegraphZoomPosition {\n  switch (action.type) {\n    case 'checkpoint': {\n      return {view: Rect.From(action.payload)};\n    }\n    default: {\n      return state;\n    }\n  }\n}\n","export type FlamegraphColorCodings = [\n  'by symbol name',\n  'by system / application',\n  'by library',\n  'by recursion'\n];\n\nexport type FlamegraphSorting = ['left heavy', 'call order'];\nexport type FlamegraphViewOptions = ['top down', 'bottom up'];\nexport type FlamegraphAxisOptions = ['standalone', 'transaction'];\n\nexport interface FlamegraphPreferences {\n  colorCoding: FlamegraphColorCodings[number];\n  sorting: FlamegraphSorting[number];\n  view: FlamegraphViewOptions[number];\n  xAxis: FlamegraphAxisOptions[number];\n}\n\ntype FlamegraphPreferencesAction =\n  | {payload: FlamegraphPreferences['colorCoding']; type: 'set color coding'}\n  | {payload: FlamegraphPreferences['sorting']; type: 'set sorting'}\n  | {payload: FlamegraphPreferences['view']; type: 'set view'}\n  | {\n      payload: FlamegraphPreferences['xAxis'];\n      type: 'set xAxis';\n    };\n\nexport function flamegraphPreferencesReducer(\n  state: FlamegraphPreferences,\n  action: FlamegraphPreferencesAction\n): FlamegraphPreferences {\n  switch (action.type) {\n    case 'set color coding': {\n      return {\n        ...state,\n        colorCoding: action.payload,\n      };\n    }\n    case 'set sorting': {\n      return {\n        ...state,\n        sorting: action.payload,\n      };\n    }\n    case 'set view': {\n      return {\n        ...state,\n        view: action.payload,\n      };\n    }\n    case 'set xAxis': {\n      return {...state, xAxis: action.payload};\n    }\n    default: {\n      return state;\n    }\n  }\n}\n","import {FlamegraphFrame} from '../../flamegraphFrame';\n\ntype FlamegraphSearch = {\n  index: number | null;\n  query: string;\n  results: Record<string, FlamegraphFrame> | null;\n};\n\ntype ClearFlamegraphSearchAction = {\n  type: 'clear search';\n};\n\ntype SetFlamegraphResultsAction = {\n  payload: {\n    query: string;\n    results: FlamegraphSearch['results'];\n  };\n  type: 'set results';\n};\n\ntype FlamegraphSearchArrowNavigationAction = {\n  payload: number;\n  type: 'set search index position';\n};\n\ntype FlamegraphSearchAction =\n  | ClearFlamegraphSearchAction\n  | FlamegraphSearchArrowNavigationAction\n  | SetFlamegraphResultsAction;\n\nexport function flamegraphSearchReducer(\n  state: FlamegraphSearch,\n  action: FlamegraphSearchAction\n): FlamegraphSearch {\n  switch (action.type) {\n    case 'clear search': {\n      return {\n        ...state,\n        query: '',\n        index: null,\n        results: null,\n      };\n    }\n    case 'set results': {\n      return {...state, ...action.payload};\n    }\n    case 'set search index position': {\n      return {...state, index: action.payload};\n    }\n    default: {\n      return state;\n    }\n  }\n}\n","import {ReducerAction, ReducerState, useReducer} from 'react';\n\nexport type UndoableNode<S> = {\n  current: S;\n  next: UndoableNode<S> | undefined;\n  previous: UndoableNode<S> | undefined;\n};\n\ntype UndoAction = {\n  type: 'undo';\n};\n\ntype RedoAction = {\n  type: 'redo';\n};\n\nexport type UndoableReducerAction<A> = UndoAction | RedoAction | A;\n\nexport type UndoableReducer<R extends React.Reducer<any, any>> = React.Reducer<\n  UndoableNode<ReducerState<R>>,\n  UndoableReducerAction<ReducerAction<R>>\n>;\n\nfunction isUndoOrRedoAction(\n  action: UndoableReducerAction<any>\n): action is UndoAction | RedoAction {\n  if (action.type) {\n    return action.type === 'undo' || action.type === 'redo';\n  }\n  return false;\n}\n\nfunction undoableReducer<S>(\n  state: UndoableNode<S>,\n  action: UndoAction | RedoAction\n): UndoableNode<S> {\n  if (action.type === 'undo') {\n    return state.previous === undefined ? state : state.previous;\n  }\n\n  if (action.type === 'redo') {\n    return state.next === undefined ? state : state.next;\n  }\n\n  throw new Error('Unreachable case');\n}\n\nexport function makeUndoableReducer<R extends React.Reducer<any, any>>(\n  reducer: R\n): UndoableReducer<R> {\n  return (\n    state: UndoableNode<ReducerState<R>>,\n    action: UndoableReducerAction<ReducerAction<R>>\n  ) => {\n    if (isUndoOrRedoAction(action)) {\n      return undoableReducer(state, action);\n    }\n\n    const newState: UndoableNode<ReducerState<R>> = {\n      next: undefined,\n      previous: state,\n      current: reducer(state.current, action),\n    };\n\n    state.next = newState;\n    return newState;\n  };\n}\n\nexport function useUndoableReducer<\n  R extends React.Reducer<ReducerState<R>, ReducerAction<R>>\n>(\n  reducer: R,\n  initialState: ReducerState<R>\n): [\n  ReducerState<R>,\n  React.Dispatch<UndoableReducerAction<ReducerAction<R>>>,\n  {\n    nextState: ReducerState<R> | undefined;\n    previousState: ReducerState<R> | undefined;\n  }\n] {\n  const [state, dispatch] = useReducer(makeUndoableReducer(reducer), {\n    current: initialState,\n    previous: undefined,\n    next: undefined,\n  });\n\n  return [\n    state.current,\n    dispatch,\n    {previousState: state.previous?.current, nextState: state.next?.current},\n  ];\n}\n","import {useContext} from 'react';\n\nimport {\n  FlamegraphStateContext,\n  FlamegraphStateContextValue,\n} from './flamegraphStateProvider';\n\nexport function useFlamegraphPreferences(): [\n  FlamegraphStateContextValue[0]['preferences'],\n  FlamegraphStateContextValue[1]\n] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphPreferences called outside of FlamegraphStateProvider');\n  }\n\n  return [context[0].preferences, context[1]];\n}\n\nexport function useFlamegraphPreferencesValue(): FlamegraphStateContextValue[0]['preferences'] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error(\n      'useFlamegraphPreferencesValue called outside of FlamegraphStateProvider'\n    );\n  }\n\n  return context[0].preferences;\n}\n","import {Fragment} from 'react';\n\nimport Button from 'sentry/components/button';\nimport CompositeSelect from 'sentry/components/forms/compositeSelect';\nimport {IconSliders} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {CanvasPoolManager} from 'sentry/utils/profiling/canvasScheduler';\nimport {FlamegraphPreferences} from 'sentry/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphPreferences';\nimport {useFlamegraphPreferences} from 'sentry/utils/profiling/flamegraph/useFlamegraphPreferences';\n\ninterface FlamegraphOptionsMenuProps {\n  canvasPoolManager: CanvasPoolManager;\n}\n\nfunction FlamegraphOptionsMenu({\n  canvasPoolManager,\n}: FlamegraphOptionsMenuProps): React.ReactElement {\n  const [{colorCoding, xAxis}, dispatch] = useFlamegraphPreferences();\n\n  return (\n    <Fragment>\n      <Button size=\"xsmall\" onClick={() => canvasPoolManager.dispatch('resetZoom', [])}>\n        {t('Reset Zoom')}\n      </Button>\n      <CompositeSelect\n        triggerLabel={t('Options')}\n        triggerProps={{\n          icon: <IconSliders size=\"xs\" />,\n          size: 'xsmall',\n        }}\n        placement=\"bottom right\"\n        sections={[\n          {\n            label: t('X Axis'),\n            value: 'x axis',\n            defaultValue: xAxis,\n            options: Object.entries(X_AXIS).map(([value, label]) => ({\n              label,\n              value,\n            })),\n            onChange: value =>\n              dispatch({\n                type: 'set xAxis',\n                payload: value,\n              }),\n          },\n          {\n            label: t('Color Coding'),\n            value: 'by symbol name',\n            defaultValue: colorCoding,\n            options: Object.entries(COLOR_CODINGS).map(([value, label]) => ({\n              label,\n              value,\n            })),\n            onChange: value =>\n              dispatch({\n                type: 'set color coding',\n                payload: value,\n              }),\n          },\n        ]}\n      />\n    </Fragment>\n  );\n}\n\nconst X_AXIS: Record<FlamegraphPreferences['xAxis'], string> = {\n  standalone: t('Standalone'),\n  transaction: t('Transaction'),\n};\n\nconst COLOR_CODINGS: Record<FlamegraphPreferences['colorCoding'], string> = {\n  'by symbol name': t('By Symbol Name'),\n  'by library': t('By Library'),\n  'by system / application': t('By System / Application'),\n  'by recursion': t('By Recursion'),\n};\n\nexport {FlamegraphOptionsMenu};\n","const REG_EXP = /(.*)\\/([dgimsuy])/;\n\nexport const parseRegExp = (string: string): RegExpMatchArray | null => {\n  return string.match(REG_EXP);\n};\n\nexport const isRegExpString = (string?: string): boolean => {\n  if (!string?.trim().length) {\n    return false;\n  }\n\n  return REG_EXP.test(string);\n};\n","import {useCallback, useEffect, useMemo} from 'react';\nimport styled from '@emotion/styled';\nimport * as Sentry from '@sentry/react';\nimport Fuse from 'fuse.js';\n\nimport SearchBar from 'sentry/components/searchBar';\nimport {t} from 'sentry/locale';\nimport {CanvasPoolManager} from 'sentry/utils/profiling/canvasScheduler';\nimport {Flamegraph} from 'sentry/utils/profiling/flamegraph';\nimport {useFlamegraphSearch} from 'sentry/utils/profiling/flamegraph/useFlamegraphSearch';\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {memoizeByReference} from 'sentry/utils/profiling/profile/utils';\nimport {isRegExpString, parseRegExp} from 'sentry/utils/profiling/validators/regExp';\n\nfunction sortFrameResults(\n  frames: Record<string, FlamegraphFrame> | null\n): Array<FlamegraphFrame> {\n  // If frames have the same start times, move frames with lower stack depth first.\n  // This results in top down and left to right iteration\n  return Object.values(frames ?? {}).sort((a, b) =>\n    a.start === b.start\n      ? numericSort(a.depth, b.depth, 'asc')\n      : numericSort(a.start, b.start, 'asc')\n  );\n}\n\nconst memoizedSortFrameResults = memoizeByReference(sortFrameResults);\n\nfunction frameSearch(\n  query: string,\n  frames: ReadonlyArray<FlamegraphFrame>,\n  index: Fuse<FlamegraphFrame>\n): Record<string, FlamegraphFrame> | null {\n  const results = {};\n  if (isRegExpString(query)) {\n    const [_, lookup, flags] = parseRegExp(query) ?? [];\n\n    let matches = 0;\n\n    try {\n      if (!lookup) {\n        throw new Error('Invalid RegExp');\n      }\n\n      for (let i = 0; i < frames.length; i++) {\n        const frame = frames[i];\n\n        if (new RegExp(lookup, flags ?? 'g').test(frame.frame.name.trim())) {\n          results[\n            `${\n              frame.frame.name +\n              (frame.frame.file ? frame.frame.file : '') +\n              String(frame.start)\n            }`\n          ] = frame;\n          matches += 1;\n        }\n      }\n    } catch (e) {\n      Sentry.captureMessage(e.message);\n    }\n\n    if (matches <= 0) {\n      return null;\n    }\n\n    return results;\n  }\n\n  const fuseResults = index.search(query);\n\n  if (fuseResults.length <= 0) {\n    return null;\n  }\n\n  for (let i = 0; i < fuseResults.length; i++) {\n    const frame = fuseResults[i];\n\n    results[\n      `${\n        frame.item.frame.name +\n        (frame.item.frame.file ? frame.item.frame.file : '') +\n        String(frame.item.start)\n      }`\n    ] = frame.item;\n  }\n\n  return results;\n}\n\nconst numericSort = (\n  a: null | undefined | number,\n  b: null | undefined | number,\n  direction: 'asc' | 'desc'\n): number => {\n  if (a === b) {\n    return 0;\n  }\n  if (a === null || a === undefined) {\n    return 1;\n  }\n  if (b === null || b === undefined) {\n    return -1;\n  }\n\n  return direction === 'asc' ? a - b : b - a;\n};\n\ninterface FlamegraphSearchProps {\n  canvasPoolManager: CanvasPoolManager;\n  flamegraphs: Flamegraph | Flamegraph[];\n}\n\nfunction FlamegraphSearch({\n  flamegraphs,\n  canvasPoolManager,\n}: FlamegraphSearchProps): React.ReactElement | null {\n  const [search, dispatchSearch] = useFlamegraphSearch();\n\n  const allFrames = useMemo(() => {\n    if (Array.isArray(flamegraphs)) {\n      return flamegraphs.reduce(\n        (acc: FlamegraphFrame[], graph) => acc.concat(graph.frames),\n        []\n      );\n    }\n\n    return flamegraphs.frames;\n  }, [flamegraphs]);\n\n  const searchIndex = useMemo(() => {\n    return new Fuse(allFrames, {\n      keys: ['frame.name'],\n      threshold: 0.3,\n      includeMatches: true,\n    });\n  }, [allFrames]);\n\n  const onZoomIntoFrame = useCallback(\n    (frame: FlamegraphFrame) => {\n      canvasPoolManager.dispatch('zoomIntoFrame', [frame]);\n    },\n    [canvasPoolManager]\n  );\n\n  useEffect(() => {\n    if (typeof search.index !== 'number') {\n      return;\n    }\n\n    const frames = memoizedSortFrameResults(search.results);\n    if (frames[search.index]) {\n      onZoomIntoFrame(frames[search.index]);\n    }\n  }, [search.results, search.index, onZoomIntoFrame]);\n\n  const handleChange: (value: string) => void = useCallback(\n    value => {\n      if (!value) {\n        dispatchSearch({type: 'clear search'});\n        return;\n      }\n\n      dispatchSearch({\n        type: 'set results',\n        payload: {\n          results: frameSearch(value, allFrames, searchIndex),\n          query: value,\n        },\n      });\n    },\n    [dispatchSearch, allFrames, searchIndex]\n  );\n\n  const onNextSearchClick = useCallback(() => {\n    const frames = memoizedSortFrameResults(search.results);\n    if (!frames.length) {\n      return;\n    }\n\n    if (search.index === null || search.index === frames.length - 1) {\n      dispatchSearch({type: 'set search index position', payload: 0});\n      return;\n    }\n\n    dispatchSearch({\n      type: 'set search index position',\n      payload: search.index + 1,\n    });\n  }, [search.results, search.index, dispatchSearch]);\n\n  const onPreviousSearchClick = useCallback(() => {\n    const frames = memoizedSortFrameResults(search.results);\n    if (!frames.length) {\n      return;\n    }\n\n    if (search.index === null || search.index === 0) {\n      dispatchSearch({\n        type: 'set search index position',\n        payload: frames.length - 1,\n      });\n      return;\n    }\n\n    dispatchSearch({\n      type: 'set search index position',\n      payload: search.index - 1,\n    });\n  }, [search.results, search.index, dispatchSearch]);\n\n  const handleKeyDown = useCallback(\n    (evt: React.KeyboardEvent<HTMLInputElement>) => {\n      if (evt.key === 'ArrowDown') {\n        evt.preventDefault();\n        onNextSearchClick();\n      } else if (evt.key === 'ArrowUp') {\n        evt.preventDefault();\n        onPreviousSearchClick();\n      }\n    },\n    [onNextSearchClick, onPreviousSearchClick]\n  );\n\n  return (\n    <StyledSearchBar\n      placeholder={t('Find Frames')}\n      query={search.query}\n      onChange={handleChange}\n      onKeyDown={handleKeyDown}\n    />\n  );\n}\n\nconst StyledSearchBar = styled(SearchBar)`\n  .search-input {\n    height: 28px;\n  }\n\n  flex: 1 1 100%;\n`;\n\nexport {FlamegraphSearch};\n","import {useContext} from 'react';\n\nimport {\n  FlamegraphStateContext,\n  FlamegraphStateContextValue,\n} from './flamegraphStateProvider';\n\nexport function useFlamegraphSearch(): [\n  FlamegraphStateContextValue[0]['search'],\n  FlamegraphStateContextValue[1]\n] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphSearch called outside of FlamegraphStateProvider');\n  }\n\n  return [context[0].search, context[1]];\n}\n\nexport function useFlamegraphSearchValue(): FlamegraphStateContextValue[0]['search'] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphSearchValue called outside of FlamegraphStateProvider');\n  }\n\n  return context[0].search;\n}\n","import styled from '@emotion/styled';\n\nimport space from 'sentry/styles/space';\n\ninterface FlamegraphToolbarProps {\n  children: React.ReactNode;\n}\n\nexport const FlamegraphToolbar = styled('div')<FlamegraphToolbarProps>`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin: ${space(1)} ${space(4)};\n  gap: ${space(1)};\n`;\n","import {Fragment} from 'react';\n\nimport Button from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport {t} from 'sentry/locale';\nimport {FlamegraphPreferences} from 'sentry/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphPreferences';\n\ninterface FlamegraphViewSelectMenuProps {\n  onSortingChange: (sorting: FlamegraphViewSelectMenuProps['sorting']) => void;\n  onViewChange: (view: FlamegraphViewSelectMenuProps['view']) => void;\n  sorting: FlamegraphPreferences['sorting'];\n  view: FlamegraphPreferences['view'];\n}\n\nfunction FlamegraphViewSelectMenu({\n  view,\n  onViewChange,\n  sorting,\n  onSortingChange,\n}: FlamegraphViewSelectMenuProps): React.ReactElement {\n  return (\n    <Fragment>\n      <ButtonBar merged active={sorting}>\n        <Button\n          barId=\"call order\"\n          size=\"xsmall\"\n          onClick={() => onSortingChange('call order')}\n        >\n          {t('Call Order')}\n        </Button>\n        <Button\n          barId=\"left heavy\"\n          size=\"xsmall\"\n          onClick={() => onSortingChange('left heavy')}\n        >\n          {t('Left Heavy')}\n        </Button>\n      </ButtonBar>\n      <ButtonBar merged active={view}>\n        <Button barId=\"bottom up\" size=\"xsmall\" onClick={() => onViewChange('bottom up')}>\n          {t('Bottom Up')}\n        </Button>\n        <Button barId=\"top down\" size=\"xsmall\" onClick={() => onViewChange('top down')}>\n          {t('Top Down')}\n        </Button>\n      </ButtonBar>\n    </Fragment>\n  );\n}\n\nexport {FlamegraphViewSelectMenu};\n","import {lightTheme} from '../../theme';\nimport {FlamegraphFrame} from '../flamegraphFrame';\n\nimport {makeColorBucketTheme, makeColorMap, makeStackToColor} from './../colors/utils';\nimport {Frame} from './../frame';\n\nconst MONOSPACE_FONT = `ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono', 'Roboto Mono',\n'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro', 'Fira Mono', 'Droid Sans Mono',\n'Courier New', monospace`;\n\nconst FRAME_FONT = lightTheme.text.familyMono;\n\n// Luma chroma hue settings\nexport interface LCH {\n  C_0: number;\n  C_d: number;\n  L_0: number;\n  L_d: number;\n}\n// Color can be rgb or rgba. I want to probably eliminate rgb and just use rgba, but we would be allocating 25% more memory,\n// and I'm not sure about the impact we'd need. There is a tradeoff between memory and runtime performance checks that I'll need to evaluate at some point.\nexport type ColorChannels = [number, number, number] | [number, number, number, number];\n\nexport interface FlamegraphTheme {\n  // @TODO, most colors are defined as strings, which is a mistake as we loose a lot of functionality and impose constraints.\n  // They should instead be defined as arrays of numbers so we can use them with glsl and avoid unnecessary parsing\n  COLORS: {\n    BAR_LABEL_FONT_COLOR: string;\n    COLOR_BUCKET: (t: number, frame?: Frame) => ColorChannels;\n    COLOR_MAP: (\n      frames: ReadonlyArray<FlamegraphFrame>,\n      colorBucket: FlamegraphTheme['COLORS']['COLOR_BUCKET'],\n      sortByKey?: (a: FlamegraphFrame, b: FlamegraphFrame) => number\n    ) => Map<FlamegraphFrame['frame']['key'], ColorChannels>;\n    CURSOR_CROSSHAIR: string;\n    DIFFERENTIAL_DECREASE: ColorChannels;\n    DIFFERENTIAL_INCREASE: ColorChannels;\n    FRAME_FALLBACK_COLOR: [number, number, number, number];\n    GRID_FRAME_BACKGROUND_COLOR: string;\n    GRID_LINE_COLOR: string;\n    HOVERED_FRAME_BORDER_COLOR: string;\n    LABEL_FONT_COLOR: string;\n    MINIMAP_POSITION_OVERLAY_BORDER_COLOR: string;\n    MINIMAP_POSITION_OVERLAY_COLOR: string;\n    REQUEST_2XX_RESPONSE: string;\n    REQUEST_4XX_RESPONSE: string;\n\n    REQUEST_DNS_TIME: string;\n    REQUEST_SSL_TIME: string;\n    REQUEST_TCP_TIME: string;\n    // Nice color picker for GLSL colors - https://keiwando.com/color-picker/\n    REQUEST_WAIT_TIME: string;\n    SEARCH_RESULT_FRAME_COLOR: string;\n    SELECTED_FRAME_BORDER_COLOR: string;\n    SPAN_FRAME_BACKGROUND: string;\n    SPAN_FRAME_BORDER: string;\n    STACK_TO_COLOR: (\n      frames: ReadonlyArray<FlamegraphFrame>,\n      colorMapFn: FlamegraphTheme['COLORS']['COLOR_MAP'],\n      colorBucketFn: FlamegraphTheme['COLORS']['COLOR_BUCKET']\n    ) => {\n      colorBuffer: Array<number>;\n      colorMap: Map<Frame['key'], ColorChannels>;\n    };\n  };\n  CONFIG: {\n    HIGHLIGHT_RECURSION: boolean;\n  };\n  FONTS: {\n    FONT: string;\n    FRAME_FONT: string;\n  };\n  SIZES: {\n    BAR_FONT_SIZE: number;\n    BAR_HEIGHT: number;\n    BAR_PADDING: number;\n    FLAMEGRAPH_DEPTH_OFFSET: number;\n    FRAME_BORDER_WIDTH: number;\n    GRID_LINE_WIDTH: number;\n    HOVERED_FRAME_BORDER_WIDTH: number;\n    LABEL_FONT_PADDING: number;\n    LABEL_FONT_SIZE: number;\n    MINIMAP_HEIGHT: number;\n    MINIMAP_POSITION_OVERLAY_BORDER_WIDTH: number;\n    REQUEST_BAR_HEIGHT: number;\n    REQUEST_DEPTH_OFFSET: number;\n    REQUEST_FONT_SIZE: number;\n    // Request\n    REQUEST_TAIL_HEIGHT: number;\n\n    // Spans\n    SPANS_BAR_HEIGHT: number;\n    SPANS_DEPTH_OFFSET: number;\n    SPANS_FONT_SIZE: number;\n    TIMELINE_HEIGHT: number;\n    TOOLTIP_FONT_SIZE: number;\n  };\n}\n\n// Luma chroma hue settings for light theme\nexport const LCH_LIGHT = {\n  C_0: 0.25,\n  C_d: 0.2,\n  L_0: 0.8,\n  L_d: 0.15,\n};\n\n// Luma chroma hue settings for dark theme\nexport const LCH_DARK = {\n  C_0: 0.2,\n  C_d: 0.1,\n  L_0: 0.2,\n  L_d: 0.1,\n};\n\nexport const LightFlamegraphTheme: FlamegraphTheme = {\n  CONFIG: {\n    HIGHLIGHT_RECURSION: false,\n  },\n  SIZES: {\n    BAR_HEIGHT: 20,\n    BAR_FONT_SIZE: 11,\n    BAR_PADDING: 4,\n    FLAMEGRAPH_DEPTH_OFFSET: 12,\n    SPANS_DEPTH_OFFSET: 4,\n    SPANS_FONT_SIZE: 10,\n    SPANS_BAR_HEIGHT: 14,\n    REQUEST_TAIL_HEIGHT: 8,\n    REQUEST_BAR_HEIGHT: 14,\n    REQUEST_FONT_SIZE: 10,\n    REQUEST_DEPTH_OFFSET: 4,\n    MINIMAP_POSITION_OVERLAY_BORDER_WIDTH: 2,\n    MINIMAP_HEIGHT: 100,\n    TIMELINE_HEIGHT: 20,\n    LABEL_FONT_SIZE: 10,\n    LABEL_FONT_PADDING: 6,\n    FRAME_BORDER_WIDTH: 2,\n    HOVERED_FRAME_BORDER_WIDTH: 1,\n    TOOLTIP_FONT_SIZE: 12,\n    GRID_LINE_WIDTH: 2,\n  },\n  COLORS: {\n    LABEL_FONT_COLOR: '#1f233a',\n    BAR_LABEL_FONT_COLOR: '#000',\n    GRID_LINE_COLOR: '#e5e7eb',\n    GRID_FRAME_BACKGROUND_COLOR: 'rgba(255, 255, 255, 0.8)',\n    SEARCH_RESULT_FRAME_COLOR: 'vec4(0.99, 0.70, 0.35, 1.0)',\n    SELECTED_FRAME_BORDER_COLOR: '#005aff',\n    HOVERED_FRAME_BORDER_COLOR: 'rgba(0, 0, 0, 0.8)',\n    CURSOR_CROSSHAIR: '#bbbbbb',\n    SPAN_FRAME_BORDER: 'rgba(200, 200, 200, 1)',\n    SPAN_FRAME_BACKGROUND: 'rgba(231, 231, 231, 0.5)',\n    MINIMAP_POSITION_OVERLAY_COLOR: 'rgba(0,0,0,0.1)',\n    MINIMAP_POSITION_OVERLAY_BORDER_COLOR: 'rgba(0,0,0, 0.2)',\n    REQUEST_WAIT_TIME: `rgba(253,252,224, 1)`,\n    REQUEST_DNS_TIME: `rgba(57, 146, 152, 1)`,\n    REQUEST_TCP_TIME: `rgba(242, 146,57,1)`,\n    REQUEST_SSL_TIME: `rgba(207,84,218, 1)`,\n    REQUEST_2XX_RESPONSE: 'rgba(218, 231, 209, 1)',\n    REQUEST_4XX_RESPONSE: 'rgba(255,96, 96, 1)',\n    DIFFERENTIAL_INCREASE: [0.98, 0.2058, 0.4381],\n    DIFFERENTIAL_DECREASE: [0.309, 0.2058, 0.98],\n    COLOR_BUCKET: makeColorBucketTheme(LCH_LIGHT),\n    COLOR_MAP: makeColorMap,\n    STACK_TO_COLOR: makeStackToColor([0, 0, 0, 0.035]),\n    FRAME_FALLBACK_COLOR: [0, 0, 0, 0.035],\n  },\n  FONTS: {\n    FONT: MONOSPACE_FONT,\n    FRAME_FONT,\n  },\n};\n\nexport const DarkFlamegraphTheme: FlamegraphTheme = {\n  CONFIG: {\n    HIGHLIGHT_RECURSION: false,\n  },\n  SIZES: {\n    BAR_HEIGHT: 20,\n    BAR_FONT_SIZE: 11,\n    BAR_PADDING: 4,\n    FLAMEGRAPH_DEPTH_OFFSET: 12,\n    SPANS_DEPTH_OFFSET: 4,\n    SPANS_FONT_SIZE: 10,\n    SPANS_BAR_HEIGHT: 14,\n    REQUEST_TAIL_HEIGHT: 8,\n    REQUEST_BAR_HEIGHT: 14,\n    REQUEST_FONT_SIZE: 10,\n    REQUEST_DEPTH_OFFSET: 4,\n    MINIMAP_POSITION_OVERLAY_BORDER_WIDTH: 2,\n    MINIMAP_HEIGHT: 100,\n    TIMELINE_HEIGHT: 20,\n    LABEL_FONT_SIZE: 10,\n    LABEL_FONT_PADDING: 6,\n    FRAME_BORDER_WIDTH: 2,\n    HOVERED_FRAME_BORDER_WIDTH: 1,\n    TOOLTIP_FONT_SIZE: 12,\n    GRID_LINE_WIDTH: 2,\n  },\n  COLORS: {\n    LABEL_FONT_COLOR: 'rgba(255, 255, 255, 0.8)',\n    BAR_LABEL_FONT_COLOR: 'rgb(255 255 255 / 80%)',\n    GRID_LINE_COLOR: '#222227',\n    GRID_FRAME_BACKGROUND_COLOR: 'rgba(0, 0, 0, 0.4)',\n    SEARCH_RESULT_FRAME_COLOR: 'vec4(0.99, 0.70, 0.35, 0.7)',\n    SELECTED_FRAME_BORDER_COLOR: '#3482ea',\n    HOVERED_FRAME_BORDER_COLOR: 'rgba(255, 255, 255, 0.8)',\n    CURSOR_CROSSHAIR: '#828285',\n    SPAN_FRAME_BORDER: '#57575b',\n    SPAN_FRAME_BACKGROUND: 'rgba(232, 232, 232, 0.2)',\n    REQUEST_WAIT_TIME: `rgba(253,252,224, 1)`,\n    REQUEST_DNS_TIME: `rgba(57, 146, 152, 1)`,\n    REQUEST_TCP_TIME: `rgba(242, 146,57,1)`,\n    REQUEST_SSL_TIME: `rgba(207,84,218, 1)`,\n    REQUEST_2XX_RESPONSE: 'rgba(218, 231, 209, 1)',\n    REQUEST_4XX_RESPONSE: 'rgba(255,96, 96, 1)',\n    MINIMAP_POSITION_OVERLAY_COLOR: 'rgba(255,255,255,0.1)',\n    MINIMAP_POSITION_OVERLAY_BORDER_COLOR: 'rgba(255,255,255, 0.2)',\n    DIFFERENTIAL_INCREASE: [0.98, 0.2058, 0.4381],\n    DIFFERENTIAL_DECREASE: [0.309, 0.2058, 0.98],\n    COLOR_BUCKET: makeColorBucketTheme(LCH_DARK),\n    COLOR_MAP: makeColorMap,\n    STACK_TO_COLOR: makeStackToColor([1, 1, 1, 0.1]),\n    FRAME_FALLBACK_COLOR: [1, 1, 1, 0.1],\n  },\n  FONTS: {\n    FONT: MONOSPACE_FONT,\n    FRAME_FONT,\n  },\n};\n","import {createContext, useMemo} from 'react';\n\nimport ConfigStore from 'sentry/stores/configStore';\nimport {useLegacyStore} from 'sentry/stores/useLegacyStore';\n\nimport {\n  makeColorMapByImage,\n  makeColorMapByRecursion,\n  makeColorMapBySystemVsApplication,\n} from '../colors/utils';\n\nimport {\n  DarkFlamegraphTheme,\n  FlamegraphTheme,\n  LightFlamegraphTheme,\n} from './flamegraphTheme';\nimport {useFlamegraphPreferencesValue} from './useFlamegraphPreferences';\n\nexport const FlamegraphThemeContext = createContext<FlamegraphTheme | null>(null);\n\ninterface FlamegraphThemeProviderProps {\n  children: React.ReactNode;\n}\n\nfunction FlamegraphThemeProvider(\n  props: FlamegraphThemeProviderProps\n): React.ReactElement {\n  const {theme} = useLegacyStore(ConfigStore);\n  const flamegraphPreferences = useFlamegraphPreferencesValue();\n\n  const activeFlamegraphTheme = useMemo((): FlamegraphTheme => {\n    const base = theme === 'light' ? LightFlamegraphTheme : DarkFlamegraphTheme;\n\n    switch (flamegraphPreferences.colorCoding) {\n      case 'by symbol name': {\n        return base;\n      }\n      case 'by recursion': {\n        return {...base, COLORS: {...base.COLORS, COLOR_MAP: makeColorMapByRecursion}};\n      }\n      case 'by library': {\n        return {...base, COLORS: {...base.COLORS, COLOR_MAP: makeColorMapByImage}};\n      }\n      case 'by system / application': {\n        return {\n          ...base,\n          COLORS: {...base.COLORS, COLOR_MAP: makeColorMapBySystemVsApplication},\n        };\n      }\n      default: {\n        throw new TypeError(\n          `Unsupported flamegraph color coding ${flamegraphPreferences.colorCoding}`\n        );\n      }\n    }\n  }, [theme, flamegraphPreferences.colorCoding]);\n\n  return (\n    <FlamegraphThemeContext.Provider value={activeFlamegraphTheme}>\n      {props.children}\n    </FlamegraphThemeContext.Provider>\n  );\n}\n\nexport {FlamegraphThemeProvider};\n","import {useContext} from 'react';\n\nimport {FlamegraphTheme} from './flamegraphTheme';\nimport {FlamegraphThemeContext} from './flamegraphThemeProvider';\n\nfunction useFlamegraphTheme(): FlamegraphTheme {\n  const ctx = useContext(FlamegraphThemeContext);\n\n  if (!ctx) {\n    throw new Error('useFlamegraphTheme was called outside of FlamegraphThemeProvider');\n  }\n\n  return ctx;\n}\n\nexport {useFlamegraphTheme};\n","import {useCallback, useEffect, useState} from 'react';\n\nimport {clamp} from 'sentry/utils/profiling/colors/utils';\nimport {Rect} from 'sentry/utils/profiling/gl/utils';\n\nimport {useKeyboardNavigation} from './useKeyboardNavigation';\n\nexport function computeBestContextMenuPosition(\n  mouse: Rect,\n  container: Rect,\n  target: Rect\n) {\n  const maxY = Math.floor(container.height - target.height);\n  const minY = container.top;\n\n  const minX = container.left;\n  const maxX = Math.floor(container.right - target.width);\n\n  // We add a tiny offset so that the menu is not directly where the user places their cursor.\n  const OFFSET = 6;\n\n  return {\n    left: clamp(mouse.x + OFFSET, minX, maxX),\n    top: clamp(mouse.y + OFFSET, minY, maxY),\n  };\n}\n\ninterface UseContextMenuOptions {\n  container: HTMLElement | null;\n}\n\nexport function useContextMenu({container}: UseContextMenuOptions) {\n  const [open, setOpen] = useState<boolean>(false);\n  const [menuCoordinates, setMenuCoordinates] = useState<Rect | null>(null);\n  const [contextMenuCoordinates, setContextMenuCoordinates] = useState<Rect | null>(null);\n  const [containerCoordinates, setContainerCoordinates] = useState<Rect | null>(null);\n\n  const itemProps = useKeyboardNavigation();\n\n  // We wrap the setOpen function in a useEffect so that we also clear the keyboard\n  // tabIndex when a menu is closed. This prevents tabIndex from being persisted between render\n  const wrapSetOpen = useCallback(\n    (newOpen: boolean) => {\n      if (!newOpen) {\n        itemProps.setTabIndex(null);\n      }\n      setOpen(newOpen);\n    },\n    [itemProps]\n  );\n\n  const getMenuProps = useCallback(() => {\n    const menuProps = itemProps.getMenuProps();\n\n    return {\n      ...menuProps,\n      onKeyDown: (evt: React.KeyboardEvent) => {\n        if (evt.key === 'Escape') {\n          wrapSetOpen(false);\n        }\n        menuProps.onKeyDown(evt);\n      },\n    };\n  }, [itemProps, wrapSetOpen]);\n\n  const getMenuItemProps = useCallback(() => {\n    const menuItemProps = itemProps.getItemProps();\n\n    return {\n      ...menuItemProps,\n      onKeyDown: (evt: React.KeyboardEvent) => {\n        if (evt.key === 'Escape') {\n          wrapSetOpen(false);\n        }\n        menuItemProps.onKeyDown(evt);\n      },\n    };\n  }, [itemProps, wrapSetOpen]);\n\n  const handleContextMenu = useCallback(\n    (evt: React.MouseEvent) => {\n      if (!container) {\n        return;\n      }\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      const parentPosition = container.getBoundingClientRect();\n\n      setContextMenuCoordinates(\n        new Rect(\n          evt.clientX - parentPosition.left,\n          evt.clientY - parentPosition.top,\n          0,\n          0\n        )\n      );\n      wrapSetOpen(true);\n    },\n    [wrapSetOpen, container]\n  );\n\n  useEffect(() => {\n    const listener = (event: MouseEvent | TouchEvent) => {\n      // Do nothing if clicking ref's element or descendent elements\n      if (!itemProps.menuRef || itemProps.menuRef.contains(event.target as Node)) {\n        return;\n      }\n\n      setOpen(false);\n    };\n\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n    return () => {\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n  }, [itemProps.menuRef]);\n\n  // Observe the menu\n  useEffect(() => {\n    if (!itemProps.menuRef) {\n      return undefined;\n    }\n\n    const resizeObserver = new window.ResizeObserver(entries => {\n      const contentRect = entries[0].contentRect;\n      setMenuCoordinates(new Rect(0, 0, contentRect.width, contentRect.height));\n    });\n\n    resizeObserver.observe(itemProps.menuRef);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [itemProps.menuRef]);\n\n  // Observe the container\n  useEffect(() => {\n    if (!container) {\n      return undefined;\n    }\n\n    const resizeObserver = new window.ResizeObserver(entries => {\n      const contentRect = entries[0].contentRect;\n      setContainerCoordinates(new Rect(0, 0, contentRect.width, contentRect.height));\n    });\n\n    resizeObserver.observe(container);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [container]);\n\n  const position =\n    contextMenuCoordinates && containerCoordinates && menuCoordinates\n      ? computeBestContextMenuPosition(\n          contextMenuCoordinates,\n          containerCoordinates,\n          menuCoordinates\n        )\n      : null;\n\n  return {\n    open,\n    setOpen: wrapSetOpen,\n    position,\n    containerCoordinates,\n    contextMenuCoordinates: position,\n    menuRef: itemProps.menuRef,\n    handleContextMenu,\n    getMenuProps,\n    getMenuItemProps,\n  };\n}\n","import {useCallback, useEffect, useState} from 'react';\n\nexport function useRovingTabIndex(items: any[]) {\n  const [tabIndex, setTabIndex] = useState<number | null>(null);\n\n  const onKeyDown = useCallback(\n    (evt: React.KeyboardEvent) => {\n      if (items.length === 0) {\n        return;\n      }\n\n      if (evt.key === 'Escape') {\n        setTabIndex(null);\n      }\n\n      if (evt.key === 'ArrowDown' || evt.key === 'Tab') {\n        evt.preventDefault();\n\n        if (tabIndex === items.length - 1 || tabIndex === null) {\n          setTabIndex(0);\n        } else {\n          setTabIndex((tabIndex ?? 0) + 1);\n        }\n      }\n\n      if (evt.key === 'ArrowUp' || (evt.key === 'Tab' && evt.shiftKey)) {\n        evt.preventDefault();\n\n        if (tabIndex === 0 || tabIndex === null) {\n          setTabIndex(items.length - 1);\n        } else {\n          setTabIndex((tabIndex ?? 0) - 1);\n        }\n      }\n    },\n    [tabIndex, items]\n  );\n\n  return {\n    tabIndex,\n    setTabIndex,\n    onKeyDown,\n  };\n}\n\nexport function useKeyboardNavigation() {\n  const [menuRef, setMenuRef] = useState<HTMLDivElement | null>(null);\n  const items: {id: number; node: HTMLElement | null}[] = [];\n\n  const {tabIndex, setTabIndex, onKeyDown} = useRovingTabIndex(items);\n\n  useEffect(() => {\n    if (menuRef) {\n      if (tabIndex === null) {\n        menuRef.focus();\n      }\n    }\n  }, [menuRef, tabIndex]);\n\n  function getMenuProps() {\n    return {\n      tabIndex: -1,\n      ref: setMenuRef,\n      onKeyDown,\n    };\n  }\n\n  function getItemProps() {\n    const idx = items.length;\n    items.push({id: idx, node: null});\n\n    return {\n      tabIndex: tabIndex === idx ? 0 : -1,\n      ref: (node: HTMLElement | null) => {\n        if (items[idx]) {\n          if (tabIndex === idx) {\n            node?.focus();\n          }\n          items[idx].node = node;\n        }\n      },\n      onMouseEnter: () => {\n        setTabIndex(idx);\n      },\n      onKeyDown,\n    };\n  }\n\n  return {\n    menuRef,\n    getItemProps,\n    getMenuProps,\n    tabIndex,\n    setTabIndex,\n  };\n}\n","export class VirtualizedTreeNode<T> {\n  node: T;\n  parent: VirtualizedTreeNode<T> | null;\n  children: VirtualizedTreeNode<T>[];\n  expanded: boolean;\n  depth: number;\n\n  constructor(\n    node: T,\n    parent: VirtualizedTreeNode<T> | null,\n    depth: number,\n    expanded: boolean = false\n  ) {\n    this.node = node;\n    this.parent = parent;\n    this.expanded = expanded ?? false;\n    this.children = [];\n    this.depth = depth;\n  }\n\n  getVisibleChildrenCount(): number {\n    if (!this.expanded || !this.children.length) {\n      return 0;\n    }\n\n    let count = 0;\n    const queue = [...this.children];\n\n    while (queue.length > 0) {\n      const next = queue.pop();\n      if (next === undefined) {\n        throw new Error('Undefined queue node, this should never happen');\n      }\n\n      if (next.expanded) {\n        for (let i = 0; i < next.children.length; i++) {\n          queue.push(next.children[i]);\n        }\n      }\n      count++;\n    }\n\n    return count;\n  }\n\n  setExpanded(value: boolean, opts?: {expandChildren: boolean}) {\n    if (value === this.expanded) {\n      return [];\n    }\n\n    // We are closing a node, so we need to remove all of its children. To do that, we just get the\n    // count of visible children and return it.\n    if (!value) {\n      const removedCount = this.getVisibleChildrenCount();\n      this.expanded = value;\n      return new Array(removedCount);\n    }\n\n    // If we are opening a node, we need to add all of its children to the list and insert it\n    this.expanded = value;\n\n    // Collect the newly visible children.\n    const list: VirtualizedTreeNode<T>[] = [];\n    function visit(node: VirtualizedTreeNode<T>): void {\n      if (opts?.expandChildren) {\n        node.expanded = true;\n      }\n\n      list.push(node);\n\n      if (!node.expanded) {\n        return;\n      }\n\n      for (let i = 0; i < node.children.length; i++) {\n        visit(node.children[i]);\n      }\n    }\n\n    for (let i = 0; i < this.children.length; i++) {\n      visit(this.children[i]);\n    }\n\n    return list;\n  }\n}\n","import {TreeLike} from 'sentry/utils/profiling/hooks/useVirtualizedTree/useVirtualizedTree';\n\nimport {VirtualizedTreeNode} from './VirtualizedTreeNode';\n\nexport class VirtualizedTree<T extends TreeLike> {\n  roots: VirtualizedTreeNode<T>[] = [];\n  flattened: VirtualizedTreeNode<T>[] = [];\n\n  constructor(roots: VirtualizedTreeNode<T>[], flattenedList?: VirtualizedTreeNode<T>[]) {\n    this.roots = roots;\n    this.flattened = flattenedList || VirtualizedTree.toExpandedList(this.roots);\n  }\n\n  // Rebuilds the tree\n  static fromRoots<T extends TreeLike>(\n    items: T[],\n    skipFn: (n: VirtualizedTreeNode<T>) => boolean = () => false,\n    expandedNodes?: Set<T>\n  ): VirtualizedTree<T> {\n    const roots: VirtualizedTreeNode<T>[] = [];\n\n    function toTreeNode(\n      node: T,\n      parent: VirtualizedTreeNode<T> | null,\n      collection: VirtualizedTreeNode<T>[] | null,\n      depth: number\n    ) {\n      const treeNode = new VirtualizedTreeNode<T>(\n        node,\n        parent,\n        depth,\n        expandedNodes ? expandedNodes.has(node) : false\n      );\n\n      // We cannot skip root nodes, so we check that the parent is not null.\n      // If the node should be skipped, then we don't add it to the tree and descend\n      // into its children without incrementing the depth.\n      if (parent && skipFn(treeNode)) {\n        for (let i = 0; i < node.children.length; i++) {\n          toTreeNode(node.children[i] as T, treeNode, parent.children, depth);\n        }\n        return;\n      }\n\n      if (collection) {\n        collection.push(treeNode);\n      }\n\n      for (let i = 0; i < node.children.length; i++) {\n        toTreeNode(node.children[i] as T, treeNode, treeNode.children, depth + 1);\n      }\n    }\n\n    for (let i = 0; i < items.length; i++) {\n      toTreeNode(items[i], null, roots, 0);\n    }\n\n    return new VirtualizedTree<T>(roots, undefined);\n  }\n\n  // Returns a list of nodes that are visible in the tree.\n  static toExpandedList<T extends TreeLike>(\n    nodes: VirtualizedTreeNode<T>[]\n  ): VirtualizedTreeNode<T>[] {\n    const list: VirtualizedTreeNode<T>[] = [];\n\n    function visit(node: VirtualizedTreeNode<T>): void {\n      list.push(node);\n\n      if (!node.expanded) {\n        return;\n      }\n\n      for (let i = 0; i < node.children.length; i++) {\n        visit(node.children[i]);\n      }\n    }\n\n    for (let i = 0; i < nodes.length; i++) {\n      visit(nodes[i]);\n    }\n\n    return list;\n  }\n\n  expandNode(\n    node: VirtualizedTreeNode<T>,\n    value: boolean,\n    opts?: {expandChildren: boolean}\n  ) {\n    // Because node.setExpanded handles toggling the node and all it's children, we still need to update the\n    // flattened list. To do that w/o having to rebuild the entire tree, we can just remove the node and add them\n    const removedOrAddedNodes = node.setExpanded(value, opts);\n\n    // If toggling the node resulted in no changes to the actual tree, do nothing\n    if (!removedOrAddedNodes.length) {\n      return removedOrAddedNodes;\n    }\n\n    // If a node was expanded, we need to add all of its children to the flattened list.\n    if (node.expanded) {\n      this.flattened.splice(this.flattened.indexOf(node) + 1, 0, ...removedOrAddedNodes);\n    } else {\n      // If a node was collapsed, we need to remove all of its children from the flattened list.\n      this.flattened.splice(this.flattened.indexOf(node) + 1, removedOrAddedNodes.length);\n    }\n\n    return removedOrAddedNodes;\n  }\n\n  // Sorts the entire tree and rebuilds the flattened list.\n  sort(sortFn: (a: VirtualizedTreeNode<T>, b: VirtualizedTreeNode<T>) => number) {\n    if (!this.roots.length) {\n      return;\n    }\n\n    function visit(node: VirtualizedTreeNode<T>) {\n      const sortedChildren = node.children.sort(sortFn);\n      for (let i = 0; i < sortedChildren.length; i++) {\n        visit(sortedChildren[i]);\n      }\n    }\n\n    const sortedRoots = this.roots.sort(sortFn);\n    for (let i = 0; i < sortedRoots.length; i++) {\n      visit(sortedRoots[i]);\n    }\n\n    this.flattened = VirtualizedTree.toExpandedList(this.roots);\n  }\n\n  getAllExpandedNodes(previouslyExpandedNodes: Set<T>): Set<T> {\n    const expandedNodes = new Set<T>([...previouslyExpandedNodes]);\n\n    function visit(node: VirtualizedTreeNode<T>) {\n      if (node.expanded) {\n        expandedNodes.add(node.node);\n      }\n\n      for (let i = 0; i < node.children.length; i++) {\n        visit(node.children[i]);\n      }\n    }\n\n    for (let i = 0; i < this.roots.length; i++) {\n      visit(this.roots[i]);\n    }\n\n    return expandedNodes;\n  }\n}\n","import {\n  MutableRefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\n\nimport theme from 'sentry/utils/theme';\nimport {useEffectAfterFirstRender} from 'sentry/utils/useEffectAfterFirstRender';\n\nimport {VirtualizedTree} from './VirtualizedTree';\nimport {VirtualizedTreeNode} from './VirtualizedTreeNode';\n\ntype AnimationTimeoutId = {\n  id: number;\n};\n\nconst cancelAnimationTimeout = (frame: AnimationTimeoutId) =>\n  window.cancelAnimationFrame(frame.id);\n\n/**\n * Recursively calls requestAnimationFrame until a specified delay has been met or exceeded.\n * When the delay time has been reached the function you're timing out will be called.\n * This was copied from react-virtualized, with credits to the original author.\n *\n * Credit: Joe Lambert (https://gist.github.com/joelambert/1002116#file-requesttimeout-js)\n */\nconst requestAnimationTimeout = (\n  callback: Function,\n  delay: number\n): AnimationTimeoutId => {\n  let start;\n  // wait for end of processing current event handler, because event handler may be long\n  Promise.resolve().then(() => {\n    start = Date.now();\n  });\n\n  const timeout = () => {\n    if (start === undefined) {\n      frame.id = window.requestAnimationFrame(timeout);\n      return;\n    }\n    if (Date.now() - start >= delay) {\n      callback();\n    } else {\n      frame.id = window.requestAnimationFrame(timeout);\n    }\n  };\n\n  const frame: AnimationTimeoutId = {\n    id: window.requestAnimationFrame(timeout),\n  };\n\n  return frame;\n};\n\nexport interface TreeLike {\n  children: TreeLike[];\n}\n\ninterface VirtualizedState<T> {\n  overscroll: number;\n  roots: T[];\n  scrollHeight: number;\n  scrollTop: number;\n  tabIndexKey: number | null;\n}\n\ninterface SetScrollTop {\n  payload: number;\n  type: 'set scroll top';\n}\n\ninterface SetTabIndexKey {\n  payload: number | null;\n  type: 'set tab index key';\n}\ninterface SetContainerHeight {\n  payload: number;\n  type: 'set scroll height';\n}\n\ntype VirtualizedStateAction = SetScrollTop | SetContainerHeight | SetTabIndexKey;\n\nexport function VirtualizedTreeStateReducer<T>(\n  state: VirtualizedState<T>,\n  action: VirtualizedStateAction\n): VirtualizedState<T> {\n  switch (action.type) {\n    case 'set tab index key': {\n      return {...state, tabIndexKey: action.payload};\n    }\n    case 'set scroll top': {\n      return {...state, scrollTop: action.payload};\n    }\n    case 'set scroll height': {\n      return {...state, scrollHeight: action.payload};\n    }\n    default: {\n      return state;\n    }\n  }\n}\n\nfunction hideGhostRow({ref}: {ref: MutableRefObject<HTMLElement | null>}) {\n  if (ref.current) {\n    ref.current.style.opacity = '0';\n  }\n}\n\nfunction updateGhostRow({\n  ref,\n  tabIndexKey,\n  rowHeight,\n  scrollTop,\n  interaction,\n}: {\n  interaction: 'hover' | 'active';\n  ref: MutableRefObject<HTMLElement | null>;\n  rowHeight: number;\n  scrollTop: number;\n  tabIndexKey: number;\n}) {\n  if (!ref.current) {\n    return;\n  }\n  ref.current.style.left = '0';\n  ref.current.style.right = '0';\n  ref.current.style.height = `${rowHeight}px`;\n  ref.current.style.position = 'absolute';\n  ref.current.style.backgroundColor =\n    interaction === 'active' ? theme.blue300 : theme.blue100;\n  ref.current.style.pointerEvents = 'none';\n  ref.current.style.willChange = 'transform, opacity';\n  ref.current.style.transform = `translateY(${rowHeight * tabIndexKey - scrollTop}px)`;\n  ref.current.style.opacity = '1';\n}\nfunction findOptimisticStartIndex<T extends TreeLike>({\n  items,\n  overscroll,\n  rowHeight,\n  scrollTop,\n  viewport,\n}: {\n  items: VirtualizedTreeNode<T>[];\n  overscroll: number;\n  rowHeight: number;\n  scrollTop: number;\n  viewport: {bottom: number; top: number};\n}): number {\n  if (!items.length || viewport.top === 0) {\n    return 0;\n  }\n  return Math.max(Math.floor(scrollTop / rowHeight) - overscroll, 0);\n}\n\nfunction findVisibleItems<T extends TreeLike>({\n  items,\n  overscroll,\n  rowHeight,\n  scrollHeight,\n  scrollTop,\n}: {\n  items: VirtualizedTreeNode<T>[];\n  overscroll: NonNullable<UseVirtualizedListProps<T>['overscroll']>;\n  rowHeight: UseVirtualizedListProps<T>['rowHeight'];\n  scrollHeight: VirtualizedState<T>['scrollHeight'];\n  scrollTop: VirtualizedState<T>['scrollTop'];\n}) {\n  // This is overscroll height for single direction, when computing the total,\n  // we need to multiply this by 2 because we overscroll in both directions.\n  const OVERSCROLL_HEIGHT = overscroll * rowHeight;\n  const visibleItems: VisibleItem<T>[] = [];\n\n  // Clamp viewport to scrollHeight bounds [0, length * rowHeight] because some browsers may fire\n  // scrollTop with negative values when the user scrolls up past the top of the list (overscroll behavior)\n  const viewport = {\n    top: Math.max(scrollTop - OVERSCROLL_HEIGHT, 0),\n    bottom: Math.min(\n      scrollTop + scrollHeight + OVERSCROLL_HEIGHT,\n      items.length * rowHeight\n    ),\n  };\n\n  // Points to the position inside the visible array\n  let visibleItemIndex = 0;\n  // Points to the currently iterated item\n  let indexPointer = findOptimisticStartIndex({\n    items,\n    viewport,\n    scrollTop,\n    rowHeight,\n    overscroll,\n  });\n\n  // Max number of visible items in our list\n  const MAX_VISIBLE_ITEMS = Math.ceil((scrollHeight + OVERSCROLL_HEIGHT * 2) / rowHeight);\n  const ALL_ITEMS = items.length;\n\n  // While number of visible items is less than max visible items, and we haven't reached the end of the list\n  while (visibleItemIndex < MAX_VISIBLE_ITEMS && indexPointer < ALL_ITEMS) {\n    const elementTop = indexPointer * rowHeight;\n    const elementBottom = elementTop + rowHeight;\n\n    // An element is inside a viewport if the top of the element is below the top of the viewport\n    // and the bottom of the element is above the bottom of the viewport\n    if (elementTop >= viewport.top && elementBottom <= viewport.bottom) {\n      visibleItems[visibleItemIndex] = {\n        key: indexPointer,\n        ref: null,\n        styles: {position: 'absolute', top: elementTop},\n        item: items[indexPointer],\n      };\n\n      visibleItemIndex++;\n    }\n    indexPointer++;\n  }\n\n  return visibleItems;\n}\n\ninterface VisibleItem<T> {\n  item: VirtualizedTreeNode<T>;\n  key: number;\n  ref: HTMLElement | null;\n  styles: React.CSSProperties;\n}\n\nexport interface UseVirtualizedListProps<T extends TreeLike> {\n  renderRow: (\n    item: VisibleItem<T>,\n    itemHandlers: {\n      handleExpandTreeNode: (\n        node: VirtualizedTreeNode<T>,\n        opts?: {expandChildren: boolean}\n      ) => void;\n      handleRowClick: (evt: React.MouseEvent<HTMLElement>) => void;\n      handleRowKeyDown: (event: React.KeyboardEvent) => void;\n      handleRowMouseEnter: (event: React.MouseEvent<HTMLElement>) => void;\n      tabIndexKey: number | null;\n    }\n  ) => React.ReactNode;\n  roots: T[];\n  rowHeight: number;\n  scrollContainer: HTMLElement | null;\n  overscroll?: number;\n  skipFunction?: (node: VirtualizedTreeNode<T>) => boolean;\n  sortFunction?: (a: VirtualizedTreeNode<T>, b: VirtualizedTreeNode<T>) => number;\n}\n\nconst DEFAULT_OVERSCROLL_ITEMS = 5;\n\nfunction findCarryOverIndex<T extends TreeLike>(\n  previousNode: VirtualizedTreeNode<T> | null | undefined,\n  newTree: VirtualizedTree<T>\n): number | null {\n  if (!newTree.flattened.length || !previousNode) {\n    return null;\n  }\n\n  const newIndex = newTree.flattened.findIndex(n => n.node === previousNode.node);\n  if (newIndex === -1) {\n    return null;\n  }\n  return newIndex;\n}\n\nexport function useVirtualizedTree<T extends TreeLike>(\n  props: UseVirtualizedListProps<T>\n) {\n  const clickedGhostRowRef = useRef<HTMLDivElement | null>(null);\n  const hoveredGhostRowRef = useRef<HTMLDivElement | null>(null);\n\n  const previousHoveredRow = useRef<number | null>(null);\n\n  const [state, dispatch] = useReducer(VirtualizedTreeStateReducer, {\n    scrollTop: 0,\n    roots: props.roots,\n    tabIndexKey: null,\n    overscroll: props.overscroll ?? DEFAULT_OVERSCROLL_ITEMS,\n    scrollHeight: props.scrollContainer?.getBoundingClientRect()?.height ?? 0,\n  });\n\n  // Keep a ref to latest state to avoid re-rendering\n  const latestStateRef = useRef<typeof state>(state);\n  latestStateRef.current = state;\n  const [tree, setTree] = useState(() => {\n    const initialTree = VirtualizedTree.fromRoots(props.roots, props.skipFunction);\n\n    if (props.sortFunction) {\n      initialTree.sort(props.sortFunction);\n    }\n\n    return initialTree;\n  });\n\n  const cleanupAllHoveredRows = useCallback(() => {\n    for (const row of latestItemsRef.current) {\n      if (row.ref && row.ref.dataset.hovered) {\n        delete row.ref.dataset.hovered;\n      }\n    }\n  }, []);\n\n  const expandedHistory = useRef<Set<T>>(new Set());\n  useEffectAfterFirstRender(() => {\n    const expandedNodes = tree.getAllExpandedNodes(expandedHistory.current);\n    const newTree = VirtualizedTree.fromRoots(\n      props.roots,\n      props.skipFunction,\n      expandedNodes\n    );\n\n    expandedHistory.current = expandedNodes;\n\n    if (props.sortFunction) {\n      newTree.sort(props.sortFunction);\n    }\n\n    const tabIndex = findCarryOverIndex(\n      latestStateRef.current.tabIndexKey\n        ? tree.flattened[latestStateRef.current.tabIndexKey]\n        : null,\n      newTree\n    );\n\n    if (tabIndex) {\n      updateGhostRow({\n        ref: clickedGhostRowRef,\n        tabIndexKey: tabIndex,\n        rowHeight: props.rowHeight,\n        scrollTop: latestStateRef.current.scrollTop,\n        interaction: 'active',\n      });\n    } else {\n      hideGhostRow({ref: clickedGhostRowRef});\n    }\n\n    cleanupAllHoveredRows();\n    hideGhostRow({ref: hoveredGhostRowRef});\n\n    dispatch({type: 'set tab index key', payload: tabIndex});\n    setTree(newTree);\n  }, [props.roots, props.skipFunction, cleanupAllHoveredRows]);\n\n  const items = useMemo(() => {\n    return findVisibleItems<T>({\n      items: tree.flattened,\n      scrollHeight: state.scrollHeight,\n      scrollTop: state.scrollTop,\n      overscroll: state.overscroll,\n      rowHeight: props.rowHeight,\n    });\n  }, [tree, state.overscroll, state.scrollHeight, state.scrollTop, props.rowHeight]);\n\n  const latestItemsRef = useRef(items);\n  latestItemsRef.current = items;\n\n  // On scroll, we update scrollTop position.\n  // Keep a rafId reference in the unlikely event where component unmounts before raf is executed.\n  const scrollEndTimeoutId = useRef<AnimationTimeoutId | undefined>(undefined);\n  useEffect(() => {\n    const scrollContainer = props.scrollContainer;\n\n    if (!scrollContainer) {\n      return undefined;\n    }\n\n    const handleScroll = evt => {\n      evt.target.firstChild.style.pointerEvents = 'none';\n\n      if (scrollEndTimeoutId.current !== undefined) {\n        cancelAnimationTimeout(scrollEndTimeoutId.current);\n      }\n\n      scrollEndTimeoutId.current = requestAnimationTimeout(() => {\n        evt.target.firstChild.style.pointerEvents = 'auto';\n      }, 150);\n\n      dispatch({\n        type: 'set scroll top',\n        payload: Math.max(evt.target.scrollTop, 0),\n      });\n\n      // On scroll, we need to update the selected ghost row and clear the hovered ghost row\n      if (latestStateRef.current.tabIndexKey !== null) {\n        updateGhostRow({\n          ref: clickedGhostRowRef,\n          tabIndexKey: latestStateRef.current.tabIndexKey,\n          scrollTop: Math.max(evt.target.scrollTop, 0),\n          interaction: 'active',\n          rowHeight: props.rowHeight,\n        });\n      }\n\n      cleanupAllHoveredRows();\n      hideGhostRow({\n        ref: hoveredGhostRowRef,\n      });\n    };\n\n    scrollContainer.addEventListener('scroll', handleScroll, {\n      passive: true,\n    });\n\n    return () => {\n      scrollContainer.removeEventListener('scroll', handleScroll);\n    };\n  }, [props.scrollContainer, props.rowHeight, cleanupAllHoveredRows]);\n\n  useEffect(() => {\n    const scrollContainer = props.scrollContainer;\n\n    if (!scrollContainer) {\n      return undefined;\n    }\n\n    // Because nodes dont span the full width, it's possible for users to\n    // click or hover on a node at the far right end which is outside of the row width.\n    // In that case, we check if the cursor position overlaps with a row and select that row.\n    const handleClick = (evt: MouseEvent) => {\n      if (evt.target !== scrollContainer) {\n        // user clicked on an element inside the container, defer to onClick\n        return;\n      }\n\n      const rect = (evt.target as HTMLDivElement).getBoundingClientRect();\n      const index = Math.floor(\n        (latestStateRef.current.scrollTop + evt.clientY - rect.top) / props.rowHeight\n      );\n\n      // If a node exists at the index, select it\n      if (tree.flattened[index]) {\n        dispatch({type: 'set tab index key', payload: index});\n        updateGhostRow({\n          ref: clickedGhostRowRef,\n          tabIndexKey: index,\n          scrollTop: latestStateRef.current.scrollTop,\n          rowHeight: props.rowHeight,\n          interaction: 'active',\n        });\n      }\n    };\n\n    // Because nodes dont span the full width, it's possible for users to\n    // click on a node at the far right end which is outside of the row width.\n    // In that case, check if the top position where the user clicked overlaps\n    // with a row and select that row.\n    const handleMouseMove = (evt: MouseEvent) => {\n      if (evt.target !== scrollContainer) {\n        // user clicked on an element inside the container, defer to onClick\n        return;\n      }\n\n      const rect = (evt.target as HTMLDivElement).getBoundingClientRect();\n      const index = Math.floor(\n        (latestStateRef.current.scrollTop + evt.clientY - rect.top) / props.rowHeight\n      );\n\n      cleanupAllHoveredRows();\n      const element = latestItemsRef.current.find(item => item.key === index);\n      if (element?.ref) {\n        element.ref.dataset.hovered = 'true';\n      }\n\n      // If a node exists at the index, select it\n      if (tree.flattened[index] && index !== latestStateRef.current.tabIndexKey) {\n        updateGhostRow({\n          ref: hoveredGhostRowRef,\n          tabIndexKey: index,\n          scrollTop: latestStateRef.current.scrollTop,\n          rowHeight: props.rowHeight,\n          interaction: 'hover',\n        });\n      }\n    };\n\n    scrollContainer.addEventListener('click', handleClick);\n    scrollContainer.addEventListener('mousemove', handleMouseMove);\n\n    return () => {\n      scrollContainer.removeEventListener('click', handleClick);\n      scrollContainer.removeEventListener('mousemove', handleMouseMove);\n    };\n  }, [props.rowHeight, props.scrollContainer, tree.flattened, cleanupAllHoveredRows]);\n\n  // When mouseleave is triggered on the contianer,\n  // we need to hide the ghost row to avoid an orphaned row\n  useEffect(() => {\n    const container = props.scrollContainer;\n    if (!container) {\n      return undefined;\n    }\n\n    function onMouseLeave() {\n      cleanupAllHoveredRows();\n      hideGhostRow({\n        ref: hoveredGhostRowRef,\n      });\n    }\n    container.addEventListener('mouseleave', onMouseLeave, {\n      passive: true,\n    });\n\n    return () => {\n      container.removeEventListener('mouseleave', onMouseLeave);\n    };\n  }, [cleanupAllHoveredRows, props.scrollContainer]);\n\n  // When a node is expanded, the underlying tree is recomputed (the flattened tree is updated)\n  // We copy the properties of the old tree by creating a new instance of VirtualizedTree\n  // and passing in the roots and its flattened representation so that no extra work is done.\n  const handleExpandTreeNode = useCallback(\n    (node: VirtualizedTreeNode<T>, opts?: {expandChildren: boolean}) => {\n      // When we expand nodes, tree.expand will mutate the underlying tree which then\n      // gets copied to the new tree instance. To get the right index, we need to read\n      // it before any mutations are made\n      const previousNode = latestStateRef.current.tabIndexKey\n        ? tree.flattened[latestStateRef.current.tabIndexKey] ?? null\n        : null;\n\n      tree.expandNode(node, !node.expanded, opts);\n      const newTree = new VirtualizedTree(tree.roots, tree.flattened);\n      expandedHistory.current = newTree.getAllExpandedNodes(new Set());\n\n      // Hide or update the ghost if necessary\n      const tabIndex = findCarryOverIndex(previousNode, newTree);\n      if (tabIndex === null) {\n        hideGhostRow({ref: clickedGhostRowRef});\n      } else {\n        updateGhostRow({\n          ref: clickedGhostRowRef,\n          tabIndexKey: tabIndex,\n          scrollTop: Math.max(latestStateRef.current.scrollTop, 0),\n          interaction: 'active',\n          rowHeight: props.rowHeight,\n        });\n      }\n\n      dispatch({type: 'set tab index key', payload: tabIndex});\n      setTree(newTree);\n    },\n    [tree, props.rowHeight]\n  );\n\n  // When a tree is sorted, we sort all of the nodes in the tree and not just the visible ones\n  // We could probably optimize this to lazily sort as we scroll, but since we want the least amount\n  // of work during scrolling, we just sort the entire tree every time.\n  const handleSortingChange = useCallback(\n    (sortFn: (a: VirtualizedTreeNode<T>, b: VirtualizedTreeNode<T>) => number) => {\n      // When we sort nodes, tree.sort will mutate the underlying tree which then\n      // gets copied to the new tree instance. To get the right index, we need to read\n      // it before any mutations are made\n      const previousNode = latestStateRef.current.tabIndexKey\n        ? tree.flattened[latestStateRef.current.tabIndexKey] ?? null\n        : null;\n\n      tree.sort(sortFn);\n      const newTree = new VirtualizedTree(tree.roots, tree.flattened);\n\n      // Hide or update the ghost if necessary\n      const tabIndex = findCarryOverIndex(previousNode, newTree);\n      if (tabIndex === null) {\n        hideGhostRow({ref: clickedGhostRowRef});\n      } else {\n        updateGhostRow({\n          ref: clickedGhostRowRef,\n          tabIndexKey: tabIndex,\n          scrollTop: Math.max(latestStateRef.current.scrollTop, 0),\n          interaction: 'active',\n          rowHeight: props.rowHeight,\n        });\n      }\n\n      dispatch({type: 'set tab index key', payload: tabIndex});\n      setTree(newTree);\n    },\n    [tree, props.rowHeight]\n  );\n\n  // When a row is clicked, we update the selected node\n  const handleRowClick = useCallback(\n    (tabIndexKey: number) => {\n      return (_evt: React.MouseEvent<HTMLElement>) => {\n        dispatch({type: 'set tab index key', payload: tabIndexKey});\n        updateGhostRow({\n          ref: clickedGhostRowRef,\n          tabIndexKey,\n          scrollTop: state.scrollTop,\n          rowHeight: props.rowHeight,\n          interaction: 'active',\n        });\n      };\n    },\n    [state.scrollTop, props.rowHeight]\n  );\n\n  // Keyboard navigation for row\n  const handleRowKeyDown = useCallback(\n    (event: React.KeyboardEvent) => {\n      if (latestStateRef.current.tabIndexKey === null) {\n        return;\n      }\n\n      if (event.key === 'Enter') {\n        handleExpandTreeNode(tree.flattened[latestStateRef.current.tabIndexKey], {\n          expandChildren: true,\n        });\n      }\n\n      if (event.key === 'ArrowDown') {\n        event.preventDefault();\n        const indexInVisibleItems = items.findIndex(\n          i => i.key === latestStateRef.current.tabIndexKey\n        );\n\n        if (indexInVisibleItems !== -1) {\n          const nextIndex = indexInVisibleItems + 1;\n\n          // Bounds check if we are at end of list\n          if (nextIndex > tree.flattened.length - 1) {\n            return;\n          }\n\n          dispatch({type: 'set tab index key', payload: items[nextIndex].key});\n          updateGhostRow({\n            ref: clickedGhostRowRef,\n            tabIndexKey: items[nextIndex].key,\n            scrollTop: latestStateRef.current.scrollTop,\n            rowHeight: props.rowHeight,\n            interaction: 'active',\n          });\n          items[nextIndex].ref?.focus({preventScroll: true});\n          items[nextIndex].ref?.scrollIntoView({block: 'nearest'});\n        }\n      }\n\n      if (event.key === 'ArrowUp') {\n        event.preventDefault();\n        const indexInVisibleItems = items.findIndex(\n          i => i.key === latestStateRef.current.tabIndexKey\n        );\n\n        if (indexInVisibleItems !== -1) {\n          const nextIndex = indexInVisibleItems - 1;\n\n          // Bound check if we are at start of list\n          if (nextIndex < 0) {\n            return;\n          }\n\n          dispatch({type: 'set tab index key', payload: items[nextIndex].key});\n          updateGhostRow({\n            ref: clickedGhostRowRef,\n            tabIndexKey: items[nextIndex].key,\n            scrollTop: latestStateRef.current.scrollTop,\n            rowHeight: props.rowHeight,\n            interaction: 'active',\n          });\n          items[nextIndex].ref?.focus({preventScroll: true});\n          items[nextIndex].ref?.scrollIntoView({block: 'nearest'});\n        }\n      }\n    },\n    [handleExpandTreeNode, items, tree.flattened, props.rowHeight]\n  );\n\n  // When a row is hovered, we update the ghost row\n  const handleRowMouseEnter = useCallback(\n    (key: number) => {\n      return (_evt: React.MouseEvent<HTMLElement>) => {\n        if (previousHoveredRow.current !== key) {\n          cleanupAllHoveredRows();\n\n          (_evt.currentTarget as HTMLElement).dataset.hovered = 'true';\n          previousHoveredRow.current = key;\n        }\n        updateGhostRow({\n          ref: hoveredGhostRowRef,\n          tabIndexKey: key,\n          scrollTop: state.scrollTop,\n          rowHeight: props.rowHeight,\n          interaction: 'hover',\n        });\n      };\n    },\n    [state.scrollTop, props.rowHeight, cleanupAllHoveredRows]\n  );\n\n  // Register a resize observer for when the scroll container is resized.\n  // When the container is resized, update the scroll height in our state.\n  // Similarly to handleScroll, we use requestAnimationFrame to avoid overupdating the UI\n  useEffect(() => {\n    if (!props.scrollContainer) {\n      return undefined;\n    }\n    let rafId: number | undefined;\n    const resizeObserver = new window.ResizeObserver(elements => {\n      rafId = window.requestAnimationFrame(() => {\n        dispatch({\n          type: 'set scroll height',\n          payload: elements[0]?.contentRect?.height ?? 0,\n        });\n        cleanupAllHoveredRows();\n        hideGhostRow({\n          ref: hoveredGhostRowRef,\n        });\n      });\n    });\n\n    resizeObserver.observe(props.scrollContainer);\n\n    return () => {\n      if (typeof rafId === 'number') {\n        window.cancelAnimationFrame(rafId);\n      }\n      resizeObserver.disconnect();\n    };\n  }, [props.scrollContainer, cleanupAllHoveredRows]);\n\n  // Basic required styles for the scroll container\n  const scrollContainerStyles: React.CSSProperties = useMemo(() => {\n    return {\n      height: '100%',\n      overflow: 'auto',\n      position: 'relative',\n      willChange: 'transform',\n    };\n  }, []);\n\n  // Basic styles for the element container. We fake the height so that the\n  // scrollbar is sized according to the number of items in the list.\n  const containerStyles: React.CSSProperties = useMemo(() => {\n    const height = tree.flattened.length * props.rowHeight;\n    return {height, maxHeight: height};\n  }, [tree.flattened.length, props.rowHeight]);\n\n  const renderRow = props.renderRow;\n  const renderedItems: React.ReactNode[] = useMemo(() => {\n    const renderered: React.ReactNode[] = [];\n\n    // It is important that we do not create a copy of item\n    // because refs will assign the dom node to the item.\n    // If we map, we get a new object that our internals will not be able to access.\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      renderered.push(\n        renderRow(item, {\n          handleRowClick: handleRowClick(item.key),\n          handleExpandTreeNode,\n          handleRowKeyDown,\n          handleRowMouseEnter: handleRowMouseEnter(item.key),\n          tabIndexKey: state.tabIndexKey,\n        })\n      );\n    }\n\n    return renderered;\n  }, [\n    items,\n    handleRowClick,\n    handleRowKeyDown,\n    state.tabIndexKey,\n    handleRowMouseEnter,\n    handleExpandTreeNode,\n    renderRow,\n  ]);\n\n  // Register a resize observer for when the scroll container is resized.\n  // When the container is resized, update the scroll height in our state.\n  // Similarly to handleScroll, we use requestAnimationFrame to avoid overupdating the UI\n  useEffect(() => {\n    if (!props.scrollContainer) {\n      return undefined;\n    }\n    let rafId: number | undefined;\n    const resizeObserver = new window.ResizeObserver(elements => {\n      rafId = window.requestAnimationFrame(() => {\n        dispatch({\n          type: 'set scroll height',\n          payload: elements[0]?.contentRect?.height ?? 0,\n        });\n      });\n    });\n\n    resizeObserver.observe(props.scrollContainer);\n\n    return () => {\n      if (typeof rafId === 'number') {\n        window.cancelAnimationFrame(rafId);\n      }\n      resizeObserver.disconnect();\n    };\n  }, [props.scrollContainer]);\n\n  return {\n    tree,\n    items,\n    renderedItems,\n    tabIndexKey: state.tabIndexKey,\n    dispatch,\n    handleRowClick,\n    handleRowKeyDown,\n    handleRowMouseEnter,\n    handleExpandTreeNode,\n    handleSortingChange,\n    scrollContainerStyles,\n    containerStyles,\n    clickedGhostRowRef,\n    hoveredGhostRowRef,\n  };\n}\n","import {forwardRef} from 'react';\nimport styled from '@emotion/styled';\n\nimport {IconCheckmark} from 'sentry/icons';\nimport space from 'sentry/styles/space';\n\ninterface MenuProps\n  extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  children: React.ReactNode;\n}\n\nconst Menu = styled(\n  forwardRef((props: MenuProps, ref: React.Ref<HTMLDivElement> | undefined) => {\n    return <div ref={ref} role=\"menu\" {...props} />;\n  })\n)`\n  position: absolute;\n  font-size: ${p => p.theme.fontSizeMedium};\n  z-index: ${p => p.theme.zIndex.dropdown};\n  background: ${p => p.theme.backgroundElevated};\n  border: 1px solid ${p => p.theme.border};\n  border-radius: ${p => p.theme.borderRadius};\n  box-shadow: ${p => p.theme.dropShadowHeavy};\n  width: auto;\n  min-width: 164px;\n  overflow: auto;\n  padding-bottom: ${space(0.5)};\n`;\n\nexport {Menu as ProfilingContextMenu};\n\nconst MenuContentContainer = styled('div')`\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  font-weight: normal;\n  padding: 0 ${space(1)};\n  border-radius: ${p => p.theme.borderRadius};\n  box-sizing: border-box;\n  background: ${p => (p.tabIndex === 0 ? p.theme.hover : undefined)};\n\n  &:focus {\n    color: ${p => p.theme.textColor};\n    background: ${p => p.theme.hover};\n    outline: none;\n  }\n`;\n\nconst MenuItemCheckboxLabel = styled('label')`\n  display: flex;\n  align-items: center;\n  font-weight: normal;\n  margin: 0;\n  cursor: pointer;\n  flex: 1 1 100%;\n`;\n\ninterface MenuItemCheckboxProps\n  extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  checked?: boolean;\n}\n\nconst MenuItemCheckbox = forwardRef(\n  (props: MenuItemCheckboxProps, ref: React.Ref<HTMLDivElement> | undefined) => {\n    const {children, checked, ...rest} = props;\n\n    return (\n      <MenuContentOuterContainer>\n        <MenuContentContainer ref={ref} role=\"menuitem\" {...rest}>\n          <MenuItemCheckboxLabel>\n            <MenuLeadingItem>\n              <Input type=\"checkbox\" checked={checked} onChange={() => void 0} />\n              <IconCheckmark />\n            </MenuLeadingItem>\n            <MenuContent>{children}</MenuContent>\n          </MenuItemCheckboxLabel>\n        </MenuContentContainer>\n      </MenuContentOuterContainer>\n    );\n  }\n);\n\nexport {MenuItemCheckbox as ProfilingContextMenuItemCheckbox};\n\nconst MenuLeadingItem = styled('div')`\n  display: flex;\n  align-items: center;\n  height: 1.4em;\n  width: 1em;\n  gap: ${space(1)};\n  padding: ${space(1)} 0;\n  position: relative;\n`;\n\nconst MenuContent = styled('div')`\n  position: relative;\n  width: 100%;\n  display: flex;\n  gap: ${space(0.5)};\n  justify-content: space-between;\n  padding: ${space(0.5)} 0;\n  margin-left: ${space(0.5)};\n  text-transform: capitalize;\n\n  margin-bottom: 0;\n  line-height: 1.4;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst Input = styled('input')`\n  position: absolute;\n  opacity: 0;\n  cursor: pointer;\n  height: 0;\n  padding-right: ${space(1)};\n\n  & + svg {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 1em;\n    height: 1.4em;\n    display: none;\n  }\n\n  &:checked + svg {\n    display: block;\n  }\n`;\n\ninterface MenuItemProps\n  extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  children: React.ReactNode;\n}\n\nconst MenuItem = styled(\n  forwardRef((props: MenuItemProps, ref: React.Ref<HTMLDivElement> | undefined) => {\n    const {children, ...rest} = props;\n    return (\n      <MenuContentOuterContainer>\n        <MenuContentContainer ref={ref} role=\"menuitem\" {...rest}>\n          <MenuContent>{children}</MenuContent>\n        </MenuContentContainer>\n      </MenuContentOuterContainer>\n    );\n  })\n)`\n  cursor: pointer;\n  color: ${p => p.theme.textColor};\n  background: transparent;\n  padding: 0 ${space(0.5)};\n\n  &:focus {\n    outline: none;\n  }\n\n  &:active: {\n    background: transparent;\n  }\n`;\n\nexport {MenuItem as ProfilingContextMenuItem};\n\nconst MenuContentOuterContainer = styled('div')`\n  padding: 0 ${space(0.5)};\n`;\n\nconst MenuGroup = styled('div')`\n  padding-top: 0;\n  padding-bottom: ${space(1)};\n\n  &:last-of-type {\n    padding-bottom: 0;\n  }\n`;\n\nexport {MenuGroup as ProfilingContextMenuGroup};\n\ninterface MenuHeadingProps\n  extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  children: React.ReactNode;\n}\n\nconst MenuHeading = styled((props: MenuHeadingProps) => {\n  const {children, ...rest} = props;\n  return <div {...rest}>{children}</div>;\n})`\n  text-transform: uppercase;\n  line-height: 1.5;\n  font-weight: 600;\n  color: ${p => p.theme.subText};\n  margin-bottom: 0;\n  cursor: default;\n  font-size: 75%;\n  padding: ${space(0.5)} ${space(1.5)};\n`;\n\nexport {MenuHeading as ProfilingContextMenuHeading};\n\nconst Layer = styled('div')`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: ${p => p.theme.zIndex.dropdown - 1};\n`;\n\nexport {Layer as ProfilingContextMenuLayer};\n","import {Fragment} from 'react';\n\nimport {\n  ProfilingContextMenu,\n  ProfilingContextMenuGroup,\n  ProfilingContextMenuHeading,\n  ProfilingContextMenuItem,\n  ProfilingContextMenuLayer,\n} from 'sentry/components/profiling/ProfilingContextMenu/profilingContextMenu';\nimport {t} from 'sentry/locale';\nimport {useContextMenu} from 'sentry/utils/profiling/hooks/useContextMenu';\n\ninterface FrameStackContextMenuProps {\n  contextMenu: ReturnType<typeof useContextMenu>;\n  onZoomIntoNodeClick: (evt: React.MouseEvent<HTMLDivElement>) => void;\n}\n\nexport function FrameStackContextMenu(props: FrameStackContextMenuProps) {\n  return props.contextMenu.open ? (\n    <Fragment>\n      <ProfilingContextMenuLayer onClick={() => props.contextMenu.setOpen(false)} />\n      <ProfilingContextMenu\n        {...props.contextMenu.getMenuProps()}\n        style={{\n          position: 'absolute',\n          left: props.contextMenu.position?.left ?? -9999,\n          top: props.contextMenu.position?.top ?? -9999,\n          maxHeight: props.contextMenu.containerCoordinates?.height ?? 'auto',\n        }}\n      >\n        <ProfilingContextMenuGroup>\n          <ProfilingContextMenuHeading>{t('Flamegraph')}</ProfilingContextMenuHeading>\n          <ProfilingContextMenuItem\n            {...props.contextMenu.getMenuItemProps()}\n            onClick={props.onZoomIntoNodeClick}\n          >\n            {t('Scope view to this node')}\n          </ProfilingContextMenuItem>\n        </ProfilingContextMenuGroup>\n      </ProfilingContextMenu>\n    </Fragment>\n  ) : null;\n}\n","import {forwardRef, useCallback, useMemo} from 'react';\nimport styled from '@emotion/styled';\n\nimport {IconSettings, IconUser} from 'sentry/icons';\nimport space from 'sentry/styles/space';\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {formatColorForFrame} from 'sentry/utils/profiling/gl/utils';\nimport {VirtualizedTreeNode} from 'sentry/utils/profiling/hooks/useVirtualizedTree/VirtualizedTreeNode';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\n\nimport {FrameCallersTableCell} from './frameStack';\n\nfunction computeRelativeWeight(base: number, value: number) {\n  // Make sure we dont divide by zero\n  if (!base || !value) {\n    return 0;\n  }\n  return (value / base) * 100;\n}\n\ninterface FrameStackTableRowProps {\n  flamegraphRenderer: FlamegraphRenderer;\n  node: VirtualizedTreeNode<FlamegraphFrame>;\n  onClick: React.MouseEventHandler<HTMLDivElement>;\n  onContextMenu: React.MouseEventHandler<HTMLDivElement>;\n  onExpandClick: (\n    node: VirtualizedTreeNode<FlamegraphFrame>,\n    opts?: {expandChildren: boolean}\n  ) => void;\n  onKeyDown: React.KeyboardEventHandler<HTMLDivElement>;\n  onMouseEnter: React.MouseEventHandler<HTMLDivElement>;\n  referenceNode: FlamegraphFrame;\n  style: React.CSSProperties;\n  tabIndex: number;\n}\n\nexport const FrameStackTableRow = forwardRef<HTMLDivElement, FrameStackTableRowProps>(\n  (\n    {\n      node,\n      flamegraphRenderer,\n      referenceNode,\n      onExpandClick,\n      onContextMenu,\n      tabIndex,\n      onKeyDown,\n      onClick,\n      onMouseEnter,\n      style,\n    },\n    ref\n  ) => {\n    const isSelected = tabIndex === 0;\n    const colorString = useMemo(() => {\n      return formatColorForFrame(node.node, flamegraphRenderer);\n    }, [node, flamegraphRenderer]);\n\n    const handleExpanding = useCallback(\n      (evt: React.MouseEvent) => {\n        evt.stopPropagation();\n        onExpandClick(node, {expandChildren: evt.metaKey});\n      },\n      [node, onExpandClick]\n    );\n\n    return (\n      <FrameCallersRow\n        ref={ref}\n        style={style}\n        onContextMenu={onContextMenu}\n        tabIndex={tabIndex}\n        isSelected={isSelected}\n        onKeyDown={onKeyDown}\n        onClick={onClick}\n        onMouseEnter={onMouseEnter}\n      >\n        <FrameCallersTableCell isSelected={isSelected} textAlign=\"right\">\n          {flamegraphRenderer.flamegraph.formatter(node.node.node.selfWeight)}\n          <Weight\n            isSelected={isSelected}\n            weight={computeRelativeWeight(\n              referenceNode.node.totalWeight,\n              node.node.node.selfWeight\n            )}\n          />\n        </FrameCallersTableCell>\n        <FrameCallersTableCell isSelected={isSelected} noPadding textAlign=\"right\">\n          <FrameWeightTypeContainer>\n            <FrameWeightContainer>\n              {flamegraphRenderer.flamegraph.formatter(node.node.node.totalWeight)}\n              <Weight\n                isSelected={isSelected}\n                weight={computeRelativeWeight(\n                  referenceNode.node.totalWeight,\n                  node.node.node.totalWeight\n                )}\n              />\n            </FrameWeightContainer>\n            <FrameTypeIndicator isSelected={isSelected}>\n              {node.node.node.frame.is_application ? (\n                <IconUser size=\"xs\" />\n              ) : (\n                <IconSettings size=\"xs\" />\n              )}\n            </FrameTypeIndicator>\n          </FrameWeightTypeContainer>\n        </FrameCallersTableCell>\n        <FrameCallersTableCell\n          // We stretch this table to 100% width.\n          style={{paddingLeft: node.depth * 14 + 8, width: '100%'}}\n        >\n          <FrameNameContainer>\n            <FrameColorIndicator style={{backgroundColor: colorString}} />\n            <FrameChildrenIndicator\n              tabIndex={-1}\n              onClick={handleExpanding}\n              open={node.expanded}\n            >\n              {node.node.children.length > 0 ? '\\u203A' : null}\n            </FrameChildrenIndicator>\n            <FrameName>{node.node.frame.name}</FrameName>\n          </FrameNameContainer>\n        </FrameCallersTableCell>\n      </FrameCallersRow>\n    );\n  }\n);\n\nconst Weight = styled((props: {isSelected: boolean; weight: number}) => {\n  const {weight, isSelected: _, ...rest} = props;\n  return (\n    <div {...rest}>\n      {weight.toFixed(1)}%\n      <BackgroundWeightBar style={{transform: `scaleX(${weight / 100})`}} />\n    </div>\n  );\n})`\n  display: inline-block;\n  min-width: 7ch;\n  color: ${p => (p.isSelected ? p.theme.white : p.theme.subText)};\n  opacity: ${p => (p.isSelected ? 0.8 : 1)};\n`;\n\nconst FrameWeightTypeContainer = styled('div')`\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  position: relative;\n`;\n\nconst FrameTypeIndicator = styled('div')<{isSelected: boolean}>`\n  flex-shrink: 0;\n  width: 26px;\n  height: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: ${p => (p.isSelected ? p.theme.white : p.theme.subText)};\n  opacity: ${p => (p.isSelected ? 0.8 : 1)};\n`;\n\nconst FrameWeightContainer = styled('div')`\n  display: flex;\n  align-items: center;\n  position: relative;\n  justify-content: flex-end;\n  flex: 1 1 100%;\n`;\n\nconst BackgroundWeightBar = styled('div')`\n  pointer-events: none;\n  position: absolute;\n  right: 0;\n  top: 0;\n  background-color: ${props => props.theme.yellow100};\n  border-bottom: 1px solid ${props => props.theme.yellow200};\n  transform-origin: center right;\n  height: 100%;\n  width: 100%;\n`;\n\nconst FrameCallersRow = styled('div')<{isSelected: boolean}>`\n  display: flex;\n  width: calc(100% + 400px);\n  color: ${p => (p.isSelected ? p.theme.white : 'inherit')};\n\n  &:focus {\n    outline: none;\n  }\n\n  &[data-hovered='true']:not([tabindex='0']) {\n    > div:first-child,\n    > div:nth-child(2) {\n      background-color: #edf2fc !important;\n    }\n  }\n`;\n\nconst FrameNameContainer = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst FrameChildrenIndicator = styled('button')<{open: boolean}>`\n  width: 10px;\n  height: 10px;\n  display: flex;\n  padding: 0;\n  border: none;\n  background-color: transparent;\n  align-items: center;\n  justify-content: center;\n  user-select: none;\n  transform: ${p => (p.open ? 'rotate(90deg)' : 'rotate(0deg)')};\n`;\n\nconst FrameName = styled('span')`\n  margin-left: ${space(0.5)};\n`;\n\nconst FrameColorIndicator = styled('div')`\n  width: 12px;\n  height: 12px;\n  border-radius: 2px;\n  display: inline-block;\n  flex-shrink: 0;\n  margin-right: ${space(0.5)};\n`;\n","import {useCallback, useMemo, useState} from 'react';\nimport styled from '@emotion/styled';\n\nimport {IconArrow} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {CanvasPoolManager} from 'sentry/utils/profiling/canvasScheduler';\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {useContextMenu} from 'sentry/utils/profiling/hooks/useContextMenu';\nimport {\n  UseVirtualizedListProps,\n  useVirtualizedTree,\n} from 'sentry/utils/profiling/hooks/useVirtualizedTree/useVirtualizedTree';\nimport {VirtualizedTreeNode} from 'sentry/utils/profiling/hooks/useVirtualizedTree/VirtualizedTreeNode';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\nimport theme from 'sentry/utils/theme';\n\nimport {FrameCallersTableCell} from './frameStack';\nimport {FrameStackContextMenu} from './frameStackContextMenu';\nimport {FrameStackTableRow} from './frameStackTableRow';\n\nfunction makeSortFunction(\n  property: 'total weight' | 'self weight' | 'name',\n  direction: 'asc' | 'desc'\n) {\n  if (property === 'total weight') {\n    return direction === 'desc'\n      ? (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return b.node.node.totalWeight - a.node.node.totalWeight;\n        }\n      : (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return a.node.node.totalWeight - b.node.node.totalWeight;\n        };\n  }\n\n  if (property === 'self weight') {\n    return direction === 'desc'\n      ? (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return b.node.node.selfWeight - a.node.node.selfWeight;\n        }\n      : (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return a.node.node.selfWeight - b.node.node.selfWeight;\n        };\n  }\n\n  if (property === 'name') {\n    return direction === 'desc'\n      ? (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return a.node.frame.name.localeCompare(b.node.frame.name);\n        }\n      : (\n          a: VirtualizedTreeNode<FlamegraphFrame>,\n          b: VirtualizedTreeNode<FlamegraphFrame>\n        ) => {\n          return b.node.frame.name.localeCompare(a.node.frame.name);\n        };\n  }\n\n  throw new Error(`Unknown sort property ${property}`);\n}\n\nfunction skipRecursiveNodes(n: VirtualizedTreeNode<FlamegraphFrame>): boolean {\n  return n.node.node.isDirectRecursive();\n}\n\ninterface FrameStackTableProps {\n  canvasPoolManager: CanvasPoolManager;\n  flamegraphRenderer: FlamegraphRenderer;\n  recursion: 'collapsed' | null;\n  referenceNode: FlamegraphFrame;\n  roots: FlamegraphFrame[];\n}\n\nexport function FrameStackTable({\n  roots,\n  flamegraphRenderer,\n  canvasPoolManager,\n  referenceNode,\n  recursion,\n}: FrameStackTableProps) {\n  const [scrollContainerRef, setScrollContainerRef] = useState<HTMLDivElement | null>(\n    null\n  );\n  const [sort, setSort] = useState<'total weight' | 'self weight' | 'name'>(\n    'total weight'\n  );\n  const [direction, setDirection] = useState<'asc' | 'desc'>('desc');\n  const sortFunction = useMemo(() => {\n    return makeSortFunction(sort, direction);\n  }, [sort, direction]);\n\n  const [clickedContextMenuNode, setClickedContextMenuClose] =\n    useState<VirtualizedTreeNode<FlamegraphFrame> | null>(null);\n\n  const contextMenu = useContextMenu({container: scrollContainerRef});\n\n  const handleZoomIntoNodeClick = useCallback(() => {\n    if (!clickedContextMenuNode) {\n      return;\n    }\n\n    canvasPoolManager.dispatch('zoomIntoFrame', [clickedContextMenuNode.node]);\n  }, [canvasPoolManager, clickedContextMenuNode]);\n\n  const renderRow: UseVirtualizedListProps<FlamegraphFrame>['renderRow'] = useCallback(\n    (\n      r,\n      {\n        handleRowClick,\n        handleRowMouseEnter,\n        handleExpandTreeNode,\n        handleRowKeyDown,\n        tabIndexKey,\n      }\n    ) => {\n      return (\n        <FrameStackTableRow\n          ref={n => {\n            r.ref = n;\n          }}\n          node={r.item}\n          style={r.styles}\n          referenceNode={referenceNode}\n          tabIndex={tabIndexKey === r.key ? 0 : 1}\n          flamegraphRenderer={flamegraphRenderer}\n          onClick={handleRowClick}\n          onExpandClick={handleExpandTreeNode}\n          onKeyDown={handleRowKeyDown}\n          onMouseEnter={handleRowMouseEnter}\n          onContextMenu={evt => {\n            setClickedContextMenuClose(r.item);\n            contextMenu.handleContextMenu(evt);\n          }}\n        />\n      );\n    },\n    [contextMenu, flamegraphRenderer, referenceNode]\n  );\n\n  const {\n    renderedItems,\n    scrollContainerStyles,\n    containerStyles,\n    handleSortingChange,\n    clickedGhostRowRef,\n    hoveredGhostRowRef,\n  } = useVirtualizedTree({\n    skipFunction: recursion === 'collapsed' ? skipRecursiveNodes : undefined,\n    sortFunction,\n    renderRow,\n    scrollContainer: scrollContainerRef,\n    rowHeight: 24,\n    roots,\n  });\n\n  const onSortChange = useCallback(\n    (newSort: 'total weight' | 'self weight' | 'name') => {\n      const newDirection =\n        newSort === sort ? (direction === 'asc' ? 'desc' : 'asc') : 'desc';\n\n      setDirection(newDirection);\n      setSort(newSort);\n\n      const sortFn = makeSortFunction(newSort, newDirection);\n      handleSortingChange(sortFn);\n    },\n    [sort, direction, handleSortingChange]\n  );\n\n  return (\n    <FrameBar>\n      <FrameCallersTable>\n        <FrameCallersTableHeader>\n          <FrameWeightCell>\n            <TableHeaderButton onClick={() => onSortChange('self weight')}>\n              {t('Self Time ')}\n              {sort === 'self weight' ? (\n                <IconArrow direction={direction === 'desc' ? 'down' : 'up'} />\n              ) : null}\n            </TableHeaderButton>\n          </FrameWeightCell>\n          <FrameWeightCell>\n            <TableHeaderButton onClick={() => onSortChange('total weight')}>\n              {t('Total Time')}{' '}\n              {sort === 'total weight' ? (\n                <IconArrow direction={direction === 'desc' ? 'down' : 'up'} />\n              ) : null}\n            </TableHeaderButton>\n          </FrameWeightCell>\n          <FrameNameCell>\n            <TableHeaderButton onClick={() => onSortChange('name')}>\n              {t('Frame')}{' '}\n              {sort === 'name' ? (\n                <IconArrow direction={direction === 'desc' ? 'down' : 'up'} />\n              ) : null}\n            </TableHeaderButton>\n          </FrameNameCell>\n        </FrameCallersTableHeader>\n        <FrameStackContextMenu\n          onZoomIntoNodeClick={handleZoomIntoNodeClick}\n          contextMenu={contextMenu}\n        />\n        <div style={{position: 'relative', height: '100%', background: theme.white}}>\n          <div ref={clickedGhostRowRef} />\n          <div ref={hoveredGhostRowRef} />\n          <div\n            ref={ref => setScrollContainerRef(ref)}\n            style={scrollContainerStyles}\n            onContextMenu={contextMenu.handleContextMenu}\n          >\n            <div style={containerStyles}>\n              {renderedItems}\n              {/*\n              This is a ghost row, we stretch its width and height to fit the entire table\n              so that borders on columns are shown across the entire table and not just the rows.\n              This is useful when number of rows does not fill up the entire table height.\n             */}\n              <GhostRowContainer>\n                <FrameCallersTableCell />\n                <FrameCallersTableCell />\n                <FrameCallersTableCell style={{width: '100%'}} />\n              </GhostRowContainer>\n            </div>\n          </div>\n        </div>\n      </FrameCallersTable>\n    </FrameBar>\n  );\n}\n\nconst GhostRowContainer = styled('div')`\n  display: flex;\n  width: 100%;\n  pointer-events: none;\n  position: absolute;\n  height: 100%;\n  z-index: -1;\n`;\n\nconst TableHeaderButton = styled('button')`\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 ${space(1)};\n  border: none;\n  background-color: ${props => props.theme.surface400};\n  transition: background-color 100ms ease-in-out;\n\n  &:hover {\n    background-color: #edecee;\n  }\n\n  svg {\n    width: 10px;\n    height: 10px;\n  }\n`;\n\nconst FrameBar = styled('div')`\n  overflow: auto;\n  width: 100%;\n  position: relative;\n  background-color: ${p => p.theme.surface100};\n  border-top: 1px solid ${p => p.theme.border};\n  flex: 1 1 100%;\n`;\n\nconst FrameCallersTable = styled('div')`\n  font-size: ${p => p.theme.fontSizeSmall};\n  margin: 0;\n  overflow: auto;\n  max-height: 100%;\n  height: 100%;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst FRAME_WEIGHT_CELL_WIDTH_PX = 164;\n\nconst FrameWeightCell = styled('div')`\n  width: ${FRAME_WEIGHT_CELL_WIDTH_PX}px;\n`;\n\nconst FrameNameCell = styled('div')`\n  flex: 1 1 100%;\n`;\n\nconst FrameCallersTableHeader = styled('div')`\n  top: 0;\n  position: sticky;\n  z-index: 1;\n  display: flex;\n  flex: 1;\n\n  > div {\n    position: relative;\n    border-bottom: 1px solid ${p => p.theme.border};\n    background-color: ${p => p.theme.background};\n    white-space: nowrap;\n\n    &:last-child {\n      flex: 1;\n    }\n\n    &:not(:last-child) {\n      border-right: 1px solid ${p => p.theme.border};\n    }\n  }\n`;\n","import {useCallback, useMemo, useState} from 'react';\nimport styled from '@emotion/styled';\n\nimport Button from 'sentry/components/button';\nimport {t} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {CanvasPoolManager} from 'sentry/utils/profiling/canvasScheduler';\nimport {filterFlamegraphTree} from 'sentry/utils/profiling/filterFlamegraphTree';\nimport {useFlamegraphProfilesValue} from 'sentry/utils/profiling/flamegraph/useFlamegraphProfiles';\nimport {useFlamegraphTheme} from 'sentry/utils/profiling/flamegraph/useFlamegraphTheme';\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {useVerticallyResizableDrawer} from 'sentry/utils/profiling/hooks/useResizableDrawer';\nimport {invertCallTree} from 'sentry/utils/profiling/profile/utils';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\n\nimport {FrameStackTable} from './frameStackTable';\n\ninterface FrameStackProps {\n  canvasPoolManager: CanvasPoolManager;\n  flamegraphRenderer: FlamegraphRenderer;\n}\n\nfunction FrameStack(props: FrameStackProps) {\n  const theme = useFlamegraphTheme();\n  const {selectedNode} = useFlamegraphProfilesValue();\n\n  const [tab, setTab] = useState<'bottom up' | 'call order'>('call order');\n  const [treeType, setTreeType] = useState<'all' | 'application' | 'system'>('all');\n  const [recursion, setRecursion] = useState<'collapsed' | null>(null);\n\n  const roots: FlamegraphFrame[] | null = useMemo(() => {\n    if (!selectedNode) {\n      return null;\n    }\n\n    const skipFunction: (f: FlamegraphFrame) => boolean =\n      treeType === 'application'\n        ? f => !f.frame.is_application\n        : treeType === 'system'\n        ? f => f.frame.is_application\n        : () => false;\n\n    const maybeFilteredRoots =\n      treeType !== 'all'\n        ? filterFlamegraphTree([selectedNode], skipFunction)\n        : [selectedNode];\n\n    if (tab === 'call order') {\n      return maybeFilteredRoots;\n    }\n\n    return invertCallTree(maybeFilteredRoots);\n  }, [selectedNode, tab, treeType]);\n\n  const handleRecursionChange = useCallback(\n    (evt: React.ChangeEvent<HTMLInputElement>) => {\n      setRecursion(evt.currentTarget.checked ? 'collapsed' : null);\n    },\n    []\n  );\n\n  const onBottomUpClick = useCallback(() => {\n    setTab('bottom up');\n  }, []);\n\n  const onCallOrderClick = useCallback(() => {\n    setTab('call order');\n  }, []);\n\n  const onAllApplicationsClick = useCallback(() => {\n    setTreeType('all');\n  }, []);\n\n  const onApplicationsClick = useCallback(() => {\n    setTreeType('application');\n  }, []);\n\n  const onSystemsClick = useCallback(() => {\n    setTreeType('system');\n  }, []);\n\n  const {height, onMouseDown} = useVerticallyResizableDrawer({\n    initialHeight: (theme.SIZES.FLAMEGRAPH_DEPTH_OFFSET + 2) * theme.SIZES.BAR_HEIGHT,\n    minHeight: 30,\n  });\n\n  return selectedNode ? (\n    <FrameDrawer\n      style={{\n        height,\n      }}\n    >\n      <FrameTabs>\n        <li className={tab === 'bottom up' ? 'active' : undefined}>\n          <Button\n            data-title={t('Bottom Up')}\n            priority=\"link\"\n            size=\"zero\"\n            onClick={onBottomUpClick}\n          >\n            {t('Bottom Up')}\n          </Button>\n        </li>\n        <li className={tab === 'call order' ? 'active' : undefined}>\n          <Button\n            data-title={t('Call Order')}\n            priority=\"link\"\n            size=\"zero\"\n            onClick={onCallOrderClick}\n          >\n            {t('Call Order')}\n          </Button>\n        </li>\n        <Separator />\n        <li className={treeType === 'all' ? 'active' : undefined}>\n          <Button\n            data-title={t('All Frames')}\n            priority=\"link\"\n            size=\"zero\"\n            onClick={onAllApplicationsClick}\n          >\n            {t('All Frames')}\n          </Button>\n        </li>\n        <li className={treeType === 'application' ? 'active' : undefined}>\n          <Button\n            data-title={t('Application Frames')}\n            priority=\"link\"\n            size=\"zero\"\n            onClick={onApplicationsClick}\n          >\n            {t('Application Frames')}\n          </Button>\n        </li>\n        <li className={treeType === 'system' ? 'active' : undefined}>\n          <Button\n            data-title={t('System Frames')}\n            priority=\"link\"\n            size=\"zero\"\n            onClick={onSystemsClick}\n          >\n            {t('System Frames')}\n          </Button>\n        </li>\n        <Separator />\n        <li>\n          <FrameDrawerLabel>\n            <input\n              type=\"checkbox\"\n              checked={recursion === 'collapsed'}\n              onChange={handleRecursionChange}\n            />\n            {t('Collapse recursion')}\n          </FrameDrawerLabel>\n        </li>\n        <li style={{flex: '1 1 100%', cursor: 'ns-resize'}} onMouseDown={onMouseDown} />\n      </FrameTabs>\n      <FrameStackTable\n        {...props}\n        recursion={recursion}\n        roots={roots ?? []}\n        referenceNode={selectedNode}\n        canvasPoolManager={props.canvasPoolManager}\n      />\n    </FrameDrawer>\n  ) : null;\n}\n\nconst FrameDrawerLabel = styled('label')`\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n  margin-bottom: 0;\n  height: 100%;\n  font-weight: normal;\n\n  > input {\n    margin: 0 ${space(0.5)} 0 0;\n  }\n`;\n\nconst FrameDrawer = styled('div')`\n  display: flex;\n  flex-shrink: 0;\n  flex-direction: column;\n`;\n\nconst Separator = styled('li')`\n  width: 1px;\n  height: 66%;\n  margin: 0 ${space(0.5)};\n  background: ${p => p.theme.border};\n  transform: translateY(29%);\n`;\n\nconst FrameTabs = styled('ul')`\n  display: flex;\n  list-style-type: none;\n  padding: 0 ${space(1)};\n  margin: 0;\n  border-top: 1px solid ${prop => prop.theme.border};\n  background-color: ${props => props.theme.surface400};\n  user-select: none;\n\n  > li {\n    font-size: ${p => p.theme.fontSizeSmall};\n    margin-right: ${space(1)};\n\n    button {\n      border: none;\n      border-top: 2px solid transparent;\n      border-bottom: 2px solid transparent;\n      border-radius: 0;\n      margin: 0;\n      padding: ${space(0.5)} 0;\n      color: ${p => p.theme.textColor};\n\n      &::after {\n        display: block;\n        content: attr(data-title);\n        font-weight: bold;\n        height: 1px;\n        color: transparent;\n        overflow: hidden;\n        visibility: hidden;\n        white-space: nowrap;\n      }\n\n      &:hover {\n        color: ${p => p.theme.textColor};\n      }\n    }\n\n    &.active button {\n      font-weight: bold;\n      border-bottom: 2px solid ${prop => prop.theme.active};\n    }\n  }\n`;\n\nconst FRAME_WEIGHT_CELL_WIDTH_PX = 164;\nexport const FrameCallersTableCell = styled('div')<{\n  isSelected?: boolean;\n  noPadding?: boolean;\n  textAlign?: React.CSSProperties['textAlign'];\n}>`\n  width: ${FRAME_WEIGHT_CELL_WIDTH_PX}px;\n  position: relative;\n  white-space: nowrap;\n  flex-shrink: 0;\n  padding: 0 ${p => (p.noPadding ? 0 : space(1))} 0 0;\n  text-align: ${p => p.textAlign ?? 'initial'};\n\n  &:first-child,\n  &:nth-child(2) {\n    position: sticky;\n    z-index: 1;\n    background-color: ${p => (p.isSelected ? p.theme.blue300 : p.theme.background)};\n  }\n\n  &:first-child {\n    left: 0;\n  }\n  &:nth-child(2) {\n    left: ${FRAME_WEIGHT_CELL_WIDTH_PX}px;\n  }\n\n  &:not(:last-child) {\n    border-right: 1px solid ${p => p.theme.border};\n  }\n`;\n\nexport {FrameStack};\n","import {useContext} from 'react';\n\nimport {\n  FlamegraphStateContext,\n  FlamegraphStateContextValue,\n} from './flamegraphStateProvider/index';\n\nexport function useFlamegraphProfiles(): [\n  FlamegraphStateContextValue[0]['profiles'],\n  FlamegraphStateContextValue[1]\n] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphProfiles called outside of FlamegraphStateProvider');\n  }\n\n  return [context[0].profiles, context[1]];\n}\n\nexport function useFlamegraphProfilesValue(): FlamegraphStateContextValue[0]['profiles'] {\n  const context = useContext(FlamegraphStateContext);\n\n  if (context === null) {\n    throw new Error('useFlamegraphProfiles called outside of FlamegraphStateProvider');\n  }\n\n  return context[0].profiles;\n}\n","import {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\n\n// Utility fn to filter a tree.\n// The filtering is done in two steps - the first step marks nodes\n// that should be kept in the tree. The second step iterates over all of the\n// nodes that should be kept in the tree and finds their new parent nodes\n// by walking up the node.parent reference chain and checking if the parent\n// is in the set of nodes that should be kept.\n\n// A tiny but important implementation details is that we only need to find every node's\n// first new parent and not all of the parents. That is because we rely on insertion order\n// of nodesToKeep (dfs). This effectively means that when a node is marked as kept, all of\n// it's parent nodes have already been considered and exist in our new tree.\nexport function filterFlamegraphTree(\n  roots: FlamegraphFrame[],\n  skipFn: (frame: FlamegraphFrame) => boolean\n): FlamegraphFrame[] {\n  const stack: FlamegraphFrame[] = [];\n  const nodesToKeep = new Map<FlamegraphFrame['frame']['key'], FlamegraphFrame>();\n\n  // dfs to find nodes we want to keep.\n  // Iteration order is important because we want to keep the order of the\n  // original tree which allows us to rebuild it starting from the root.\n  for (const root of roots) {\n    stack.push(root);\n\n    while (stack.length > 0) {\n      const node = stack.pop();\n\n      if (!node) {\n        continue;\n      }\n\n      // If this is not a skippable node, add it to the set\n      if (!skipFn(node)) {\n        nodesToKeep.set(node.key, node);\n      }\n\n      // enqueue children\n      for (let i = 0; i < node.children.length; i++) {\n        stack.push(node.children[node.children.length - i - 1]);\n      }\n    }\n  }\n\n  // Rebuild the tree by iterating over the nodes we want to keep and\n  // finding a new parent for each node.\n  const tree: FlamegraphFrame[] = [];\n  const nodes = new Map<FlamegraphFrame['frame']['key'], FlamegraphFrame>();\n  for (const node of nodesToKeep.values()) {\n    // We clear the children when we create a copy so we dont carry\n    // over nodes that were not meant to be kept.\n    const cpy = {...node, children: []};\n\n    // Find the first parent that we are not supposed to skip\n    let parent = node.parent;\n    // While we have a parent and while that parent is not a node we want to keep\n    while (parent) {\n      if (nodesToKeep.has(parent.key)) {\n        // We found a base, break\n        break;\n      }\n\n      parent = parent.parent;\n    }\n\n    // Reassign parent. We can guarantee that parent is not null because\n    // we are iterating over values in insertion order (maps guarantee this)\n    cpy.parent = (parent ? nodes.get(parent.key) : null) || null;\n    if (cpy.parent) {\n      cpy.parent.children.push(cpy);\n    } else {\n      // If the frame's root does not exist or it may have\n      // been filtered out, push the node to the roots\n      tree.push(cpy);\n    }\n\n    // Set the new node in the map\n    nodes.set(cpy.key, cpy);\n  }\n\n  return tree;\n}\n","import {useCallback, useEffect, useRef, useState} from 'react';\n\ninterface UseVerticallyResizableDrawerOptions {\n  initialHeight: number;\n  minHeight?: number;\n}\n\nexport function useVerticallyResizableDrawer(\n  options: UseVerticallyResizableDrawerOptions\n) {\n  const rafIdRef = useRef<number | null>(null);\n  const startResizeVectorRef = useRef<[number, number] | null>(null);\n  const [drawerHeight, setDrawerHeight] = useState(options.initialHeight);\n\n  const onMouseMove = useCallback(\n    (mvEvent: MouseEvent) => {\n      const rafId = rafIdRef.current;\n      if (rafId !== null) {\n        window.cancelAnimationFrame(rafId);\n        rafIdRef.current = null;\n      }\n\n      rafIdRef.current = window.requestAnimationFrame(() => {\n        if (!startResizeVectorRef.current) {\n          return;\n        }\n        const currentPositionVector: [number, number] = [\n          mvEvent.clientX,\n          mvEvent.clientY,\n        ];\n\n        const distance = [\n          startResizeVectorRef.current[0] - currentPositionVector[0],\n          startResizeVectorRef.current[1] - currentPositionVector[1],\n        ];\n\n        startResizeVectorRef.current = currentPositionVector;\n        setDrawerHeight(h => Math.max(options.minHeight ?? 0, h + distance[1]));\n      });\n    },\n    [options.minHeight]\n  );\n\n  const onMouseUp = useCallback(() => {\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n  }, [onMouseMove]);\n\n  const onMouseDown = useCallback(\n    (evt: React.MouseEvent<HTMLElement>) => {\n      startResizeVectorRef.current = [evt.clientX, evt.clientY];\n\n      document.addEventListener('mousemove', onMouseMove, {passive: true});\n      document.addEventListener('mouseup', onMouseUp);\n    },\n    [onMouseMove, onMouseUp]\n  );\n\n  useEffect(() => {\n    return () => {\n      if (rafIdRef.current !== null) {\n        window.cancelAnimationFrame(rafIdRef.current);\n      }\n    };\n  });\n\n  return {height: drawerHeight, onMouseDown};\n}\n","import {mat3} from 'gl-matrix';\n\nimport {Rect} from './gl/utils';\n\ntype DrawFn = () => void;\ntype ArgumentTypes<F> = F extends (...args: infer A) => any ? A : never;\n\nexport interface FlamegraphEvents {\n  resetZoom: () => void;\n  selectedNode: (frame: any | null) => void;\n  setConfigView: (configView: Rect) => void;\n  transformConfigView: (transform: mat3) => void;\n  zoomIntoFrame: (frame: any) => void;\n}\n\ntype EventStore = {[K in keyof FlamegraphEvents]: Set<FlamegraphEvents[K]>};\n\nexport class CanvasScheduler {\n  beforeFrameCallbacks: Set<DrawFn> = new Set();\n  afterFrameCallbacks: Set<DrawFn> = new Set();\n\n  onDisposeCallbacks: Set<() => void> = new Set();\n  requestAnimationFrame: number | null = null;\n\n  events: EventStore = {\n    transformConfigView: new Set<FlamegraphEvents['transformConfigView']>(),\n    zoomIntoFrame: new Set<FlamegraphEvents['zoomIntoFrame']>(),\n    selectedNode: new Set<FlamegraphEvents['selectedNode']>(),\n    resetZoom: new Set<FlamegraphEvents['resetZoom']>(),\n    setConfigView: new Set<FlamegraphEvents['setConfigView']>(),\n  };\n\n  onDispose(cb: () => void): void {\n    if (this.onDisposeCallbacks.has(cb)) {\n      return;\n    }\n\n    this.onDisposeCallbacks.add(cb);\n  }\n\n  on<K extends keyof FlamegraphEvents>(eventName: K, cb: FlamegraphEvents[K]): void {\n    const set = this.events[eventName] as unknown as Set<FlamegraphEvents[K]>;\n    if (set.has(cb)) {\n      return;\n    }\n    set.add(cb);\n  }\n\n  off<K extends keyof FlamegraphEvents>(eventName: K, cb: FlamegraphEvents[K]): void {\n    const set = this.events[eventName] as unknown as Set<FlamegraphEvents[K]>;\n\n    if (set.has(cb)) {\n      set.delete(cb);\n    }\n  }\n\n  dispatch<K extends keyof FlamegraphEvents>(\n    event: K,\n    ...args: ArgumentTypes<FlamegraphEvents[K]>\n  ): void {\n    for (const handler of this.events[event]) {\n      // @ts-ignore\n      handler(...args);\n    }\n  }\n\n  private registerCallback(cb: DrawFn, pool: Set<DrawFn>) {\n    if (pool.has(cb)) {\n      return;\n    }\n    pool.add(cb);\n  }\n\n  private unregisterCallback(cb: DrawFn, pool: Set<DrawFn>) {\n    if (pool.has(cb)) {\n      pool.delete(cb);\n    }\n  }\n\n  registerBeforeFrameCallback(cb: DrawFn): void {\n    this.registerCallback(cb, this.beforeFrameCallbacks);\n  }\n  unregisterBeforeFrameCallback(cb: DrawFn): void {\n    this.unregisterCallback(cb, this.beforeFrameCallbacks);\n  }\n  registerAfterFrameCallback(cb: DrawFn): void {\n    this.registerCallback(cb, this.afterFrameCallbacks);\n  }\n  unregisterAfterFrameCallback(cb: DrawFn): void {\n    this.unregisterCallback(cb, this.afterFrameCallbacks);\n  }\n\n  dispose(): void {\n    for (const cb of this.onDisposeCallbacks) {\n      this.onDisposeCallbacks.delete(cb);\n      cb();\n    }\n    for (const type in this.events) {\n      this.events[type].clear();\n    }\n  }\n\n  drawSync(): void {\n    for (const cb of this.beforeFrameCallbacks) {\n      cb();\n    }\n\n    for (const cb of this.afterFrameCallbacks) {\n      cb();\n    }\n  }\n\n  draw(): void {\n    if (this.requestAnimationFrame) {\n      window.cancelAnimationFrame(this.requestAnimationFrame);\n    }\n\n    this.requestAnimationFrame = window.requestAnimationFrame(() => {\n      for (const cb of this.beforeFrameCallbacks) {\n        cb();\n      }\n\n      for (const cb of this.afterFrameCallbacks) {\n        cb();\n      }\n      this.requestAnimationFrame = null;\n    });\n  }\n}\n\nexport class CanvasPoolManager {\n  schedulers: Set<CanvasScheduler> = new Set();\n\n  registerScheduler(scheduler: CanvasScheduler): void {\n    if (this.schedulers.has(scheduler)) {\n      return;\n    }\n    this.schedulers.add(scheduler);\n  }\n\n  dispatch<K extends keyof FlamegraphEvents>(\n    event: K,\n    args: ArgumentTypes<FlamegraphEvents[K]>\n  ): void {\n    for (const scheduler of this.schedulers) {\n      scheduler.dispatch(event, ...args);\n    }\n  }\n\n  unregisterScheduler(scheduler: CanvasScheduler): void {\n    if (this.schedulers.has(scheduler)) {\n      scheduler.dispose();\n      this.schedulers.delete(scheduler);\n    }\n  }\n\n  drawSync(): void {\n    for (const scheduler of this.schedulers) {\n      scheduler.drawSync();\n    }\n  }\n\n  draw(): void {\n    for (const scheduler of this.schedulers) {\n      scheduler.draw();\n    }\n  }\n}\n","import {mat3, vec2} from 'gl-matrix';\n\nimport {Flamegraph} from '../flamegraph';\nimport {FlamegraphTheme} from '../flamegraph/flamegraphTheme';\nimport {FlamegraphFrame} from '../flamegraphFrame';\nimport {\n  createProgram,\n  createShader,\n  getContext,\n  makeProjectionMatrix,\n  Rect,\n  resizeCanvasToDisplaySize,\n} from '../gl/utils';\n\nimport {fragment, vertex} from './shaders';\n\nclass FlamegraphRenderer {\n  canvas: HTMLCanvasElement | null;\n  flamegraph: Flamegraph;\n\n  gl: WebGLRenderingContext | null = null;\n  program: WebGLProgram | null = null;\n\n  theme: FlamegraphTheme;\n  frames: ReadonlyArray<FlamegraphFrame> = [];\n  roots: ReadonlyArray<FlamegraphFrame> = [];\n\n  // Vertex and color buffer\n  positions: Array<number> = [];\n  bounds: Array<number> = [];\n  colors: Array<number> = [];\n\n  colorMap: Map<string | number, number[]> = new Map();\n\n  lastDragPosition: vec2 | null = null;\n\n  attributes: {\n    a_bounds: number | null;\n    a_color: number | null;\n    a_position: number | null;\n  } = {\n    a_position: null,\n    a_color: null,\n    a_bounds: null,\n  };\n\n  uniforms: {\n    u_border_width: WebGLUniformLocation | null;\n    u_draw_border: WebGLUniformLocation | null;\n    u_is_search_result: WebGLUniformLocation | null;\n    u_model: WebGLUniformLocation | null;\n    u_projection: WebGLUniformLocation | null;\n  } = {\n    u_border_width: null,\n    u_draw_border: null,\n    u_is_search_result: null,\n    u_model: null,\n    u_projection: null,\n  };\n\n  options: {\n    draw_border: boolean;\n  };\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    flamegraph: Flamegraph,\n    theme: FlamegraphTheme,\n    options: {draw_border: boolean} = {draw_border: false}\n  ) {\n    this.flamegraph = flamegraph;\n    this.canvas = canvas;\n    this.theme = theme;\n    this.options = options;\n\n    this.init();\n  }\n\n  init(): void {\n    const VERTICES = 6;\n    const COLOR_COMPONENTS = 4;\n\n    this.colors = new Array(VERTICES * COLOR_COMPONENTS);\n    this.frames = [...this.flamegraph.frames];\n    this.roots = this.flamegraph.frames.filter(f => !f.parent);\n\n    // Generate colors for the flamegraph\n    const {colorBuffer, colorMap} = this.theme.COLORS.STACK_TO_COLOR(\n      this.frames,\n      this.theme.COLORS.COLOR_MAP,\n      this.theme.COLORS.COLOR_BUCKET\n    );\n\n    this.colorMap = colorMap;\n    this.colors = colorBuffer;\n\n    this.initCanvasContext();\n    this.initVertices();\n    this.initShaders();\n  }\n\n  initVertices(): void {\n    const POSITIONS_PER_PASS = 2;\n    const BOUNDS_PER_PASS = 4;\n    const VERTICES = 6;\n\n    this.bounds = new Array(VERTICES * BOUNDS_PER_PASS * this.frames.length);\n    this.positions = new Array(VERTICES * POSITIONS_PER_PASS * this.frames.length);\n\n    const length = this.frames.length;\n\n    for (let index = 0; index < length; index++) {\n      const frame = this.frames[index];\n\n      const x1 = frame.start;\n      const x2 = frame.end;\n      const y1 = frame.depth;\n      const y2 = frame.depth + 1;\n\n      // top left -> top right -> bottom left ->\n      // bottom left -> top right -> bottom right\n      const positionOffset = index * 12;\n\n      this.positions[positionOffset] = x1;\n      this.positions[positionOffset + 1] = y1;\n      this.positions[positionOffset + 2] = x2;\n      this.positions[positionOffset + 3] = y1;\n      this.positions[positionOffset + 4] = x1;\n      this.positions[positionOffset + 5] = y2;\n      this.positions[positionOffset + 6] = x1;\n      this.positions[positionOffset + 7] = y2;\n      this.positions[positionOffset + 8] = x2;\n      this.positions[positionOffset + 9] = y1;\n      this.positions[positionOffset + 10] = x2;\n      this.positions[positionOffset + 11] = y2;\n\n      // @TODO check if we can pack bounds across vertex calls,\n      // we are allocating 6x the amount of memory here\n      const boundsOffset = index * VERTICES * BOUNDS_PER_PASS;\n\n      for (let i = 0; i < VERTICES; i++) {\n        const offset = boundsOffset + i * BOUNDS_PER_PASS;\n\n        this.bounds[offset] = x1;\n        this.bounds[offset + 1] = y1;\n        this.bounds[offset + 2] = x2;\n        this.bounds[offset + 3] = y2;\n      }\n    }\n  }\n\n  initCanvasContext(): void {\n    if (!this.canvas) {\n      throw new Error('Cannot initialize context from null canvas');\n    }\n    // Setup webgl canvas context\n    this.gl = getContext(this.canvas, 'webgl');\n\n    if (!this.gl) {\n      throw new Error('Uninitialized WebGL context');\n    }\n\n    this.gl.enable(this.gl.BLEND);\n    this.gl.blendFuncSeparate(\n      this.gl.SRC_ALPHA,\n      this.gl.ONE_MINUS_SRC_ALPHA,\n      this.gl.ONE,\n      this.gl.ONE_MINUS_SRC_ALPHA\n    );\n    resizeCanvasToDisplaySize(this.canvas);\n  }\n\n  initShaders(): void {\n    if (!this.gl) {\n      throw new Error('Uninitialized WebGL context');\n    }\n\n    // @ts-ignore\n    this.uniforms = {};\n    // @ts-ignore\n    this.attributes = {};\n\n    const vertexShader = createShader(this.gl, this.gl.VERTEX_SHADER, vertex());\n\n    const fragmentShader = createShader(\n      this.gl,\n      this.gl.FRAGMENT_SHADER,\n      fragment(this.theme)\n    );\n\n    // create program\n    this.program = createProgram(this.gl, vertexShader, fragmentShader);\n\n    const uProjectionMatrix = this.gl.getUniformLocation(this.program, 'u_projection');\n    const uModelMatrix = this.gl.getUniformLocation(this.program, 'u_model');\n    const uIsSearchResult = this.gl.getUniformLocation(\n      this.program,\n      'u_is_search_result'\n    );\n    const uBorderWidth = this.gl.getUniformLocation(this.program, 'u_border_width');\n    const uDrawBorder = this.gl.getUniformLocation(this.program, 'u_draw_border');\n\n    if (!uProjectionMatrix) {\n      throw new Error('Could not locate u_projection in shader');\n    }\n    if (!uModelMatrix) {\n      throw new Error('Could not locate u_model in shader');\n    }\n    if (!uIsSearchResult) {\n      throw new Error('Could not locate u_is_search_result in shader');\n    }\n    if (!uBorderWidth) {\n      throw new Error('Could not locate u_border_width in shader');\n    }\n    if (!uDrawBorder) {\n      throw new Error('Could not locate u_draw_border in shader');\n    }\n\n    this.uniforms.u_projection = uProjectionMatrix;\n    this.uniforms.u_model = uModelMatrix;\n    this.uniforms.u_is_search_result = uIsSearchResult;\n    this.uniforms.u_border_width = uBorderWidth;\n    this.uniforms.u_draw_border = uDrawBorder;\n\n    {\n      const aColorAttributeLocation = this.gl.getAttribLocation(this.program, 'a_color');\n\n      if (aColorAttributeLocation === -1) {\n        throw new Error('Could not locate a_color in shader');\n      }\n\n      // attributes get data from buffers\n      this.attributes.a_color = aColorAttributeLocation;\n\n      // Init color buffer\n      const colorBuffer = this.gl.createBuffer();\n\n      // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = colorBuffer)\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, colorBuffer);\n      this.gl.bufferData(\n        this.gl.ARRAY_BUFFER,\n        new Float32Array(this.colors),\n        this.gl.STATIC_DRAW\n      );\n\n      const size = 4;\n      const type = this.gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n\n      this.gl.vertexAttribPointer(\n        aColorAttributeLocation,\n        size,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n      // Point to attribute location\n      this.gl.enableVertexAttribArray(aColorAttributeLocation);\n    }\n    {\n      // look up where the vertex data needs to go.\n      const aPositionAttributeLocation = this.gl.getAttribLocation(\n        this.program,\n        'a_position'\n      );\n\n      if (aPositionAttributeLocation === -1) {\n        throw new Error('Could not locate a_color in shader');\n      }\n\n      // attributes get data from buffers\n      this.attributes.a_position = aPositionAttributeLocation;\n\n      // Init position buffer\n      const positionBuffer = this.gl.createBuffer();\n\n      // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, positionBuffer);\n      this.gl.bufferData(\n        this.gl.ARRAY_BUFFER,\n        new Float32Array(this.positions),\n        this.gl.STATIC_DRAW\n      );\n      const size = 2;\n      const type = this.gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n\n      this.gl.vertexAttribPointer(\n        aPositionAttributeLocation,\n        size,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n      // Point to attribute location\n      this.gl.enableVertexAttribArray(aPositionAttributeLocation);\n    }\n\n    {\n      // look up where the bounds vertices needs to go.\n      const aBoundsAttributeLocation = this.gl.getAttribLocation(\n        this.program,\n        'a_bounds'\n      );\n\n      if (aBoundsAttributeLocation === -1) {\n        throw new Error('Could not locate a_color in shader');\n      }\n\n      // attributes get data from buffers\n      this.attributes.a_bounds = aBoundsAttributeLocation;\n\n      // Init bounds buffer\n      const boundsBuffer = this.gl.createBuffer();\n\n      // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = boundsBuffer)\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, boundsBuffer);\n      this.gl.bufferData(\n        this.gl.ARRAY_BUFFER,\n        new Float32Array(this.bounds),\n        this.gl.STATIC_DRAW\n      );\n      const size = 4;\n      const type = this.gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n\n      this.gl.vertexAttribPointer(\n        aBoundsAttributeLocation,\n        size,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n      // Point to attribute location\n      this.gl.enableVertexAttribArray(aBoundsAttributeLocation);\n    }\n\n    // Use shader program\n    this.gl.useProgram(this.program);\n  }\n\n  getColorForFrame(frame: FlamegraphFrame): number[] {\n    return this.colorMap.get(frame.key) ?? this.theme.COLORS.FRAME_FALLBACK_COLOR;\n  }\n\n  getHoveredNode(configSpaceCursor: vec2): FlamegraphFrame | null {\n    let hoveredNode: FlamegraphFrame | null = null;\n\n    const findHoveredNode = (frame: FlamegraphFrame, depth: number) => {\n      // This is outside\n      if (hoveredNode) {\n        return;\n      }\n\n      const frameRect = new Rect(frame.start, frame.depth, frame.end - frame.start, 1);\n\n      // We treat entire flamegraph as a segment tree, this allows us to query in O(log n) time by\n      // only looking at the nodes that are relevant to the current cursor position. We discard any values\n      // on x axis that do not overlap the cursor, and descend until we find a node that overlaps at cursor y position\n      if (!frameRect.containsX(configSpaceCursor)) {\n        return;\n      }\n\n      // If our frame depth overlaps cursor y position, we have found our node\n      if (frameRect.containsY(configSpaceCursor)) {\n        hoveredNode = frame;\n        return;\n      }\n\n      // Descend into the rest of the children\n      for (let i = 0; i < frame.children.length; i++) {\n        findHoveredNode(frame.children[i], depth + 1);\n      }\n    };\n\n    for (let i = 0; i < this.roots.length; i++) {\n      findHoveredNode(this.roots[i], 0);\n    }\n\n    return hoveredNode;\n  }\n\n  draw(\n    configViewToPhysicalSpace: mat3,\n    searchResults: Record<FlamegraphFrame['frame']['key'], FlamegraphFrame> | null = null\n  ): void {\n    if (!this.gl) {\n      throw new Error('Uninitialized WebGL context');\n    }\n\n    this.gl.clearColor(0, 0, 0, 0);\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n    // We have no frames to draw\n    if (!this.positions.length) {\n      return;\n    }\n\n    this.gl.useProgram(this.program);\n\n    const projectionMatrix = makeProjectionMatrix(\n      this.gl.canvas.width,\n      this.gl.canvas.height\n    );\n\n    // Projection matrix\n    this.gl.uniformMatrix3fv(this.uniforms.u_projection, false, projectionMatrix);\n\n    // Model to projection\n    this.gl.uniformMatrix3fv(this.uniforms.u_model, false, configViewToPhysicalSpace);\n\n    // Check if we should draw border\n    this.gl.uniform1i(this.uniforms.u_draw_border, this.options.draw_border ? 1 : 0);\n\n    // Tell webgl to convert clip space to px\n    this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n\n    const physicalSpacePixel = new Rect(0, 0, 1, 1);\n    const physicalToConfig = mat3.invert(mat3.create(), configViewToPhysicalSpace);\n    const configSpacePixel = physicalSpacePixel.transformRect(physicalToConfig);\n\n    this.gl.uniform2f(\n      this.uniforms.u_border_width,\n      configSpacePixel.width,\n      configSpacePixel.height\n    );\n\n    const VERTICES = 6;\n\n    const length = this.frames.length;\n    let frame;\n\n    // This is an optimization to avoid setting uniform1i for each draw call when user is not searching\n    if (searchResults) {\n      for (let i = 0; i < length; i++) {\n        frame = this.frames[i];\n        const vertexOffset = i * VERTICES;\n\n        this.gl.uniform1i(\n          this.uniforms.u_is_search_result,\n          searchResults[\n            `${\n              frame.frame.name +\n              (frame.frame.file ? frame.frame.file : '') +\n              String(frame.start)\n            }`\n          ]\n            ? 1\n            : 0\n        );\n        this.gl.drawArrays(this.gl.TRIANGLES, vertexOffset, VERTICES);\n      }\n    } else {\n      this.gl.uniform1i(this.uniforms.u_is_search_result, 0);\n      for (let i = 0; i < length; i++) {\n        const vertexOffset = i * VERTICES;\n\n        this.gl.drawArrays(this.gl.TRIANGLES, vertexOffset, VERTICES);\n      }\n    }\n  }\n}\n\nexport {FlamegraphRenderer};\n","import {FlamegraphTheme} from '../flamegraph/flamegraphTheme';\n\nexport const vertex = () => `\nattribute vec2 a_position;\nattribute vec4 a_color;\nattribute vec4 a_bounds;\n\nuniform mat3 u_model;\nuniform mat3 u_projection;\n\nvarying lowp vec4 v_color;\nvarying vec2 v_pos;\nvarying vec4 v_bounds;\n\nvoid main() {\n  vec2 scaled = (u_model * vec3(a_position.xy, 1)).xy;\n  vec2 pos = (u_projection * vec3(scaled.xy, 1)).xy;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  v_color = a_color;\n  v_pos = a_position.xy;\n  v_bounds = a_bounds;\n}\n`;\n\nexport const fragment = (theme: FlamegraphTheme) => `\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\nprecision mediump float;\n\nuniform bool u_is_search_result;\nuniform vec2 u_border_width;\nuniform bool u_draw_border;\n\nvarying lowp vec4 v_color;\nvarying vec4 v_bounds;\nvarying vec2 v_pos;\n\nvoid main() {\n  float minX = v_bounds.x + u_border_width.x;\n  float maxX = v_bounds.z - u_border_width.x;\n\n  float minY = v_bounds.y + u_border_width.y;\n  float maxY = v_bounds.y + 1.0 - u_border_width.y;\n\n  float width = maxX - minX;\n\n  if (u_is_search_result) {\n    gl_FragColor = ${theme.COLORS.SEARCH_RESULT_FRAME_COLOR};\n  } else if (u_draw_border) {\n    if(width <= u_border_width.x) {\n      if(v_pos.y > minY && v_pos.y < maxY){\n        gl_FragColor = vec4(v_color);\n      } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      }\n    } else if (v_pos.x > minX && v_pos.x < maxX && v_pos.y > minY && v_pos.y < maxY) {\n      gl_FragColor = vec4(v_color);\n    } else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n  } else {\n    gl_FragColor = vec4(v_color);\n  }\n}\n`;\n","import {mat3} from 'gl-matrix';\n\nimport {FlamegraphTheme} from '../flamegraph/flamegraphTheme';\nimport {getContext, measureText, Rect} from '../gl/utils';\n\nexport function getIntervalTimeAtX(logicalSpaceToConfigView: mat3, x: number): number {\n  const vector = logicalSpaceToConfigView[0] * x + logicalSpaceToConfigView[6];\n\n  if (vector > 1) {\n    return Math.round(vector);\n  }\n\n  return Math.round(vector * 10) / 10;\n}\n\nexport function computeInterval(\n  configView: Rect,\n  logicalSpaceToConfigView: mat3\n): number[] {\n  // We want to draw an interval every 200px\n  const target = 200;\n  // Compute x at 200 and subtract left, so we have the interval\n  const targetInterval =\n    getIntervalTimeAtX(logicalSpaceToConfigView, target) - configView.left;\n\n  const minInterval = Math.pow(10, Math.floor(Math.log10(targetInterval)));\n\n  let interval = minInterval;\n\n  if (targetInterval / interval > 5) {\n    interval *= 5;\n  } else if (targetInterval / interval > 2) {\n    interval *= 2;\n  }\n\n  const intervals: number[] = [];\n  let x = Math.ceil(configView.left / interval) * interval;\n\n  while (x <= configView.right) {\n    intervals.push(x);\n    x += interval;\n  }\n\n  return intervals;\n}\n\nclass GridRenderer {\n  canvas: HTMLCanvasElement;\n  context: CanvasRenderingContext2D;\n  theme: FlamegraphTheme;\n\n  formatter: (value: number) => string;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    theme: FlamegraphTheme,\n    formatter: (value: number) => string\n  ) {\n    this.canvas = canvas;\n    this.theme = theme;\n    this.formatter = formatter;\n\n    this.context = getContext(canvas, '2d');\n  }\n\n  draw(\n    configViewSpace: Rect,\n    physicalViewRect: Rect,\n    configViewToPhysicalSpace: mat3,\n    logicalSpaceToConfigView: mat3,\n    context: CanvasRenderingContext2D = this.context\n  ): void {\n    context.font = `${this.theme.SIZES.LABEL_FONT_SIZE * window.devicePixelRatio}px ${\n      this.theme.FONTS.FONT\n    }`;\n    context.textBaseline = 'top';\n\n    const LINE_WIDTH = 1;\n\n    // Draw the background of the top timeline\n    context.fillStyle = this.theme.COLORS.GRID_FRAME_BACKGROUND_COLOR;\n    context.fillRect(\n      0,\n      LINE_WIDTH,\n      physicalViewRect.width,\n      this.theme.SIZES.LABEL_FONT_SIZE * window.devicePixelRatio +\n        this.theme.SIZES.LABEL_FONT_PADDING * window.devicePixelRatio * 2 -\n        this.theme.SIZES.LABEL_FONT_PADDING\n    );\n\n    // Draw top timeline lines\n    context.fillStyle = this.theme.COLORS.GRID_LINE_COLOR;\n    context.fillRect(0, 0, physicalViewRect.width, LINE_WIDTH / 2);\n    context.fillRect(\n      0,\n      this.theme.SIZES.TIMELINE_HEIGHT * window.devicePixelRatio,\n      physicalViewRect.width,\n      LINE_WIDTH / 2\n    );\n\n    const intervals = computeInterval(configViewSpace, logicalSpaceToConfigView);\n\n    for (let i = 0; i < intervals.length; i++) {\n      // Compute the x position of our interval from config space to physical\n      const physicalIntervalPosition = Math.round(\n        intervals[i] * configViewToPhysicalSpace[0] + configViewToPhysicalSpace[6]\n      );\n\n      // Format the label text\n      const labelText = this.formatter(intervals[i]);\n\n      context.fillStyle = this.theme.COLORS.LABEL_FONT_COLOR;\n      // Subtract width of the text and padding so that the text is align to the left of our interval\n      context.fillText(\n        labelText,\n        physicalIntervalPosition -\n          measureText(labelText, context).width -\n          this.theme.SIZES.LABEL_FONT_PADDING * window.devicePixelRatio,\n        this.theme.SIZES.LABEL_FONT_PADDING * window.devicePixelRatio\n      );\n\n      // Draw the vertical grid line\n      context.strokeStyle = this.theme.COLORS.GRID_LINE_COLOR;\n      context.lineWidth = this.theme.SIZES.GRID_LINE_WIDTH;\n      context.strokeRect(\n        physicalIntervalPosition - LINE_WIDTH / 2,\n        physicalViewRect.y,\n        LINE_WIDTH / 2,\n        physicalViewRect.height\n      );\n    }\n  }\n}\n\nexport {GridRenderer};\n","import {mat3} from 'gl-matrix';\n\nimport {getContext, Rect} from '../gl/utils';\n\nclass SelectedFrameRenderer {\n  canvas: HTMLCanvasElement;\n  context: CanvasRenderingContext2D;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.context = getContext(canvas, '2d');\n  }\n\n  // We allow for passing of different contexts, this allows us to use a\n  // single instance of the renderer to draw overlays on multiple canvases\n  draw(\n    frame: Rect,\n    style: {BORDER_COLOR: string; BORDER_WIDTH: number},\n    configViewToPhysicalSpace: mat3,\n    context: CanvasRenderingContext2D = this.context\n  ): void {\n    const frameInPhysicalSpace = frame.transformRect(configViewToPhysicalSpace);\n\n    // We draw the border in the center of the flamegraph, so we need to increase\n    // the width by border width and negatively offset it by half the border width\n    const borderRect = frameInPhysicalSpace\n      .withWidth(frameInPhysicalSpace.width - style.BORDER_WIDTH)\n      .withHeight(frameInPhysicalSpace.height - style.BORDER_WIDTH)\n      .translate(\n        frameInPhysicalSpace.x + style.BORDER_WIDTH / 2,\n        frameInPhysicalSpace.y + style.BORDER_WIDTH / 2\n      );\n\n    context.beginPath();\n    context.strokeStyle = style.BORDER_COLOR;\n    context.lineWidth = style.BORDER_WIDTH;\n    context.strokeRect(borderRect.x, borderRect.y, borderRect.width, borderRect.height);\n  }\n}\n\nexport {SelectedFrameRenderer};\n","import {mat3} from 'gl-matrix';\n\nimport {Flamegraph} from '../flamegraph';\nimport {FlamegraphTheme} from '../flamegraph/flamegraphTheme';\nimport {FlamegraphFrame} from '../flamegraphFrame';\nimport {\n  ELLIPSIS,\n  findRangeBinarySearch,\n  getContext,\n  Rect,\n  resizeCanvasToDisplaySize,\n  trimTextCenter,\n} from '../gl/utils';\n\nclass TextRenderer {\n  textCache: Record<string, number> = {};\n\n  canvas: HTMLCanvasElement;\n  context: CanvasRenderingContext2D;\n  theme: FlamegraphTheme;\n  flamegraph: Flamegraph;\n\n  constructor(canvas: HTMLCanvasElement, flamegraph: Flamegraph, theme: FlamegraphTheme) {\n    this.canvas = canvas;\n    this.theme = theme;\n    this.flamegraph = flamegraph;\n\n    this.context = getContext(canvas, '2d');\n    resizeCanvasToDisplaySize(canvas);\n  }\n\n  measureAndCacheText(text: string): number {\n    if (this.textCache[text]) {\n      return this.textCache[text];\n    }\n    this.textCache[text] = this.context.measureText(text).width;\n    return this.textCache[text];\n  }\n\n  maybeInvalidateCache(): void {\n    const TEST_STRING = 'Who knows if this changed, font-display: swap wont tell me';\n\n    if (this.textCache[TEST_STRING] === undefined) {\n      this.measureAndCacheText(TEST_STRING);\n      return;\n    }\n\n    const newMeasuredSize = this.context.measureText(TEST_STRING).width;\n    if (newMeasuredSize !== this.textCache[TEST_STRING]) {\n      this.textCache = {[TEST_STRING]: newMeasuredSize};\n    }\n  }\n\n  draw(configView: Rect, configViewToPhysicalSpace: mat3): void {\n    this.maybeInvalidateCache();\n\n    this.context.font = `${this.theme.SIZES.BAR_FONT_SIZE * window.devicePixelRatio}px ${\n      this.theme.FONTS.FRAME_FONT\n    }`;\n\n    this.context.textBaseline = 'alphabetic';\n    this.context.fillStyle = this.theme.COLORS.LABEL_FONT_COLOR;\n\n    const minWidth = this.measureAndCacheText(ELLIPSIS);\n\n    const SIDE_PADDING = 2 * this.theme.SIZES.BAR_PADDING * window.devicePixelRatio;\n    const HALF_SIDE_PADDING = SIDE_PADDING / 2;\n    const BASELINE_OFFSET =\n      (this.theme.SIZES.BAR_HEIGHT - this.theme.SIZES.BAR_FONT_SIZE / 2) *\n      window.devicePixelRatio;\n\n    // We start by iterating over root frames, so we draw the call stacks top-down.\n    // This allows us to do a couple optimizations that improve our best case performance.\n    // 1. We can skip drawing the entire tree if the root frame is not visible\n    // 2. We can skip drawing and\n    const frames: FlamegraphFrame[] = [...this.flamegraph.roots];\n\n    while (frames.length) {\n      const frame = frames.pop()!;\n\n      // Check if our rect overlaps with the current viewport and skip it\n      if (frame.end < configView.left || frame.start > configView.right) {\n        continue;\n      }\n\n      // We pin the start and end of the frame, so scrolling around keeps text pinned to the left or right side of the viewport\n      const pinnedStart = Math.max(frame.start, configView.left);\n      const pinnedEnd = Math.min(frame.end, configView.right);\n\n      // Transform frame to physical space coordinates. This does the same operation as\n      // Rect.transformRect, but without allocating a new Rect object.\n      const frameWidth =\n        (pinnedEnd - pinnedStart) * configViewToPhysicalSpace[0] +\n        configViewToPhysicalSpace[3];\n      const frameHeight =\n        (pinnedEnd - pinnedStart) * configViewToPhysicalSpace[1] +\n        configViewToPhysicalSpace[4];\n      const frameX =\n        pinnedStart * configViewToPhysicalSpace[0] +\n        frame.depth * configViewToPhysicalSpace[3] +\n        configViewToPhysicalSpace[6];\n      const frameY =\n        pinnedStart * configViewToPhysicalSpace[1] +\n        frame.depth * configViewToPhysicalSpace[4] +\n        configViewToPhysicalSpace[7];\n\n      const frameInPhysicalSpace = [\n        frameX + (frameWidth < 0 ? frameWidth : 0),\n        frameY + (frameHeight < 0 ? frameHeight : 0),\n        frameWidth,\n        frameHeight,\n      ];\n\n      // Since the text is not exactly aligned to the left/right bounds of the frame, we need to subtract the padding\n      // from the total width, so that we can truncate the center of the text accurately.\n      const paddedRectangleWidth = frameInPhysicalSpace[2] - SIDE_PADDING;\n\n      // Since children of a frame cannot be wider than the frame itself, we can exit early and discard the entire subtree\n      if (paddedRectangleWidth <= minWidth) {\n        continue;\n      }\n\n      // We want to draw the text in the vertical center of the frame, so we substract half the height of the text\n      const y = frameInPhysicalSpace[1] + BASELINE_OFFSET;\n\n      // Offset x by 1x the padding\n      const x = frameInPhysicalSpace[0] + HALF_SIDE_PADDING;\n\n      this.context.fillText(\n        trimTextCenter(\n          frame.frame.name,\n          findRangeBinarySearch(\n            {low: 0, high: paddedRectangleWidth},\n            n => this.measureAndCacheText(frame.frame.name.substring(0, n)),\n            paddedRectangleWidth\n          )[0]\n        ),\n        x,\n        y\n      );\n\n      for (let i = 0; i < frame.children.length; i++) {\n        frames.push(frame.children[i]);\n      }\n    }\n  }\n}\n\nexport {TextRenderer};\n","import {useRef} from 'react';\nimport styled from '@emotion/styled';\nimport {vec2} from 'gl-matrix';\n\nimport space from 'sentry/styles/space';\nimport {useFlamegraphTheme} from 'sentry/utils/profiling/flamegraph/useFlamegraphTheme';\nimport {FlamegraphCanvas} from 'sentry/utils/profiling/flamegraphCanvas';\nimport {FlamegraphView} from 'sentry/utils/profiling/flamegraphView';\nimport {Rect} from 'sentry/utils/profiling/gl/utils';\nimport theme from 'sentry/utils/theme';\n\nfunction computeBestTooltipPlacement(cursor: vec2, container: Rect) {\n  // This is because the cursor's origin is in the top left corner of the arrow, so we want\n  // to offset it just enough so that the tooltip does not overlap with the arrow's tail.\n  // When the tooltip placed to the left of the cursor, we do not have that issue and hence\n  // no offset is applied.\n  const OFFSET_PX = 6;\n\n  const style: Record<string, number | undefined> = {\n    left: cursor[0] + OFFSET_PX,\n    right: undefined,\n    top: cursor[1] + OFFSET_PX,\n    bottom: undefined,\n  };\n\n  if (cursor[0] > container.width / 2) {\n    style.left = undefined;\n    style.right = container.width - cursor[0]; // No offset is applied here as tooltip is placed to the left\n  }\n\n  return style;\n}\n\ninterface BoundTooltipProps {\n  bounds: Rect;\n  cursor: vec2;\n  flamegraphCanvas: FlamegraphCanvas;\n  flamegraphView: FlamegraphView;\n  children?: React.ReactNode;\n}\n\nfunction BoundTooltip({\n  bounds,\n  flamegraphCanvas,\n  cursor,\n  flamegraphView,\n  children,\n}: BoundTooltipProps): React.ReactElement | null {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const flamegraphTheme = useFlamegraphTheme();\n\n  const physicalSpaceCursor = vec2.transformMat3(\n    vec2.create(),\n    cursor,\n    flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n  );\n\n  const logicalSpaceCursor = vec2.transformMat3(\n    vec2.create(),\n    physicalSpaceCursor,\n    flamegraphCanvas.physicalToLogicalSpace\n  );\n\n  const placement = computeBestTooltipPlacement(logicalSpaceCursor, bounds);\n\n  return (\n    <Tooltip\n      ref={tooltipRef}\n      style={{\n        ...placement,\n        fontSize: flamegraphTheme.SIZES.TOOLTIP_FONT_SIZE,\n        fontFamily: flamegraphTheme.FONTS.FONT,\n        zIndex: theme.zIndex.tooltip,\n        maxWidth: bounds.width,\n      }}\n    >\n      {children}\n    </Tooltip>\n  );\n}\n\nconst Tooltip = styled('div')`\n  background: ${p => p.theme.background};\n  position: absolute;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  pointer-events: none;\n  user-select: none;\n  border-radius: ${p => p.theme.borderRadius};\n  padding: ${space(0.25)} ${space(1)};\n  border: 1px solid ${p => p.theme.border};\n`;\n\nexport {BoundTooltip};\n","import {Fragment} from 'react';\n\nimport {t} from 'sentry/locale';\nimport {\n  FlamegraphAxisOptions,\n  FlamegraphColorCodings,\n  FlamegraphSorting,\n  FlamegraphViewOptions,\n} from 'sentry/utils/profiling/flamegraph/flamegraphStateProvider/flamegraphPreferences';\nimport {useFlamegraphPreferences} from 'sentry/utils/profiling/flamegraph/useFlamegraphPreferences';\nimport {useContextMenu} from 'sentry/utils/profiling/hooks/useContextMenu';\n\nimport {\n  ProfilingContextMenu,\n  ProfilingContextMenuGroup,\n  ProfilingContextMenuHeading,\n  ProfilingContextMenuItemCheckbox,\n  ProfilingContextMenuLayer,\n} from './ProfilingContextMenu/profilingContextMenu';\n\nconst FLAMEGRAPH_COLOR_CODINGS: FlamegraphColorCodings = [\n  'by symbol name',\n  'by system / application',\n  'by library',\n  'by recursion',\n];\nconst FLAMEGRAPH_VIEW_OPTIONS: FlamegraphViewOptions = ['top down', 'bottom up'];\nconst FLAMEGRAPH_SORTING_OPTIONS: FlamegraphSorting = ['left heavy', 'call order'];\nconst FLAMEGRAPH_AXIS_OPTIONS: FlamegraphAxisOptions = ['standalone', 'transaction'];\n\ninterface FlameGraphOptionsContextMenuProps {\n  contextMenu: ReturnType<typeof useContextMenu>;\n}\n\nexport function FlamegraphOptionsContextMenu(props: FlameGraphOptionsContextMenuProps) {\n  const [preferences, dispatch] = useFlamegraphPreferences();\n\n  return props.contextMenu.open ? (\n    <Fragment>\n      <ProfilingContextMenuLayer onClick={() => props.contextMenu.setOpen(false)} />\n      <ProfilingContextMenu\n        {...props.contextMenu.getMenuProps()}\n        style={{\n          position: 'absolute',\n          left: props.contextMenu.position?.left ?? -9999,\n          top: props.contextMenu.position?.top ?? -9999,\n          maxHeight: props.contextMenu.containerCoordinates?.height ?? 'auto',\n        }}\n      >\n        <ProfilingContextMenuGroup>\n          <ProfilingContextMenuHeading>{t('Color Coding')}</ProfilingContextMenuHeading>\n          {FLAMEGRAPH_COLOR_CODINGS.map((coding, idx) => (\n            <ProfilingContextMenuItemCheckbox\n              key={idx}\n              {...props.contextMenu.getMenuItemProps()}\n              onClick={() => dispatch({type: 'set color coding', payload: coding})}\n              checked={preferences.colorCoding === coding}\n            >\n              {coding}\n            </ProfilingContextMenuItemCheckbox>\n          ))}\n        </ProfilingContextMenuGroup>\n        <ProfilingContextMenuGroup>\n          <ProfilingContextMenuHeading>{t('View')}</ProfilingContextMenuHeading>\n          {FLAMEGRAPH_VIEW_OPTIONS.map((view, idx) => (\n            <ProfilingContextMenuItemCheckbox\n              key={idx}\n              {...props.contextMenu.getMenuItemProps()}\n              onClick={() => dispatch({type: 'set view', payload: view})}\n              checked={preferences.view === view}\n            >\n              {view}\n            </ProfilingContextMenuItemCheckbox>\n          ))}\n        </ProfilingContextMenuGroup>\n        <ProfilingContextMenuGroup>\n          <ProfilingContextMenuHeading>{t('Sorting')}</ProfilingContextMenuHeading>\n          {FLAMEGRAPH_SORTING_OPTIONS.map((sorting, idx) => (\n            <ProfilingContextMenuItemCheckbox\n              key={idx}\n              {...props.contextMenu.getMenuItemProps()}\n              onClick={() => dispatch({type: 'set sorting', payload: sorting})}\n              checked={preferences.sorting === sorting}\n            >\n              {sorting}\n            </ProfilingContextMenuItemCheckbox>\n          ))}\n        </ProfilingContextMenuGroup>\n        <ProfilingContextMenuGroup>\n          <ProfilingContextMenuHeading>{t('X Axis')}</ProfilingContextMenuHeading>\n          {FLAMEGRAPH_AXIS_OPTIONS.map((axis, idx) => (\n            <ProfilingContextMenuItemCheckbox\n              key={idx}\n              {...props.contextMenu.getMenuItemProps()}\n              onClick={() => dispatch({type: 'set xAxis', payload: axis})}\n              checked={preferences.xAxis === axis}\n            >\n              {axis}\n            </ProfilingContextMenuItemCheckbox>\n          ))}\n        </ProfilingContextMenuGroup>\n      </ProfilingContextMenu>\n    </Fragment>\n  ) : null;\n}\n","import {Fragment, useCallback, useEffect, useMemo, useRef, useState} from 'react';\nimport styled from '@emotion/styled';\nimport {mat3, vec2} from 'gl-matrix';\n\nimport {FrameStack} from 'sentry/components/profiling/FrameStack/frameStack';\nimport space from 'sentry/styles/space';\nimport {CallTreeNode} from 'sentry/utils/profiling/callTreeNode';\nimport {CanvasPoolManager, CanvasScheduler} from 'sentry/utils/profiling/canvasScheduler';\nimport {DifferentialFlamegraph} from 'sentry/utils/profiling/differentialFlamegraph';\nimport {Flamegraph} from 'sentry/utils/profiling/flamegraph';\nimport {\n  useDispatchFlamegraphState,\n  useFlamegraphState,\n} from 'sentry/utils/profiling/flamegraph/useFlamegraphState';\nimport {useFlamegraphTheme} from 'sentry/utils/profiling/flamegraph/useFlamegraphTheme';\nimport {FlamegraphCanvas} from 'sentry/utils/profiling/flamegraphCanvas';\nimport {FlamegraphView} from 'sentry/utils/profiling/flamegraphView';\nimport {formatColorForFrame, Rect} from 'sentry/utils/profiling/gl/utils';\nimport {useContextMenu} from 'sentry/utils/profiling/hooks/useContextMenu';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\nimport {GridRenderer} from 'sentry/utils/profiling/renderers/gridRenderer';\nimport {SelectedFrameRenderer} from 'sentry/utils/profiling/renderers/selectedFrameRenderer';\nimport {TextRenderer} from 'sentry/utils/profiling/renderers/textRenderer';\nimport usePrevious from 'sentry/utils/usePrevious';\n\nimport {BoundTooltip} from './boundTooltip';\nimport {FlamegraphOptionsContextMenu} from './flamegraphOptionsContextMenu';\n\nfunction formatWeightToProfileDuration(frame: CallTreeNode, flamegraph: Flamegraph) {\n  return `(${Math.round((frame.totalWeight / flamegraph.profile.duration) * 100)}%)`;\n}\n\ninterface FlamegraphZoomViewProps {\n  canvasBounds: Rect;\n  canvasPoolManager: CanvasPoolManager;\n  flamegraph: Flamegraph | DifferentialFlamegraph;\n  flamegraphCanvas: FlamegraphCanvas | null;\n  flamegraphCanvasRef: HTMLCanvasElement | null;\n  flamegraphOverlayCanvasRef: HTMLCanvasElement | null;\n  flamegraphView: FlamegraphView | null;\n  setFlamegraphCanvasRef: React.Dispatch<React.SetStateAction<HTMLCanvasElement | null>>;\n  setFlamegraphOverlayCanvasRef: React.Dispatch<\n    React.SetStateAction<HTMLCanvasElement | null>\n  >;\n}\n\nfunction FlamegraphZoomView({\n  canvasPoolManager,\n  canvasBounds,\n  flamegraph,\n  flamegraphCanvas,\n  flamegraphCanvasRef,\n  flamegraphOverlayCanvasRef,\n  flamegraphView,\n  setFlamegraphCanvasRef,\n  setFlamegraphOverlayCanvasRef,\n}: FlamegraphZoomViewProps): React.ReactElement {\n  const flamegraphTheme = useFlamegraphTheme();\n\n  const [lastInteraction, setLastInteraction] = useState<\n    'pan' | 'click' | 'zoom' | 'scroll' | null\n  >(null);\n\n  const [dispatch, {previousState, nextState}] = useDispatchFlamegraphState();\n\n  const scheduler = useMemo(() => new CanvasScheduler(), []);\n\n  const [flamegraphState, dispatchFlamegraphState] = useFlamegraphState();\n  const [startPanVector, setStartPanVector] = useState<vec2 | null>(null);\n  const [configSpaceCursor, setConfigSpaceCursor] = useState<vec2 | null>(null);\n\n  const flamegraphRenderer = useMemo(() => {\n    if (!flamegraphCanvasRef) {\n      return null;\n    }\n\n    return new FlamegraphRenderer(flamegraphCanvasRef, flamegraph, flamegraphTheme, {\n      draw_border: true,\n    });\n  }, [flamegraph, flamegraphCanvasRef, flamegraphTheme]);\n\n  const textRenderer: TextRenderer | null = useMemo(() => {\n    if (!flamegraphOverlayCanvasRef) {\n      return null;\n    }\n    return new TextRenderer(flamegraphOverlayCanvasRef, flamegraph, flamegraphTheme);\n  }, [flamegraph, flamegraphOverlayCanvasRef, flamegraphTheme]);\n\n  const gridRenderer: GridRenderer | null = useMemo(() => {\n    if (!flamegraphOverlayCanvasRef) {\n      return null;\n    }\n    return new GridRenderer(\n      flamegraphOverlayCanvasRef,\n      flamegraphTheme,\n      flamegraph.formatter\n    );\n  }, [flamegraphOverlayCanvasRef, flamegraph, flamegraphTheme]);\n\n  const selectedFrameRenderer = useMemo(() => {\n    if (!flamegraphOverlayCanvasRef) {\n      return null;\n    }\n    return new SelectedFrameRenderer(flamegraphOverlayCanvasRef);\n  }, [flamegraphOverlayCanvasRef]);\n\n  const hoveredNode = useMemo(() => {\n    if (!configSpaceCursor || !flamegraphRenderer) {\n      return null;\n    }\n    return flamegraphRenderer.getHoveredNode(configSpaceCursor);\n  }, [configSpaceCursor, flamegraphRenderer]);\n\n  useEffect(() => {\n    const onKeyDown = (evt: KeyboardEvent) => {\n      if (!flamegraphView) {\n        return;\n      }\n\n      if (evt.key === 'z' && evt.metaKey) {\n        const action = evt.shiftKey ? 'redo' : 'undo';\n\n        if (action === 'undo') {\n          const previousPosition = previousState?.position?.view;\n\n          // If previous position is empty, reset the view to it's max\n          if (previousPosition?.isEmpty()) {\n            canvasPoolManager.dispatch('resetZoom', []);\n          } else if (\n            previousPosition &&\n            !previousPosition?.equals(flamegraphView.configView)\n          ) {\n            // We need to always dispatch with the height of the current view,\n            // because the height may have changed due to window resizing and\n            // calling it with the old height may result in the flamegraph\n            // being drawn into a very small or very large area.\n            canvasPoolManager.dispatch('setConfigView', [\n              previousPosition.withHeight(flamegraphView.configView.height),\n            ]);\n          }\n        }\n\n        if (action === 'redo') {\n          const nextPosition = nextState?.position?.view;\n\n          if (nextPosition && !nextPosition.equals(flamegraphView.configView)) {\n            // We need to always dispatch with the height of the current view,\n            // because the height may have changed due to window resizing and\n            // calling it with the old height may result in the flamegraph\n            // being drawn into a very small or very large area.\n            canvasPoolManager.dispatch('setConfigView', [\n              nextPosition.withHeight(flamegraphView.configView.height),\n            ]);\n          }\n        }\n\n        dispatchFlamegraphState({type: action});\n      }\n    };\n\n    document.addEventListener('keydown', onKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n    };\n  }, [\n    canvasPoolManager,\n    dispatchFlamegraphState,\n    nextState,\n    previousState,\n    flamegraphView,\n  ]);\n\n  const previousInteraction = usePrevious(lastInteraction);\n  const beforeInteractionConfigView = useRef<Rect | null>(null);\n\n  useEffect(() => {\n    if (!flamegraphView) {\n      return;\n    }\n\n    // Check if we are starting a new interaction\n    if (previousInteraction === null && lastInteraction) {\n      beforeInteractionConfigView.current = flamegraphView.configView.clone();\n      return;\n    }\n\n    if (\n      beforeInteractionConfigView.current &&\n      !beforeInteractionConfigView.current.equals(flamegraphView.configView)\n    ) {\n      dispatch({type: 'checkpoint', payload: flamegraphView.configView.clone()});\n    }\n  }, [dispatch, lastInteraction, previousInteraction, flamegraphView]);\n\n  useEffect(() => {\n    if (!flamegraphCanvas || !flamegraphView || !flamegraphRenderer) {\n      return undefined;\n    }\n\n    const drawRectangles = () => {\n      flamegraphRenderer.draw(\n        flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace),\n        flamegraphState.search.results\n      );\n    };\n\n    scheduler.registerBeforeFrameCallback(drawRectangles);\n    scheduler.draw();\n\n    return () => {\n      scheduler.unregisterBeforeFrameCallback(drawRectangles);\n    };\n  }, [\n    flamegraphCanvas,\n    flamegraphRenderer,\n    flamegraphState.search.results,\n    scheduler,\n    flamegraphView,\n  ]);\n\n  useEffect(() => {\n    if (\n      !flamegraphCanvas ||\n      !flamegraphView ||\n      !textRenderer ||\n      !gridRenderer ||\n      !selectedFrameRenderer\n    ) {\n      return undefined;\n    }\n\n    const clearOverlayCanvas = () => {\n      textRenderer.context.clearRect(\n        0,\n        0,\n        textRenderer.canvas.width,\n        textRenderer.canvas.height\n      );\n    };\n\n    const drawSelectedFrameBorder = () => {\n      if (flamegraphState.profiles.selectedNode) {\n        selectedFrameRenderer.draw(\n          new Rect(\n            flamegraphState.profiles.selectedNode.start,\n            flamegraphState.profiles.selectedNode.depth,\n            flamegraphState.profiles.selectedNode.end -\n              flamegraphState.profiles.selectedNode.start,\n            1\n          ),\n          {\n            BORDER_COLOR: flamegraphTheme.COLORS.SELECTED_FRAME_BORDER_COLOR,\n            BORDER_WIDTH: flamegraphTheme.SIZES.FRAME_BORDER_WIDTH,\n          },\n          flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n        );\n      }\n\n      if (hoveredNode && flamegraphState.profiles.selectedNode !== hoveredNode) {\n        selectedFrameRenderer.draw(\n          new Rect(\n            hoveredNode.start,\n            hoveredNode.depth,\n            hoveredNode.end - hoveredNode.start,\n            1\n          ),\n          {\n            BORDER_COLOR: flamegraphTheme.COLORS.HOVERED_FRAME_BORDER_COLOR,\n            BORDER_WIDTH: flamegraphTheme.SIZES.HOVERED_FRAME_BORDER_WIDTH,\n          },\n          flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n        );\n      }\n    };\n\n    const drawText = () => {\n      textRenderer.draw(\n        flamegraphView.configView,\n        flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n      );\n    };\n\n    const drawGrid = () => {\n      gridRenderer.draw(\n        flamegraphView.configView,\n        flamegraphCanvas.physicalSpace,\n        flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace),\n        flamegraphView.toConfigView(flamegraphCanvas.logicalSpace)\n      );\n    };\n\n    scheduler.registerBeforeFrameCallback(clearOverlayCanvas);\n    scheduler.registerBeforeFrameCallback(drawSelectedFrameBorder);\n    scheduler.registerAfterFrameCallback(drawText);\n    scheduler.registerAfterFrameCallback(drawGrid);\n\n    scheduler.draw();\n\n    return () => {\n      scheduler.unregisterBeforeFrameCallback(clearOverlayCanvas);\n      scheduler.unregisterBeforeFrameCallback(drawSelectedFrameBorder);\n      scheduler.unregisterAfterFrameCallback(drawText);\n      scheduler.unregisterAfterFrameCallback(drawGrid);\n    };\n  }, [\n    flamegraphCanvas,\n    flamegraphView,\n    scheduler,\n    flamegraph,\n    flamegraphTheme,\n    textRenderer,\n    gridRenderer,\n    flamegraphState.profiles.selectedNode,\n    hoveredNode,\n    selectedFrameRenderer,\n  ]);\n\n  useEffect(() => {\n    if (!flamegraphCanvas || !flamegraphView) {\n      return undefined;\n    }\n\n    const onResetZoom = () => {\n      setConfigSpaceCursor(null);\n    };\n\n    const onZoomIntoFrame = () => {\n      setConfigSpaceCursor(null);\n    };\n\n    scheduler.on('resetZoom', onResetZoom);\n    scheduler.on('zoomIntoFrame', onZoomIntoFrame);\n\n    return () => {\n      scheduler.off('resetZoom', onResetZoom);\n      scheduler.off('zoomIntoFrame', onZoomIntoFrame);\n    };\n  }, [\n    flamegraphCanvas,\n    canvasPoolManager,\n    dispatchFlamegraphState,\n    scheduler,\n    flamegraphView,\n  ]);\n\n  useEffect(() => {\n    canvasPoolManager.registerScheduler(scheduler);\n    return () => canvasPoolManager.unregisterScheduler(scheduler);\n  }, [canvasPoolManager, scheduler]);\n\n  const onCanvasMouseDown = useCallback((evt: React.MouseEvent<HTMLCanvasElement>) => {\n    const logicalMousePos = vec2.fromValues(\n      evt.nativeEvent.offsetX,\n      evt.nativeEvent.offsetY\n    );\n\n    const physicalMousePos = vec2.scale(\n      vec2.create(),\n      logicalMousePos,\n      window.devicePixelRatio\n    );\n\n    setLastInteraction('click');\n    setStartPanVector(physicalMousePos);\n  }, []);\n\n  const onCanvasMouseUp = useCallback(\n    (evt: React.MouseEvent<HTMLCanvasElement>) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      if (!configSpaceCursor) {\n        setLastInteraction(null);\n        setStartPanVector(null);\n        return;\n      }\n\n      // Only dispatch the zoom action if the new clicked node is not the same as the old selected node.\n      // This essentialy tracks double click action on a rectangle\n      if (lastInteraction === 'click') {\n        if (\n          hoveredNode &&\n          flamegraphState.profiles.selectedNode &&\n          hoveredNode === flamegraphState.profiles.selectedNode\n        ) {\n          canvasPoolManager.dispatch('zoomIntoFrame', [hoveredNode]);\n        }\n        canvasPoolManager.dispatch('selectedNode', [hoveredNode]);\n        dispatchFlamegraphState({type: 'set selected node', payload: hoveredNode});\n      }\n\n      setLastInteraction(null);\n      setStartPanVector(null);\n    },\n    [\n      configSpaceCursor,\n      flamegraphState.profiles.selectedNode,\n      dispatchFlamegraphState,\n      hoveredNode,\n      canvasPoolManager,\n      lastInteraction,\n    ]\n  );\n\n  const onMouseDrag = useCallback(\n    (evt: React.MouseEvent<HTMLCanvasElement>) => {\n      if (!flamegraphCanvas || !flamegraphView || !startPanVector) {\n        return;\n      }\n\n      const logicalMousePos = vec2.fromValues(\n        evt.nativeEvent.offsetX,\n        evt.nativeEvent.offsetY\n      );\n\n      const physicalMousePos = vec2.scale(\n        vec2.create(),\n        logicalMousePos,\n        window.devicePixelRatio\n      );\n\n      const physicalDelta = vec2.subtract(\n        vec2.create(),\n        startPanVector,\n        physicalMousePos\n      );\n\n      if (physicalDelta[0] === 0 && physicalDelta[1] === 0) {\n        return;\n      }\n\n      const physicalToConfig = mat3.invert(\n        mat3.create(),\n        flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n      );\n      const [m00, m01, m02, m10, m11, m12] = physicalToConfig;\n\n      const configDelta = vec2.transformMat3(vec2.create(), physicalDelta, [\n        m00,\n        m01,\n        m02,\n        m10,\n        m11,\n        m12,\n        0,\n        0,\n        0,\n      ]);\n\n      canvasPoolManager.dispatch('transformConfigView', [\n        mat3.fromTranslation(mat3.create(), configDelta),\n      ]);\n\n      setStartPanVector(physicalMousePos);\n    },\n    [flamegraphCanvas, flamegraphView, startPanVector, canvasPoolManager]\n  );\n\n  const onCanvasMouseMove = useCallback(\n    (evt: React.MouseEvent<HTMLCanvasElement>) => {\n      if (!flamegraphCanvas || !flamegraphView) {\n        return;\n      }\n\n      const configSpaceMouse = flamegraphView.getConfigViewCursor(\n        vec2.fromValues(evt.nativeEvent.offsetX, evt.nativeEvent.offsetY),\n        flamegraphCanvas\n      );\n\n      setConfigSpaceCursor(configSpaceMouse);\n\n      if (startPanVector) {\n        onMouseDrag(evt);\n        setLastInteraction('pan');\n      } else {\n        setLastInteraction(null);\n      }\n    },\n    [flamegraphCanvas, flamegraphView, setConfigSpaceCursor, onMouseDrag, startPanVector]\n  );\n\n  const onCanvasMouseLeave = useCallback(() => {\n    setConfigSpaceCursor(null);\n    setStartPanVector(null);\n    setLastInteraction(null);\n  }, []);\n\n  const zoom = useCallback(\n    (evt: WheelEvent) => {\n      if (!flamegraphCanvas || !flamegraphView) {\n        return;\n      }\n\n      const identity = mat3.identity(mat3.create());\n      const scale = 1 - evt.deltaY * 0.01 * -1; // -1 to invert scale\n\n      const mouseInConfigView = flamegraphView.getConfigViewCursor(\n        vec2.fromValues(evt.offsetX, evt.offsetY),\n        flamegraphCanvas\n      );\n\n      const configCenter = vec2.fromValues(\n        mouseInConfigView[0],\n        flamegraphView.configView.y\n      );\n\n      const invertedConfigCenter = vec2.multiply(\n        vec2.create(),\n        vec2.fromValues(-1, -1),\n        configCenter\n      );\n\n      const translated = mat3.translate(mat3.create(), identity, configCenter);\n      const scaled = mat3.scale(mat3.create(), translated, vec2.fromValues(scale, 1));\n      const translatedBack = mat3.translate(mat3.create(), scaled, invertedConfigCenter);\n\n      canvasPoolManager.dispatch('transformConfigView', [translatedBack]);\n    },\n    [flamegraphCanvas, flamegraphView, canvasPoolManager]\n  );\n\n  const scroll = useCallback(\n    (evt: WheelEvent) => {\n      if (!flamegraphCanvas || !flamegraphView) {\n        return;\n      }\n\n      const physicalDelta = vec2.fromValues(evt.deltaX, evt.deltaY);\n      const physicalToConfig = mat3.invert(\n        mat3.create(),\n        flamegraphView.fromConfigView(flamegraphCanvas.physicalSpace)\n      );\n      const [m00, m01, m02, m10, m11, m12] = physicalToConfig;\n\n      const configDelta = vec2.transformMat3(vec2.create(), physicalDelta, [\n        m00,\n        m01,\n        m02,\n        m10,\n        m11,\n        m12,\n        0,\n        0,\n        0,\n      ]);\n\n      const translate = mat3.fromTranslation(mat3.create(), configDelta);\n      canvasPoolManager.dispatch('transformConfigView', [translate]);\n    },\n    [flamegraphCanvas, flamegraphView, canvasPoolManager]\n  );\n\n  useEffect(() => {\n    if (!flamegraphCanvasRef) {\n      return undefined;\n    }\n\n    let wheelStopTimeoutId: number | undefined;\n    function onCanvasWheel(evt: WheelEvent) {\n      window.clearTimeout(wheelStopTimeoutId);\n      wheelStopTimeoutId = window.setTimeout(() => {\n        setLastInteraction(null);\n      }, 300);\n\n      evt.preventDefault();\n\n      // When we zoom, we want to clear cursor so that any tooltips\n      // rendered on the flamegraph are removed from the flamegraphView\n      setConfigSpaceCursor(null);\n\n      if (evt.metaKey) {\n        zoom(evt);\n        setLastInteraction('zoom');\n      } else {\n        scroll(evt);\n        setLastInteraction('scroll');\n      }\n    }\n\n    flamegraphCanvasRef.addEventListener('wheel', onCanvasWheel);\n\n    return () => {\n      window.clearTimeout(wheelStopTimeoutId);\n      flamegraphCanvasRef.removeEventListener('wheel', onCanvasWheel);\n    };\n  }, [flamegraphCanvasRef, zoom, scroll]);\n\n  const contextMenu = useContextMenu({container: flamegraphCanvasRef});\n\n  return (\n    <Fragment>\n      <CanvasContainer>\n        <Canvas\n          ref={canvas => setFlamegraphCanvasRef(canvas)}\n          onMouseDown={onCanvasMouseDown}\n          onMouseUp={onCanvasMouseUp}\n          onMouseMove={onCanvasMouseMove}\n          onMouseLeave={onCanvasMouseLeave}\n          onContextMenu={contextMenu.handleContextMenu}\n          style={{cursor: lastInteraction === 'pan' ? 'grab' : 'default'}}\n        />\n        <Canvas\n          ref={canvas => setFlamegraphOverlayCanvasRef(canvas)}\n          style={{\n            pointerEvents: 'none',\n          }}\n        />\n        <FlamegraphOptionsContextMenu contextMenu={contextMenu} />\n        {flamegraphCanvas &&\n        flamegraphRenderer &&\n        flamegraphView &&\n        configSpaceCursor &&\n        hoveredNode?.frame?.name ? (\n          <BoundTooltip\n            bounds={canvasBounds}\n            cursor={configSpaceCursor}\n            flamegraphCanvas={flamegraphCanvas}\n            flamegraphView={flamegraphView}\n          >\n            <HoveredFrameMainInfo>\n              <FrameColorIndicator\n                backgroundColor={formatColorForFrame(hoveredNode, flamegraphRenderer)}\n              />\n              {flamegraphRenderer.flamegraph.formatter(hoveredNode.node.totalWeight)}{' '}\n              {formatWeightToProfileDuration(\n                hoveredNode.node,\n                flamegraphRenderer.flamegraph\n              )}{' '}\n              {hoveredNode.frame.name}\n            </HoveredFrameMainInfo>\n            <HoveredFrameTimelineInfo>\n              {flamegraphRenderer.flamegraph.timelineFormatter(hoveredNode.start)}{' '}\n              {' \\u2014 '}\n              {flamegraphRenderer.flamegraph.timelineFormatter(hoveredNode.end)}\n            </HoveredFrameTimelineInfo>\n          </BoundTooltip>\n        ) : null}\n      </CanvasContainer>\n      {flamegraphRenderer ? (\n        <FrameStack\n          canvasPoolManager={canvasPoolManager}\n          flamegraphRenderer={flamegraphRenderer}\n        />\n      ) : null}\n    </Fragment>\n  );\n}\n\nconst HoveredFrameTimelineInfo = styled('div')`\n  color: ${p => p.theme.subText};\n`;\n\nconst HoveredFrameMainInfo = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst FrameColorIndicator = styled('div')<{\n  backgroundColor: React.CSSProperties['backgroundColor'];\n}>`\n  width: 12px;\n  height: 12px;\n  min-width: 12px;\n  min-height: 12px;\n  border-radius: 2px;\n  display: inline-block;\n  background-color: ${p => p.backgroundColor};\n  margin-right: ${space(1)};\n`;\n\nconst CanvasContainer = styled('div')`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  position: relative;\n`;\n\nconst Canvas = styled('canvas')`\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  user-select: none;\n  position: absolute;\n`;\n\nexport {FlamegraphZoomView};\n","import {mat3} from 'gl-matrix';\n\nimport {FlamegraphTheme} from '../flamegraph/flamegraphTheme';\nimport {getContext, Rect} from '../gl/utils';\n\nclass PositionIndicatorRenderer {\n  canvas: HTMLCanvasElement;\n  context: CanvasRenderingContext2D;\n  theme: FlamegraphTheme;\n\n  constructor(canvas: HTMLCanvasElement, theme: FlamegraphTheme) {\n    this.canvas = canvas;\n    this.theme = theme;\n\n    this.context = getContext(this.canvas, '2d');\n  }\n\n  draw(configView: Rect, configSpace: Rect, configSpaceToPhysicalSpace: mat3): void {\n    if (configView.equals(configSpace)) {\n      // User is not zoomed in, so we dont need to draw anything.\n      return;\n    }\n\n    // Transform both views to their respective physical spaces\n    const physicalConfigViewRect = Rect.From(configView).transformRect(\n      configSpaceToPhysicalSpace\n    );\n\n    const physicalConfigRect = Rect.From(configSpace).transformRect(\n      configSpaceToPhysicalSpace\n    );\n\n    const offsetRectForBorderWidth: [number, number, number, number] = [\n      physicalConfigViewRect.x - this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH,\n      physicalConfigViewRect.y,\n      physicalConfigViewRect.width +\n        this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH,\n      physicalConfigViewRect.height,\n    ];\n\n    // What we do to draw the \"window\" that the user is currently watching is we draw two rectangles, the\n    // zoomed in view and the zoomed out view. The zoomed out view is the full view of the flamegraph, and the zoom\n    // in view is whatever the user is currently looking at. Because the zoomed in view is a subset of the zoomed,\n    // we just need to use the evenodd fill rule to paint inbetween the two rectangles.\n    this.context.fillStyle = this.theme.COLORS.MINIMAP_POSITION_OVERLAY_COLOR;\n    this.context.strokeStyle = this.theme.COLORS.MINIMAP_POSITION_OVERLAY_BORDER_COLOR;\n    this.context.lineWidth = this.theme.SIZES.MINIMAP_POSITION_OVERLAY_BORDER_WIDTH;\n\n    this.context.beginPath();\n    this.context.rect(0, 0, physicalConfigRect.width, physicalConfigRect.height);\n    this.context.rect(...offsetRectForBorderWidth);\n\n    this.context.fill('evenodd');\n    this.context.strokeRect(...offsetRectForBorderWidth);\n  }\n}\n\nexport {PositionIndicatorRenderer};\n","import {Fragment, useCallback, useEffect, useMemo, useRef, useState} from 'react';\nimport styled from '@emotion/styled';\nimport {mat3, vec2} from 'gl-matrix';\n\nimport {CanvasPoolManager, CanvasScheduler} from 'sentry/utils/profiling/canvasScheduler';\nimport {Flamegraph} from 'sentry/utils/profiling/flamegraph';\nimport {useDispatchFlamegraphState} from 'sentry/utils/profiling/flamegraph/useFlamegraphState';\nimport {useFlamegraphTheme} from 'sentry/utils/profiling/flamegraph/useFlamegraphTheme';\nimport {FlamegraphCanvas} from 'sentry/utils/profiling/flamegraphCanvas';\nimport {FlamegraphView} from 'sentry/utils/profiling/flamegraphView';\nimport {Rect} from 'sentry/utils/profiling/gl/utils';\nimport {FlamegraphRenderer} from 'sentry/utils/profiling/renderers/flamegraphRenderer';\nimport {PositionIndicatorRenderer} from 'sentry/utils/profiling/renderers/positionIndicatorRenderer';\nimport usePrevious from 'sentry/utils/usePrevious';\n\ninterface FlamegraphZoomViewMinimapProps {\n  canvasPoolManager: CanvasPoolManager;\n  flamegraph: Flamegraph;\n  flamegraphMiniMapCanvas: FlamegraphCanvas | null;\n  flamegraphMiniMapCanvasRef: HTMLCanvasElement | null;\n  flamegraphMiniMapOverlayCanvasRef: HTMLCanvasElement | null;\n  flamegraphMiniMapView: FlamegraphView | null;\n  setFlamegraphMiniMapCanvasRef: React.Dispatch<\n    React.SetStateAction<HTMLCanvasElement | null>\n  >;\n  setFlamegraphMiniMapOverlayCanvasRef: React.Dispatch<\n    React.SetStateAction<HTMLCanvasElement | null>\n  >;\n}\n\nfunction FlamegraphZoomViewMinimap({\n  canvasPoolManager,\n  flamegraph,\n  flamegraphMiniMapCanvas,\n  flamegraphMiniMapCanvasRef,\n  flamegraphMiniMapOverlayCanvasRef,\n  flamegraphMiniMapView,\n  setFlamegraphMiniMapCanvasRef,\n  setFlamegraphMiniMapOverlayCanvasRef,\n}: FlamegraphZoomViewMinimapProps): React.ReactElement {\n  const flamegraphTheme = useFlamegraphTheme();\n  const [lastInteraction, setLastInteraction] = useState<\n    'pan' | 'click' | 'zoom' | 'scroll' | 'select' | null\n  >(null);\n\n  const [dispatch] = useDispatchFlamegraphState();\n\n  const [configSpaceCursor, setConfigSpaceCursor] = useState<vec2 | null>(null);\n\n  const scheduler = useMemo(() => new CanvasScheduler(), []);\n\n  const flamegraphMiniMapRenderer = useMemo(() => {\n    if (!flamegraphMiniMapCanvasRef) {\n      return null;\n    }\n\n    const BAR_HEIGHT =\n      flamegraphTheme.SIZES.MINIMAP_HEIGHT /\n      (flamegraph.depth + flamegraphTheme.SIZES.FLAMEGRAPH_DEPTH_OFFSET);\n\n    return new FlamegraphRenderer(flamegraphMiniMapCanvasRef, flamegraph, {\n      ...flamegraphTheme,\n      SIZES: {\n        ...flamegraphTheme.SIZES,\n        BAR_HEIGHT,\n      },\n    });\n  }, [flamegraph, flamegraphMiniMapCanvasRef, flamegraphTheme]);\n\n  const positionIndicatorRenderer: PositionIndicatorRenderer | null = useMemo(() => {\n    if (!flamegraphMiniMapOverlayCanvasRef) {\n      return null;\n    }\n\n    return new PositionIndicatorRenderer(\n      flamegraphMiniMapOverlayCanvasRef,\n      flamegraphTheme\n    );\n  }, [flamegraphMiniMapOverlayCanvasRef, flamegraphTheme]);\n\n  useEffect(() => {\n    if (\n      !flamegraphMiniMapCanvas ||\n      !flamegraphMiniMapView ||\n      !flamegraphMiniMapRenderer\n    ) {\n      return undefined;\n    }\n\n    const drawRectangles = () => {\n      flamegraphMiniMapRenderer.draw(\n        flamegraphMiniMapView.fromConfigSpace(flamegraphMiniMapCanvas.physicalSpace)\n      );\n    };\n\n    scheduler.registerBeforeFrameCallback(drawRectangles);\n\n    return () => {\n      scheduler.unregisterBeforeFrameCallback(drawRectangles);\n    };\n  }, [\n    flamegraphMiniMapCanvas,\n    flamegraphMiniMapRenderer,\n    scheduler,\n    flamegraphMiniMapView,\n  ]);\n\n  useEffect(() => {\n    if (\n      !flamegraphMiniMapCanvas ||\n      !flamegraphMiniMapView ||\n      !positionIndicatorRenderer\n    ) {\n      return undefined;\n    }\n\n    const clearOverlayCanvas = () => {\n      positionIndicatorRenderer.context.clearRect(\n        0,\n        0,\n        positionIndicatorRenderer.canvas.width,\n        positionIndicatorRenderer.canvas.height\n      );\n    };\n\n    const drawPosition = () => {\n      positionIndicatorRenderer.draw(\n        flamegraphMiniMapView.configView,\n        flamegraphMiniMapView.configSpace,\n        flamegraphMiniMapView.fromConfigSpace(flamegraphMiniMapCanvas.physicalSpace)\n      );\n    };\n\n    scheduler.registerBeforeFrameCallback(clearOverlayCanvas);\n    scheduler.registerAfterFrameCallback(drawPosition);\n\n    scheduler.draw();\n\n    return () => {\n      scheduler.unregisterBeforeFrameCallback(clearOverlayCanvas);\n      scheduler.unregisterAfterFrameCallback(drawPosition);\n    };\n  }, [\n    flamegraphMiniMapCanvas,\n    flamegraphMiniMapView,\n    scheduler,\n    positionIndicatorRenderer,\n  ]);\n\n  const previousInteraction = usePrevious(lastInteraction);\n  const beforeInteractionConfigView = useRef<Rect | null>(null);\n\n  useEffect(() => {\n    if (!flamegraphMiniMapView) {\n      return;\n    }\n\n    // Check if we are starting a new interaction\n    if (previousInteraction === null && lastInteraction) {\n      beforeInteractionConfigView.current = flamegraphMiniMapView.configView.clone();\n      return;\n    }\n\n    if (\n      beforeInteractionConfigView.current &&\n      !beforeInteractionConfigView.current.equals(flamegraphMiniMapView.configView)\n    ) {\n      dispatch({\n        type: 'checkpoint',\n        payload: flamegraphMiniMapView.configView.clone(),\n      });\n    }\n  }, [lastInteraction, flamegraphMiniMapView, dispatch, previousInteraction]);\n\n  const [startDragVector, setStartDragConfigSpaceCursor] = useState<vec2 | null>(null);\n  const [lastDragVector, setLastDragVector] = useState<vec2 | null>(null);\n\n  useEffect(() => {\n    canvasPoolManager.registerScheduler(scheduler);\n    return () => canvasPoolManager.unregisterScheduler(scheduler);\n  }, [scheduler, canvasPoolManager]);\n\n  const onMouseDrag = useCallback(\n    (evt: React.MouseEvent<HTMLCanvasElement>) => {\n      if (!lastDragVector || !flamegraphMiniMapCanvas || !flamegraphMiniMapView) {\n        return;\n      }\n\n      const logicalMousePos = vec2.fromValues(\n        evt.nativeEvent.offsetX,\n        evt.nativeEvent.offsetY\n      );\n      const physicalMousePos = vec2.scale(\n        vec2.create(),\n        logicalMousePos,\n        window.devicePixelRatio\n      );\n\n      const physicalDelta = vec2.subtract(\n        vec2.create(),\n        physicalMousePos,\n        lastDragVector\n      );\n\n      if (physicalDelta[0] === 0 && physicalDelta[1] === 0) {\n        return;\n      }\n\n      const physicalToConfig = mat3.invert(\n        mat3.create(),\n        flamegraphMiniMapView.fromConfigSpace(flamegraphMiniMapCanvas.physicalSpace)\n      );\n\n      const configDelta = vec2.transformMat3(\n        vec2.create(),\n        physicalDelta,\n        physicalToConfig\n      );\n\n      canvasPoolManager.dispatch('transformConfigView', [\n        mat3.fromTranslation(mat3.create(), configDelta),\n      ]);\n\n      setLastDragVector(physicalMousePos);\n    },\n    [flamegraphMiniMapCanvas, flamegraphMiniMapView, lastDragVector, canvasPoolManager]\n  );\n\n  const onMinimapCanvasMouseMove = useCallback(\n    (evt: React.MouseEvent<HTMLCanvasElement>) => {\n      if (!flamegraphMiniMapCanvas || !flamegraphMiniMapView) {\n        return;\n      }\n\n      const configSpaceMouse = flamegraphMiniMapView.getConfigSpaceCursor(\n        vec2.fromValues(evt.nativeEvent.offsetX, evt.nativeEvent.offsetY),\n        flamegraphMiniMapCanvas\n      );\n\n      setConfigSpaceCursor(configSpaceMouse);\n\n      if (lastDragVector) {\n        onMouseDrag(evt);\n        setLastInteraction('pan');\n        return;\n      }\n      if (startDragVector) {\n        const start = vec2.min(vec2.create(), startDragVector, configSpaceMouse);\n        const end = vec2.max(vec2.create(), startDragVector, configSpaceMouse);\n\n        const rect = new Rect(\n          start[0],\n          configSpaceMouse[1] - flamegraphMiniMapView.configView.height / 2,\n          end[0] - start[0],\n          flamegraphMiniMapView.configView.height\n        );\n        canvasPoolManager.dispatch('setConfigView', [rect]);\n        setLastInteraction('select');\n        return;\n      }\n\n      setLastInteraction(null);\n    },\n    [\n      flamegraphMiniMapCanvas,\n      flamegraphMiniMapView,\n      canvasPoolManager,\n      lastDragVector,\n      onMouseDrag,\n      startDragVector,\n    ]\n  );\n\n  const onMinimapScroll = useCallback(\n    (evt: WheelEvent) => {\n      if (!flamegraphMiniMapCanvas || !flamegraphMiniMapView) {\n        return;\n      }\n\n      {\n        const physicalDelta = vec2.fromValues(evt.deltaX * 0.8, evt.deltaY);\n        const physicalToConfig = mat3.invert(\n          mat3.create(),\n          flamegraphMiniMapView.fromConfigView(flamegraphMiniMapCanvas.physicalSpace)\n        );\n        const [m00, m01, m02, m10, m11, m12] = physicalToConfig;\n\n        const configDelta = vec2.transformMat3(vec2.create(), physicalDelta, [\n          m00,\n          m01,\n          m02,\n          m10,\n          m11,\n          m12,\n          0,\n          0,\n          0,\n        ]);\n\n        const translate = mat3.fromTranslation(mat3.create(), configDelta);\n        canvasPoolManager.dispatch('transformConfigView', [translate]);\n      }\n    },\n    [flamegraphMiniMapCanvas, flamegraphMiniMapView, canvasPoolManager]\n  );\n\n  const onMinimapZoom = useCallback(\n    (evt: WheelEvent) => {\n      if (!flamegraphMiniMapCanvas || !flamegraphMiniMapView) {\n        return;\n      }\n\n      const identity = mat3.identity(mat3.create());\n      const scale = 1 - evt.deltaY * 0.001 * -1; // -1 to invert scale\n\n      const mouseInConfigSpace = flamegraphMiniMapView.getConfigSpaceCursor(\n        vec2.fromValues(evt.offsetX, evt.offsetY),\n        flamegraphMiniMapCanvas\n      );\n\n      const configCenter = vec2.fromValues(\n        mouseInConfigSpace[0],\n        flamegraphMiniMapView.configView.y\n      );\n\n      const invertedConfigCenter = vec2.multiply(\n        vec2.create(),\n        vec2.fromValues(-1, -1),\n        configCenter\n      );\n\n      const translated = mat3.translate(mat3.create(), identity, configCenter);\n      const scaled = mat3.scale(mat3.create(), translated, vec2.fromValues(scale, 1));\n      const translatedBack = mat3.translate(mat3.create(), scaled, invertedConfigCenter);\n\n      canvasPoolManager.dispatch('transformConfigView', [translatedBack]);\n    },\n    [flamegraphMiniMapCanvas, flamegraphMiniMapView, canvasPoolManager]\n  );\n\n  const onMinimapCanvasMouseDown = useCallback(\n    evt => {\n      if (\n        !configSpaceCursor ||\n        !flamegraphMiniMapCanvas ||\n        !flamegraphMiniMapView ||\n        !canvasPoolManager\n      ) {\n        return;\n      }\n\n      const logicalMousePos = vec2.fromValues(\n        evt.nativeEvent.offsetX,\n        evt.nativeEvent.offsetY\n      );\n      const physicalMousePos = vec2.scale(\n        vec2.create(),\n        logicalMousePos,\n        window.devicePixelRatio\n      );\n\n      if (flamegraphMiniMapView.configView.contains(configSpaceCursor)) {\n        setLastDragVector(physicalMousePos);\n      } else {\n        const startConfigSpaceCursor = flamegraphMiniMapView.getConfigSpaceCursor(\n          vec2.fromValues(evt.nativeEvent.offsetX, evt.nativeEvent.offsetY),\n          flamegraphMiniMapCanvas\n        );\n        setStartDragConfigSpaceCursor(startConfigSpaceCursor);\n      }\n      setLastInteraction('select');\n    },\n    [configSpaceCursor, flamegraphMiniMapCanvas, flamegraphMiniMapView, canvasPoolManager]\n  );\n\n  const onMinimapCanvasMouseUp = useCallback(() => {\n    setConfigSpaceCursor(null);\n    setStartDragConfigSpaceCursor(null);\n    setLastDragVector(null);\n    setLastInteraction(null);\n  }, []);\n\n  useEffect(() => {\n    if (!flamegraphMiniMapCanvasRef) {\n      return undefined;\n    }\n\n    let wheelStopTimeoutId: number | undefined;\n    function onCanvasWheel(evt: WheelEvent) {\n      window.clearTimeout(wheelStopTimeoutId);\n      wheelStopTimeoutId = window.setTimeout(() => {\n        setLastInteraction(null);\n      }, 300);\n\n      evt.preventDefault();\n\n      // When we zoom, we want to clear cursor so that any tooltips\n      // rendered on the flamegraph are removed from the view\n      setConfigSpaceCursor(null);\n\n      if (evt.metaKey) {\n        onMinimapZoom(evt);\n        setLastInteraction('zoom');\n      } else {\n        onMinimapScroll(evt);\n        setLastInteraction('scroll');\n      }\n    }\n\n    flamegraphMiniMapCanvasRef.addEventListener('wheel', onCanvasWheel);\n\n    return () => {\n      window.clearTimeout(wheelStopTimeoutId);\n      flamegraphMiniMapCanvasRef.removeEventListener('wheel', onCanvasWheel);\n    };\n  }, [flamegraphMiniMapCanvasRef, onMinimapZoom, onMinimapScroll]);\n\n  useEffect(() => {\n    window.addEventListener('mouseup', onMinimapCanvasMouseUp);\n\n    return () => {\n      window.removeEventListener('mouseup', onMinimapCanvasMouseUp);\n    };\n  }, [onMinimapCanvasMouseUp]);\n\n  useEffect(() => {\n    if (!flamegraphMiniMapCanvasRef) {\n      return undefined;\n    }\n\n    const onCanvasWheel = (evt: WheelEvent) => {\n      evt.preventDefault();\n      const isZoom = evt.metaKey;\n\n      // @TODO figure out what key to use for other platforms\n      if (isZoom) {\n        onMinimapZoom(evt);\n      } else {\n        onMinimapScroll(evt);\n      }\n    };\n\n    flamegraphMiniMapCanvasRef.addEventListener('wheel', onCanvasWheel);\n    return () => flamegraphMiniMapCanvasRef?.removeEventListener('wheel', onCanvasWheel);\n  }, [flamegraphMiniMapCanvasRef, onMinimapScroll, onMinimapZoom]);\n\n  return (\n    <Fragment>\n      <Canvas\n        ref={c => setFlamegraphMiniMapCanvasRef(c)}\n        onMouseDown={onMinimapCanvasMouseDown}\n        onMouseMove={onMinimapCanvasMouseMove}\n        onMouseLeave={onMinimapCanvasMouseUp}\n        cursor={\n          configSpaceCursor &&\n          flamegraphMiniMapView?.configView.contains(configSpaceCursor)\n            ? 'grab'\n            : 'col-resize'\n        }\n      />\n      <OverlayCanvas ref={c => setFlamegraphMiniMapOverlayCanvasRef(c)} />\n    </Fragment>\n  );\n}\n\nconst Canvas = styled('canvas')<{cursor?: React.CSSProperties['cursor']}>`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  cursor: ${props => props.cursor ?? 'default'};\n  user-select: none;\n`;\n\nconst OverlayCanvas = styled(Canvas)`\n  pointer-events: none;\n`;\n\nexport {FlamegraphZoomViewMinimap};\n","import {useCallback, useState} from 'react';\nimport styled from '@emotion/styled';\n\nimport {t} from 'sentry/locale';\nimport {\n  importDroppedProfile,\n  ProfileGroup,\n} from 'sentry/utils/profiling/profile/importProfile';\n\nexport interface ProfileDragDropImportProps {\n  children: React.ReactNode;\n  onImport: (profile: ProfileGroup) => void;\n}\n\nfunction ProfileDragDropImport({\n  onImport,\n  children,\n}: ProfileDragDropImportProps): React.ReactElement {\n  const [dropState, setDropState] = useState<'idle' | 'dragover' | 'processing'>('idle');\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n\n  const onDrop = useCallback(\n    (evt: React.DragEvent<HTMLDivElement>) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      const file = evt.dataTransfer.items[0].getAsFile();\n\n      if (file) {\n        setDropState('processing');\n        importDroppedProfile(file)\n          .then(profile => {\n            setDropState('idle');\n            setErrorMessage(null);\n\n            onImport(profile);\n          })\n          .catch(e => {\n            setDropState('idle');\n            setErrorMessage(e.message);\n          });\n      }\n    },\n    [onImport]\n  );\n\n  const onDragEnter = useCallback((evt: React.DragEvent<HTMLDivElement>) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n    setDropState('dragover');\n  }, []);\n\n  const onDragLeave = useCallback((evt: React.DragEvent<HTMLDivElement>) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n    setDropState('idle');\n  }, []);\n\n  // This is required to indicate that onDrop is supported on this element\n  const onDragOver = useCallback((evt: React.DragEvent<HTMLDivElement>) => {\n    evt.preventDefault();\n  }, []);\n\n  return (\n    <DragDropContainer onDragEnter={onDragEnter}>\n      {dropState === 'idle' ? null : (\n        <Overlay onDrop={onDrop} onDragOver={onDragOver} onDragLeave={onDragLeave}>\n          {t('Drop here')}\n          <p>{errorMessage}</p>\n        </Overlay>\n      )}\n      {children}\n    </DragDropContainer>\n  );\n}\n\nconst DragDropContainer = styled('div')`\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 100%;\n`;\n\nconst Overlay = styled('div')`\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  display: grid;\n  grid: auto/50%;\n  place-content: center;\n  z-index: ${p => p.theme.zIndex.modal};\n  text-align: center;\n`;\n\nexport {ProfileDragDropImport};\n","import {useCallback, useMemo} from 'react';\nimport styled from '@emotion/styled';\n\nimport CompactSelect from 'sentry/components/forms/compactSelect';\nimport {ControlProps, GeneralSelectValue} from 'sentry/components/forms/selectControl';\nimport {IconList} from 'sentry/icons';\nimport {tn} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {SelectValue} from 'sentry/types';\nimport {defined} from 'sentry/utils';\nimport {FlamegraphState} from 'sentry/utils/profiling/flamegraph/flamegraphStateProvider/index';\nimport {ProfileGroup} from 'sentry/utils/profiling/profile/importProfile';\nimport {Profile} from 'sentry/utils/profiling/profile/profile';\nimport {makeFormatter} from 'sentry/utils/profiling/units/units';\n\ninterface ThreadSelectorProps {\n  onThreadIdChange: (threadId: Profile['threadId']) => void;\n  profileGroup: ProfileGroup;\n  threadId: FlamegraphState['profiles']['threadId'];\n}\n\nfunction ThreadMenuSelector<OptionType extends GeneralSelectValue = GeneralSelectValue>({\n  threadId,\n  onThreadIdChange,\n  profileGroup,\n}: ThreadSelectorProps) {\n  const options: SelectValue<number>[] = useMemo(() => {\n    return [...profileGroup.profiles].sort(compareProfiles).map(profile => ({\n      label: profile.name\n        ? `tid (${profile.threadId}): ${profile.name}`\n        : `tid (${profile.threadId})`,\n      value: profile.threadId,\n      details: (\n        <ThreadLabelDetails\n          duration={makeFormatter(profile.unit)(profile.duration)}\n          samples={profile.samples.length}\n        />\n      ),\n    }));\n  }, [profileGroup]);\n\n  const handleChange: NonNullable<ControlProps<OptionType>['onChange']> = useCallback(\n    opt => {\n      if (defined(opt)) {\n        onThreadIdChange(opt.value);\n      }\n    },\n    [onThreadIdChange]\n  );\n\n  return (\n    <CompactSelect\n      triggerProps={{\n        icon: <IconList size=\"xs\" />,\n        size: 'xsmall',\n      }}\n      options={options}\n      value={threadId}\n      onChange={handleChange}\n      isSearchable\n    />\n  );\n}\n\ninterface ThreadLabelDetailsProps {\n  duration: string;\n  samples: number;\n}\n\nfunction ThreadLabelDetails(props: ThreadLabelDetailsProps) {\n  return (\n    <DetailsContainer>\n      <div>{props.duration}</div>\n      <div>{tn('%s sample', '%s samples', props.samples)}</div>\n    </DetailsContainer>\n  );\n}\n\ntype ProfileLight = {\n  duration: Profile['duration'];\n  name: Profile['name'];\n  threadId: Profile['threadId'];\n};\n\nfunction compareProfiles(a: ProfileLight, b: ProfileLight): number {\n  if (!b.duration) {\n    return -1;\n  }\n  if (!a.duration) {\n    return 1;\n  }\n\n  if (a.name.startsWith('(tid') && b.name.startsWith('(tid')) {\n    return -1;\n  }\n  if (a.name.startsWith('(tid')) {\n    return -1;\n  }\n  if (b.name.startsWith('(tid')) {\n    return -1;\n  }\n  if (a.name.includes('main')) {\n    return -1;\n  }\n  if (b.name.includes('main')) {\n    return 1;\n  }\n  return a.name > b.name ? -1 : 1;\n}\n\nconst DetailsContainer = styled('div')`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  gap: ${space(1)};\n`;\n\nexport {ThreadMenuSelector};\n","import {lastOfArray} from 'sentry/utils';\n\nimport {Rect} from './gl/utils';\nimport {Profile} from './profile/profile';\nimport {makeFormatter, makeTimelineFormatter} from './units/units';\nimport {CallTreeNode} from './callTreeNode';\nimport {FlamegraphFrame} from './flamegraphFrame';\n\nexport class Flamegraph {\n  profile: Profile;\n  frames: FlamegraphFrame[] = [];\n  roots: FlamegraphFrame[] = [];\n\n  profileIndex: number;\n\n  inverted?: boolean = false;\n  leftHeavy?: boolean = false;\n\n  depth = 0;\n  configSpace: Rect = new Rect(0, 0, 0, 0);\n\n  formatter: (value: number) => string;\n  timelineFormatter: (value: number) => string;\n\n  frameIndex: Record<string, FlamegraphFrame> = {};\n\n  static Empty(): Flamegraph {\n    return new Flamegraph(Profile.Empty(), 0, {\n      inverted: false,\n      leftHeavy: false,\n    });\n  }\n\n  static From(from: Flamegraph, {inverted = false, leftHeavy = false}): Flamegraph {\n    return new Flamegraph(from.profile, from.profileIndex, {inverted, leftHeavy});\n  }\n\n  constructor(\n    profile: Profile,\n    profileIndex: number,\n    {\n      inverted = false,\n      leftHeavy = false,\n      configSpace,\n    }: {configSpace?: Rect; inverted?: boolean; leftHeavy?: boolean} = {}\n  ) {\n    this.inverted = inverted;\n    this.leftHeavy = leftHeavy;\n\n    // @TODO check if we can get rid of this profile reference\n    this.profile = profile;\n    this.profileIndex = profileIndex;\n\n    this.roots = [];\n\n    // If a custom config space is provided, use it and draw the chart in it\n    this.frames = leftHeavy\n      ? this.buildLeftHeavyGraph(profile, configSpace ? configSpace.x : 0)\n      : this.buildCallOrderGraph(profile, configSpace ? configSpace.x : 0);\n\n    this.formatter = makeFormatter(profile.unit);\n    this.timelineFormatter = makeTimelineFormatter(profile.unit);\n\n    // If the profile duration is 0, set the flamegraph duration\n    // to 1 second so we can render a placeholder grid\n    this.configSpace = new Rect(\n      0,\n      0,\n      this.profile.unit === 'microseconds'\n        ? 1e6\n        : this.profile.unit === 'milliseconds'\n        ? 1e3\n        : 1,\n      this.depth\n    );\n\n    if (this.profile.duration) {\n      this.configSpace = new Rect(\n        configSpace ? configSpace.x : this.profile.startedAt,\n        0,\n        configSpace ? configSpace.width : this.profile.duration,\n        this.depth\n      );\n    }\n  }\n\n  buildCallOrderGraph(profile: Profile, offset: number): FlamegraphFrame[] {\n    const frames: FlamegraphFrame[] = [];\n    const stack: FlamegraphFrame[] = [];\n\n    let idx = 0;\n\n    const openFrame = (node: CallTreeNode, value: number) => {\n      const parent = lastOfArray(stack);\n\n      const frame: FlamegraphFrame = {\n        key: idx,\n        frame: node.frame,\n        node,\n        parent,\n        children: [],\n        depth: 0,\n        start: offset + value,\n        end: offset + value,\n      };\n\n      if (parent) {\n        parent.children.push(frame);\n      }\n\n      stack.push(frame);\n\n      if (stack.length === 1) {\n        this.roots.push(frame);\n      }\n      idx++;\n    };\n\n    const closeFrame = (_: CallTreeNode, value: number) => {\n      const stackTop = stack.pop();\n\n      if (!stackTop) {\n        // This is unreachable because the profile importing logic already checks this\n        throw new Error('Unbalanced stack');\n      }\n\n      stackTop.end = offset + value;\n      stackTop.depth = stack.length;\n\n      if (stackTop.end - stackTop.start === 0) {\n        return;\n      }\n\n      frames.unshift(stackTop);\n      this.depth = Math.max(stackTop.depth, this.depth);\n    };\n\n    profile.forEach(openFrame, closeFrame);\n    return frames;\n  }\n\n  buildLeftHeavyGraph(profile: Profile, offset: number): FlamegraphFrame[] {\n    const frames: FlamegraphFrame[] = [];\n    const stack: FlamegraphFrame[] = [];\n\n    const sortTree = (node: CallTreeNode) => {\n      node.children.sort((a, b) => -(a.totalWeight - b.totalWeight));\n      node.children.forEach(c => sortTree(c));\n    };\n\n    sortTree(profile.appendOrderTree);\n\n    let idx = 0;\n    const openFrame = (node: CallTreeNode, value: number) => {\n      const parent = lastOfArray(stack);\n      const frame: FlamegraphFrame = {\n        key: idx,\n        frame: node.frame,\n        node,\n        parent,\n        children: [],\n        depth: 0,\n        start: offset + value,\n        end: offset + value,\n      };\n\n      if (parent) {\n        parent.children.push(frame);\n      }\n\n      stack.push(frame);\n\n      if (stack.length === 1) {\n        this.roots.push(frame);\n      }\n      idx++;\n    };\n\n    const closeFrame = (_node: CallTreeNode, value: number) => {\n      const stackTop = stack.pop();\n\n      if (!stackTop) {\n        throw new Error('Unbalanced stack');\n      }\n\n      stackTop.end = offset + value;\n      stackTop.depth = stack.length;\n\n      // Dont draw 0 width frames\n      if (stackTop.end - stackTop.start === 0) {\n        return;\n      }\n      frames.unshift(stackTop);\n      this.depth = Math.max(stackTop.depth, this.depth);\n    };\n\n    function visit(node: CallTreeNode, start: number) {\n      if (!node.frame.isRoot()) {\n        openFrame(node, start);\n      }\n\n      let childTime = 0;\n\n      node.children.forEach(child => {\n        visit(child, start + childTime);\n        childTime += child.totalWeight;\n      });\n\n      if (!node.frame.isRoot()) {\n        closeFrame(node, start + node.totalWeight);\n      }\n    }\n    visit(profile.appendOrderTree, 0);\n    return frames;\n  }\n\n  setConfigSpace(configSpace: Rect): Flamegraph {\n    this.configSpace = configSpace;\n    return this;\n  }\n}\n","import {mat3, vec2} from 'gl-matrix';\n\nimport {Rect, Transform} from 'sentry/utils/profiling/gl/utils';\n\nexport class FlamegraphCanvas {\n  canvas: HTMLCanvasElement;\n  origin: vec2;\n\n  physicalSpace: Rect = Rect.Empty();\n  logicalSpace: Rect = Rect.Empty();\n\n  physicalToLogicalSpace: mat3 = mat3.create();\n  logicalToPhysicalSpace: mat3 = mat3.create();\n\n  constructor(canvas: HTMLCanvasElement, origin: vec2) {\n    this.canvas = canvas;\n    this.origin = origin;\n    this.initPhysicalSpace();\n  }\n\n  initPhysicalSpace() {\n    this.physicalSpace = new Rect(\n      this.origin[0],\n      this.origin[1],\n      this.canvas.width - this.origin[0],\n      this.canvas.height - this.origin[1]\n    );\n\n    this.logicalSpace = this.physicalSpace.scale(\n      1 / window.devicePixelRatio,\n      1 / window.devicePixelRatio\n    );\n\n    this.logicalToPhysicalSpace = Transform.transformMatrixBetweenRect(\n      this.logicalSpace,\n      this.physicalSpace\n    );\n\n    this.physicalToLogicalSpace = Transform.transformMatrixBetweenRect(\n      this.physicalSpace,\n      this.logicalSpace\n    );\n  }\n}\n","import {mat3, vec2} from 'gl-matrix';\n\nimport {Flamegraph} from 'sentry/utils/profiling/flamegraph';\nimport {FlamegraphTheme} from 'sentry/utils/profiling/flamegraph/flamegraphTheme';\nimport {FlamegraphCanvas} from 'sentry/utils/profiling/flamegraphCanvas';\nimport {computeClampedConfigView, Rect, Transform} from 'sentry/utils/profiling/gl/utils';\n\nexport class FlamegraphView {\n  flamegraph: Flamegraph;\n  theme: FlamegraphTheme;\n\n  configView: Rect = Rect.Empty();\n  configSpace: Rect = Rect.Empty();\n\n  constructor({\n    canvas,\n    flamegraph,\n    theme,\n  }: {\n    canvas: FlamegraphCanvas;\n    flamegraph: Flamegraph;\n    theme: FlamegraphTheme;\n  }) {\n    this.flamegraph = flamegraph;\n    this.theme = theme;\n    this.initConfigSpace(canvas);\n  }\n\n  private _initConfigSpace(canvas: FlamegraphCanvas): void {\n    const BAR_HEIGHT = this.theme.SIZES.BAR_HEIGHT * window.devicePixelRatio;\n\n    this.configSpace = new Rect(\n      0,\n      0,\n      this.flamegraph.configSpace.width,\n      Math.max(\n        this.flamegraph.depth + this.theme.SIZES.FLAMEGRAPH_DEPTH_OFFSET + 1,\n        canvas.physicalSpace.height / BAR_HEIGHT\n      )\n    );\n  }\n\n  private _initConfigView(canvas: FlamegraphCanvas, space: Rect): void {\n    const BAR_HEIGHT = this.theme.SIZES.BAR_HEIGHT * window.devicePixelRatio;\n\n    this.configView = Rect.From(space).withHeight(\n      canvas.physicalSpace.height / BAR_HEIGHT\n    );\n  }\n\n  initConfigSpace(canvas: FlamegraphCanvas): void {\n    this._initConfigSpace(canvas);\n    this._initConfigView(canvas, this.configSpace);\n  }\n\n  resizeConfigSpace(canvas: FlamegraphCanvas): void {\n    this._initConfigSpace(canvas);\n    this._initConfigView(canvas, this.configView);\n  }\n\n  resetConfigView(canvas: FlamegraphCanvas): void {\n    this._initConfigView(canvas, this.configSpace);\n  }\n\n  setConfigView(configView: Rect) {\n    this.configView = computeClampedConfigView(configView, {\n      width: {\n        min: this.flamegraph.profile.minFrameDuration,\n        max: this.configSpace.width,\n      },\n      height: {\n        min: 0,\n        max: this.configSpace.height,\n      },\n    });\n  }\n\n  transformConfigView(transformation: mat3) {\n    this.setConfigView(this.configView.transformRect(transformation));\n  }\n\n  toConfigSpace(space: Rect): mat3 {\n    const toConfigSpace = Transform.transformMatrixBetweenRect(space, this.configSpace);\n\n    if (this.flamegraph.inverted) {\n      mat3.multiply(toConfigSpace, this.configSpace.invertYTransform(), toConfigSpace);\n    }\n\n    return toConfigSpace;\n  }\n\n  toConfigView(space: Rect): mat3 {\n    const toConfigView = Transform.transformMatrixBetweenRect(space, this.configView);\n\n    if (this.flamegraph.inverted) {\n      mat3.multiply(toConfigView, this.configView.invertYTransform(), toConfigView);\n    }\n\n    return toConfigView;\n  }\n\n  fromConfigSpace(space: Rect): mat3 {\n    const fromConfigSpace = Transform.transformMatrixBetweenRect(this.configSpace, space);\n\n    if (this.flamegraph.inverted) {\n      mat3.multiply(fromConfigSpace, space.invertYTransform(), fromConfigSpace);\n    }\n\n    return fromConfigSpace;\n  }\n\n  fromConfigView(space: Rect): mat3 {\n    const fromConfigView = Transform.transformMatrixBetweenRect(this.configView, space);\n\n    if (this.flamegraph.inverted) {\n      mat3.multiply(fromConfigView, space.invertYTransform(), fromConfigView);\n    }\n\n    return fromConfigView;\n  }\n\n  getConfigSpaceCursor(logicalSpaceCursor: vec2, canvas: FlamegraphCanvas): vec2 {\n    const physicalSpaceCursor = vec2.transformMat3(\n      vec2.create(),\n      logicalSpaceCursor,\n      canvas.logicalToPhysicalSpace\n    );\n\n    return vec2.transformMat3(\n      vec2.create(),\n      physicalSpaceCursor,\n      this.toConfigSpace(canvas.physicalSpace)\n    );\n  }\n\n  getConfigViewCursor(logicalSpaceCursor: vec2, canvas: FlamegraphCanvas): vec2 {\n    const physicalSpaceCursor = vec2.transformMat3(\n      vec2.create(),\n      logicalSpaceCursor,\n      canvas.logicalToPhysicalSpace\n    );\n\n    return vec2.transformMat3(\n      vec2.create(),\n      physicalSpaceCursor,\n      this.toConfigView(canvas.physicalSpace)\n    );\n  }\n}\n","import {\n  Fragment,\n  ReactElement,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport styled from '@emotion/styled';\nimport {mat3, vec2} from 'gl-matrix';\n\nimport {FlamegraphOptionsMenu} from 'sentry/components/profiling/flamegraphOptionsMenu';\nimport {FlamegraphSearch} from 'sentry/components/profiling/flamegraphSearch';\nimport {FlamegraphToolbar} from 'sentry/components/profiling/flamegraphToolbar';\nimport {FlamegraphViewSelectMenu} from 'sentry/components/profiling/flamegraphViewSelectMenu';\nimport {FlamegraphZoomView} from 'sentry/components/profiling/flamegraphZoomView';\nimport {FlamegraphZoomViewMinimap} from 'sentry/components/profiling/flamegraphZoomViewMinimap';\nimport {\n  ProfileDragDropImport,\n  ProfileDragDropImportProps,\n} from 'sentry/components/profiling/profileDragDropImport';\nimport {ThreadMenuSelector} from 'sentry/components/profiling/threadSelector';\nimport {CanvasPoolManager, CanvasScheduler} from 'sentry/utils/profiling/canvasScheduler';\nimport {Flamegraph as FlamegraphModel} from 'sentry/utils/profiling/flamegraph';\nimport {FlamegraphTheme} from 'sentry/utils/profiling/flamegraph/flamegraphTheme';\nimport {useFlamegraphPreferences} from 'sentry/utils/profiling/flamegraph/useFlamegraphPreferences';\nimport {useFlamegraphProfiles} from 'sentry/utils/profiling/flamegraph/useFlamegraphProfiles';\nimport {useFlamegraphTheme} from 'sentry/utils/profiling/flamegraph/useFlamegraphTheme';\nimport {FlamegraphCanvas} from 'sentry/utils/profiling/flamegraphCanvas';\nimport {FlamegraphFrame} from 'sentry/utils/profiling/flamegraphFrame';\nimport {FlamegraphView} from 'sentry/utils/profiling/flamegraphView';\nimport {Rect, watchForResize} from 'sentry/utils/profiling/gl/utils';\nimport {ProfileGroup} from 'sentry/utils/profiling/profile/importProfile';\nimport {Profile} from 'sentry/utils/profiling/profile/profile';\nimport {useDevicePixelRatio} from 'sentry/utils/useDevicePixelRatio';\nimport {useMemoWithPrevious} from 'sentry/utils/useMemoWithPrevious';\n\nfunction getTransactionConfigSpace(profiles: Profile[]): Rect {\n  const startedAt = Math.min(...profiles.map(p => p.startedAt));\n  const endedAt = Math.max(...profiles.map(p => p.endedAt));\n  return new Rect(startedAt, 0, endedAt - startedAt, 0);\n}\ninterface FlamegraphProps {\n  onImport: ProfileDragDropImportProps['onImport'];\n  profiles: ProfileGroup;\n}\n\nfunction Flamegraph(props: FlamegraphProps): ReactElement {\n  const devicePixelRatio = useDevicePixelRatio();\n\n  const flamegraphTheme = useFlamegraphTheme();\n  const [{sorting, view, xAxis}, dispatch] = useFlamegraphPreferences();\n  const [{threadId}, dispatchThreadId] = useFlamegraphProfiles();\n\n  const canvasBounds = useRef<Rect>(Rect.Empty());\n\n  const [flamegraphCanvasRef, setFlamegraphCanvasRef] =\n    useState<HTMLCanvasElement | null>(null);\n  const [flamegraphOverlayCanvasRef, setFlamegraphOverlayCanvasRef] =\n    useState<HTMLCanvasElement | null>(null);\n\n  const [flamegraphMiniMapCanvasRef, setFlamegraphMiniMapCanvasRef] =\n    useState<HTMLCanvasElement | null>(null);\n  const [flamegraphMiniMapOverlayCanvasRef, setFlamegraphMiniMapOverlayCanvasRef] =\n    useState<HTMLCanvasElement | null>(null);\n\n  const canvasPoolManager = useMemo(() => new CanvasPoolManager(), []);\n\n  const scheduler = useMemo(() => new CanvasScheduler(), []);\n\n  const flamegraph = useMemo(() => {\n    if (typeof threadId !== 'number') {\n      return FlamegraphModel.Empty();\n    }\n\n    // This could happen if threadId was initialized from query string, but for some\n    // reason the profile was removed from the list of profiles.\n    const profile = props.profiles.profiles.find(p => p.threadId === threadId);\n    if (!profile) {\n      return FlamegraphModel.Empty();\n    }\n\n    return new FlamegraphModel(profile, threadId, {\n      inverted: view === 'bottom up',\n      leftHeavy: sorting === 'left heavy',\n      configSpace:\n        xAxis === 'transaction'\n          ? getTransactionConfigSpace(props.profiles.profiles)\n          : undefined,\n    });\n  }, [props.profiles, sorting, threadId, view, xAxis]);\n\n  const flamegraphCanvas = useMemo(() => {\n    if (!flamegraphCanvasRef) {\n      return null;\n    }\n    return new FlamegraphCanvas(\n      flamegraphCanvasRef,\n      vec2.fromValues(0, flamegraphTheme.SIZES.TIMELINE_HEIGHT * devicePixelRatio)\n    );\n  }, [devicePixelRatio, flamegraphCanvasRef, flamegraphTheme]);\n\n  const flamegraphMiniMapCanvas = useMemo(() => {\n    if (!flamegraphMiniMapCanvasRef) {\n      return null;\n    }\n    return new FlamegraphCanvas(flamegraphMiniMapCanvasRef, vec2.fromValues(0, 0));\n  }, [flamegraphMiniMapCanvasRef]);\n\n  const flamegraphView = useMemoWithPrevious<FlamegraphView | null>(\n    previousView => {\n      if (!flamegraphCanvas) {\n        return null;\n      }\n\n      const newView = new FlamegraphView({\n        canvas: flamegraphCanvas,\n        flamegraph,\n        theme: flamegraphTheme,\n      });\n\n      // if the profile we're rendering as a flamegraph has changed, we do not\n      // want to persist the config view\n      if (previousView?.flamegraph.profile === newView.flamegraph.profile) {\n        // if we're still looking at the same profile but only a preference other than\n        // left heavy has changed, we do want to persist the config view\n        if (previousView.flamegraph.leftHeavy === newView.flamegraph.leftHeavy) {\n          newView.setConfigView(\n            previousView.configView.withHeight(newView.configView.height)\n          );\n        }\n      }\n\n      return newView;\n    },\n    [flamegraph, flamegraphCanvas, flamegraphTheme]\n  );\n\n  useEffect(() => {\n    if (!flamegraphCanvas || !flamegraphView) {\n      return undefined;\n    }\n\n    const onConfigViewChange = (rect: Rect) => {\n      flamegraphView.setConfigView(rect);\n      canvasPoolManager.draw();\n    };\n\n    const onTransformConfigView = (mat: mat3) => {\n      flamegraphView.transformConfigView(mat);\n      canvasPoolManager.draw();\n    };\n\n    const onResetZoom = () => {\n      flamegraphView.resetConfigView(flamegraphCanvas);\n      canvasPoolManager.draw();\n    };\n\n    const onZoomIntoFrame = (frame: FlamegraphFrame) => {\n      flamegraphView.setConfigView(\n        new Rect(\n          frame.start,\n          frame.depth,\n          frame.end - frame.start,\n          flamegraphView.configView.height\n        )\n      );\n\n      canvasPoolManager.draw();\n    };\n\n    scheduler.on('setConfigView', onConfigViewChange);\n    scheduler.on('transformConfigView', onTransformConfigView);\n    scheduler.on('resetZoom', onResetZoom);\n    scheduler.on('zoomIntoFrame', onZoomIntoFrame);\n\n    return () => {\n      scheduler.off('setConfigView', onConfigViewChange);\n      scheduler.off('transformConfigView', onTransformConfigView);\n      scheduler.off('resetZoom', onResetZoom);\n      scheduler.off('zoomIntoFrame', onZoomIntoFrame);\n    };\n  }, [canvasPoolManager, flamegraphCanvas, flamegraphView, scheduler]);\n\n  useEffect(() => {\n    canvasPoolManager.registerScheduler(scheduler);\n    return () => canvasPoolManager.unregisterScheduler(scheduler);\n  }, [canvasPoolManager, scheduler]);\n\n  useLayoutEffect(() => {\n    if (\n      !flamegraphView ||\n      !flamegraphCanvas ||\n      !flamegraphMiniMapCanvas ||\n      !flamegraphCanvasRef ||\n      !flamegraphOverlayCanvasRef ||\n      !flamegraphMiniMapCanvasRef ||\n      !flamegraphMiniMapOverlayCanvasRef\n    ) {\n      return undefined;\n    }\n\n    const flamegraphObserver = watchForResize(\n      [flamegraphCanvasRef, flamegraphOverlayCanvasRef],\n      () => {\n        const bounds = flamegraphCanvasRef.getBoundingClientRect();\n        canvasBounds.current = new Rect(bounds.x, bounds.y, bounds.width, bounds.height);\n\n        flamegraphCanvas.initPhysicalSpace();\n        flamegraphView.resizeConfigSpace(flamegraphCanvas);\n\n        canvasPoolManager.drawSync();\n      }\n    );\n\n    const flamegraphMiniMapObserver = watchForResize(\n      [flamegraphMiniMapCanvasRef, flamegraphMiniMapOverlayCanvasRef],\n      () => {\n        flamegraphMiniMapCanvas.initPhysicalSpace();\n\n        canvasPoolManager.drawSync();\n      }\n    );\n\n    return () => {\n      flamegraphObserver.disconnect();\n      flamegraphMiniMapObserver.disconnect();\n    };\n  }, [\n    canvasPoolManager,\n    flamegraphCanvas,\n    flamegraphCanvasRef,\n    flamegraphMiniMapCanvas,\n    flamegraphMiniMapCanvasRef,\n    flamegraphMiniMapOverlayCanvasRef,\n    flamegraphOverlayCanvasRef,\n    flamegraphView,\n  ]);\n\n  return (\n    <Fragment>\n      <FlamegraphToolbar>\n        <ThreadMenuSelector\n          profileGroup={props.profiles}\n          threadId={threadId}\n          onThreadIdChange={newThreadId =>\n            dispatchThreadId({type: 'set thread id', payload: newThreadId})\n          }\n        />\n        <FlamegraphViewSelectMenu\n          view={view}\n          sorting={sorting}\n          onSortingChange={s => {\n            dispatch({type: 'set sorting', payload: s});\n          }}\n          onViewChange={v => {\n            dispatch({type: 'set view', payload: v});\n          }}\n        />\n        <FlamegraphSearch\n          flamegraphs={[flamegraph]}\n          canvasPoolManager={canvasPoolManager}\n        />\n        <FlamegraphOptionsMenu canvasPoolManager={canvasPoolManager} />\n      </FlamegraphToolbar>\n\n      <FlamegraphZoomViewMinimapContainer height={flamegraphTheme.SIZES.MINIMAP_HEIGHT}>\n        <FlamegraphZoomViewMinimap\n          canvasPoolManager={canvasPoolManager}\n          flamegraph={flamegraph}\n          flamegraphMiniMapCanvas={flamegraphMiniMapCanvas}\n          flamegraphMiniMapCanvasRef={flamegraphMiniMapCanvasRef}\n          flamegraphMiniMapOverlayCanvasRef={flamegraphMiniMapOverlayCanvasRef}\n          flamegraphMiniMapView={flamegraphView}\n          setFlamegraphMiniMapCanvasRef={setFlamegraphMiniMapCanvasRef}\n          setFlamegraphMiniMapOverlayCanvasRef={setFlamegraphMiniMapOverlayCanvasRef}\n        />\n      </FlamegraphZoomViewMinimapContainer>\n      <FlamegraphZoomViewContainer>\n        <ProfileDragDropImport onImport={props.onImport}>\n          <FlamegraphZoomView\n            canvasBounds={canvasBounds.current}\n            canvasPoolManager={canvasPoolManager}\n            flamegraph={flamegraph}\n            flamegraphCanvas={flamegraphCanvas}\n            flamegraphCanvasRef={flamegraphCanvasRef}\n            flamegraphOverlayCanvasRef={flamegraphOverlayCanvasRef}\n            flamegraphView={flamegraphView}\n            setFlamegraphCanvasRef={setFlamegraphCanvasRef}\n            setFlamegraphOverlayCanvasRef={setFlamegraphOverlayCanvasRef}\n          />\n        </ProfileDragDropImport>\n      </FlamegraphZoomViewContainer>\n    </Fragment>\n  );\n}\n\nconst FlamegraphZoomViewMinimapContainer = styled('div')<{\n  height: FlamegraphTheme['SIZES']['MINIMAP_HEIGHT'];\n}>`\n  position: relative;\n  height: ${p => p.height}px;\n  flex-shrink: 0;\n`;\n\nconst FlamegraphZoomViewContainer = styled('div')`\n  position: relative;\n  display: flex;\n  flex: 1 1 100%;\n`;\n\nexport {Flamegraph};\n","import {useCallback, useLayoutEffect, useState} from 'react';\n\n/**\n * Hook to retrieve dpr value of the device and monitor for changes\n * (e.g. if user drags window to a screen with different dpr, we want to be notified).\n * @returns dpr of the device\n */\nfunction useDevicePixelRatio(): number {\n  const [devicePixelRatio, setDevicePixelRatio] = useState<number>(\n    window.devicePixelRatio\n  );\n\n  const updateDevicePixelRatio = useCallback(() => {\n    setDevicePixelRatio(window.devicePixelRatio);\n  }, []);\n\n  useLayoutEffect(() => {\n    window\n      .matchMedia(`(resolution: ${devicePixelRatio}dppx)`)\n      .addEventListener('change', updateDevicePixelRatio, {once: true});\n\n    return () => {\n      window\n        .matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`)\n        .removeEventListener('change', updateDevicePixelRatio);\n    };\n  }, [devicePixelRatio, updateDevicePixelRatio]);\n\n  return devicePixelRatio;\n}\n\nexport {useDevicePixelRatio};\n","import {useState} from 'react';\n\nimport {useEffectAfterFirstRender} from './useEffectAfterFirstRender';\nimport usePrevious from './usePrevious';\n\nconst useMemoWithPrevious = <T>(\n  factory: (previousInstance: T | null) => T,\n  deps: React.DependencyList\n): T => {\n  const [value, setValue] = useState<T>(() => factory(null));\n  const previous = usePrevious<T | null>(value);\n\n  useEffectAfterFirstRender(() => {\n    setValue(factory(previous));\n  }, deps);\n\n  return value;\n};\n\nexport {useMemoWithPrevious};\n","import {Fragment, useMemo} from 'react';\nimport styled from '@emotion/styled';\n\nimport Alert from 'sentry/components/alert';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {Flamegraph} from 'sentry/components/profiling/flamegraph';\nimport {ProfileDragDropImportProps} from 'sentry/components/profiling/profileDragDropImport';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\nimport {t} from 'sentry/locale';\nimport {DeepPartial} from 'sentry/types/utils';\nimport {\n  decodeFlamegraphStateFromQueryParams,\n  FlamegraphState,\n  FlamegraphStateProvider,\n  FlamegraphStateQueryParamSync,\n} from 'sentry/utils/profiling/flamegraph/flamegraphStateProvider/index';\nimport {FlamegraphThemeProvider} from 'sentry/utils/profiling/flamegraph/flamegraphThemeProvider';\nimport {ProfileGroup} from 'sentry/utils/profiling/profile/importProfile';\nimport {Profile} from 'sentry/utils/profiling/profile/profile';\nimport {useLocation} from 'sentry/utils/useLocation';\nimport useOrganization from 'sentry/utils/useOrganization';\n\nimport {useProfileGroup} from './profileGroupProvider';\n\nconst LoadingGroup: ProfileGroup = {\n  name: 'Loading',\n  traceID: '',\n  activeProfileIndex: 0,\n  profiles: [Profile.Empty()],\n};\n\nfunction ProfileFlamegraph(): React.ReactElement {\n  const location = useLocation();\n  const organization = useOrganization();\n  const [profileGroup, setProfileGroup] = useProfileGroup();\n\n  const onImport: ProfileDragDropImportProps['onImport'] = profiles => {\n    setProfileGroup({type: 'resolved', data: profiles});\n  };\n\n  const initialFlamegraphPreferencesState = useMemo((): DeepPartial<FlamegraphState> => {\n    return decodeFlamegraphStateFromQueryParams(location.query);\n    // We only want to decode this when our component mounts\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <Fragment>\n      <SentryDocumentTitle\n        title={t('Profiling \\u2014 Flamegraph')}\n        orgSlug={organization.slug}\n      >\n        <FlamegraphStateProvider initialState={initialFlamegraphPreferencesState}>\n          <FlamegraphThemeProvider>\n            <FlamegraphStateQueryParamSync />\n            <FlamegraphContainer>\n              {profileGroup.type === 'errored' ? (\n                <Alert type=\"error\" showIcon>\n                  {profileGroup.error}\n                </Alert>\n              ) : profileGroup.type === 'loading' ? (\n                <Fragment>\n                  <Flamegraph onImport={onImport} profiles={LoadingGroup} />\n                  <LoadingIndicatorContainer>\n                    <LoadingIndicator />\n                  </LoadingIndicatorContainer>\n                </Fragment>\n              ) : profileGroup.type === 'resolved' ? (\n                <Flamegraph onImport={onImport} profiles={profileGroup.data} />\n              ) : null}\n            </FlamegraphContainer>\n          </FlamegraphThemeProvider>\n        </FlamegraphStateProvider>\n      </SentryDocumentTitle>\n    </Fragment>\n  );\n}\n\nconst LoadingIndicatorContainer = styled('div')`\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n`;\n\nconst FlamegraphContainer = styled('div')`\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 100%;\n\n  /*\n   * The footer component is a sibling of this div.\n   * Remove it so the flamegraph can take up the\n   * entire screen.\n   */\n  ~ footer {\n    display: none;\n  }\n`;\n\nexport default ProfileFlamegraph;\n"],"names":["durationMappings","nanoseconds","microseconds","milliseconds","seconds","format","v","abbrev","precision","toFixed","makeFormatter","from","multiplier","undefined","Error","value","duration","pad","n","slots","Math","floor","toString","padStart","makeTimelineFormatter","s","ms","NOOP","useEffectAfterFirstRender","cb","deps","firstRender","useRef","useEffect","current","ref","makeStackToColor","fallback","frames","colorMap","colorBucket","colors","length","colorBuffer","Array","index","c","get","key","colorWithAlpha","concat","i","offset","isNumber","input","isNaN","clamp","number","min","max","defaultFrameSortKey","frame","name","file","defaultFrameSort","a","b","makeColorBucketTheme","lch","t","x","abs","fract","triangle","H","C","C_0","C_d","L","hPrime","X","R1","G1","B1","m","fromLumaChromaHue","L_0","L_d","makeColorMap","sortBy","Map","sortedFrames","sort","set","makeColorMapByRecursion","localeCompare","filter","f","node","isRecursive","colorsByName","nameKey","has","color","makeColorMapByImage","reverseFrameToImageIndex","arr","predicate","reduce","map","item","values","uniqueBy","image","push","imageFrames","j","makeColorMapBySystemVsApplication","is_application","createShader","gl","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","deleteShader","canvasToDisplaySizeMap","watchForResize","canvas","callback","width","height","resizeObserver","ResizeObserver","entries","entry","dpr","window","devicePixelRatio","devicePixelContentBoxSize","inlineSize","blockSize","contentBoxSize","contentRect","displayWidth","round","displayHeight","target","resizeCanvasToDisplaySize","onResize","forEach","observe","box","ex","size","clientWidth","clientHeight","needResize","Transform","to","mat3","y","Rect","constructor","this","origin","vec2","clone","From","isValid","toMatrix","every","isEmpty","rect","left","right","top","bottom","query","maybeEncodedRect","split","isArray","p","parseFloat","join","w","h","hasIntersectionWith","other","containsX","vec","containsY","contains","containsRect","overlapsX","overlapsY","overlaps","transformRect","transform","invertYTransform","withHeight","withWidth","withX","withY","toBounds","toArray","between","translate","translateX","translateY","scaleX","scaleY","scale","scaleOriginBy","scaledBy","equals","notEqualTo","getContext","context","ctx","antialias","measureText","string","Empty","measures","document","createElement","actualBoundingBoxAscent","actualBoundingBoxDescent","findRangeBinarySearch","fn","low","high","mid","formatColorForFrame","renderer","getColorForFrame","slice","trimTextCenter","text","prefixLength","postfixLength","substring","useDispatchFlamegraphState","useContext","FlamegraphStateContext","isSorting","includes","isView","isXAxis","encodeFlamegraphStateToQueryParams","state","colorCoding","preferences","sorting","view","xAxis","search","position","fov","encode","profiles","threadId","tid","combinedReducers","reducers","keys","Object","action","nextState","makeCombinedReducers","selectedNode","payload","results","FlamegraphStateQueryParamSync","location","useLocation","useFlamegraphStateValue","browserHistory","createContext","DEFAULT_FLAMEGRAPH_STATE","FlamegraphStateProvider","props","profileGroup","useProfileGroup","reducer","initialState","dispatch","useReducer","isUndoOrRedoAction","previous","next","undoableReducer","newState","makeUndoableReducer","previousState","useUndoableReducer","data","activeProfileIndex","threadID","Provider","children","useFlamegraphPreferences","FlamegraphOptionsMenu","canvasPoolManager","Fragment","onClick","triggerLabel","triggerProps","icon","placement","sections","label","defaultValue","options","X_AXIS","onChange","COLOR_CODINGS","standalone","transaction","REG_EXP","memoizedSortFrameResults","memoizeByReference","start","numericSort","depth","frameSearch","trim","test","_","lookup","flags","match","parseRegExp","matches","RegExp","String","e","Sentry","message","fuseResults","direction","FlamegraphSearch","flamegraphs","dispatchSearch","useFlamegraphSearch","allFrames","useMemo","acc","graph","searchIndex","Fuse","threshold","includeMatches","onZoomIntoFrame","useCallback","handleChange","onNextSearchClick","onPreviousSearchClick","handleKeyDown","evt","preventDefault","StyledSearchBar","placeholder","onKeyDown","SearchBar","FlamegraphToolbar","space","FlamegraphViewSelectMenu","onViewChange","onSortingChange","merged","active","barId","MONOSPACE_FONT","FRAME_FONT","lightTheme","LightFlamegraphTheme","CONFIG","HIGHLIGHT_RECURSION","SIZES","BAR_HEIGHT","BAR_FONT_SIZE","BAR_PADDING","FLAMEGRAPH_DEPTH_OFFSET","SPANS_DEPTH_OFFSET","SPANS_FONT_SIZE","SPANS_BAR_HEIGHT","REQUEST_TAIL_HEIGHT","REQUEST_BAR_HEIGHT","REQUEST_FONT_SIZE","REQUEST_DEPTH_OFFSET","MINIMAP_POSITION_OVERLAY_BORDER_WIDTH","MINIMAP_HEIGHT","TIMELINE_HEIGHT","LABEL_FONT_SIZE","LABEL_FONT_PADDING","FRAME_BORDER_WIDTH","HOVERED_FRAME_BORDER_WIDTH","TOOLTIP_FONT_SIZE","GRID_LINE_WIDTH","COLORS","LABEL_FONT_COLOR","BAR_LABEL_FONT_COLOR","GRID_LINE_COLOR","GRID_FRAME_BACKGROUND_COLOR","SEARCH_RESULT_FRAME_COLOR","SELECTED_FRAME_BORDER_COLOR","HOVERED_FRAME_BORDER_COLOR","CURSOR_CROSSHAIR","SPAN_FRAME_BORDER","SPAN_FRAME_BACKGROUND","MINIMAP_POSITION_OVERLAY_COLOR","MINIMAP_POSITION_OVERLAY_BORDER_COLOR","REQUEST_WAIT_TIME","REQUEST_DNS_TIME","REQUEST_TCP_TIME","REQUEST_SSL_TIME","REQUEST_2XX_RESPONSE","REQUEST_4XX_RESPONSE","DIFFERENTIAL_INCREASE","DIFFERENTIAL_DECREASE","COLOR_BUCKET","COLOR_MAP","STACK_TO_COLOR","FRAME_FALLBACK_COLOR","FONTS","FONT","DarkFlamegraphTheme","FlamegraphThemeContext","FlamegraphThemeProvider","theme","useLegacyStore","ConfigStore","flamegraphPreferences","useFlamegraphPreferencesValue","activeFlamegraphTheme","base","TypeError","useFlamegraphTheme","useContextMenu","container","open","setOpen","useState","menuCoordinates","setMenuCoordinates","contextMenuCoordinates","setContextMenuCoordinates","containerCoordinates","setContainerCoordinates","itemProps","menuRef","setMenuRef","items","tabIndex","setTabIndex","shiftKey","useRovingTabIndex","focus","getItemProps","idx","id","onMouseEnter","getMenuProps","useKeyboardNavigation","wrapSetOpen","newOpen","menuProps","getMenuItemProps","menuItemProps","handleContextMenu","stopPropagation","parentPosition","getBoundingClientRect","clientX","clientY","listener","event","addEventListener","removeEventListener","disconnect","mouse","maxY","minY","minX","maxX","computeBestContextMenuPosition","VirtualizedTreeNode","parent","expanded","getVisibleChildrenCount","count","queue","pop","setExpanded","opts","removedCount","list","visit","expandChildren","VirtualizedTree","roots","flattenedList","flattened","toExpandedList","skipFn","expandedNodes","toTreeNode","collection","treeNode","nodes","expandNode","removedOrAddedNodes","splice","indexOf","sortFn","sortedChildren","sortedRoots","getAllExpandedNodes","previouslyExpandedNodes","Set","add","VirtualizedTreeStateReducer","tabIndexKey","scrollTop","scrollHeight","hideGhostRow","style","opacity","updateGhostRow","rowHeight","interaction","backgroundColor","pointerEvents","willChange","findCarryOverIndex","previousNode","newTree","newIndex","findIndex","useVirtualizedTree","clickedGhostRowRef","hoveredGhostRowRef","previousHoveredRow","overscroll","scrollContainer","latestStateRef","tree","setTree","initialTree","fromRoots","skipFunction","sortFunction","cleanupAllHoveredRows","row","latestItemsRef","dataset","hovered","expandedHistory","OVERSCROLL_HEIGHT","visibleItems","viewport","visibleItemIndex","indexPointer","findOptimisticStartIndex","MAX_VISIBLE_ITEMS","ceil","ALL_ITEMS","elementTop","elementBottom","styles","findVisibleItems","scrollEndTimeoutId","handleScroll","firstChild","cancelAnimationFrame","delay","Promise","resolve","then","Date","now","timeout","requestAnimationFrame","requestAnimationTimeout","passive","handleClick","handleMouseMove","element","find","onMouseLeave","handleExpandTreeNode","handleSortingChange","handleRowClick","_evt","handleRowKeyDown","indexInVisibleItems","nextIndex","preventScroll","scrollIntoView","block","handleRowMouseEnter","currentTarget","rafId","elements","scrollContainerStyles","overflow","containerStyles","maxHeight","renderRow","renderedItems","renderered","Menu","forwardRef","role","fontSizeMedium","zIndex","dropdown","backgroundElevated","border","borderRadius","dropShadowHeavy","MenuContentContainer","hover","textColor","MenuItemCheckboxLabel","MenuItemCheckbox","checked","rest","MenuContentOuterContainer","MenuLeadingItem","Input","MenuContent","MenuItem","MenuGroup","MenuHeading","subText","Layer","FrameStackContextMenu","contextMenu","onZoomIntoNodeClick","computeRelativeWeight","FrameStackTableRow","flamegraphRenderer","referenceNode","onExpandClick","onContextMenu","isSelected","colorString","handleExpanding","metaKey","FrameCallersRow","FrameCallersTableCell","textAlign","flamegraph","formatter","selfWeight","Weight","weight","totalWeight","noPadding","FrameWeightTypeContainer","FrameWeightContainer","FrameTypeIndicator","paddingLeft","FrameNameContainer","FrameColorIndicator","FrameChildrenIndicator","FrameName","BackgroundWeightBar","white","yellow100","yellow200","makeSortFunction","property","skipRecursiveNodes","isDirectRecursive","FrameStackTable","recursion","scrollContainerRef","setScrollContainerRef","setSort","setDirection","clickedContextMenuNode","setClickedContextMenuClose","handleZoomIntoNodeClick","r","onSortChange","newSort","newDirection","FrameBar","FrameCallersTable","FrameCallersTableHeader","FrameWeightCell","TableHeaderButton","FrameNameCell","background","GhostRowContainer","surface400","surface100","fontSizeSmall","FrameStack","useFlamegraphProfilesValue","tab","setTab","treeType","setTreeType","setRecursion","maybeFilteredRoots","stack","nodesToKeep","root","cpy","filterFlamegraphTree","invertCallTree","handleRecursionChange","onBottomUpClick","onCallOrderClick","onAllApplicationsClick","onApplicationsClick","onSystemsClick","onMouseDown","rafIdRef","startResizeVectorRef","drawerHeight","setDrawerHeight","initialHeight","onMouseMove","mvEvent","currentPositionVector","distance","minHeight","onMouseUp","useVerticallyResizableDrawer","FrameDrawer","FrameTabs","className","priority","Separator","FrameDrawerLabel","flex","cursor","prop","blue300","CanvasScheduler","transformConfigView","zoomIntoFrame","resetZoom","setConfigView","onDispose","onDisposeCallbacks","on","eventName","events","off","delete","args","handler","registerCallback","pool","unregisterCallback","registerBeforeFrameCallback","beforeFrameCallbacks","unregisterBeforeFrameCallback","registerAfterFrameCallback","afterFrameCallbacks","unregisterAfterFrameCallback","dispose","clear","drawSync","draw","CanvasPoolManager","registerScheduler","scheduler","schedulers","unregisterScheduler","FlamegraphRenderer","draw_border","a_position","a_color","a_bounds","u_border_width","u_draw_border","u_is_search_result","u_model","u_projection","init","VERTICES","initCanvasContext","initVertices","initShaders","bounds","positions","x1","x2","end","y1","y2","positionOffset","boundsOffset","enable","BLEND","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","uniforms","attributes","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","fragment","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","deleteProgram","uProjectionMatrix","getUniformLocation","uModelMatrix","uIsSearchResult","uBorderWidth","uDrawBorder","aColorAttributeLocation","getAttribLocation","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","FLOAT","normalize","stride","vertexAttribPointer","enableVertexAttribArray","aPositionAttributeLocation","positionBuffer","aBoundsAttributeLocation","boundsBuffer","useProgram","getHoveredNode","configSpaceCursor","hoveredNode","findHoveredNode","frameRect","configViewToPhysicalSpace","searchResults","clearColor","COLOR_BUFFER_BIT","projectionMatrix","makeProjectionMatrix","uniformMatrix3fv","uniform1i","physicalSpacePixel","physicalToConfig","configSpacePixel","uniform2f","vertexOffset","drawArrays","TRIANGLES","GridRenderer","configViewSpace","physicalViewRect","logicalSpaceToConfigView","font","textBaseline","fillStyle","fillRect","LINE_WIDTH","intervals","configView","targetInterval","vector","getIntervalTimeAtX","interval","pow","log10","computeInterval","physicalIntervalPosition","labelText","fillText","strokeStyle","lineWidth","strokeRect","SelectedFrameRenderer","frameInPhysicalSpace","borderRect","BORDER_WIDTH","beginPath","BORDER_COLOR","TextRenderer","measureAndCacheText","textCache","maybeInvalidateCache","TEST_STRING","newMeasuredSize","minWidth","SIDE_PADDING","HALF_SIDE_PADDING","BASELINE_OFFSET","pinnedStart","pinnedEnd","frameWidth","frameHeight","paddedRectangleWidth","BoundTooltip","flamegraphCanvas","flamegraphView","tooltipRef","flamegraphTheme","physicalSpaceCursor","fromConfigView","physicalSpace","computeBestTooltipPlacement","physicalToLogicalSpace","Tooltip","fontSize","fontFamily","maxWidth","FLAMEGRAPH_COLOR_CODINGS","FLAMEGRAPH_VIEW_OPTIONS","FLAMEGRAPH_SORTING_OPTIONS","FLAMEGRAPH_AXIS_OPTIONS","FlamegraphOptionsContextMenu","coding","axis","formatWeightToProfileDuration","profile","FlamegraphZoomView","canvasBounds","flamegraphCanvasRef","flamegraphOverlayCanvasRef","setFlamegraphCanvasRef","setFlamegraphOverlayCanvasRef","lastInteraction","setLastInteraction","flamegraphState","dispatchFlamegraphState","useFlamegraphState","startPanVector","setStartPanVector","setConfigSpaceCursor","textRenderer","gridRenderer","selectedFrameRenderer","previousPosition","nextPosition","previousInteraction","usePrevious","beforeInteractionConfigView","drawRectangles","clearOverlayCanvas","clearRect","drawSelectedFrameBorder","drawText","drawGrid","toConfigView","logicalSpace","onResetZoom","onCanvasMouseDown","logicalMousePos","nativeEvent","offsetX","offsetY","physicalMousePos","onCanvasMouseUp","onMouseDrag","physicalDelta","m00","m01","m02","m10","m11","m12","configDelta","onCanvasMouseMove","configSpaceMouse","getConfigViewCursor","onCanvasMouseLeave","zoom","identity","deltaY","mouseInConfigView","configCenter","invertedConfigCenter","translated","scaled","translatedBack","scroll","deltaX","wheelStopTimeoutId","onCanvasWheel","clearTimeout","setTimeout","CanvasContainer","Canvas","HoveredFrameMainInfo","HoveredFrameTimelineInfo","timelineFormatter","PositionIndicatorRenderer","configSpace","configSpaceToPhysicalSpace","physicalConfigViewRect","physicalConfigRect","offsetRectForBorderWidth","fill","FlamegraphZoomViewMinimap","flamegraphMiniMapCanvas","flamegraphMiniMapCanvasRef","flamegraphMiniMapOverlayCanvasRef","flamegraphMiniMapView","setFlamegraphMiniMapCanvasRef","setFlamegraphMiniMapOverlayCanvasRef","flamegraphMiniMapRenderer","positionIndicatorRenderer","fromConfigSpace","drawPosition","startDragVector","setStartDragConfigSpaceCursor","lastDragVector","setLastDragVector","onMinimapCanvasMouseMove","getConfigSpaceCursor","onMinimapScroll","onMinimapZoom","mouseInConfigSpace","onMinimapCanvasMouseDown","startConfigSpaceCursor","onMinimapCanvasMouseUp","OverlayCanvas","ProfileDragDropImport","onImport","dropState","setDropState","errorMessage","setErrorMessage","onDrop","dataTransfer","getAsFile","importDroppedProfile","catch","onDragEnter","onDragLeave","onDragOver","DragDropContainer","Overlay","modal","ThreadMenuSelector","onThreadIdChange","compareProfiles","details","ThreadLabelDetails","unit","samples","opt","defined","isSearchable","DetailsContainer","tn","startsWith","Flamegraph","Profile","inverted","leftHeavy","profileIndex","buildLeftHeavyGraph","buildCallOrderGraph","startedAt","lastOfArray","stackTop","unshift","sortTree","appendOrderTree","openFrame","closeFrame","_node","isRoot","childTime","child","setConfigSpace","FlamegraphCanvas","initPhysicalSpace","logicalToPhysicalSpace","FlamegraphView","initConfigSpace","_initConfigSpace","_initConfigView","resizeConfigSpace","resetConfigView","newConfigView","clampedWidth","clampedHeight","clampedX","clampedY","computeClampedConfigView","minFrameDuration","transformation","toConfigSpace","logicalSpaceCursor","getTransactionConfigSpace","endedAt","setDevicePixelRatio","updateDevicePixelRatio","useLayoutEffect","matchMedia","once","useDevicePixelRatio","dispatchThreadId","useFlamegraphProfiles","FlamegraphModel","factory","setValue","useMemoWithPrevious","previousView","newView","onConfigViewChange","onTransformConfigView","mat","flamegraphObserver","flamegraphMiniMapObserver","newThreadId","FlamegraphZoomViewMinimapContainer","FlamegraphZoomViewContainer","LoadingGroup","traceID","ProfileFlamegraph","organization","useOrganization","setProfileGroup","initialFlamegraphPreferencesState","parseInt","decode","title","orgSlug","slug","FlamegraphContainer","showIcon","error","LoadingIndicatorContainer"],"sourceRoot":""}